var e=Object.defineProperty,t=(t,n,i)=>(((t,n,i)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i})(t,"symbol"!=typeof n?n+"":n,i),i);import{r as n,b as i}from"./runtime.f8a9df05.js";import{r}from"./runtime-dom.270610a4.js";import{_ as s,a,j as o,h as l,p as c,b as u,F as d,s as h,T as p,t as f,c as m,d as g,e as b,r as y,f as v,g as T,i as x,k as _}from"./ui.db83a881.js";import{c as S,g as w,l as I,a as k}from"./lodash.2210f759.js";import{c as C}from"./classnames.f9d2a9c9.js";import{h as E}from"./moment.40bc58bf.js";function A(e,t){for(var n=0;n<t.length;n++){const i=t[n];if("string"!=typeof i&&!Array.isArray(i))for(const t in i)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(i,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>i[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var R={},N=r.exports;R.createRoot=N.createRoot,R.hydrateRoot=N.hydrateRoot;var P={exports:{}},D={},O=n.exports;var L="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},M=O.useState,F=O.useEffect,$=O.useLayoutEffect,B=O.useDebugValue;function z(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!L(e,n)}catch(i){return!0}}var U="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=M({inst:{value:n,getSnapshot:t}}),r=i[0].inst,s=i[1];return $(function(){r.value=n,r.getSnapshot=t,z(r)&&s({inst:r})},[e,n,t]),F(function(){return z(r)&&s({inst:r}),e(function(){z(r)&&s({inst:r})})},[e]),B(n),n};D.useSyncExternalStore=void 0!==O.useSyncExternalStore?O.useSyncExternalStore:U,P.exports=D;var G={},V=n.exports,H=P.exports;var W="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},j=H.useSyncExternalStore,q=V.useRef,X=V.useEffect,K=V.useMemo,Y=V.useDebugValue;G.useSyncExternalStoreWithSelector=function(e,t,n,i,r){var s=q(null);if(null===s.current){var a={hasValue:!1,value:null};s.current=a}else a=s.current;s=K(function(){function e(e){if(!l){if(l=!0,s=e,e=i(e),void 0!==r&&a.hasValue){var t=a.value;if(r(t,e))return o=t}return o=e}if(t=o,W(s,e))return t;var n=i(e);return void 0!==r&&r(t,n)?(s=e,t):(s=e,o=n)}var s,o,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,i,r]);var o=j(e,s[0],s[1]);return X(function(){a.hasValue=!0,a.value=o},[o]),Y(o),o};let Z=function(e){e()};const Q=Symbol.for("react-redux-context"),J="undefined"!=typeof globalThis?globalThis:{};function ee(){var e;if(!n.exports.createContext)return{};const t=null!=(e=J[Q])?e:J[Q]=new Map;let i=t.get(n.exports.createContext);return i||(i=n.exports.createContext(null),t.set(n.exports.createContext,i)),i}const te=ee();var ne,ie={exports:{}},re={},se=Symbol.for("react.element"),ae=Symbol.for("react.portal"),oe=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),ce=Symbol.for("react.profiler"),ue=Symbol.for("react.provider"),de=Symbol.for("react.context"),he=Symbol.for("react.server_context"),pe=Symbol.for("react.forward_ref"),fe=Symbol.for("react.suspense"),me=Symbol.for("react.suspense_list"),ge=Symbol.for("react.memo"),be=Symbol.for("react.lazy"),ye=Symbol.for("react.offscreen");function ve(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case se:switch(e=e.type){case oe:case ce:case le:case fe:case me:return e;default:switch(e=e&&e.$$typeof){case he:case de:case pe:case be:case ge:case ue:return e;default:return t}}case ae:return t}}}ne=Symbol.for("react.module.reference"),re.ContextConsumer=de,re.ContextProvider=ue,re.Element=se,re.ForwardRef=pe,re.Fragment=oe,re.Lazy=be,re.Memo=ge,re.Portal=ae,re.Profiler=ce,re.StrictMode=le,re.Suspense=fe,re.SuspenseList=me,re.isAsyncMode=function(){return!1},re.isConcurrentMode=function(){return!1},re.isContextConsumer=function(e){return ve(e)===de},re.isContextProvider=function(e){return ve(e)===ue},re.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===se},re.isForwardRef=function(e){return ve(e)===pe},re.isFragment=function(e){return ve(e)===oe},re.isLazy=function(e){return ve(e)===be},re.isMemo=function(e){return ve(e)===ge},re.isPortal=function(e){return ve(e)===ae},re.isProfiler=function(e){return ve(e)===ce},re.isStrictMode=function(e){return ve(e)===le},re.isSuspense=function(e){return ve(e)===fe},re.isSuspenseList=function(e){return ve(e)===me},re.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===oe||e===ce||e===le||e===fe||e===me||e===ye||"object"==typeof e&&null!==e&&(e.$$typeof===be||e.$$typeof===ge||e.$$typeof===ue||e.$$typeof===de||e.$$typeof===pe||e.$$typeof===ne||void 0!==e.getModuleId)},re.typeOf=ve,ie.exports=re;const Te=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function xe(e,t,n,i,{areStatesEqual:r,areOwnPropsEqual:s,areStatePropsEqual:a}){let o,l,c,u,d,h=!1;function p(h,p){const f=!s(p,l),m=!r(h,o,p,l);return o=h,l=p,f&&m?(c=e(o,l),t.dependsOnOwnProps&&(u=t(i,l)),d=n(c,u,l),d):f?(e.dependsOnOwnProps&&(c=e(o,l)),t.dependsOnOwnProps&&(u=t(i,l)),d=n(c,u,l),d):m?function(){const t=e(o,l),i=!a(t,c);return c=t,i&&(d=n(c,u,l)),d}():d}return function(r,s){return h?p(r,s):(o=r,l=s,c=e(o,l),u=t(i,l),d=n(c,u,l),h=!0,d)}}function _e(e){return function(t){const n=e(t);function i(){return n}return i.dependsOnOwnProps=!1,i}}function Se(e){return e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function we(e,t){return function(t,{displayName:n}){const i=function(e,t){return i.dependsOnOwnProps?i.mapToProps(e,t):i.mapToProps(e,void 0)};return i.dependsOnOwnProps=!0,i.mapToProps=function(t,n){i.mapToProps=e,i.dependsOnOwnProps=Se(e);let r=i(t,n);return"function"==typeof r&&(i.mapToProps=r,i.dependsOnOwnProps=Se(r),r=i(t,n)),r},i}}function Ie(e,t){return(n,i)=>{throw new Error(`Invalid value of type ${typeof e} for ${t} argument when connecting component ${i.wrappedComponentName}.`)}}function ke(e,t,n){return a({},n,e,t)}function Ce(){const e=Z;let t=null,n=null;return{clear(){t=null,n=null},notify(){e(()=>{let e=t;for(;e;)e.callback(),e=e.next})},get(){let e=[],n=t;for(;n;)e.push(n),n=n.next;return e},subscribe(e){let i=!0,r=n={callback:e,next:null,prev:n};return r.prev?r.prev.next=r:t=r,function(){i&&null!==t&&(i=!1,r.next?r.next.prev=r.prev:n=r.prev,r.prev?r.prev.next=r.next:t=r.next)}}}}const Ee={notify(){},get:()=>[]};function Ae(e,t){let n,i=Ee,r=0,s=!1;function a(){c.onStateChange&&c.onStateChange()}function o(){r++,n||(n=t?t.addNestedSub(a):e.subscribe(a),i=Ce())}function l(){r--,n&&0===r&&(n(),n=void 0,i.clear(),i=Ee)}const c={addNestedSub:function(e){o();const t=i.subscribe(e);let n=!1;return()=>{n||(n=!0,t(),l())}},notifyNestedSubs:function(){i.notify()},handleChangeWrapper:a,isSubscribed:function(){return s},trySubscribe:function(){s||(s=!0,o())},tryUnsubscribe:function(){s&&(s=!1,l())},getListeners:()=>i};return c}const Re=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?n.exports.useLayoutEffect:n.exports.useEffect;function Ne(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function Pe(e,t){if(Ne(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Ne(e[n[r]],t[n[r]]))return!1;return!0}const De=["reactReduxForwardedRef"];let Oe=()=>{throw new Error("uSES not initialized!")};const Le=[null,null];function Me(e,t,n,i,r,s){e.current=i,n.current=!1,r.current&&(r.current=null,s())}function Fe(e,t){return e===t}function $e(e,t,i,{pure:r,areStatesEqual:c=Fe,areOwnPropsEqual:u=Pe,areStatePropsEqual:d=Pe,areMergedPropsEqual:h=Pe,forwardRef:p=!1,context:f=te}={}){const m=f,g=function(e){return e?"function"==typeof e?we(e):Ie(e,"mapStateToProps"):_e(()=>({}))}(e),b=function(e){return e&&"object"==typeof e?_e(t=>function(e,t){const n={};for(const i in e){const r=e[i];"function"==typeof r&&(n[i]=(...e)=>t(r(...e)))}return n}(e,t)):e?"function"==typeof e?we(e):Ie(e,"mapDispatchToProps"):_e(e=>({dispatch:e}))}(t),y=function(e){return e?"function"==typeof e?function(e){return function(t,{displayName:n,areMergedPropsEqual:i}){let r,s=!1;return function(t,n,a){const o=e(t,n,a);return s?i(o,r)||(r=o):(s=!0,r=o),r}}}(e):Ie(e,"mergeProps"):()=>ke}(i),v=Boolean(e);return e=>{const t=e.displayName||e.name||"Component",i=`Connect(${t})`,r={shouldHandleStateChanges:v,displayName:i,wrappedComponentName:t,WrappedComponent:e,initMapStateToProps:g,initMapDispatchToProps:b,initMergeProps:y,areStatesEqual:c,areStatePropsEqual:d,areOwnPropsEqual:u,areMergedPropsEqual:h};function f(t){const[i,l,c]=n.exports.useMemo(()=>{const{reactReduxForwardedRef:e}=t,n=s(t,De);return[t.context,e,n]},[t]),u=n.exports.useMemo(()=>i&&i.Consumer&&ie.exports.isContextConsumer(n.exports.createElement(i.Consumer,null))?i:m,[i,m]),d=n.exports.useContext(u),h=Boolean(t.store)&&Boolean(t.store.getState)&&Boolean(t.store.dispatch),p=Boolean(d)&&Boolean(d.store),f=h?t.store:d.store,g=p?d.getServerState:f.getState,b=n.exports.useMemo(()=>function(e,t){let{initMapStateToProps:n,initMapDispatchToProps:i,initMergeProps:r}=t,a=s(t,Te);return xe(n(e,a),i(e,a),r(e,a),e,a)}(f.dispatch,r),[f]),[y,T]=n.exports.useMemo(()=>{if(!v)return Le;const e=Ae(f,h?void 0:d.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]},[f,h,d]),x=n.exports.useMemo(()=>h?d:a({},d,{subscription:y}),[h,d,y]),_=n.exports.useRef(),S=n.exports.useRef(c),w=n.exports.useRef(),I=n.exports.useRef(!1);n.exports.useRef(!1);const k=n.exports.useRef(!1),C=n.exports.useRef();Re(()=>(k.current=!0,()=>{k.current=!1}),[]);const E=n.exports.useMemo(()=>()=>w.current&&c===S.current?w.current:b(f.getState(),c),[f,c]),A=n.exports.useMemo(()=>e=>y?function(e,t,n,i,r,s,a,o,l,c,u){if(!e)return()=>{};let d=!1,h=null;const p=()=>{if(d||!o.current)return;const e=t.getState();let n,p;try{n=i(e,r.current)}catch(f){p=f,h=f}p||(h=null),n===s.current?a.current||c():(s.current=n,l.current=n,a.current=!0,u())};return n.onStateChange=p,n.trySubscribe(),p(),()=>{if(d=!0,n.tryUnsubscribe(),n.onStateChange=null,h)throw h}}(v,f,y,b,S,_,I,k,w,T,e):()=>{},[y]);var R,N,P;let D;R=Me,N=[S,_,I,c,w,T],Re(()=>R(...N),P);try{D=Oe(A,E,g?()=>b(g(),c):E)}catch(L){throw C.current&&(L.message+=`\nThe error may be correlated with this previous error:\n${C.current.stack}\n\n`),L}Re(()=>{C.current=void 0,w.current=void 0,_.current=D});const O=n.exports.useMemo(()=>o(e,{...D,ref:l}),[l,e,D]);return n.exports.useMemo(()=>v?o(u.Provider,{value:x,children:O}):O,[u,O,x])}const T=n.exports.memo(f);if(T.WrappedComponent=e,T.displayName=f.displayName=i,p){const t=n.exports.forwardRef(function(e,t){return o(T,{...e,reactReduxForwardedRef:t})});return t.displayName=i,t.WrappedComponent=e,l(t,e)}return l(T,e)}}function Be({store:e,context:t,children:i,serverState:r,stabilityCheck:s="once",noopCheck:a="once"}){const l=n.exports.useMemo(()=>{const t=Ae(e);return{store:e,subscription:t,getServerState:r?()=>r:void 0,stabilityCheck:s,noopCheck:a}},[e,r,s,a]),c=n.exports.useMemo(()=>e.getState(),[e]);Re(()=>{const{subscription:t}=l;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),c!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}},[l,c]);return o((t||te).Provider,{value:l,children:i})}var ze,Ue;ze=P.exports.useSyncExternalStore,Oe=ze,Ue=r.exports.unstable_batchedUpdates,Z=Ue;var Ge=(e=>(e.TOP="TOP",e.BOTTOM="BOTTOM",e.LEFT="LEFT",e.RIGHT="RIGHT",e.TOP_RIGHT="TOP_RIGHT",e.TOP_LEFT="TOP_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.CENTER="CENTER",e))(Ge||{}),Ve=(e=>(e.LOAD_LABEL_NAMES="LOAD_LABEL_NAMES",e.UPDATE_LABEL="UPDATE_LABEL",e.SUGGEST_LABEL_NAMES="SUGGEST_LABEL_NAMES",e.IMPORT_IMAGES="IMPORT_IMAGES",e.LOAD_AI_MODEL="LOAD_AI_MODEL",e.CONNECT_AI_MODEL_VIA_API="CONNECT_AI_MODEL_VIA_API",e.LOAD_YOLO_V5_MODEL="LOAD_YOLO_V5_MODEL",e.EXPORT_ANNOTATIONS="EXPORT_ANNOTATIONS",e.IMPORT_ANNOTATIONS="IMPORT_ANNOTATIONS",e.INSERT_LABEL_NAMES="INSERT_LABEL_NAMES",e.EXIT_PROJECT="EXIT_PROJECT",e.LOADER="LOADER",e))(Ve||{});const He=class{};let We=He;t(We,"GITHUB_URL","https://github.com/SkalskiP"),t(We,"MEDIUM_URL","https://medium.com/@piotr.skalski92"),t(We,"TWITCH_URL","https://www.twitch.tv/skalskip"),t(We,"YOUTUBE_URL","https://www.youtube.com/watch?v=AWjKfjDGiYE"),t(We,"TOP_NAVIGATION_BAR_HEIGHT_PX",35),t(We,"EDITOR_BOTTOM_NAVIGATION_BAR_HEIGHT_PX",41),t(We,"EDITOR_TOP_NAVIGATION_BAR_HEIGHT_PX",41),t(We,"SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX",24),t(We,"SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX",He.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX+300+1),t(We,"TOOLKIT_TAB_HEIGHT_PX",40),t(We,"TOOLBOX_PANEL_WIDTH_PX",51),t(We,"MAX_DROPDOWN_OPTION_LENGTH",20),t(We,"EDITOR_MIN_WIDTH",900),t(We,"EDITOR_MIN_HEIGHT",500),t(We,"PRIMARY_COLOR","#2af598"),t(We,"SECONDARY_COLOR","#009efd"),t(We,"DARK_THEME_FIRST_COLOR","#171717"),t(We,"DARK_THEME_SECOND_COLOR","#282828"),t(We,"DARK_THEME_THIRD_COLOR","#4c4c4c"),t(We,"DARK_THEME_FORTH_COLOR","#262c2f"),t(We,"CROSS_HAIR_THICKNESS_PX",1),t(We,"CROSS_HAIR_COLOR","#fff"),t(We,"RESIZE_HANDLE_DIMENSION_PX",8),t(We,"RESIZE_HANDLE_HOVER_DIMENSION_PX",16),t(We,"CLOSEABLE_POPUPS",[Ve.IMPORT_IMAGES,Ve.EXPORT_ANNOTATIONS,Ve.IMPORT_ANNOTATIONS,Ve.EXIT_PROJECT,Ve.UPDATE_LABEL,Ve.LOAD_AI_MODEL,Ve.LOAD_YOLO_V5_MODEL]),t(We,"LABEL_COLORS_PALETTE",["#ff3838","#ff9d97","#ff701f","#ffb21d","#cff231","#48f90a","#92cc17","#3ddb86","#1a9334","#00d4bb","#2c99a8","#00c2ff","#344593","#6473ff","#0018ec","#8438ff","#520085","#cb38ff","#ff95c8","#ff37c7"]),t(We,"CSV_SEPARATOR",","),t(We,"RECT_LABELS_EXPORT_CSV_COLUMN_NAMES",["image_name","start_frame","end_frame","behavior"].join(He.CSV_SEPARATOR));var je=(e=>(e.VIDEO_RECOGNITION="VIDEO RECOGNITION",e.POINT="POINT",e.RECT="RECT",e.POLYGON="POLYGON",e.LINE="LINE",e))(je||{}),qe={},Xe={},Ke={exports:{}},Ye={exports:{}};(function(){var e,t,n,i,r,s;"undefined"!=typeof performance&&null!==performance&&performance.now?Ye.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(Ye.exports=function(){return(e()-r)/1e6},t=process.hrtime,i=(e=function(){var e;return 1e9*(e=t())[0]+e[1]})(),s=1e9*process.uptime(),r=i-s):Date.now?(Ye.exports=function(){return Date.now()-n},n=Date.now()):(Ye.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(S);for(var Ze=Ye.exports,Qe="undefined"==typeof window?S:window,Je=["moz","webkit"],et="AnimationFrame",tt=Qe["request"+et],nt=Qe["cancel"+et]||Qe["cancelRequest"+et],it=0;!tt&&it<Je.length;it++)tt=Qe[Je[it]+"Request"+et],nt=Qe[Je[it]+"Cancel"+et]||Qe[Je[it]+"CancelRequest"+et];if(!tt||!nt){var rt=0,st=0,at=[],ot=1e3/60;tt=function(e){if(0===at.length){var t=Ze(),n=Math.max(0,ot-(t-rt));rt=n+t,setTimeout(function(){var e=at.slice(0);at.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(rt)}catch(n){setTimeout(function(){throw n},0)}},Math.round(n))}return at.push({handle:++st,callback:e,cancelled:!1}),st},nt=function(e){for(var t=0;t<at.length;t++)at[t].handle===e&&(at[t].cancelled=!0)}}Ke.exports=function(e){return tt.call(Qe,e)},Ke.exports.cancel=function(){nt.apply(Qe,arguments)},Ke.exports.polyfill=function(e){e||(e=Qe),e.requestAnimationFrame=tt,e.cancelAnimationFrame=nt};var lt={exports:{}},ct=null,ut=["Webkit","Moz","O","ms"],dt=function(e){return ht.test(e)?e.toLowerCase():pt.test(e)?(function(e){return e.replace(mt,function(e,t){return t?" "+t:""})}(e)||e).toLowerCase():ft.test(e)?function(e){return e.replace(gt,function(e,t,n){return t+" "+n.toLowerCase().split("").join(" ")})}(e).toLowerCase():e.toLowerCase()},ht=/\s/,pt=/(_|-|\.|:)/,ft=/([a-z][A-Z]|[A-Z][a-z])/;var mt=/[\W_]+(.|$)/g;var gt=/(.)([A-Z]+)/g;var bt=dt;var yt=function(e){return bt(e).replace(/[\W_]+(.|$)/g,function(e,t){return t?" "+t:""}).trim()};var vt={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},Tt=function(e){ct||(ct=document.createElement("div"));var t=ct.style;if(e in t)return e;for(var n=e.charAt(0).toUpperCase()+e.slice(1),i=ut.length;i>=0;i--){var r=ut[i]+n;if(r in t)return r}return!1},xt=function(e){return yt(e).replace(/\s(\w)/g,function(e,t){return t.toUpperCase()})},_t={float:"cssFloat"},St=function(e,t){return"number"!=typeof t||vt[e]?t:t+"px"};function wt(e,t,n){var i=_t[t];if(void 0===i&&(i=function(e){var t=xt(e),n=Tt(t);return _t[t]=_t[e]=_t[n]=n,n}(t)),i){if(void 0===n)return e.style[i];e.style[i]=St(i,n)}}function It(){2===arguments.length?"string"==typeof arguments[1]?arguments[0].style.cssText=arguments[1]:function(e,t){for(var n in t)t.hasOwnProperty(n)&&wt(e,n,t[n])}(arguments[0],arguments[1]):wt(arguments[0],arguments[1],arguments[2])}lt.exports=It,lt.exports.set=It,lt.exports.get=function(e,t){return Array.isArray(t)?t.reduce(function(t,n){return t[n]=wt(e,n||""),t},{}):wt(e,t||"")};var kt,Ct={};kt=Ct,Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=function(e){return"string"==typeof e};var Et={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e&&!1!==r)return r;if("undefined"!=typeof document){var t=document.createElement("div");(0,i.default)(t,{width:100,height:100,position:"absolute",top:-9999,overflow:"scroll",MsOverflowStyle:"scrollbar"}),document.body.appendChild(t),r=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}else r=0;return r||0};var t,n=lt.exports,i=(t=n)&&t.__esModule?t:{default:t};var r=!1}(Et);var At={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return!1}}(At);var Rt={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=e.clientWidth,n=getComputedStyle(e),i=n.paddingLeft,r=n.paddingRight;return t-parseFloat(i)-parseFloat(r)}}(Rt);var Nt={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=e.clientHeight,n=getComputedStyle(e),i=n.paddingTop,r=n.paddingBottom;return t-parseFloat(i)-parseFloat(r)}}(Nt);var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.containerStyleDefault={position:"relative",overflow:"hidden",width:"100%",height:"100%"},Pt.containerStyleAutoHeight={height:"auto"},Pt.viewStyleDefault={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"scroll",WebkitOverflowScrolling:"touch"},Pt.viewStyleAutoHeight={position:"relative",top:void 0,left:void 0,right:void 0,bottom:void 0},Pt.viewStyleUniversalInitial={overflow:"hidden",marginRight:0,marginBottom:0},Pt.trackHorizontalStyleDefault={position:"absolute",height:6},Pt.trackVerticalStyleDefault={position:"absolute",width:6},Pt.thumbHorizontalStyleDefault={position:"relative",display:"block",height:"100%"},Pt.thumbVerticalStyleDefault={position:"relative",display:"block",width:"100%"},Pt.disableSelectStyle={userSelect:"none"},Pt.disableSelectStyleReset={userSelect:""};var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});var Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};Dt.renderViewDefault=function(e){return Ft.default.createElement("div",e)},Dt.renderTrackHorizontalDefault=function(e){var t=e.style,n=$t(e,["style"]),i=Ot({},t,{right:2,bottom:2,left:2,borderRadius:3});return Ft.default.createElement("div",Ot({style:i},n))},Dt.renderTrackVerticalDefault=function(e){var t=e.style,n=$t(e,["style"]),i=Ot({},t,{right:2,bottom:2,top:2,borderRadius:3});return Ft.default.createElement("div",Ot({style:i},n))},Dt.renderThumbHorizontalDefault=function(e){var t=e.style,n=$t(e,["style"]),i=Ot({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return Ft.default.createElement("div",Ot({style:i},n))},Dt.renderThumbVerticalDefault=function(e){var t=e.style,n=$t(e,["style"]),i=Ot({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return Ft.default.createElement("div",Ot({style:i},n))};var Lt,Mt=n.exports,Ft=(Lt=Mt)&&Lt.__esModule?Lt:{default:Lt};function $t(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=Ke.exports,s=b(r),a=b(lt.exports),o=n.exports,l=b(c.exports),u=b(Ct),d=b(Et),h=b(At),p=b(Rt),f=b(Nt),m=Pt,g=Dt;function b(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function n(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t=n.__proto__||Object.getPrototypeOf(n)).call.apply(t,[this,e].concat(r)));return a.getScrollLeft=a.getScrollLeft.bind(a),a.getScrollTop=a.getScrollTop.bind(a),a.getScrollWidth=a.getScrollWidth.bind(a),a.getScrollHeight=a.getScrollHeight.bind(a),a.getClientWidth=a.getClientWidth.bind(a),a.getClientHeight=a.getClientHeight.bind(a),a.getValues=a.getValues.bind(a),a.getThumbHorizontalWidth=a.getThumbHorizontalWidth.bind(a),a.getThumbVerticalHeight=a.getThumbVerticalHeight.bind(a),a.getScrollLeftForOffset=a.getScrollLeftForOffset.bind(a),a.getScrollTopForOffset=a.getScrollTopForOffset.bind(a),a.scrollLeft=a.scrollLeft.bind(a),a.scrollTop=a.scrollTop.bind(a),a.scrollToLeft=a.scrollToLeft.bind(a),a.scrollToTop=a.scrollToTop.bind(a),a.scrollToRight=a.scrollToRight.bind(a),a.scrollToBottom=a.scrollToBottom.bind(a),a.handleTrackMouseEnter=a.handleTrackMouseEnter.bind(a),a.handleTrackMouseLeave=a.handleTrackMouseLeave.bind(a),a.handleHorizontalTrackMouseDown=a.handleHorizontalTrackMouseDown.bind(a),a.handleVerticalTrackMouseDown=a.handleVerticalTrackMouseDown.bind(a),a.handleHorizontalThumbMouseDown=a.handleHorizontalThumbMouseDown.bind(a),a.handleVerticalThumbMouseDown=a.handleVerticalThumbMouseDown.bind(a),a.handleWindowResize=a.handleWindowResize.bind(a),a.handleScroll=a.handleScroll.bind(a),a.handleDrag=a.handleDrag.bind(a),a.handleDragEnd=a.handleDragEnd.bind(a),a.state={didMountUniversal:!1},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),i(n,[{key:"componentDidMount",value:function(){this.addListeners(),this.update(),this.componentDidMountUniversal()}},{key:"componentDidMountUniversal",value:function(){this.props.universal&&this.setState({didMountUniversal:!0})}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"componentWillUnmount",value:function(){this.removeListeners(),(0,r.cancel)(this.requestFrame),clearTimeout(this.hideTracksTimeout),clearInterval(this.detectScrollingInterval)}},{key:"getScrollLeft",value:function(){return this.view?this.view.scrollLeft:0}},{key:"getScrollTop",value:function(){return this.view?this.view.scrollTop:0}},{key:"getScrollWidth",value:function(){return this.view?this.view.scrollWidth:0}},{key:"getScrollHeight",value:function(){return this.view?this.view.scrollHeight:0}},{key:"getClientWidth",value:function(){return this.view?this.view.clientWidth:0}},{key:"getClientHeight",value:function(){return this.view?this.view.clientHeight:0}},{key:"getValues",value:function(){var e=this.view||{},t=e.scrollLeft,n=void 0===t?0:t,i=e.scrollTop,r=void 0===i?0:i,s=e.scrollWidth,a=void 0===s?0:s,o=e.scrollHeight,l=void 0===o?0:o,c=e.clientWidth,u=void 0===c?0:c,d=e.clientHeight,h=void 0===d?0:d;return{left:n/(a-u)||0,top:r/(l-h)||0,scrollLeft:n,scrollTop:r,scrollWidth:a,scrollHeight:l,clientWidth:u,clientHeight:h}}},{key:"getThumbHorizontalWidth",value:function(){var e=this.props,t=e.thumbSize,n=e.thumbMinSize,i=this.view,r=i.scrollWidth,s=i.clientWidth,a=(0,p.default)(this.trackHorizontal),o=Math.ceil(s/r*a);return a<=o?0:t||Math.max(o,n)}},{key:"getThumbVerticalHeight",value:function(){var e=this.props,t=e.thumbSize,n=e.thumbMinSize,i=this.view,r=i.scrollHeight,s=i.clientHeight,a=(0,f.default)(this.trackVertical),o=Math.ceil(s/r*a);return a<=o?0:t||Math.max(o,n)}},{key:"getScrollLeftForOffset",value:function(e){var t=this.view,n=t.scrollWidth,i=t.clientWidth;return e/((0,p.default)(this.trackHorizontal)-this.getThumbHorizontalWidth())*(n-i)}},{key:"getScrollTopForOffset",value:function(e){var t=this.view,n=t.scrollHeight,i=t.clientHeight;return e/((0,f.default)(this.trackVertical)-this.getThumbVerticalHeight())*(n-i)}},{key:"scrollLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.view&&(this.view.scrollLeft=e)}},{key:"scrollTop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.view&&(this.view.scrollTop=e)}},{key:"scrollToLeft",value:function(){this.view&&(this.view.scrollLeft=0)}},{key:"scrollToTop",value:function(){this.view&&(this.view.scrollTop=0)}},{key:"scrollToRight",value:function(){this.view&&(this.view.scrollLeft=this.view.scrollWidth)}},{key:"scrollToBottom",value:function(){this.view&&(this.view.scrollTop=this.view.scrollHeight)}},{key:"addListeners",value:function(){if("undefined"!=typeof document&&this.view){var e=this.view,t=this.trackHorizontal,n=this.trackVertical,i=this.thumbHorizontal,r=this.thumbVertical;e.addEventListener("scroll",this.handleScroll),(0,d.default)()&&(t.addEventListener("mouseenter",this.handleTrackMouseEnter),t.addEventListener("mouseleave",this.handleTrackMouseLeave),t.addEventListener("mousedown",this.handleHorizontalTrackMouseDown),n.addEventListener("mouseenter",this.handleTrackMouseEnter),n.addEventListener("mouseleave",this.handleTrackMouseLeave),n.addEventListener("mousedown",this.handleVerticalTrackMouseDown),i.addEventListener("mousedown",this.handleHorizontalThumbMouseDown),r.addEventListener("mousedown",this.handleVerticalThumbMouseDown),window.addEventListener("resize",this.handleWindowResize))}}},{key:"removeListeners",value:function(){if("undefined"!=typeof document&&this.view){var e=this.view,t=this.trackHorizontal,n=this.trackVertical,i=this.thumbHorizontal,r=this.thumbVertical;e.removeEventListener("scroll",this.handleScroll),(0,d.default)()&&(t.removeEventListener("mouseenter",this.handleTrackMouseEnter),t.removeEventListener("mouseleave",this.handleTrackMouseLeave),t.removeEventListener("mousedown",this.handleHorizontalTrackMouseDown),n.removeEventListener("mouseenter",this.handleTrackMouseEnter),n.removeEventListener("mouseleave",this.handleTrackMouseLeave),n.removeEventListener("mousedown",this.handleVerticalTrackMouseDown),i.removeEventListener("mousedown",this.handleHorizontalThumbMouseDown),r.removeEventListener("mousedown",this.handleVerticalThumbMouseDown),window.removeEventListener("resize",this.handleWindowResize),this.teardownDragging())}}},{key:"handleScroll",value:function(e){var t=this,n=this.props,i=n.onScroll,r=n.onScrollFrame;i&&i(e),this.update(function(e){var n=e.scrollLeft,i=e.scrollTop;t.viewScrollLeft=n,t.viewScrollTop=i,r&&r(e)}),this.detectScrolling()}},{key:"handleScrollStart",value:function(){var e=this.props.onScrollStart;e&&e(),this.handleScrollStartAutoHide()}},{key:"handleScrollStartAutoHide",value:function(){this.props.autoHide&&this.showTracks()}},{key:"handleScrollStop",value:function(){var e=this.props.onScrollStop;e&&e(),this.handleScrollStopAutoHide()}},{key:"handleScrollStopAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"handleWindowResize",value:function(){(0,d.default)(!1),this.forceUpdate()}},{key:"handleHorizontalTrackMouseDown",value:function(e){e.preventDefault();var t=e.target,n=e.clientX,i=t.getBoundingClientRect().left,r=this.getThumbHorizontalWidth(),s=Math.abs(i-n)-r/2;this.view.scrollLeft=this.getScrollLeftForOffset(s)}},{key:"handleVerticalTrackMouseDown",value:function(e){e.preventDefault();var t=e.target,n=e.clientY,i=t.getBoundingClientRect().top,r=this.getThumbVerticalHeight(),s=Math.abs(i-n)-r/2;this.view.scrollTop=this.getScrollTopForOffset(s)}},{key:"handleHorizontalThumbMouseDown",value:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,n=e.clientX,i=t.offsetWidth,r=t.getBoundingClientRect().left;this.prevPageX=i-(n-r)}},{key:"handleVerticalThumbMouseDown",value:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,n=e.clientY,i=t.offsetHeight,r=t.getBoundingClientRect().top;this.prevPageY=i-(n-r)}},{key:"setupDragging",value:function(){(0,a.default)(document.body,m.disableSelectStyle),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd),document.onselectstart=h.default}},{key:"teardownDragging",value:function(){(0,a.default)(document.body,m.disableSelectStyleReset),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.onselectstart=void 0}},{key:"handleDragStart",value:function(e){this.dragging=!0,e.stopImmediatePropagation(),this.setupDragging()}},{key:"handleDrag",value:function(e){if(this.prevPageX){var t=e.clientX,n=-this.trackHorizontal.getBoundingClientRect().left+t-(this.getThumbHorizontalWidth()-this.prevPageX);this.view.scrollLeft=this.getScrollLeftForOffset(n)}if(this.prevPageY){var i=e.clientY,r=-this.trackVertical.getBoundingClientRect().top+i-(this.getThumbVerticalHeight()-this.prevPageY);this.view.scrollTop=this.getScrollTopForOffset(r)}return!1}},{key:"handleDragEnd",value:function(){this.dragging=!1,this.prevPageX=this.prevPageY=0,this.teardownDragging(),this.handleDragEndAutoHide()}},{key:"handleDragEndAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"handleTrackMouseEnter",value:function(){this.trackMouseOver=!0,this.handleTrackMouseEnterAutoHide()}},{key:"handleTrackMouseEnterAutoHide",value:function(){this.props.autoHide&&this.showTracks()}},{key:"handleTrackMouseLeave",value:function(){this.trackMouseOver=!1,this.handleTrackMouseLeaveAutoHide()}},{key:"handleTrackMouseLeaveAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"showTracks",value:function(){clearTimeout(this.hideTracksTimeout),(0,a.default)(this.trackHorizontal,{opacity:1}),(0,a.default)(this.trackVertical,{opacity:1})}},{key:"hideTracks",value:function(){var e=this;if(!this.dragging&&!this.scrolling&&!this.trackMouseOver){var t=this.props.autoHideTimeout;clearTimeout(this.hideTracksTimeout),this.hideTracksTimeout=setTimeout(function(){(0,a.default)(e.trackHorizontal,{opacity:0}),(0,a.default)(e.trackVertical,{opacity:0})},t)}}},{key:"detectScrolling",value:function(){var e=this;this.scrolling||(this.scrolling=!0,this.handleScrollStart(),this.detectScrollingInterval=setInterval(function(){e.lastViewScrollLeft===e.viewScrollLeft&&e.lastViewScrollTop===e.viewScrollTop&&(clearInterval(e.detectScrollingInterval),e.scrolling=!1,e.handleScrollStop()),e.lastViewScrollLeft=e.viewScrollLeft,e.lastViewScrollTop=e.viewScrollTop},100))}},{key:"raf",value:function(e){var t=this;this.requestFrame&&s.default.cancel(this.requestFrame),this.requestFrame=(0,s.default)(function(){t.requestFrame=void 0,e()})}},{key:"update",value:function(e){var t=this;this.raf(function(){return t._update(e)})}},{key:"_update",value:function(e){var t=this.props,n=t.onUpdate,i=t.hideTracksWhenNotNeeded,r=this.getValues();if((0,d.default)()){var s=r.scrollLeft,o=r.clientWidth,l=r.scrollWidth,c=(0,p.default)(this.trackHorizontal),u=this.getThumbHorizontalWidth(),h={width:u,transform:"translateX("+s/(l-o)*(c-u)+"px)"},m=r.scrollTop,g=r.clientHeight,b=r.scrollHeight,y=(0,f.default)(this.trackVertical),v=this.getThumbVerticalHeight(),T={height:v,transform:"translateY("+m/(b-g)*(y-v)+"px)"};if(i){var x={visibility:l>o?"visible":"hidden"},_={visibility:b>g?"visible":"hidden"};(0,a.default)(this.trackHorizontal,x),(0,a.default)(this.trackVertical,_)}(0,a.default)(this.thumbHorizontal,h),(0,a.default)(this.thumbVertical,T)}n&&n(r),"function"==typeof e&&e(r)}},{key:"render",value:function(){var e=this,n=(0,d.default)(),i=this.props;i.onScroll,i.onScrollFrame,i.onScrollStart,i.onScrollStop,i.onUpdate;var r=i.renderView,s=i.renderTrackHorizontal,a=i.renderTrackVertical,l=i.renderThumbHorizontal,c=i.renderThumbVertical,h=i.tagName;i.hideTracksWhenNotNeeded;var p=i.autoHide;i.autoHideTimeout;var f=i.autoHideDuration;i.thumbSize,i.thumbMinSize;var g=i.universal,b=i.autoHeight,y=i.autoHeightMin,v=i.autoHeightMax,T=i.style,x=i.children,_=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(i,["onScroll","onScrollFrame","onScrollStart","onScrollStop","onUpdate","renderView","renderTrackHorizontal","renderTrackVertical","renderThumbHorizontal","renderThumbVertical","tagName","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","autoHideDuration","thumbSize","thumbMinSize","universal","autoHeight","autoHeightMin","autoHeightMax","style","children"]),S=this.state.didMountUniversal,w=t({},m.containerStyleDefault,b&&t({},m.containerStyleAutoHeight,{minHeight:y,maxHeight:v}),T),I=t({},m.viewStyleDefault,{marginRight:n?-n:0,marginBottom:n?-n:0},b&&t({},m.viewStyleAutoHeight,{minHeight:(0,u.default)(y)?"calc("+y+" + "+n+"px)":y+n,maxHeight:(0,u.default)(v)?"calc("+v+" + "+n+"px)":v+n}),b&&g&&!S&&{minHeight:y,maxHeight:v},g&&!S&&m.viewStyleUniversalInitial),k={transition:"opacity "+f+"ms",opacity:0},C=t({},m.trackHorizontalStyleDefault,p&&k,(!n||g&&!S)&&{display:"none"}),E=t({},m.trackVerticalStyleDefault,p&&k,(!n||g&&!S)&&{display:"none"});return(0,o.createElement)(h,t({},_,{style:w,ref:function(t){e.container=t}}),[(0,o.cloneElement)(r({style:I}),{key:"view",ref:function(t){e.view=t}},x),(0,o.cloneElement)(s({style:C}),{key:"trackHorizontal",ref:function(t){e.trackHorizontal=t}},(0,o.cloneElement)(l({style:m.thumbHorizontalStyleDefault}),{ref:function(t){e.thumbHorizontal=t}})),(0,o.cloneElement)(a({style:E}),{key:"trackVertical",ref:function(t){e.trackVertical=t}},(0,o.cloneElement)(c({style:m.thumbVerticalStyleDefault}),{ref:function(t){e.thumbVertical=t}}))])}}]),n}(o.Component);e.default=y,y.propTypes={onScroll:l.default.func,onScrollFrame:l.default.func,onScrollStart:l.default.func,onScrollStop:l.default.func,onUpdate:l.default.func,renderView:l.default.func,renderTrackHorizontal:l.default.func,renderTrackVertical:l.default.func,renderThumbHorizontal:l.default.func,renderThumbVertical:l.default.func,tagName:l.default.string,thumbSize:l.default.number,thumbMinSize:l.default.number,hideTracksWhenNotNeeded:l.default.bool,autoHide:l.default.bool,autoHideTimeout:l.default.number,autoHideDuration:l.default.number,autoHeight:l.default.bool,autoHeightMin:l.default.oneOfType([l.default.number,l.default.string]),autoHeightMax:l.default.oneOfType([l.default.number,l.default.string]),universal:l.default.bool,style:l.default.object,children:l.default.node},y.defaultProps={renderView:g.renderViewDefault,renderTrackHorizontal:g.renderTrackHorizontalDefault,renderTrackVertical:g.renderTrackVerticalDefault,renderThumbHorizontal:g.renderThumbHorizontalDefault,renderThumbVertical:g.renderThumbVerticalDefault,tagName:"div",thumbMinSize:30,hideTracksWhenNotNeeded:!1,autoHide:!1,autoHideTimeout:1e3,autoHideDuration:200,autoHeight:!1,autoHeightMin:0,autoHeightMax:200,universal:!1}}(Xe),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Scrollbars=void 0;var t=function(e){return e&&e.__esModule?e:{default:e}}(Xe);e.default=t.default,e.Scrollbars=t.default}(qe);const Bt=w(qe);class zt{static calculateGridSize(e,t,n){const i=Math.floor(e.width/t.width);return{width:i,height:Math.ceil(n/i)}}static calculateContentSize(e,t,n){const i={width:t.width*n.width,height:t.height*n.height};return{width:Math.max(e.width,i.width),height:i.height}}static calculateAnchorPoints(e,t,n){const i=zt.calculateGridSize(e,t,n),r=(zt.calculateContentSize(e,t,i).width-i.width*t.width)/(i.width+1),s=[];for(let a=0;a<n;a++){const e=Math.floor(a/i.width),n={x:e*r+a%i.width*t.width,y:e*t.height};s.push(n)}return s}}class Ut{static snapValueToRange(e,t,n){return e<t?t:e>n?n:e}static isValueInRange(e,t,n){return e>=t&&e<=n}}class Gt{static getRatio(e){return e?e.width/e.height:null}static intersect(e,t){return e&&t?!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y):null}static isPointInside(e,t){return e&&t?e.x<=t.x&&e.x+e.width>=t.x&&e.y<=t.y&&e.y+e.height>=t.y:null}static getRectWithCenterAndSize(e,t){return{x:e.x-.5*t.width,y:e.y-.5*t.height,...t}}static fitInsideRectWithRatio(e,t){if(Gt.getRatio(e)<t){const n=e.width/t;return{x:e.x,y:e.y+(e.height-n)/2,width:e.width,height:n}}{const n=e.height*t;return{x:e.x+(e.width-n)/2,y:e.y,width:n,height:e.height}}}static resizeRect(e,t,n){const i={...e};switch(t){case Ge.RIGHT:i.width+=n.x;break;case Ge.BOTTOM_RIGHT:i.width+=n.x,i.height+=n.y;break;case Ge.BOTTOM:i.height+=n.y;break;case Ge.TOP_RIGHT:i.width+=n.x,i.y+=n.y,i.height-=n.y;break;case Ge.TOP:i.y+=n.y,i.height-=n.y;break;case Ge.TOP_LEFT:i.x+=n.x,i.width-=n.x,i.y+=n.y,i.height-=n.y;break;case Ge.LEFT:i.x+=n.x,i.width-=n.x;break;case Ge.BOTTOM_LEFT:i.x+=n.x,i.width-=n.x,i.height+=n.y}return i.width<0&&(i.x=i.x+i.width,i.width=-i.width),i.height<0&&(i.y=i.y+i.height,i.height=-i.height),i}static translate(e,t){return{...e,x:e.x+t.x,y:e.y+t.y}}static expand(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width+2*t.x,height:e.height+2*t.y}}static scaleRect(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}}static mapRectToAnchors(e){return[{type:Ge.TOP_LEFT,position:{x:e.x,y:e.y}},{type:Ge.TOP,position:{x:e.x+.5*e.width,y:e.y}},{type:Ge.TOP_RIGHT,position:{x:e.x+e.width,y:e.y}},{type:Ge.LEFT,position:{x:e.x,y:e.y+.5*e.height}},{type:Ge.RIGHT,position:{x:e.x+e.width,y:e.y+.5*e.height}},{type:Ge.BOTTOM_LEFT,position:{x:e.x,y:e.y+e.height}},{type:Ge.BOTTOM,position:{x:e.x+.5*e.width,y:e.y+e.height}},{type:Ge.BOTTOM_RIGHT,position:{x:e.x+e.width,y:e.y+e.height}}]}static snapPointToRect(e,t){return Gt.isPointInside(t,e)?e:{x:Ut.snapValueToRange(e.x,t.x,t.x+t.width),y:Ut.snapValueToRange(e.y,t.y,t.y+t.height)}}static getCenter(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}static getSize(e){return{width:e.width,height:e.height}}static getVertices(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}}class Vt extends i.Component{constructor(e){super(e),t(this,"gridSize"),t(this,"contentSize"),t(this,"childAnchors"),t(this,"scrollbars"),t(this,"calculate",(e,t,n)=>{this.gridSize=zt.calculateGridSize(e,t,n),this.contentSize=zt.calculateContentSize(e,t,this.gridSize),this.childAnchors=zt.calculateAnchorPoints(e,t,n)}),t(this,"getVirtualListStyle",()=>({position:"relative",width:this.props.size.width,height:this.props.size.height})),t(this,"getVirtualListContentStyle",()=>({width:this.contentSize.width,height:this.contentSize.height})),t(this,"onScrollStart",()=>{this.setState({isScrolling:!0})}),t(this,"onScrollStop",()=>{this.setState({isScrolling:!1})}),t(this,"onScroll",e=>{this.setState({viewportRect:{x:e.scrollLeft,y:e.scrollTop,width:this.props.size.width,height:this.props.size.height}})}),t(this,"getChildren",()=>{const{viewportRect:e,isScrolling:t}=this.state,{overScanHeight:n,childSize:i}=this.props,r=n||0,s={x:e.x,y:e.y-r,width:e.width,height:e.height+2*r};return this.childAnchors.reduce((e,n,r)=>{const a=Object.assign(n,i),o=Gt.intersect(s,a);if(o){const s={position:"absolute",left:n.x,top:n.y,width:i.width,height:i.height};return e.concat(this.props.childRender(r,t,o,s))}return e},[])}),this.state={viewportRect:null,isScrolling:!1}}componentDidMount(){const{size:e,childSize:t,childCount:n}=this.props;this.calculate(e,t,n),this.setState({viewportRect:{x:0,y:0,width:this.props.size.width,height:this.props.size.height}})}componentWillUpdate(e,t,n){const{size:i,childSize:r,childCount:s}=e;this.props.size.height===i.height&&this.props.size.width===i.width&&this.props.childCount===s||(this.calculate(i,r,s),this.setState({viewportRect:{x:this.scrollbars.getValues().scrollLeft,y:this.scrollbars.getValues().scrollTop,width:i.width,height:i.height}}))}render(){const e=!!this.props.size&&!!this.props.childSize&&!!this.gridSize;return o("div",{className:"VirtualList",style:this.getVirtualListStyle(),children:o(Bt,{ref:e=>this.scrollbars=e,onScrollFrame:this.onScroll,onScrollStart:this.onScrollStart,onScrollStop:this.onScrollStop,autoHide:!0,children:e&&o("div",{className:"VirtualListContent",style:this.getVirtualListContentStyle(),children:this.getChildren()})})})}}var Ht={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function Wt(e){var t=function(e){if("number"==typeof e)return{value:e,unit:"px"};var t,n=(e.match(/^[0-9.]*/)||"").toString();t=n.includes(".")?parseFloat(n):parseInt(n,10);var i=(e.match(/[^0-9]*$/)||"").toString();return Ht[i]?{value:t,unit:i}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}(e);return"".concat(t.value).concat(t.unit)}var jt=globalThis&&globalThis.__assign||function(){return jt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},jt.apply(this,arguments)},qt=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},Xt=function(e,t,n){var i="react-spinners-".concat(e,"-").concat(n);if("undefined"==typeof window||!window.document)return i;var r=document.createElement("style");document.head.appendChild(r);var s=r.sheet,a="\n    @keyframes ".concat(i," {\n      ").concat(t,"\n    }\n  ");return s&&s.insertRule(a,0),i}("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function Kt(e){var t=e.loading,n=void 0===t||t,i=e.color,r=void 0===i?"#000000":i,s=e.speedMultiplier,a=void 0===s?1:s,l=e.cssOverride,c=void 0===l?{}:l,u=e.size,d=void 0===u?35:u,h=qt(e,["loading","color","speedMultiplier","cssOverride","size"]),p=jt({background:"transparent !important",width:Wt(d),height:Wt(d),borderRadius:"100%",border:"2px solid",borderTopColor:r,borderBottomColor:"transparent",borderLeftColor:r,borderRightColor:r,display:"inline-block",animation:"".concat(Xt," ").concat(.75/a,"s 0s infinite linear"),animationFillMode:"both"},c);return n?o("span",{...jt({style:p},h)}):null}const Yt=class{static add(e){Yt.queue.push(async()=>await e)}static run(){setTimeout(()=>Yt.runQueue(),10)}static addAndRun(e){Yt.add(e),Yt.run()}static async runQueue(){Yt.isRunning||(Yt.isRunning=!0,await Yt.runTasks(),Yt.isRunning=!1)}static async runTasks(){for(;Yt.queue.length>0;){const e=Yt.queue.shift();await e()}}};let Zt=Yt;t(Zt,"queue",[]),t(Zt,"isRunning",!1);const Qt=class{static storeImage(e,t){Qt.repository[e]=t}static storeImages(e,t){I.exports.zip(e,t).forEach(e=>{Qt.storeImage(...e)})}static getById(e){return Qt.repository[e]}};let Jt=Qt;t(Jt,"repository",{});var en=(e=>(e.UPDATE_SUGGESTED_LABEL_LIST="@@UPDATE_SUGGESTED_LABEL_LIST",e.UPDATE_REJECTED_SUGGESTED_LABEL_LIST="@@UPDATE_REJECTED_SUGGESTED_LABEL_LIST",e.UPDATE_SSD_OBJECT_DETECTOR_STATUS="@@UPDATE_SSD_OBJECT_DETECTOR_STATUS",e.UPDATE_YOLO_V5_OBJECT_DETECTOR_STATUS="@@UPDATE_YOLO_V5_OBJECT_DETECTOR_STATUS",e.UPDATE_POSE_DETECTOR_STATUS="@@UPDATE_POSE_DETECTOR_STATUS",e.UPDATE_DISABLED_AI_FLAG="@@UPDATE_DISABLED_AI_FLAG",e.UPDATE_ROBOFLOW_API_DETAILS="@@UPDATE_ROBOFLOW_API_DETAILS",e.UPDATE_PROJECT_DATA="@@UPDATE_PROJECT_DATA",e.UPDATE_WINDOW_SIZE="@@UPDATE_WINDOW_SIZE",e.UPDATE_ACTIVE_POPUP_TYPE="@@UPDATE_ACTIVE_POPUP_TYPE",e.UPDATE_CUSTOM_CURSOR_STYLE="@@UPDATE_CUSTOM_CURSOR_STYLE",e.UPDATE_CONTEXT="@@UPDATE_CONTEXT",e.UPDATE_PREVENT_CUSTOM_CURSOR_STATUS="@@UPDATE_PREVENT_CUSTOM_CURSOR_STATUS",e.UPDATE_IMAGE_DRAG_MODE_STATUS="@@UPDATE_IMAGE_DRAG_MODE_STATUS",e.UPDATE_CROSS_HAIR_VISIBLE_STATUS="@@UPDATE_CROSS_HAIR_VISIBLE_STATUS",e.UPDATE_ENABLE_PER_CLASS_COLORATION_STATUS="@@UPDATE_ENABLE_PER_CLASS_COLORATION_STATUS",e.UPDATE_ZOOM="@@UPDATE_ZOOM",e.JUMP_TO_FRAME="@@JUMP_TO_FRAME",e.UPDATE_ACTIVE_IMAGE_INDEX="@@UPDATE_ACTIVE_IMAGE_INDEX",e.UPDATE_IMAGE_DATA_BY_ID="@@UPDATE_IMAGE_DATA_BY_ID",e.ADD_IMAGES_DATA="@@ADD_IMAGES_DATA",e.UPDATE_IMAGES_DATA="@@UPDATE_IMAGES_DATA",e.UPDATE_ACTIVE_LABEL_NAME_ID="@@UPDATE_ACTIVE_LABEL_NAME_ID",e.UPDATE_ACTIVE_LABEL_TYPE="@@UPDATE_ACTIVE_LABEL_TYPE",e.UPDATE_ACTIVE_LABEL_ID="@@UPDATE_ACTIVE_LABEL_ID",e.UPDATE_HIGHLIGHTED_LABEL_ID="@@UPDATE_HIGHLIGHTED_LABEL_ID",e.UPDATE_LABEL_NAMES="@@UPDATE_LABEL_NAMES",e.UPDATE_FIRST_LABEL_CREATED_FLAG="@@UPDATE_FIRST_LABEL_CREATED_FLAG",e.SUBMIT_NEW_NOTIFICATION="@@SUBMIT_NEW_NOTIFICATION",e.DELETE_NOTIFICATION_BY_ID="@@DELETE_NOTIFICATION_BY_ID",e))(en||{});function tn(e){return{type:en.UPDATE_ACTIVE_IMAGE_INDEX,payload:{activeImageIndex:e}}}function nn(e){return{type:en.UPDATE_ACTIVE_LABEL_NAME_ID,payload:{activeLabelNameId:e}}}function rn(e){return{type:en.UPDATE_ACTIVE_LABEL_ID,payload:{activeLabelId:e}}}function sn(e){return{type:en.UPDATE_HIGHLIGHTED_LABEL_ID,payload:{highlightedLabelId:e}}}function an(e){return{type:en.UPDATE_ACTIVE_LABEL_TYPE,payload:{activeLabelType:e}}}function on(e,t){return{type:en.UPDATE_IMAGE_DATA_BY_ID,payload:{id:e,newImageData:t}}}function ln(e){return{type:en.ADD_IMAGES_DATA,payload:{imageData:e}}}function cn(e){return{type:en.UPDATE_IMAGES_DATA,payload:{imageData:e}}}function un(e){return{type:en.UPDATE_LABEL_NAMES,payload:{labels:e}}}function dn(e){return{type:en.UPDATE_FIRST_LABEL_CREATED_FLAG,payload:{firstLabelCreatedFlag:e}}}class hn{static loadImageBase64(e){return new Promise((t,n)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(i.result),i.onerror=e=>n(e)})}static loadImage(e){return new Promise((t,n)=>{const i=URL.createObjectURL(e),r=new Image;r.src=i,r.onload=()=>t(r),r.onerror=n})}static loadImages(e){return new Promise((t,n)=>{const i=e.map(e=>hn.loadImage(e));Promise.all(i).then(e=>t(e)).catch(e=>n(e))})}static readFile(e){return new Promise((t,n)=>{const i=new FileReader;i.onloadend=e=>{var n;t(null==(n=null==e?void 0:e.target)?void 0:n.result)},i.onerror=n,i.readAsText(e)})}static readFiles(e){return new Promise((t,n)=>{const i=e.map(e=>hn.readFile(e));Promise.all(i).then(e=>t(e)).catch(e=>n(e))})}static extractFileExtension(e){const t=e.split(".");return t.length>1?t[t.length-1]:null}static extractFileName(e){const t=e.split(".");let n="";for(const i of Array(t.length-1).keys())n+=""===n?t[i]:"."+t[i];return n}}class pn{static getSuggestedLabelList(){return i6.getState().ai.suggestedLabelList}static getRejectedSuggestedLabelList(){return i6.getState().ai.rejectedSuggestedLabelList}static isAISSDObjectDetectorModelLoaded(){return i6.getState().ai.isSSDObjectDetectorLoaded}static isAIYOLOObjectDetectorModelLoaded(){return i6.getState().ai.isYOLOV5ObjectDetectorLoaded}static isAIPoseDetectorModelLoaded(){return i6.getState().ai.isPoseDetectorLoaded}static isRoboflowAPIModelLoaded(){const e=i6.getState().ai.roboflowAPIDetails;return""!==e.model&&""!==e.key&&e.status}static isAIDisabled(){return i6.getState().ai.isAIDisabled}static getRoboflowAPIDetails(){return i6.getState().ai.roboflowAPIDetails}}class fn{static getLeadingColor(){return pn.isAISSDObjectDetectorModelLoaded()||pn.isAIYOLOObjectDetectorModelLoaded()||pn.isAIPoseDetectorModelLoaded()?We.PRIMARY_COLOR:We.SECONDARY_COLOR}}class mn extends i.Component{constructor(e){super(e),t(this,"isLoading",!1),t(this,"loadImage",async(e,t)=>{if(e.loadStatus){const t=Jt.getById(e.id);this.state.image!==t&&this.setState({image:t})}else if(!t||!this.isLoading){this.isLoading=!0;const t=t=>this.saveLoadedImage(t,e);hn.loadImage(e.fileData).then(e=>t(e)).catch(e=>this.handleLoadImageError())}}),t(this,"saveLoadedImage",(e,t)=>{t.loadStatus=!0,this.props.updateImageDataById(t.id,t),Jt.storeImage(t.id,e),t.id===this.props.imageData.id&&(this.setState({image:e}),this.isLoading=!1)}),t(this,"getStyle",()=>{const{size:e}=this.props,t={x:.15*e.width,y:.15*e.height,width:.7*e.width,height:.7*e.height},n={x:0,y:0,width:this.state.image.width,height:this.state.image.height},i=Gt.getRatio(n),r=Gt.fitInsideRectWithRatio(t,i);return{width:r.width,height:r.height,left:r.x,top:r.y}}),t(this,"handleLoadImageError",()=>{}),t(this,"getClassName",()=>C("ImagePreview",{selected:this.props.isSelected})),this.state={image:null}}componentDidMount(){Zt.addAndRun(this.loadImage(this.props.imageData,this.props.isScrolling))}componentWillUpdate(e,t,n){this.props.imageData.id!==e.imageData.id&&(e.imageData.loadStatus?Zt.addAndRun(this.loadImage(e.imageData,e.isScrolling)):this.setState({image:null})),this.props.isScrolling&&!e.isScrolling&&Zt.addAndRun(this.loadImage(e.imageData,!1))}shouldComponentUpdate(e,t,n){return this.props.imageData.id!==e.imageData.id||this.state.image!==t.image||this.props.isSelected!==e.isSelected||this.props.isChecked!==e.isChecked}render(){const{isChecked:e,style:t,onClick:n}=this.props;return o("div",{className:this.getClassName(),style:t,onClick:n||void 0,children:this.state.image?[u("div",{className:"Foreground",style:this.getStyle(),children:[o("img",{className:"Image",draggable:!1,src:this.state.image.src,alt:this.state.image.alt,style:{...this.getStyle(),left:0,top:0}}),e&&o("img",{className:"CheckBox",draggable:!1,src:"ico/ok.png",alt:"checkbox"})]},"Foreground"),o("div",{className:"Background",style:this.getStyle()},"Background")]:o(Kt,{size:30,color:fn.getLeadingColor(),loading:!0})})}}const gn=$e(e=>({}),{updateImageDataById:on})(mn);var bn=(e=>(e.EDITOR="EDITOR",e.LEFT_NAVBAR="LEFT_NAVBAR",e.RIGHT_NAVBAR="RIGHT_NAVBAR",e.POPUP="POPUP",e.DROPDOWN="DROPDOWN",e))(bn||{});function yn(e){return{type:en.UPDATE_ACTIVE_POPUP_TYPE,payload:{activePopupType:e}}}function vn(e){return{type:en.UPDATE_CUSTOM_CURSOR_STYLE,payload:{customCursorStyle:e}}}function Tn(e){return{type:en.UPDATE_PREVENT_CUSTOM_CURSOR_STATUS,payload:{preventCustomCursor:e}}}function xn(e){return{type:en.UPDATE_IMAGE_DRAG_MODE_STATUS,payload:{imageDragMode:e}}}function _n(e){return{type:en.UPDATE_CROSS_HAIR_VISIBLE_STATUS,payload:{crossHairVisible:e}}}function Sn(e){return{type:en.UPDATE_PROJECT_DATA,payload:{projectData:e}}}function wn(e){return{type:en.JUMP_TO_FRAME,payload:{frameIndex:e}}}class In{}t(In,"editor"),t(In,"canvas"),t(In,"mousePositionIndicator"),t(In,"cursor"),t(In,"viewPortScrollbars"),t(In,"image"),t(In,"primaryRenderingEngine"),t(In,"supportRenderingEngine"),t(In,"viewPortHelper"),t(In,"isLoading",!1),t(In,"viewPortActionsDisabled",!1),t(In,"mousePositionOnViewPortContent"),t(In,"viewPortSize"),t(In,"defaultRenderImageRect");class kn{static deg2rad(e){return e*Math.PI/180}static rad2deg(e){return 180*e/Math.PI}}class Cn{static clearCanvas(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}static drawLine(e,t,n,i="#111111",r=1){const s=e.getContext("2d");s.save(),s.strokeStyle=i,s.lineWidth=r,s.lineCap="round",s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(n.x+1,n.y+1),s.stroke(),s.restore()}static drawRect(e,t,n="#fff",i=1){const r=e.getContext("2d");r.save(),r.strokeStyle=n,r.lineWidth=i,r.beginPath(),r.rect(t.x,t.y,t.width,t.height),r.stroke(),r.restore()}static drawRectWithFill(e,t,n="#fff"){const i=e.getContext("2d");i.save(),i.fillStyle=n,i.beginPath(),i.rect(t.x,t.y,t.width,t.height),i.fill(),i.restore()}static shadeEverythingButRect(e,t,n="rgba(0, 0, 0, 0.7)"){const i=e.getContext("2d");i.save(),i.fillStyle=n,i.fillRect(0,0,e.width,e.height),i.globalCompositeOperation="destination-out",i.fillRect(t.x,t.y,t.width,t.height),i.restore()}static drawCircleWithFill(e,t,n,i="#ffffff"){const r=e.getContext("2d");r.save();const s=kn.deg2rad(0),a=kn.deg2rad(360);r.fillStyle=i,r.beginPath(),r.arc(t.x,t.y,n,s,a,!1),r.fill(),r.restore()}static drawCircle(e,t,n,i,r,s=20,a="#ffffff"){const o=e.getContext("2d"),l=kn.deg2rad(i),c=kn.deg2rad(r);o.save(),o.strokeStyle=a,o.lineWidth=s,o.beginPath(),o.arc(t.x,t.y,n,l,c,!1),o.stroke(),o.restore()}static drawPolygon(e,t,n="#fff",i=1){const r=e.getContext("2d");r.save(),r.strokeStyle=n,r.lineWidth=i,r.beginPath(),r.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)r.lineTo(t[s].x,t[s].y);r.closePath(),r.stroke(),r.restore()}static drawPolygonWithFill(e,t,n="#fff"){const i=e.getContext("2d");i.save(),i.fillStyle=n,i.beginPath(),i.moveTo(t[0].x,t[0].y);for(let r=1;r<t.length;r++)i.lineTo(t[r].x,t[r].y);i.closePath(),i.fill(),i.restore()}static drawText(e,t,n,i,r="#ffffff",s=!1,a="center"){const o=e.getContext("2d");o.save(),o.fillStyle=r,o.textAlign=a,o.textBaseline="middle",o.font=(s?"bold ":"")+n+"px Arial",o.fillText(t,i.x,i.y),o.restore()}static hexToRGB(e,t=null){const n=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);return null!==t?`rgba(${n}, ${i}, ${r}, ${t})`:`rgb(${n}, ${i}, ${r})`}}class En{static equals(e,t){return e.x===t.x&&e.y===t.y}static add(e,t){return{x:e.x+t.x,y:e.y+t.y}}static subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}}static multiply(e,t){return{x:e.x*t,y:e.y*t}}}class An{}t(An,"LINE_THICKNESS",2),t(An,"lineActiveColor",We.PRIMARY_COLOR),t(An,"defaultLineColor","#ffffff"),t(An,"CROSS_HAIR_LINE_COLOR","#ffffff"),t(An,"crossHairPadding",25),t(An,"anchorSize",{width:We.RESIZE_HANDLE_DIMENSION_PX,height:We.RESIZE_HANDLE_DIMENSION_PX}),t(An,"anchorHoverSize",{width:We.RESIZE_HANDLE_HOVER_DIMENSION_PX,height:We.RESIZE_HANDLE_HOVER_DIMENSION_PX}),t(An,"suggestedAnchorDetectionSize",{width:100,height:100}),t(An,"defaultAnchorColor","#ffffff"),t(An,"inactiveAnchorColor",We.DARK_THEME_SECOND_COLOR),t(An,"DEFAULT_ANCHOR_COLOR","#ffffff"),t(An,"ACTIVE_ANCHOR_COLOR",We.SECONDARY_COLOR),t(An,"INACTIVE_ANCHOR_COLOR",We.DARK_THEME_SECOND_COLOR),t(An,"DEFAULT_LINE_COLOR","#ffffff"),t(An,"ACTIVE_LINE_COLOR",We.PRIMARY_COLOR),t(An,"INACTIVE_LINE_COLOR","#ffffff");var Rn=(e=>(e.DEFAULT="DEFAULT",e.MOVE="MOVE",e.RESIZE="RESIZE",e.ADD="ADD",e.CANCEL="CANCEL",e.CLOSE="CLOSE",e.GRAB="GRAB",e.GRABBING="GRABBING",e))(Rn||{});class Nn{static getLabelNames(){return i6.getState().labels.labels}static getLabelNameById(e){const t=Nn.getLabelNames();return I.exports.find(t,{id:e})}static getActiveLabelNameId(){return i6.getState().labels.activeLabelNameId}static getActiveLabelType(){return i6.getState().labels.activeLabelType}static getImagesData(){return i6.getState().labels.imagesData}static getActiveImageIndex(){return i6.getState().labels.activeImageIndex}static getActiveImageData(){const e=Nn.getActiveImageIndex();return null===e?null:Nn.getImageDataByIndex(e)}static getImageDataByIndex(e){return Nn.getImagesData()[e]}static getImageDataById(e){const t=Nn.getImagesData();return I.exports.find(t,{id:e})}static getActiveLabelId(){return i6.getState().labels.activeLabelId}static getHighlightedLabelId(){return i6.getState().labels.highlightedLabelId}static getActiveRectLabel(){const e=Nn.getActiveLabelId();return null===e?null:I.exports.find(Nn.getActiveImageData().labelRects,{id:e})}static getActivePointLabel(){const e=Nn.getActiveLabelId();return null===e?null:I.exports.find(Nn.getActiveImageData().labelPoints,{id:e})}static getActivePolygonLabel(){const e=Nn.getActiveLabelId();return null===e?null:I.exports.find(Nn.getActiveImageData().labelPolygons,{id:e})}static getActiveLineLabel(){const e=Nn.getActiveLabelId();return null===e?null:I.exports.find(Nn.getActiveImageData().labelLines,{id:e})}}var Pn=(e=>(e.RESIZE="resize",e.MOUSE_UP="mouseup",e.MOUSE_DOWN="mousedown",e.MOUSE_MOVE="mousemove",e.MOUSE_WHEEL="wheel",e.KEY_DOWN="keydown",e.KEY_PRESS="keypress",e.KEY_UP="keyup",e.FOCUS="focus",e))(Pn||{});class Dn{static getEventType(e){if(!e)return null;switch(e.type){case Pn.MOUSE_DOWN:return Pn.MOUSE_DOWN;case Pn.MOUSE_UP:return Pn.MOUSE_UP;case Pn.MOUSE_MOVE:return Pn.MOUSE_MOVE;default:return null}}}class On{static getActivePopupType(){return i6.getState().general.activePopupType}static getActiveContext(){return i6.getState().general.activeContext}static getPreventCustomCursorStatus(){return i6.getState().general.preventCustomCursor}static getImageDragModeStatus(){return i6.getState().general.imageDragMode}static getCrossHairVisibleStatus(){return i6.getState().general.crossHairVisible}static getCustomCursorStyle(){return i6.getState().general.customCursorStyle}static getProjectName(){return i6.getState().general.projectData.name}static getProjectType(){return i6.getState().general.projectData.type}static getZoom(){return i6.getState().general.zoom}static getEnablePerClassColorationStatus(){return i6.getState().general.enablePerClassColoration}static getWindowSize(){return i6.getState().general.windowSize}static isObjectDetectorLoaded(){return i6.getState().ai.isSSDObjectDetectorLoaded}static isPoseDetectionLoaded(){return i6.getState().ai.isPoseDetectorLoaded}static isYOLOV5ObjectDetectorLoaded(){return i6.getState().ai.isYOLOV5ObjectDetectorLoaded}static getRoboflowAPIDetails(){return i6.getState().ai.roboflowAPIDetails}}class Ln{constructor(e){t(this,"canvas"),t(this,"labelType"),this.canvas=e}update(e){if(e.event)switch(Dn.getEventType(e.event)){case Pn.MOUSE_MOVE:this.mouseMoveHandler(e);break;case Pn.MOUSE_UP:this.mouseUpHandler(e);break;case Pn.MOUSE_DOWN:this.mouseDownHandler(e)}}static resolveLabelLineColor(e,t){if(On.getEnablePerClassColorationStatus()){const t=Nn.getLabelNameById(e);return t?t.color:An.DEFAULT_LINE_COLOR}return t?An.ACTIVE_LINE_COLOR:An.INACTIVE_LINE_COLOR}static resolveLabelAnchorColor(e){return On.getEnablePerClassColorationStatus()?An.DEFAULT_ANCHOR_COLOR:e?An.ACTIVE_ANCHOR_COLOR:An.INACTIVE_ANCHOR_COLOR}}class Mn{static getDistanceFromLine(e,t){if(e.start.x!==e.end.x||e.start.y!==e.end.y){return Math.abs((e.end.y-e.start.y)*t.x-(e.end.x-e.start.x)*t.y+e.end.x*e.start.y-e.end.y*e.start.x)/Math.sqrt(Math.pow(e.end.y-e.start.y,2)+Math.pow(e.end.x-e.start.x,2))}return null}static getCenter(e){return{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2}}static getPoints(e){return[e.start,e.end]}}class Fn{static getEdges(e,t=!0){const n=t?e.concat(e[0]):e,i=[];for(let r=0;r<n.length-1;r++)i.push({start:n[r],end:n[r+1]});return i}}class $n{static calculateImageScale(e){return e.realImageSize.width/e.viewPortContentImageRect.width}static isMouseOverImage(e){return Gt.isPointInside(e.viewPortContentImageRect,e.mousePositionOnViewPortContent)}static isMouseOverCanvas(e){return Gt.isPointInside({x:0,y:0,...e.viewPortContentSize},e.mousePositionOnViewPortContent)}static transferPointFromImageToViewPortContent(e,t){const n=$n.calculateImageScale(t);return En.add(En.multiply(e,1/n),t.viewPortContentImageRect)}static transferPolygonFromImageToViewPortContent(e,t){return e.map(e=>$n.transferPointFromImageToViewPortContent(e,t))}static transferLineFromImageToViewPortContent(e,t){return{start:$n.transferPointFromImageToViewPortContent(e.start,t),end:$n.transferPointFromImageToViewPortContent(e.end,t)}}static transferPointFromViewPortContentToImage(e,t){const n=$n.calculateImageScale(t);return En.multiply(En.subtract(e,t.viewPortContentImageRect),n)}static transferPolygonFromViewPortContentToImage(e,t){return e.map(e=>$n.transferPointFromViewPortContentToImage(e,t))}static transferLineFromViewPortContentToImage(e,t){return{start:$n.transferPointFromViewPortContentToImage(e.start,t),end:$n.transferPointFromViewPortContentToImage(e.end,t)}}static transferRectFromViewPortContentToImage(e,t){const n=$n.calculateImageScale(t);return Gt.translate(Gt.scaleRect(e,1/n),t.viewPortContentImageRect)}static transferRectFromImageToViewPortContent(e,t){const n=$n.calculateImageScale(t),i={x:-t.viewPortContentImageRect.x,y:-t.viewPortContentImageRect.y};return Gt.scaleRect(Gt.translate(e,i),n)}static wrapDefaultCursorStyleInCancel(e){Gt.isPointInside(e.viewPortContentImageRect,e.mousePositionOnViewPortContent)?i6.dispatch(vn(Rn.DEFAULT)):i6.dispatch(vn(Rn.CANCEL))}static setValueBetweenPixels(e){return Math.floor(e)+.5}static setPointBetweenPixels(e){return{x:$n.setValueBetweenPixels(e.x),y:$n.setValueBetweenPixels(e.y)}}static setRectBetweenPixels(e){const t={x:e.x,y:e.y},n={x:e.x+e.width,y:e.y+e.height},i=$n.setPointBetweenPixels(t),r=$n.setPointBetweenPixels(n);return{x:i.x,y:i.y,width:r.x-i.x,height:r.y-i.y}}static isMouseOverLine(e,t,n){const i=Math.min(t.start.x,t.end.x),r=Math.max(t.start.x,t.end.x),s=Math.min(t.start.y,t.end.y),a=Math.max(t.start.y,t.end.y);return i-n<=e.x&&r+n>=e.x&&s-n<=e.y&&a+n>=e.y&&Mn.getDistanceFromLine(t,e)<n}static isMouseOverAnchor(e,t,n){const i={width:2*n,height:2*n};return Gt.isPointInside(Gt.getRectWithCenterAndSize(t,i),e)}static isMouseOverPolygon(e,t,n){for(const r of t)if($n.isMouseOverAnchor(e,r,n))return!0;const i=Fn.getEdges(t);for(const r of i)if($n.isMouseOverLine(e,r,n))return!0;return!1}}var Bn,zn=(e=>(e.ACCEPTED="ACCEPTED",e.REJECTED="REJECTED",e.UNDECIDED="UNDECIDED",e))(zn||{}),Un=new Uint8Array(16);function Gn(){if(!Bn&&!(Bn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Bn(Un)}const Vn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Hn=[],Wn=0;Wn<256;++Wn)Hn.push((Wn+256).toString(16).substr(1));function jn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Hn[e[t+0]]+Hn[e[t+1]]+Hn[e[t+2]]+Hn[e[t+3]]+"-"+Hn[e[t+4]]+Hn[e[t+5]]+"-"+Hn[e[t+6]]+Hn[e[t+7]]+"-"+Hn[e[t+8]]+Hn[e[t+9]]+"-"+Hn[e[t+10]]+Hn[e[t+11]]+Hn[e[t+12]]+Hn[e[t+13]]+Hn[e[t+14]]+Hn[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Vn.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function qn(e,t,n){var i=(e=e||{}).random||(e.rng||Gn)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return jn(i)}class Xn{static createLabelName(e){return{id:qn(),name:e,color:I.exports.sample(We.LABEL_COLORS_PALETTE)}}static createLabelRect(e,t,n,i,r){if("object"==typeof t&&"x"in t)return{id:qn(),labelId:e,isVisible:!0,isCreatedByAI:!1,status:zn.ACCEPTED,suggestedLabel:null};const s=t;let a,o;if(r&&r.frameRate&&"number"==typeof s){a=(s/r.frameRate).toFixed(3)+"s"}if(r&&r.frameRate&&"number"==typeof n){o=(n/r.frameRate).toFixed(3)+"s"}return{id:qn(),labelId:e,isVisible:!0,isCreatedByAI:!1,status:zn.ACCEPTED,suggestedLabel:null,timestamp:a,frame:s,endTimestamp:o,endFrame:n,behavior:i}}static createLabelPolygon(e,t){return{id:qn(),labelId:e,vertices:t,isVisible:!0}}static createLabelPoint(e,t){return{id:qn(),labelId:e,point:t,isVisible:!0,isCreatedByAI:!1,status:zn.ACCEPTED,suggestedLabel:null}}static toggleAnnotationVisibility(e){return{...e,isVisible:!e.isVisible}}static labelNamesIdsDiff(e,t){return e.reduce((e,n)=>(I.exports.find(t,{id:n.id})||e.push(n.id),e),[])}}class Kn extends Ln{constructor(e){super(e),t(this,"startCreateRectPoint"),t(this,"startResizeRectAnchor"),t(this,"mouseDownHandler",e=>{const t=$n.isMouseOverImage(e);if($n.isMouseOverCanvas(e)){const n=this.getRectUnderMouse(e);if(n){const t=this.calculateRectRelativeToActiveImage(n.rect,e),i=this.getAnchorUnderMouseByRect(t,e.mousePositionOnViewPortContent,e.viewPortContentImageRect);i&&n.status===zn.ACCEPTED?(i6.dispatch(rn(n.id)),this.startRectResize(i)):Nn.getHighlightedLabelId()?i6.dispatch(rn(Nn.getHighlightedLabelId())):this.startRectCreation(e.mousePositionOnViewPortContent)}else t&&this.startRectCreation(e.mousePositionOnViewPortContent)}}),t(this,"mouseUpHandler",e=>{if(e.viewPortContentImageRect){const t=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),n=Nn.getActiveRectLabel();if(this.startCreateRectPoint&&!En.equals(this.startCreateRectPoint,t)){const n=Math.min(this.startCreateRectPoint.x,t.x),i=Math.min(this.startCreateRectPoint.y,t.y),r={x:n,y:i,width:Math.max(this.startCreateRectPoint.x,t.x)-n,height:Math.max(this.startCreateRectPoint.y,t.y)-i};this.addRectLabel($n.transferRectFromImageToViewPortContent(r,e))}if(this.startResizeRectAnchor&&n){const i=this.calculateRectRelativeToActiveImage(n.rect,e),r=En.add(this.startResizeRectAnchor.position,e.viewPortContentImageRect),s=En.subtract(t,r),a=Gt.resizeRect(i,this.startResizeRectAnchor.type,s),o=$n.calculateImageScale(e),l=Gt.scaleRect(a,o),c=Nn.getActiveImageData();c.labelRects=c.labelRects.map(e=>e.id===n.id?{...e,rect:l}:e),i6.dispatch(on(c.id,c))}}this.endRectTransformation()}),t(this,"mouseMoveHandler",e=>{if(e.viewPortContentImageRect&&e.mousePositionOnViewPortContent){if($n.isMouseOverImage(e)&&!this.startResizeRectAnchor){const t=this.getRectUnderMouse(e);t&&!this.isInProgress()?Nn.getHighlightedLabelId()!==t.id&&i6.dispatch(sn(t.id)):null!==Nn.getHighlightedLabelId()&&i6.dispatch(sn(null))}}}),t(this,"addRectLabel",e=>{const t=Nn.getActiveLabelNameId(),n=Nn.getActiveImageData(),i=Xn.createLabelRect(t,e);n.labelRects.push(i),i6.dispatch(on(n.id,n)),i6.dispatch(dn(!0)),i6.dispatch(rn(i.id))}),this.labelType=je.RECT}render(e){const t=Nn.getActiveLabelId(),n=Nn.getActiveImageData();n&&(n.labelRects.forEach(n=>{n.isVisible&&(n.status===zn.ACCEPTED&&n.id===t?this.drawActiveRect(n,e):this.drawInactiveRect(n,e))}),this.drawCurrentlyCreatedRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),this.updateCursorStyle(e))}drawCurrentlyCreatedRect(e,t){if(this.startCreateRectPoint){const n=Gt.snapPointToRect(e,t),i={x:this.startCreateRectPoint.x,y:this.startCreateRectPoint.y,width:n.x-this.startCreateRectPoint.x,height:n.y-this.startCreateRectPoint.y},r=$n.setRectBetweenPixels(i),s=Ln.resolveLabelLineColor(null,!0);Cn.drawRect(this.canvas,r,s,An.LINE_THICKNESS)}}drawInactiveRect(e,t){const n=$n.transferRectFromViewPortContentToImage(e.rect,t),i=Nn.getHighlightedLabelId(),r=e.status===zn.ACCEPTED&&e.id===i,s=Ln.resolveLabelLineColor(e.labelId,r),a=Ln.resolveLabelAnchorColor(r);this.renderRect(n,r,s,a)}drawActiveRect(e,t){let n=this.calculateRectRelativeToActiveImage(e.rect,t);if(this.startResizeRectAnchor){const e=En.add(this.startResizeRectAnchor.position,t.viewPortContentImageRect),i=Gt.snapPointToRect(t.mousePositionOnViewPortContent,t.viewPortContentImageRect),r=En.subtract(i,e);n=Gt.resizeRect(n,this.startResizeRectAnchor.type,r)}const i=Gt.translate(n,t.viewPortContentImageRect),r=Ln.resolveLabelLineColor(e.labelId,!0),s=Ln.resolveLabelAnchorColor(!0);this.renderRect(i,!0,r,s)}renderRect(e,t,n,i){const r=$n.setRectBetweenPixels(e);if(Cn.drawRectWithFill(this.canvas,r,Cn.hexToRGB(n,.2)),Cn.drawRect(this.canvas,r,n,An.LINE_THICKNESS),t){Gt.mapRectToAnchors(e).map(e=>e.position).forEach(e=>{const t=Gt.getRectWithCenterAndSize(e,An.anchorSize),n=$n.setRectBetweenPixels(t);Cn.drawRectWithFill(this.canvas,n,i)})}}updateCursorStyle(e){if(this.canvas&&e.mousePositionOnViewPortContent&&!On.getImageDragModeStatus()){const t=this.getRectUnderMouse(e);if(this.getAnchorUnderMouse(e)&&t&&t.status===zn.ACCEPTED||this.startResizeRectAnchor)return void i6.dispatch(vn(Rn.MOVE));$n.isMouseOverCanvas(e)?(!$n.isMouseOverImage(e)&&this.startCreateRectPoint?i6.dispatch(vn(Rn.MOVE)):$n.wrapDefaultCursorStyleInCancel(e),this.canvas.style.cursor="none"):this.canvas.style.cursor="default"}}isInProgress(){return!!this.startCreateRectPoint||!!this.startResizeRectAnchor}calculateRectRelativeToActiveImage(e,t){const n=$n.calculateImageScale(t);return Gt.scaleRect(e,1/n)}getRectUnderMouse(e){const t=Nn.getActiveRectLabel();if(t&&t.isVisible&&this.isMouseOverRectEdges(t.rect,e))return t;const n=Nn.getActiveImageData().labelRects;for(const i of n)if(i.isVisible&&this.isMouseOverRectEdges(i.rect,e))return i;return null}isMouseOverRectEdges(e,t){const n=Gt.translate(this.calculateRectRelativeToActiveImage(e,t),t.viewPortContentImageRect),i={x:An.anchorHoverSize.width/2,y:An.anchorHoverSize.height/2},r=Gt.expand(n,i),s={x:-An.anchorHoverSize.width/2,y:-An.anchorHoverSize.height/2},a=Gt.expand(n,s);return Gt.isPointInside(r,t.mousePositionOnViewPortContent)&&!Gt.isPointInside(a,t.mousePositionOnViewPortContent)}getAnchorUnderMouseByRect(e,t,n){const i=Gt.mapRectToAnchors(e);for(let r=0;r<i.length;r++){const e=Gt.translate(Gt.getRectWithCenterAndSize(i[r].position,An.anchorHoverSize),n);if(t&&Gt.isPointInside(e,t))return i[r]}return null}getAnchorUnderMouse(e){const t=Nn.getActiveImageData().labelRects;for(let n=0;n<t.length;n++){const i=this.calculateRectRelativeToActiveImage(t[n].rect,e),r=this.getAnchorUnderMouseByRect(i,e.mousePositionOnViewPortContent,e.viewPortContentImageRect);if(r)return r}return null}startRectCreation(e){this.startCreateRectPoint=e,i6.dispatch(rn(null)),ci.setViewPortActionsDisabledStatus(!0)}startRectResize(e){this.startResizeRectAnchor=e,ci.setViewPortActionsDisabledStatus(!0)}endRectTransformation(){this.startCreateRectPoint=null,this.startResizeRectAnchor=null,ci.setViewPortActionsDisabledStatus(!1)}}class Yn{static getMousePositionOnCanvasFromEvent(e,t){if(t&&e){const n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}return null}static getClientRect(e){if(e){const t=e.getBoundingClientRect();return{x:t.left,y:t.top,width:t.width,height:t.height}}return null}static getSize(e){if(e){const t=e.getBoundingClientRect();return{width:t.width,height:t.height}}return null}}class Zn extends Ln{constructor(e){super(e),t(this,"addPointLabel",e=>{const t=Nn.getActiveLabelNameId(),n=Nn.getActiveImageData(),i=Xn.createLabelPoint(t,e);n.labelPoints.push(i),i6.dispatch(on(n.id,n)),i6.dispatch(dn(!0)),i6.dispatch(rn(i.id))}),this.labelType=je.POINT}mouseDownHandler(e){const t=$n.isMouseOverImage(e);if($n.isMouseOverCanvas(e)){const n=this.getLabelPointUnderMouse(e.mousePositionOnViewPortContent,e);if(n){const t=$n.transferPointFromImageToViewPortContent(n.point,e),i=$n.setPointBetweenPixels(t),r=Gt.getRectWithCenterAndSize(i,An.anchorHoverSize);if(Gt.isPointInside(r,e.mousePositionOnViewPortContent))return i6.dispatch(rn(n.id)),void ci.setViewPortActionsDisabledStatus(!0);{i6.dispatch(rn(null));const t=$n.transferPointFromViewPortContentToImage(e.mousePositionOnViewPortContent,e);this.addPointLabel(t)}}else if(t){const t=$n.transferPointFromViewPortContentToImage(e.mousePositionOnViewPortContent,e);this.addPointLabel(t)}}}mouseUpHandler(e){if(this.isInProgress()){const t=Nn.getActivePointLabel(),n=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),i=$n.transferPointFromViewPortContentToImage(n,e),r=Nn.getActiveImageData();r.labelPoints=r.labelPoints.map(e=>e.id===t.id?{...e,point:i}:e),i6.dispatch(on(r.id,r))}ci.setViewPortActionsDisabledStatus(!1)}mouseMoveHandler(e){if($n.isMouseOverImage(e)){const t=this.getLabelPointUnderMouse(e.mousePositionOnViewPortContent,e);t?Nn.getHighlightedLabelId()!==t.id&&i6.dispatch(sn(t.id)):null!==Nn.getHighlightedLabelId()&&i6.dispatch(sn(null))}}render(e){const t=Nn.getActiveLabelId(),n=Nn.getHighlightedLabelId(),i=Nn.getActiveImageData();i&&i.labelPoints.forEach(i=>{if(i.isVisible)if(i.id===t)if(this.isInProgress()){const t=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),n=$n.setPointBetweenPixels(t),i=Ln.resolveLabelAnchorColor(!0);Cn.drawCircleWithFill(this.canvas,n,We.RESIZE_HANDLE_DIMENSION_PX/2,i)}else this.renderPoint(i,!0,e);else this.renderPoint(i,i.id===t||i.id===n,e)}),this.updateCursorStyle(e)}renderPoint(e,t,n){const i=$n.transferPointFromImageToViewPortContent(e.point,n),r=$n.setPointBetweenPixels(i),s=Ln.resolveLabelAnchorColor(t);Cn.drawCircleWithFill(this.canvas,r,We.RESIZE_HANDLE_DIMENSION_PX/2,s)}updateCursorStyle(e){if(this.canvas&&e.mousePositionOnViewPortContent&&!On.getImageDragModeStatus()){const t=this.getLabelPointUnderMouse(e.mousePositionOnViewPortContent,e);if(t&&t.status===zn.ACCEPTED){const n=$n.transferPointFromImageToViewPortContent(t.point,e),i=$n.setPointBetweenPixels(n),r=Gt.getRectWithCenterAndSize(i,An.anchorHoverSize);if(Gt.isPointInside(r,e.mousePositionOnViewPortContent))return void i6.dispatch(vn(Rn.MOVE))}else if(this.isInProgress())return void i6.dispatch(vn(Rn.MOVE));Gt.isPointInside({x:0,y:0,...Yn.getSize(this.canvas)},e.mousePositionOnViewPortContent)?($n.wrapDefaultCursorStyleInCancel(e),this.canvas.style.cursor="none"):this.canvas.style.cursor="default"}}isInProgress(){return In.viewPortActionsDisabled}getLabelPointUnderMouse(e,t){const n=Nn.getActiveImageData().labelPoints.filter(e=>e.isVisible);for(const i of n){const n=$n.transferPointFromImageToViewPortContent(i.point,t),r=Gt.getRectWithCenterAndSize(n,An.anchorHoverSize);if(Gt.isPointInside(r,e))return i}return null}}class Qn extends Ln{constructor(e){super(e),t(this,"activePath",[]),t(this,"resizeAnchorIndex",null),t(this,"suggestedAnchorPositionOnCanvas",null),t(this,"suggestedAnchorIndexInPolygon",null),this.labelType=je.POLYGON}update(e){if(e.event)switch(Dn.getEventType(e.event)){case Pn.MOUSE_MOVE:this.mouseMoveHandler(e);break;case Pn.MOUSE_UP:this.mouseUpHandler(e);break;case Pn.MOUSE_DOWN:this.mouseDownHandler(e)}}mouseDownHandler(e){if($n.isMouseOverCanvas(e))if(this.isCreationInProgress()){this.isMouseOverAnchor(e.mousePositionOnViewPortContent,this.activePath[0])?this.addLabelAndFinishCreation(e):this.updateActivelyCreatedLabel(e)}else{const t=this.getPolygonUnderMouse(e);if(t){const n=t.vertices.reduce((t,n,i)=>{if(null===t){const t=$n.transferPointFromImageToViewPortContent(n,e);if(this.isMouseOverAnchor(e.mousePositionOnViewPortContent,t))return i}return t},null);if(null!==n)this.startExistingLabelResize(e,t.id,n);else{i6.dispatch(rn(t.id));this.isMouseOverAnchor(e.mousePositionOnViewPortContent,this.suggestedAnchorPositionOnCanvas)&&this.addSuggestedAnchorToPolygonLabel(e)}}else this.updateActivelyCreatedLabel(e)}}mouseUpHandler(e){this.isResizeInProgress()&&this.endExistingLabelResize(e)}mouseMoveHandler(e){if(e.viewPortContentImageRect&&e.mousePositionOnViewPortContent){if($n.isMouseOverImage(e)&&!this.isCreationInProgress()){const t=this.getPolygonUnderMouse(e);if(t&&!this.isResizeInProgress()){Nn.getHighlightedLabelId()!==t.id&&i6.dispatch(sn(t.id));const n=$n.transferPolygonFromImageToViewPortContent(t.vertices,e),i=Fn.getEdges(n);for(let t=0;t<i.length;t++){if($n.isMouseOverLine(e.mousePositionOnViewPortContent,i[t],An.anchorHoverSize.width/2)){this.suggestedAnchorPositionOnCanvas=Mn.getCenter(i[t]),this.suggestedAnchorIndexInPolygon=t+1;break}}}else null!==Nn.getHighlightedLabelId()&&(i6.dispatch(sn(null)),this.discardSuggestedPoint())}}}render(e){Nn.getActiveImageData()&&(this.drawExistingLabels(e),this.drawActivelyCreatedLabel(e),this.drawActivelyResizeLabel(e),this.updateCursorStyle(e),this.drawSuggestedAnchor(e))}updateCursorStyle(e){if(this.canvas&&e.mousePositionOnViewPortContent&&!On.getImageDragModeStatus()){if($n.isMouseOverCanvas(e)){if(this.isCreationInProgress()){this.isMouseOverAnchor(e.mousePositionOnViewPortContent,this.activePath[0])&&this.activePath.length>2?i6.dispatch(vn(Rn.CLOSE)):i6.dispatch(vn(Rn.DEFAULT))}else{const t=this.getAnchorUnderMouse(e);this.isMouseOverAnchor(e.mousePositionOnViewPortContent,this.suggestedAnchorPositionOnCanvas)?i6.dispatch(vn(Rn.ADD)):this.isResizeInProgress()||t?i6.dispatch(vn(Rn.MOVE)):$n.wrapDefaultCursorStyleInCancel(e)}this.canvas.style.cursor="none"}else this.canvas.style.cursor="default"}}drawActivelyCreatedLabel(e){const t=this.activePath.map(e=>$n.setPointBetweenPixels(e)),n=t.concat(e.mousePositionOnViewPortContent),i=Fn.getEdges(n,!1),r=Ln.resolveLabelLineColor(null,!0),s=Ln.resolveLabelAnchorColor(!0);Cn.drawPolygonWithFill(this.canvas,n,Cn.hexToRGB(r,.2)),i.forEach(e=>{Cn.drawLine(this.canvas,e.start,e.end,r,An.LINE_THICKNESS)}),t.forEach(e=>{Cn.drawCircleWithFill(this.canvas,e,We.RESIZE_HANDLE_DIMENSION_PX/2,s)})}drawActivelyResizeLabel(e){const t=Nn.getActivePolygonLabel();if(t&&this.isResizeInProgress()){const n=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),i=t.vertices.map((t,i)=>i===this.resizeAnchorIndex?n:$n.transferPointFromImageToViewPortContent(t,e));this.drawPolygon(t.labelId,i,!0)}}drawExistingLabels(e){const t=Nn.getActiveLabelId(),n=Nn.getHighlightedLabelId();Nn.getActiveImageData().labelPolygons.forEach(i=>{if(i.isVisible){const r=i.id===t||i.id===n,s=$n.transferPolygonFromImageToViewPortContent(i.vertices,e);i.id===t&&this.isResizeInProgress()||this.drawPolygon(i.labelId,s,r)}})}drawPolygon(e,t,n){const i=Ln.resolveLabelLineColor(e,!0),r=Ln.resolveLabelAnchorColor(!0),s=t.map(e=>$n.setPointBetweenPixels(e));n&&Cn.drawPolygonWithFill(this.canvas,s,Cn.hexToRGB(i,.2)),Cn.drawPolygon(this.canvas,s,i,An.LINE_THICKNESS),n&&s.forEach(e=>{Cn.drawCircleWithFill(this.canvas,e,We.RESIZE_HANDLE_DIMENSION_PX/2,r)})}drawSuggestedAnchor(e){const t=Ln.resolveLabelAnchorColor(!0);if(this.suggestedAnchorPositionOnCanvas){const n=Gt.getRectWithCenterAndSize(this.suggestedAnchorPositionOnCanvas,An.suggestedAnchorDetectionSize);Gt.isPointInside(n,e.mousePositionOnViewPortContent)&&Cn.drawCircleWithFill(this.canvas,this.suggestedAnchorPositionOnCanvas,We.RESIZE_HANDLE_DIMENSION_PX/2,t)}}updateActivelyCreatedLabel(e){if(this.isCreationInProgress()){const t=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect);this.activePath.push(t)}else{Gt.isPointInside(e.viewPortContentImageRect,e.mousePositionOnViewPortContent)&&(ci.setViewPortActionsDisabledStatus(!0),this.activePath.push(e.mousePositionOnViewPortContent),i6.dispatch(rn(null)))}}cancelLabelCreation(){this.activePath=[],ci.setViewPortActionsDisabledStatus(!1)}finishLabelCreation(){this.activePath=[],ci.setViewPortActionsDisabledStatus(!1)}addLabelAndFinishCreation(e){if(this.isCreationInProgress()&&this.activePath.length>2){const t=$n.transferPolygonFromViewPortContentToImage(this.activePath,e);this.addPolygonLabel(t),this.finishLabelCreation()}}addPolygonLabel(e){const t=Nn.getActiveLabelNameId(),n=Nn.getActiveImageData(),i=Xn.createLabelPolygon(t,e);n.labelPolygons.push(i),i6.dispatch(on(n.id,n)),i6.dispatch(dn(!0)),i6.dispatch(rn(i.id))}startExistingLabelResize(e,t,n){i6.dispatch(rn(t)),this.resizeAnchorIndex=n,ci.setViewPortActionsDisabledStatus(!0)}endExistingLabelResize(e){this.applyResizeToPolygonLabel(e),this.resizeAnchorIndex=null,ci.setViewPortActionsDisabledStatus(!1)}applyResizeToPolygonLabel(e){const t=Nn.getActiveImageData(),n=Nn.getActivePolygonLabel();t.labelPolygons=t.labelPolygons.map(t=>t.id!==n.id?t:{...t,vertices:t.vertices.map((t,n)=>{if(n!==this.resizeAnchorIndex)return t;{const t=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect);return $n.transferPointFromViewPortContentToImage(t,e)}})}),i6.dispatch(on(t.id,t)),i6.dispatch(rn(n.id))}discardSuggestedPoint(){this.suggestedAnchorIndexInPolygon=null,this.suggestedAnchorPositionOnCanvas=null}addSuggestedAnchorToPolygonLabel(e){const t=Nn.getActiveImageData(),n=Nn.getActivePolygonLabel(),i=$n.transferPointFromViewPortContentToImage(this.suggestedAnchorPositionOnCanvas,e),r={...t,labelPolygons:t.labelPolygons.map(e=>{return e.id!==n.id?e:{...e,vertices:(t=e.vertices,r=this.suggestedAnchorIndexInPolygon,s=i,[...t.slice(0,r),s,...t.slice(r)])};var t,r,s})};i6.dispatch(on(r.id,r)),this.startExistingLabelResize(e,n.id,this.suggestedAnchorIndexInPolygon),this.discardSuggestedPoint()}isInProgress(){return this.isCreationInProgress()||this.isResizeInProgress()}isCreationInProgress(){return null!==this.activePath&&0!==this.activePath.length}isResizeInProgress(){return null!==this.resizeAnchorIndex}isMouseOverAnchor(e,t){return e&&t?Gt.isPointInside(Gt.getRectWithCenterAndSize(t,An.anchorSize),e):null}getPolygonUnderMouse(e){const t=e.mousePositionOnViewPortContent;if(!t)return null;const n=Nn.getActiveImageData().labelPolygons.filter(e=>e.isVisible),i=An.anchorHoverSize.width/2;for(const r of n){const n=$n.transferPolygonFromImageToViewPortContent(r.vertices,e);if($n.isMouseOverPolygon(t,n,i))return r}return null}getAnchorUnderMouse(e){const t=e.mousePositionOnViewPortContent;if(!t)return null;const n=Nn.getActiveImageData().labelPolygons.filter(e=>e.isVisible),i=An.anchorHoverSize.width/2;for(const r of n){const n=$n.transferPolygonFromImageToViewPortContent(r.vertices,e);for(const e of n)if($n.isMouseOverAnchor(t,e,i))return e}return null}}class Jn{}t(Jn,"CANVAS_MIN_MARGIN_PX",20),t(Jn,"MIN_ZOOM",1),t(Jn,"MAX_ZOOM",4),t(Jn,"ZOOM_STEP",.1),t(Jn,"TRANSLATION_STEP_PX",20);class ei{static getSize(e){return e?{width:e.width,height:e.height}:null}}class ti{static scale(e,t){return{width:e.width*t,height:e.height*t}}}class ni{static convertDirectionToVector(e){switch(e){case Ge.RIGHT:return{x:1,y:0};case Ge.LEFT:return{x:-1,y:0};case Ge.TOP:return{x:0,y:1};case Ge.BOTTOM:return{x:0,y:-1};case Ge.TOP_RIGHT:return{x:1,y:1};case Ge.TOP_LEFT:return{x:-1,y:1};case Ge.BOTTOM_RIGHT:return{x:1,y:-1};case Ge.BOTTOM_LEFT:return{x:-1,y:-1};case Ge.CENTER:return{x:0,y:0};default:return null}}}class ii{static updateViewPortSize(){In.editor&&(In.viewPortSize={width:In.editor.offsetWidth,height:In.editor.offsetHeight})}static updateDefaultViewPortImageRect(){if(In.viewPortSize&&In.image){const e={x:Jn.CANVAS_MIN_MARGIN_PX,y:Jn.CANVAS_MIN_MARGIN_PX},t={x:0,y:0,...ei.getSize(In.image)},n={x:0,y:0,...In.viewPortSize},i=Gt.expand(n,En.multiply(e,-1));In.defaultRenderImageRect=Gt.fitInsideRectWithRatio(i,Gt.getRatio(t))}}static calculateViewPortContentSize(){if(In.viewPortSize&&In.image){const e=In.defaultRenderImageRect,t=ti.scale(In.defaultRenderImageRect,On.getZoom());return{width:t.width+2*e.x,height:t.height+2*e.y}}return null}static calculateViewPortContentImageRect(){if(In.viewPortSize&&In.image){const e=In.defaultRenderImageRect,t=ii.calculateViewPortContentSize();return{...e,width:t.width-2*e.x,height:t.height-2*e.y}}return null}static resizeCanvas(e){e&&In.canvas&&(In.canvas.width=e.width,In.canvas.height=e.height)}static resizeViewPortContent(){const e=ii.calculateViewPortContentSize();e&&ii.resizeCanvas(e)}static calculateAbsoluteScrollPosition(e){const t=ii.calculateViewPortContentSize(),n=In.viewPortSize;return{x:e.x*(t.width-n.width),y:e.y*(t.height-n.height)}}static getRelativeScrollPosition(){if(In.viewPortScrollbars){const e=In.viewPortScrollbars.getValues();return{x:e.left,y:e.top}}return null}static getAbsoluteScrollPosition(){if(In.viewPortScrollbars){const e=In.viewPortScrollbars.getValues();return{x:e.scrollLeft,y:e.scrollTop}}return null}static setScrollPosition(e){In.viewPortScrollbars.scrollLeft(e.x),In.viewPortScrollbars.scrollTop(e.y)}static translateViewPortPosition(e){if(In.viewPortActionsDisabled||On.getZoom()===Jn.MIN_ZOOM)return;const t=ni.convertDirectionToVector(e),n=En.multiply(t,Jn.TRANSLATION_STEP_PX),i=ii.getAbsoluteScrollPosition(),r=En.add(i,n);ii.setScrollPosition(r),In.mousePositionOnViewPortContent=En.add(In.mousePositionOnViewPortContent,n),ci.fullRender()}static zoomIn(){if(In.viewPortActionsDisabled)return;const e=On.getZoom(),t=ii.getRelativeScrollPosition(),n=1===e?{x:.5,y:.5}:t;ii.setZoom(e+Jn.ZOOM_STEP),ii.resizeViewPortContent(),ii.setScrollPosition(ii.calculateAbsoluteScrollPosition(n)),ci.fullRender()}static zoomOut(){if(In.viewPortActionsDisabled)return;const e=On.getZoom(),t=ii.getRelativeScrollPosition();ii.setZoom(e-Jn.ZOOM_STEP),ii.resizeViewPortContent(),ii.setScrollPosition(ii.calculateAbsoluteScrollPosition(t)),ci.fullRender()}static setDefaultZoom(){const e=ii.getRelativeScrollPosition();ii.setZoom(Jn.MIN_ZOOM),ii.resizeViewPortContent(),ii.setScrollPosition(ii.calculateAbsoluteScrollPosition(e)),ci.fullRender()}static setOneForOneZoom(){const e=On.getZoom(),t=ii.getRelativeScrollPosition(),n=1===e?{x:.5,y:.5}:t,i=In.image.width/In.defaultRenderImageRect.width;ii.setZoom(i),ii.resizeViewPortContent(),ii.setScrollPosition(ii.calculateAbsoluteScrollPosition(n)),ci.fullRender()}static setZoom(e){const t=On.getZoom();var n;Ut.isValueInRange(e,Jn.MIN_ZOOM,Jn.MAX_ZOOM)&&e!==t&&i6.dispatch((n=e,{type:en.UPDATE_ZOOM,payload:{zoom:n}}))}}var ri=(e=>(e.VIDEO_RECOGNITION="VIDEO_RECOGNITION",e.OBJECT_DETECTION="OBJECT_DETECTION",e.VIDEO="VIDEO",e))(ri||{});class si extends Ln{constructor(e){super(e)}mouseMoveHandler(e){}mouseDownHandler(e){}mouseUpHandler(e){}render(e){this.drawImage(In.image,ii.calculateViewPortContentImageRect()),this.renderCrossHair(e)}renderCrossHair(e){if(!this.shouldRenderCrossHair(e))return;const t=$n.setPointBetweenPixels(e.mousePositionOnViewPortContent),n=(e,t)=>{Cn.drawLine(this.canvas,e,t,An.CROSS_HAIR_LINE_COLOR,2)};n({x:t.x,y:0},{x:t.x-1,y:t.y-An.crossHairPadding}),n({x:t.x,y:t.y+An.crossHairPadding},{x:t.x-1,y:e.viewPortContentSize.height}),n({x:0,y:t.y},{x:t.x-An.crossHairPadding,y:t.y-1}),n({x:t.x+An.crossHairPadding,y:t.y},{x:e.viewPortContentSize.width,y:t.y-1})}shouldRenderCrossHair(e){const t=On.getCrossHairVisibleStatus(),n=On.getImageDragModeStatus(),i=On.getProjectType(),r=On.getActivePopupType(),s=$n.isMouseOverCanvas(e),a=On.getPreventCustomCursorStatus();return[!!this.canvas,t,!n,i!==ri.VIDEO_RECOGNITION,!r,s,!a].every(Boolean)}drawImage(e,t){if(e&&this.canvas){this.canvas.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height)}}isInProgress(){return!1}}class ai{constructor(){t(this,"startScrollPosition"),t(this,"mouseStartPosition")}update(e){if(e.event)switch(Dn.getEventType(e.event)){case Pn.MOUSE_MOVE:this.mouseMoveHandler(e);break;case Pn.MOUSE_UP:this.mouseUpHandler(e);break;case Pn.MOUSE_DOWN:this.mouseDownHandler(e)}}mouseDownHandler(e){const t=e.event;this.startScrollPosition=e.absoluteViewPortContentScrollPosition,this.mouseStartPosition={x:t.screenX,y:t.screenY},i6.dispatch(vn(Rn.GRABBING)),In.canvas.style.cursor="none"}mouseUpHandler(e){this.startScrollPosition=null,this.mouseStartPosition=null,i6.dispatch(vn(Rn.GRAB)),In.canvas.style.cursor="none"}mouseMoveHandler(e){if(this.startScrollPosition&&this.mouseStartPosition){const t=e.event,n={x:t.screenX,y:t.screenY},i=En.subtract(n,this.mouseStartPosition),r=En.subtract(this.startScrollPosition,i);ii.setScrollPosition(r),i6.dispatch(vn(Rn.GRABBING))}else i6.dispatch(vn(Rn.GRAB));In.canvas.style.cursor="none"}}var oi=(e=>(e.START="START",e.END="END",e))(oi||{});class li extends Ln{constructor(e){super(e),t(this,"lineCreationStartPoint"),t(this,"lineUpdateAnchorType"),t(this,"startNewLabelCreation",e=>{this.lineCreationStartPoint=$n.setPointBetweenPixels(e.mousePositionOnViewPortContent),ci.setViewPortActionsDisabledStatus(!0)}),t(this,"finishNewLabelCreation",e=>{const t=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),n={start:this.lineCreationStartPoint,end:t},i=$n.transferLineFromViewPortContentToImage(n,e),r=Nn.getActiveLabelNameId(),s=Nn.getActiveImageData(),a={id:qn(),labelId:r,line:i,isVisible:!0};s.labelLines.push(a),i6.dispatch(on(s.id,s)),i6.dispatch(dn(!0)),i6.dispatch(rn(a.id)),this.lineCreationStartPoint=null,ci.setViewPortActionsDisabledStatus(!1)}),this.labelType=je.LINE}mouseDownHandler(e){const t=$n.isMouseOverImage(e),n=$n.isMouseOverCanvas(e),i=this.getAnchorTypeUnderMouse(e),r=this.getLineUnderMouse(e);n&&(i&&!this.isResizeInProgress()?this.startExistingLabelUpdate(r.id,i):null!==r?i6.dispatch(rn(r.id)):!this.isInProgress()&&t?this.startNewLabelCreation(e):this.isInProgress()&&this.finishNewLabelCreation(e))}mouseUpHandler(e){this.isResizeInProgress()&&this.endExistingLabelUpdate(e)}mouseMoveHandler(e){if($n.isMouseOverImage(e)){const t=this.getLineUnderMouse(e);t?Nn.getHighlightedLabelId()!==t.id&&i6.dispatch(sn(t.id)):null!==Nn.getHighlightedLabelId()&&i6.dispatch(sn(null))}}render(e){this.drawExistingLabels(e),this.drawActivelyCreatedLabel(e),this.drawActivelyResizeLabel(e),this.updateCursorStyle(e)}drawExistingLabels(e){const t=Nn.getActiveLabelId(),n=Nn.getHighlightedLabelId();Nn.getActiveImageData().labelLines.forEach(i=>{if(i.isVisible){const r=i.id===t||i.id===n,s=$n.transferLineFromImageToViewPortContent(i.line,e);i.id===t&&this.isResizeInProgress()||this.drawLine(i.labelId,s,r)}})}drawActivelyCreatedLabel(e){if(this.isInProgress()){const t={start:this.lineCreationStartPoint,end:e.mousePositionOnViewPortContent};Cn.drawLine(this.canvas,t.start,t.end,An.lineActiveColor,An.LINE_THICKNESS),Cn.drawCircleWithFill(this.canvas,this.lineCreationStartPoint,We.RESIZE_HANDLE_DIMENSION_PX/2,An.defaultAnchorColor)}}drawActivelyResizeLabel(e){const t=Nn.getActiveLineLabel();if(t&&this.isResizeInProgress()){const n=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),i=$n.transferLineFromImageToViewPortContent(t.line,e),r={start:this.lineUpdateAnchorType===oi.START?n:i.start,end:this.lineUpdateAnchorType===oi.END?n:i.end};this.drawLine(t.labelId,r,!0)}}updateCursorStyle(e){if(this.canvas&&e.mousePositionOnViewPortContent&&!On.getImageDragModeStatus()){if($n.isMouseOverCanvas(e)){const t=this.getAnchorTypeUnderMouse(e);!this.isInProgress()&&t||this.isResizeInProgress()?i6.dispatch(vn(Rn.MOVE)):$n.wrapDefaultCursorStyleInCancel(e),this.canvas.style.cursor="none"}else this.canvas.style.cursor="default"}}drawLine(e,t,n){const i=Ln.resolveLabelLineColor(e,n),r=Ln.resolveLabelAnchorColor(n),s={start:$n.setPointBetweenPixels(t.start),end:$n.setPointBetweenPixels(t.end)};Cn.drawLine(this.canvas,s.start,s.end,i,An.LINE_THICKNESS),n&&Mn.getPoints(t).forEach(e=>Cn.drawCircleWithFill(this.canvas,e,We.RESIZE_HANDLE_DIMENSION_PX/2,r))}isInProgress(){return!!this.lineCreationStartPoint}isResizeInProgress(){return!!this.lineUpdateAnchorType}cancelLabelCreation(){this.lineCreationStartPoint=null,ci.setViewPortActionsDisabledStatus(!1)}startExistingLabelUpdate(e,t){i6.dispatch(rn(e)),this.lineUpdateAnchorType=t,ci.setViewPortActionsDisabledStatus(!0)}endExistingLabelUpdate(e){this.applyUpdateToLineLabel(e),this.lineUpdateAnchorType=null,ci.setViewPortActionsDisabledStatus(!1)}applyUpdateToLineLabel(e){const t=Nn.getActiveImageData(),n=Nn.getActiveLineLabel();t.labelLines=t.labelLines.map(t=>{if(t.id!==n.id)return t;{const n=Gt.snapPointToRect(e.mousePositionOnViewPortContent,e.viewPortContentImageRect),i=$n.transferPointFromViewPortContentToImage(n,e);return{...t,line:{start:this.lineUpdateAnchorType===oi.START?i:t.line.start,end:this.lineUpdateAnchorType===oi.END?i:t.line.end}}}}),i6.dispatch(on(t.id,t)),i6.dispatch(rn(n.id))}getLineUnderMouse(e){const t=e.mousePositionOnViewPortContent;if(!t)return null;const n=Nn.getActiveImageData().labelLines.filter(e=>e.isVisible),i=An.anchorHoverSize.width/2;for(const r of n){const n=$n.transferLineFromImageToViewPortContent(r.line,e);if($n.isMouseOverLine(t,n,i))return r}return null}getAnchorTypeUnderMouse(e){const t=e.mousePositionOnViewPortContent;if(!t)return null;const n=Nn.getActiveImageData().labelLines.filter(e=>e.isVisible),i=An.anchorHoverSize.width/2;for(const r of n){const n=$n.transferLineFromImageToViewPortContent(r.line,e);if($n.isMouseOverAnchor(t,n.start,i))return oi.START;if($n.isMouseOverAnchor(t,n.end,i))return oi.END}return null}}class ci{static mountSupportRenderingEngine(e){switch(e){case je.RECT:In.supportRenderingEngine=new Kn(In.canvas);break;case je.POINT:In.supportRenderingEngine=new Zn(In.canvas);break;case je.LINE:In.supportRenderingEngine=new li(In.canvas);break;case je.POLYGON:In.supportRenderingEngine=new Qn(In.canvas);break;default:In.supportRenderingEngine=null}}static swapSupportRenderingEngine(e){ci.mountSupportRenderingEngine(e)}static mountRenderEnginesAndHelpers(e){In.viewPortHelper=new ai,In.primaryRenderingEngine=new si(In.canvas),ci.mountSupportRenderingEngine(e)}static fullRender(){Cn.clearCanvas(In.canvas),In.primaryRenderingEngine.render(ci.getEditorData()),In.supportRenderingEngine&&In.supportRenderingEngine.render(ci.getEditorData())}static setLoadingStatus(e){In.isLoading=e}static setActiveImage(e){In.image=e}static setViewPortActionsDisabledStatus(e){In.viewPortActionsDisabled=e}static getEditorData(e){return{mousePositionOnViewPortContent:In.mousePositionOnViewPortContent,viewPortContentSize:Yn.getSize(In.canvas),activeKeyCombo:_i.getActiveCombo(),event:e,zoom:On.getZoom(),viewPortSize:In.viewPortSize,defaultRenderImageRect:In.defaultRenderImageRect,viewPortContentImageRect:ii.calculateViewPortContentImageRect(),realImageSize:ei.getSize(In.image),absoluteViewPortContentScrollPosition:ii.getAbsoluteScrollPosition()}}static updateMousePositionIndicator(e){if(!In.image||!In.canvas)return In.mousePositionIndicator.style.display="none",void(In.cursor.style.display="none");const t=Yn.getMousePositionOnCanvasFromEvent(e,In.canvas),n=ii.getAbsoluteScrollPosition(),i=ii.calculateViewPortContentImageRect(),r=En.subtract(t,n),s=Gt.isPointInside(i,t);if(Gt.isPointInside({x:0,y:0,...In.viewPortSize},r)&&!On.getPreventCustomCursorStatus())if(In.cursor.style.left=r.x+"px",In.cursor.style.top=r.y+"px",In.cursor.style.display="block",s&&![Rn.GRAB,Rn.GRABBING].includes(On.getCustomCursorStyle())){const e=ei.getSize(In.image).width/i.width,n=En.multiply(En.subtract(t,i),e),s="x: "+Math.round(n.x)+", y: "+Math.round(n.y);In.mousePositionIndicator.innerHTML=s,In.mousePositionIndicator.style.left=r.x+15+"px",In.mousePositionIndicator.style.top=r.y+15+"px",In.mousePositionIndicator.style.display="block"}else In.mousePositionIndicator.style.display="none";else In.cursor.style.display="none",In.mousePositionIndicator.style.display="none"}}class ui{static getActions(){return this.actions}}t(ui,"actions",[]);class di{static getPreviousImage(){const e=Nn.getActiveImageIndex();di.getImageByIndex(e-1)}static getNextImage(){const e=Nn.getActiveImageIndex();di.getImageByIndex(e+1)}static getImageByIndex(e){if(In.viewPortActionsDisabled)return;const t=Nn.getImagesData().length;e<0||e>t-1||(ii.setZoom(1),i6.dispatch(tn(e)),i6.dispatch(rn(null)))}static setActiveLabelOnActiveImage(e){const t=Nn.getLabelNames();if(t.length<e+1)return;const n=Nn.getActiveImageData();i6.dispatch(on(n.id,di.mapNewImageData(n,e))),i6.dispatch(nn(t[1].id))}static mapNewImageData(e,t){const n=Nn.getActiveLabelType(),i=Nn.getLabelNames();let r={...e};switch(n){case je.POINT:const n=Nn.getActivePointLabel();r.labelPoints=e.labelPoints.map(e=>e.id===n.id?{...e,labelId:i[t].id,status:zn.ACCEPTED}:e),i6.dispatch(rn(n.id));break;case je.LINE:const s=Nn.getActiveLineLabel();r.labelLines=e.labelLines.map(e=>e.id===s.id?{...e,labelId:i[t].id,status:zn.ACCEPTED}:e),i6.dispatch(rn(s.id));break;case je.RECT:const a=Nn.getActiveRectLabel();r.labelRects=e.labelRects.map(e=>e.id===a.id?{...e,labelId:i[t].id,status:zn.ACCEPTED}:e),i6.dispatch(rn(a.id));break;case je.POLYGON:const o=Nn.getActivePolygonLabel();r.labelPolygons=e.labelPolygons.map(e=>e.id===o.id?{...e,labelId:i[t].id,status:zn.ACCEPTED}:e),i6.dispatch(rn(o.id));break;case je.VIDEO_RECOGNITION:const l=i[t].id;e.labelNameIds.includes(l)?r.labelNameIds=I.exports.remove(e.labelNameIds,e=>e!==l):r.labelNameIds=e.labelNameIds.concat(l)}return r}}var hi,pi,fi={exports:{}};hi=fi,function(){if(hi.exports)return function(e){hi.exports=e()};if("undefined"!=typeof window)return function(e){window.MobileDetect=e()};throw new Error("unknown environment")}()(function(){var e,t={mobileDetectRules:{phones:{iPhone:"\\biPhone\\b|\\biPod\\b",BlackBerry:"BlackBerry|\\bBB10\\b|rim[0-9]+|\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\b-[0-9]+",Pixel:"; \\bPixel\\b",HTC:"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\bEVO\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel",Nexus:"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 5X|Nexus 6",Dell:"Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\b001DL\\b|\\b101DL\\b|\\bGS01\\b",Motorola:"Motorola|DROIDX|DROID BIONIC|\\bDroid\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\bMoto E\\b|XT1068|XT1092|XT1052",Samsung:"\\bSamsung\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F|SM-G610F|SM-G981B|SM-G892A|SM-A530F",LG:"\\bLG\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710",Sony:"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533|SOV34|601SO|F8332",Asus:"Asus.*Galaxy|PadFone.*Mobile",Xiaomi:"^(?!.*\\bx11\\b).*xiaomi.*$|POCOPHONE F1|MI 8|Redmi Note 9S|Redmi Note 5A Prime|N2G47H|M2001J2G|M2001J2I|M1805E10A|M2004J11G|M1902F1G|M2002J9G|M2004J19G|M2003J6A1G",NokiaLumia:"Lumia [0-9]{3,4}",Micromax:"Micromax.*\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\b",Palm:"PalmSource|Palm",Vertu:"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature",Pantech:"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790",Fly:"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250",Wiko:"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM",iMobile:"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)",SimValley:"\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\b",Wolfgang:"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q",Alcatel:"Alcatel",Nintendo:"Nintendo (3DS|Switch)",Amoi:"Amoi",INQ:"INQ",OnePlus:"ONEPLUS",GenericPhone:"Tapatalk|PDA;|SAGEM|\\bmmp\\b|pocket|\\bpsp\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\bwap\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser"},tablets:{iPad:"iPad|iPad.*Mobile",NexusTablet:"Android.*Nexus[\\s]+(7|9|10)",GoogleTablet:"Android.*Pixel C",SamsungTablet:"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V|SM-P610|SM-T290|SM-T515|SM-T590|SM-T595|SM-T725|SM-T817P|SM-P585N0|SM-T395|SM-T295|SM-T865|SM-P610N|SM-P615|SM-T970|SM-T380|SM-T5950|SM-T905|SM-T231|SM-T500|SM-T860",Kindle:"Kindle|Silk.*Accelerated|Android.*\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\b|Android.*Silk/[0-9.]+ like Chrome/[0-9.]+ (?!Mobile)",SurfaceTablet:"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)",HPTablet:"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10",AsusTablet:"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\bK00F\\b|\\bK00C\\b|\\bK00E\\b|\\bK00L\\b|TX201LA|ME176C|ME102A|\\bM80TA\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\bME70C\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\bP027\\b|\\bP024\\b|\\bP00C\\b",BlackBerryTablet:"PlayBook|RIM Tablet",HTCtablet:"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410",MotorolaTablet:"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617",NookTablet:"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2",AcerTablet:"Android.*; \\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\b|W3-810|\\bA3-A10\\b|\\bA3-A11\\b|\\bA3-A20\\b|\\bA3-A30|A3-A40",ToshibaTablet:"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO",LGTablet:"\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\b",FujitsuTablet:"Android.*\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\b",PrestigioTablet:"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002",LenovoTablet:"Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X|TB-X704F|TB-X104F|TB3-X70F|TB-X705F|TB-8504F|TB3-X70L|TB3-710F|TB-X704L",DellTablet:"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7",YarvikTablet:"Android.*\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\b",MedionTablet:"Android.*\\bOYO\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB",ArnovaTablet:"97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2",IntensoTablet:"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004",IRUTablet:"M702pro",MegafonTablet:"MegaFon V9|\\bZTE V9\\b|Android.*\\bMT7A\\b",EbodaTablet:"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)",AllViewTablet:"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)",ArchosTablet:"\\b(101G9|80G9|A101IT)\\b|Qilive 97R|Archos5|\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\b",AinolTablet:"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark",NokiaLumiaTablet:"Lumia 2520",SonyTablet:"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712",PhilipsTablet:"\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\b",CubeTablet:"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT",CobyTablet:"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010",MIDTablet:"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10",MSITablet:"MSI \\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\b",SMiTTablet:"Android.*(\\bMID\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)",RockChipTablet:"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A",FlyTablet:"IQ310|Fly Vision",bqTablet:"Android.*(bq)?.*\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\b|Maxwell.*Lite|Maxwell.*Plus",HuaweiTablet:"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19",NecTablet:"\\bN-06D|\\bN-08D",PantechTablet:"Pantech.*P4100",BronchoTablet:"Broncho.*(N701|N708|N802|a710)",VersusTablet:"TOUCHPAD.*[78910]|\\bTOUCHTAB\\b",ZyncTablet:"z1000|Z99 2G|z930|z990|z909|Z919|z900",PositivoTablet:"TB07STA|TB10STA|TB07FTA|TB10FTA",NabiTablet:"Android.*\\bNabi",KoboTablet:"Kobo Touch|\\bK080\\b|\\bVox\\b Build|\\bArc\\b Build",DanewTablet:"DSlide.*\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\b",TexetTablet:"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE",PlaystationTablet:"Playstation.*(Portable|Vita)",TrekstorTablet:"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab",PyleAudioTablet:"\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\b",AdvanTablet:"Android.* \\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\b ",DanyTechTablet:"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1",GalapadTablet:"Android [0-9.]+; [a-z-]+; \\bG1\\b",MicromaxTablet:"Funbook|Micromax.*\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\b",KarbonnTablet:"Android.*\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\b",AllFineTablet:"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide",PROSCANTablet:"\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\b",YONESTablet:"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026",ChangJiaTablet:"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503",GUTablet:"TX-A1301|TX-M9002|Q702|kf026",PointOfViewTablet:"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10",OvermaxTablet:"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027",HCLTablet:"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync",DPSTablet:"DPS Dream 9|DPS Dual 7",VistureTablet:"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10",CrestaTablet:"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989",MediatekTablet:"\\bMT8125|MT8389|MT8135|MT8377\\b",ConcordeTablet:"Concorde([ ]+)?Tab|ConCorde ReadMan",GoCleverTablet:"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042",ModecomTablet:"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003",VoninoTablet:"\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\bQ8\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\b",ECSTablet:"V07OT2|TM105A|S10OT1|TR10CS1",StorexTablet:"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab",VodafoneTablet:"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400",EssentielBTablet:"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2",RossMoorTablet:"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711",iMobileTablet:"i-mobile i-note",TolinoTablet:"tolino tab [0-9.]+|tolino shine",AudioSonicTablet:"\\bC-22Q|T7-QC|T-17B|T-17P\\b",AMPETablet:"Android.* A78 ",SkkTablet:"Android.* (SKYPAD|PHOENIX|CYCLOPS)",TecnoTablet:"TECNO P9|TECNO DP8D",JXDTablet:"Android.* \\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\b",iJoyTablet:"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)",FX2Tablet:"FX2 PAD7|FX2 PAD10",XoroTablet:"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151",ViewsonicTablet:"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a",VerizonTablet:"QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1",OdysTablet:"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\bXELIO\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10",CaptivaTablet:"CAPTIVA PAD",IconbitTablet:"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S",TeclastTablet:"T98 4G|\\bP80\\b|\\bX90HD\\b|X98 Air|X98 Air 3G|\\bX89\\b|P80 3G|\\bX80h\\b|P98 Air|\\bX89HD\\b|P98 3G|\\bP90HD\\b|P89 3G|X98 3G|\\bP70h\\b|P79HD 3G|G18d 3G|\\bP79HD\\b|\\bP89s\\b|\\bA88\\b|\\bP10HD\\b|\\bP19HD\\b|G18 3G|\\bP78HD\\b|\\bA78\\b|\\bP75\\b|G17s 3G|G17h 3G|\\bP85t\\b|\\bP90\\b|\\bP11\\b|\\bP98t\\b|\\bP98HD\\b|\\bG18d\\b|\\bP85s\\b|\\bP11HD\\b|\\bP88s\\b|\\bA80HD\\b|\\bA80se\\b|\\bA10h\\b|\\bP89\\b|\\bP78s\\b|\\bG18\\b|\\bP85\\b|\\bA70h\\b|\\bA70\\b|\\bG17\\b|\\bP18\\b|\\bA80s\\b|\\bA11s\\b|\\bP88HD\\b|\\bA80h\\b|\\bP76s\\b|\\bP76h\\b|\\bP98\\b|\\bA10HD\\b|\\bP78\\b|\\bP88\\b|\\bA11\\b|\\bA10t\\b|\\bP76a\\b|\\bP76t\\b|\\bP76e\\b|\\bP85HD\\b|\\bP85a\\b|\\bP86\\b|\\bP75HD\\b|\\bP76v\\b|\\bA12\\b|\\bP75a\\b|\\bA15\\b|\\bP76Ti\\b|\\bP81HD\\b|\\bA10\\b|\\bT760VE\\b|\\bT720HD\\b|\\bP76\\b|\\bP73\\b|\\bP71\\b|\\bP72\\b|\\bT720SE\\b|\\bC520Ti\\b|\\bT760\\b|\\bT720VE\\b|T720-3GE|T720-WiFi",OndaTablet:"\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\b[\\s]+|V10 \\b4G\\b",JaytechTablet:"TPC-PA762",BlaupunktTablet:"Endeavour 800NG|Endeavour 1010",DigmaTablet:"\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\b",EvolioTablet:"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\bEvotab\\b|\\bNeura\\b",LavaTablet:"QPAD E704|\\bIvoryS\\b|E-TAB IVORY|\\bE-TAB\\b",AocTablet:"MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712",MpmanTablet:"MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\bMPG7\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010",CelkonTablet:"CT695|CT888|CT[\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\bCT-1\\b",WolderTablet:"miTab \\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\b",MediacomTablet:"M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA",MiTablet:"\\bMI PAD\\b|\\bHM NOTE 1W\\b",NibiruTablet:"Nibiru M1|Nibiru Jupiter One",NexoTablet:"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI",LeaderTablet:"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100",UbislateTablet:"UbiSlate[\\s]?7C",PocketBookTablet:"Pocketbook",KocasoTablet:"\\b(TB-1207)\\b",HisenseTablet:"\\b(F5281|E2371)\\b",Hudl:"Hudl HT7S3|Hudl 2",TelstraTablet:"T-Hub2",GenericTablet:"Android.*\\b97D\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\bA7EB\\b|CatNova8|A1_07|CT704|CT1002|\\bM721\\b|rk30sdk|\\bEVOTAB\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\bM6pro\\b|CT1020W|arc 10HD|\\bTP750\\b|\\bQTAQZ3\\b|WVT101|TM1088|KT107"},oss:{AndroidOS:"Android",BlackBerryOS:"blackberry|\\bBB10\\b|rim tablet os",PalmOS:"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino",SymbianOS:"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\bS60\\b",WindowsMobileOS:"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;",WindowsPhoneOS:"Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;",iOS:"\\biPhone.*Mobile|\\biPod|\\biPad|AppleCoreMedia",iPadOS:"CPU OS 13",SailfishOS:"Sailfish",MeeGoOS:"MeeGo",MaemoOS:"Maemo",JavaOS:"J2ME/|\\bMIDP\\b|\\bCLDC\\b",webOS:"webOS|hpwOS",badaOS:"\\bBada\\b",BREWOS:"BREW"},uas:{Chrome:"\\bCrMo\\b|CriOS|Android.*Chrome/[.0-9]* (Mobile)?",Dolfin:"\\bDolfin\\b",Opera:"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR/[0-9.]+$|Coast/[0-9.]+",Skyfire:"Skyfire",Edge:"\\bEdgiOS\\b|Mobile Safari/[.0-9]* Edge",IE:"IEMobile|MSIEMobile",Firefox:"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS",Bolt:"bolt",TeaShark:"teashark",Blazer:"Blazer",Safari:"Version((?!\\bEdgiOS\\b).)*Mobile.*Safari|Safari.*Mobile|MobileSafari",WeChat:"\\bMicroMessenger\\b",UCBrowser:"UC.*Browser|UCWEB",baiduboxapp:"baiduboxapp",baidubrowser:"baidubrowser",DiigoBrowser:"DiigoBrowser",Mercury:"\\bMercury\\b",ObigoBrowser:"Obigo",NetFront:"NF-Browser",GenericBrowser:"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger",PaleMoon:"Android.*PaleMoon|Mobile.*PaleMoon"},props:{Mobile:"Mobile/[VER]",Build:"Build/[VER]",Version:"Version/[VER]",VendorID:"VendorID/[VER]",iPad:"iPad.*CPU[a-z ]+[VER]",iPhone:"iPhone.*CPU[a-z ]+[VER]",iPod:"iPod.*CPU[a-z ]+[VER]",Kindle:"Kindle/[VER]",Chrome:["Chrome/[VER]","CriOS/[VER]","CrMo/[VER]"],Coast:["Coast/[VER]"],Dolfin:"Dolfin/[VER]",Firefox:["Firefox/[VER]","FxiOS/[VER]"],Fennec:"Fennec/[VER]",Edge:"Edge/[VER]",IE:["IEMobile/[VER];","IEMobile [VER]","MSIE [VER];","Trident/[0-9.]+;.*rv:[VER]"],NetFront:"NetFront/[VER]",NokiaBrowser:"NokiaBrowser/[VER]",Opera:[" OPR/[VER]","Opera Mini/[VER]","Version/[VER]"],"Opera Mini":"Opera Mini/[VER]","Opera Mobi":"Version/[VER]",UCBrowser:["UCWEB[VER]","UC.*Browser/[VER]"],MQQBrowser:"MQQBrowser/[VER]",MicroMessenger:"MicroMessenger/[VER]",baiduboxapp:"baiduboxapp/[VER]",baidubrowser:"baidubrowser/[VER]",SamsungBrowser:"SamsungBrowser/[VER]",Iron:"Iron/[VER]",Safari:["Version/[VER]","Safari/[VER]"],Skyfire:"Skyfire/[VER]",Tizen:"Tizen/[VER]",Webkit:"webkit[ /][VER]",PaleMoon:"PaleMoon/[VER]",SailfishBrowser:"SailfishBrowser/[VER]",Gecko:"Gecko/[VER]",Trident:"Trident/[VER]",Presto:"Presto/[VER]",Goanna:"Goanna/[VER]",iOS:" \\bi?OS\\b [VER][ ;]{1}",Android:"Android [VER]",Sailfish:"Sailfish [VER]",BlackBerry:["BlackBerry[\\w]+/[VER]","BlackBerry.*Version/[VER]","Version/[VER]"],BREW:"BREW [VER]",Java:"Java/[VER]","Windows Phone OS":["Windows Phone OS [VER]","Windows Phone [VER]"],"Windows Phone":"Windows Phone [VER]","Windows CE":"Windows CE/[VER]","Windows NT":"Windows NT [VER]",Symbian:["SymbianOS/[VER]","Symbian/[VER]"],webOS:["webOS/[VER]","hpwOS/[VER];"]},utils:{Bot:"Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp|AspiegelBot",MobileBot:"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker/M1A1-R2D2",DesktopMode:"WPDesktop",TV:"SonyDTV|HbbTV",WebKit:"(webkit)[ /]([\\w.]+)",Console:"\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\b",Watch:"SM-V700"}},detectMobileBrowsers:{fullPattern:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,shortPattern:/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,tabletPattern:/android|ipad|playbook|silk/i}},n=Object.prototype.hasOwnProperty;function i(e,t){return null!=e&&null!=t&&e.toLowerCase()===t.toLowerCase()}function r(e,t){var n,i,r=e.length;if(!r||!t)return!1;for(n=t.toLowerCase(),i=0;i<r;++i)if(n===e[i].toLowerCase())return!0;return!1}function s(e){for(var t in e)n.call(e,t)&&(e[t]=new RegExp(e[t],"i"))}function a(e,t){this.ua=function(e){return(e||"").substr(0,500)}(e),this._cache={},this.maxPhoneWidth=t||600}return t.FALLBACK_PHONE="UnknownPhone",t.FALLBACK_TABLET="UnknownTablet",t.FALLBACK_MOBILE="UnknownMobile",e="isArray"in Array?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},function(){var i,r,a,o,l,c,u=t.mobileDetectRules;for(i in u.props)if(n.call(u.props,i)){for(r=u.props[i],e(r)||(r=[r]),l=r.length,o=0;o<l;++o)(c=(a=r[o]).indexOf("[VER]"))>=0&&(a=a.substring(0,c)+"([\\w._\\+]+)"+a.substring(c+5)),r[o]=new RegExp(a,"i");u.props[i]=r}s(u.oss),s(u.phones),s(u.tablets),s(u.uas),s(u.utils),u.oss0={WindowsPhoneOS:u.oss.WindowsPhoneOS,WindowsMobileOS:u.oss.WindowsMobileOS}}(),t.findMatch=function(e,t){for(var i in e)if(n.call(e,i)&&e[i].test(t))return i;return null},t.findMatches=function(e,t){var i=[];for(var r in e)n.call(e,r)&&e[r].test(t)&&i.push(r);return i},t.getVersionStr=function(e,i){var r,s,a,o,l=t.mobileDetectRules.props;if(n.call(l,e))for(a=(r=l[e]).length,s=0;s<a;++s)if(null!==(o=r[s].exec(i)))return o[1];return null},t.getVersion=function(e,n){var i=t.getVersionStr(e,n);return i?t.prepareVersionNo(i):NaN},t.prepareVersionNo=function(e){var t;return 1===(t=e.split(/[a-z._ \/\-]/i)).length&&(e=t[0]),t.length>1&&(e=t[0]+".",t.shift(),e+=t.join("")),Number(e)},t.isMobileFallback=function(e){return t.detectMobileBrowsers.fullPattern.test(e)||t.detectMobileBrowsers.shortPattern.test(e.substr(0,4))},t.isTabletFallback=function(e){return t.detectMobileBrowsers.tabletPattern.test(e)},t.prepareDetectionCache=function(e,n,i){if(e.mobile===pi){var r,s,o;if(s=t.findMatch(t.mobileDetectRules.tablets,n))return e.mobile=e.tablet=s,void(e.phone=null);if(r=t.findMatch(t.mobileDetectRules.phones,n))return e.mobile=e.phone=r,void(e.tablet=null);t.isMobileFallback(n)?(o=a.isPhoneSized(i))===pi?(e.mobile=t.FALLBACK_MOBILE,e.tablet=e.phone=null):o?(e.mobile=e.phone=t.FALLBACK_PHONE,e.tablet=null):(e.mobile=e.tablet=t.FALLBACK_TABLET,e.phone=null):t.isTabletFallback(n)?(e.mobile=e.tablet=t.FALLBACK_TABLET,e.phone=null):e.mobile=e.tablet=e.phone=null}},t.mobileGrade=function(e){var t=null!==e.mobile();return e.os("iOS")&&e.version("iPad")>=4.3||e.os("iOS")&&e.version("iPhone")>=3.1||e.os("iOS")&&e.version("iPod")>=3.1||e.version("Android")>2.1&&e.is("Webkit")||e.version("Windows Phone OS")>=7||e.is("BlackBerry")&&e.version("BlackBerry")>=6||e.match("Playbook.*Tablet")||e.version("webOS")>=1.4&&e.match("Palm|Pre|Pixi")||e.match("hp.*TouchPad")||e.is("Firefox")&&e.version("Firefox")>=12||e.is("Chrome")&&e.is("AndroidOS")&&e.version("Android")>=4||e.is("Skyfire")&&e.version("Skyfire")>=4.1&&e.is("AndroidOS")&&e.version("Android")>=2.3||e.is("Opera")&&e.version("Opera Mobi")>11&&e.is("AndroidOS")||e.is("MeeGoOS")||e.is("Tizen")||e.is("Dolfin")&&e.version("Bada")>=2||(e.is("UC Browser")||e.is("Dolfin"))&&e.version("Android")>=2.3||e.match("Kindle Fire")||e.is("Kindle")&&e.version("Kindle")>=3||e.is("AndroidOS")&&e.is("NookTablet")||e.version("Chrome")>=11&&!t||e.version("Safari")>=5&&!t||e.version("Firefox")>=4&&!t||e.version("MSIE")>=7&&!t||e.version("Opera")>=10&&!t?"A":e.os("iOS")&&e.version("iPad")<4.3||e.os("iOS")&&e.version("iPhone")<3.1||e.os("iOS")&&e.version("iPod")<3.1||e.is("Blackberry")&&e.version("BlackBerry")>=5&&e.version("BlackBerry")<6||e.version("Opera Mini")>=5&&e.version("Opera Mini")<=6.5&&(e.version("Android")>=2.3||e.is("iOS"))||e.match("NokiaN8|NokiaC7|N97.*Series60|Symbian/3")||e.version("Opera Mobi")>=11&&e.is("SymbianOS")?"B":(e.version("BlackBerry")<5||e.match("MSIEMobile|Windows CE.*Mobile")||e.version("Windows Mobile"),"C")},t.detectOS=function(e){return t.findMatch(t.mobileDetectRules.oss0,e)||t.findMatch(t.mobileDetectRules.oss,e)},t.getDeviceSmallerSide=function(){return window.screen.width<window.screen.height?window.screen.width:window.screen.height},a.prototype={constructor:a,mobile:function(){return t.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth),this._cache.mobile},phone:function(){return t.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth),this._cache.phone},tablet:function(){return t.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth),this._cache.tablet},userAgent:function(){return this._cache.userAgent===pi&&(this._cache.userAgent=t.findMatch(t.mobileDetectRules.uas,this.ua)),this._cache.userAgent},userAgents:function(){return this._cache.userAgents===pi&&(this._cache.userAgents=t.findMatches(t.mobileDetectRules.uas,this.ua)),this._cache.userAgents},os:function(){return this._cache.os===pi&&(this._cache.os=t.detectOS(this.ua)),this._cache.os},version:function(e){return t.getVersion(e,this.ua)},versionStr:function(e){return t.getVersionStr(e,this.ua)},is:function(e){return r(this.userAgents(),e)||i(e,this.os())||i(e,this.phone())||i(e,this.tablet())||r(t.findMatches(t.mobileDetectRules.utils,this.ua),e)},match:function(e){return e instanceof RegExp||(e=new RegExp(e,"i")),e.test(this.ua)},isPhoneSized:function(e){return a.isPhoneSized(e||this.maxPhoneWidth)},mobileGrade:function(){return this._cache.grade===pi&&(this._cache.grade=t.mobileGrade(this)),this._cache.grade}},"undefined"!=typeof window&&window.screen?a.isPhoneSized=function(e){return e<0?pi:t.getDeviceSmallerSide()<=e}:a.isPhoneSized=function(){},a._impl=t,a.version="1.4.5 2021-03-13",a});const mi=fi.exports;class gi{static getMobileDeviceData(e){const t=new mi(e);return{manufacturer:t.mobile(),browser:t.userAgent(),os:t.os()}}static isMac(e){return!!e.toLowerCase().match("mac")}static isSafari(e){return!!e.toLowerCase().match("safari")}static isFirefox(e){return!!e.toLowerCase().match("firefox")}}class bi{static deleteActiveLabel(){const e=Nn.getActiveImageData(),t=Nn.getActiveLabelId();bi.deleteImageLabelById(e.id,t)}static deleteImageLabelById(e,t){switch(Nn.getActiveLabelType()){case je.POINT:bi.deletePointLabelById(e,t);break;case je.RECT:bi.deleteRectLabelById(e,t);break;case je.POLYGON:bi.deletePolygonLabelById(e,t)}}static deleteRectLabelById(e,t){const n=Nn.getImageDataById(e),i={...n,labelRects:I.exports.filter(n.labelRects,e=>e.id!==t)};i6.dispatch(on(n.id,i))}static deletePointLabelById(e,t){const n=Nn.getImageDataById(e),i={...n,labelPoints:I.exports.filter(n.labelPoints,e=>e.id!==t)};i6.dispatch(on(n.id,i))}static deleteLineLabelById(e,t){const n=Nn.getImageDataById(e),i={...n,labelLines:I.exports.filter(n.labelLines,e=>e.id!==t)};i6.dispatch(on(n.id,i))}static deletePolygonLabelById(e,t){const n=Nn.getImageDataById(e),i={...n,labelPolygons:I.exports.filter(n.labelPolygons,e=>e.id!==t)};i6.dispatch(on(n.id,i))}static toggleLabelVisibilityById(e,t){const n=Nn.getImageDataById(e),i={...n,labelPoints:n.labelPoints.map(e=>e.id===t?Xn.toggleAnnotationVisibility(e):e),labelRects:n.labelRects.map(e=>e.id===t?Xn.toggleAnnotationVisibility(e):e),labelPolygons:n.labelPolygons.map(e=>e.id===t?Xn.toggleAnnotationVisibility(e):e),labelLines:n.labelLines.map(e=>e.id===t?Xn.toggleAnnotationVisibility(e):e)};i6.dispatch(on(n.id,i))}static removeLabelNames(e){const t=Nn.getImagesData().map(t=>bi.removeLabelNamesFromImageData(t,e));i6.dispatch(cn(t))}static removeLabelNamesFromImageData(e,t){return{...e,labelRects:e.labelRects.map(e=>t.includes(e.id)?{...e,id:null}:e),labelPoints:e.labelPoints.map(e=>t.includes(e.id)?{...e,id:null}:e),labelPolygons:e.labelPolygons.map(e=>t.includes(e.id)?{...e,id:null}:e),labelNameIds:e.labelNameIds.filter(e=>!t.includes(e))}}static labelExistsInLabelNames(e){return Nn.getLabelNames().map(e=>e.name).includes(e)}}class yi extends ui{}t(yi,"actions",[{keyCombo:["Enter"],action:e=>{if(In.supportRenderingEngine&&In.supportRenderingEngine.labelType===je.POLYGON){const e=ci.getEditorData();In.supportRenderingEngine.addLabelAndFinishCreation(e)}ci.fullRender()}},{keyCombo:["Escape"],action:e=>{if(In.supportRenderingEngine)switch(In.supportRenderingEngine.labelType){case je.POLYGON:case je.LINE:In.supportRenderingEngine.cancelLabelCreation()}ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","ArrowLeft"]:["Control","ArrowLeft"],action:e=>{di.getPreviousImage()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","ArrowRight"]:["Control","ArrowRight"],action:e=>{di.getNextImage()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","+"]:["Control","+"],action:e=>{ii.zoomIn()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","-"]:["Control","-"],action:e=>{ii.zoomOut()}},{keyCombo:["ArrowRight"],action:e=>{e.preventDefault(),ii.translateViewPortPosition(Ge.RIGHT)}},{keyCombo:["ArrowLeft"],action:e=>{e.preventDefault(),ii.translateViewPortPosition(Ge.LEFT)}},{keyCombo:["ArrowUp"],action:e=>{e.preventDefault(),ii.translateViewPortPosition(Ge.BOTTOM)}},{keyCombo:["ArrowDown"],action:e=>{e.preventDefault(),ii.translateViewPortPosition(Ge.TOP)}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Backspace"]:["Delete"],action:e=>{bi.deleteActiveLabel()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","0"]:["Control","0"],action:e=>{di.setActiveLabelOnActiveImage(0),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","1"]:["Control","1"],action:e=>{di.setActiveLabelOnActiveImage(1),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","2"]:["Control","2"],action:e=>{di.setActiveLabelOnActiveImage(2),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","3"]:["Control","3"],action:e=>{di.setActiveLabelOnActiveImage(3),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","4"]:["Control","4"],action:e=>{di.setActiveLabelOnActiveImage(4),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","5"]:["Control","5"],action:e=>{di.setActiveLabelOnActiveImage(5),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","6"]:["Control","6"],action:e=>{di.setActiveLabelOnActiveImage(6),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","7"]:["Control","7"],action:e=>{di.setActiveLabelOnActiveImage(7),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","8"]:["Control","8"],action:e=>{di.setActiveLabelOnActiveImage(8),ci.fullRender()}},{keyCombo:gi.isMac(window.navigator.userAgent)?["Alt","9"]:["Control","9"],action:e=>{di.setActiveLabelOnActiveImage(9),ci.fullRender()}}]);class vi{static close(){i6.dispatch(yn(null)),_i.restoreCtx()}}class Ti extends ui{}t(Ti,"actions",[{keyCombo:["Escape"],action:e=>{const t=On.getActivePopupType();We.CLOSEABLE_POPUPS.includes(t)&&vi.close()}}]);const xi=class{static getActiveCombo(){return xi.activeCombo}static init(){window.addEventListener(Pn.KEY_DOWN,xi.onDown),window.addEventListener(Pn.KEY_UP,xi.onUp),window.addEventListener(Pn.FOCUS,xi.onFocus)}static switchCtx(e){const t=On.getActiveContext();t!==e&&(xi.contextHistory.push(t),xi.updateCtx(e))}static updateCtx(e){var t;switch(i6.dispatch((t=e,{type:en.UPDATE_CONTEXT,payload:{activeContext:t}})),e){case bn.EDITOR:xi.actions=yi.getActions();break;case bn.POPUP:xi.actions=Ti.getActions();break;default:xi.actions=[]}}static restoreCtx(){xi.updateCtx(xi.contextHistory.pop())}static onDown(e){const t=xi.getKeyCodeFromEvent(e);xi.isInCombo(t)||xi.addToCombo(t),xi.execute(e)}static onUp(e){const t=xi.getKeyCodeFromEvent(e);xi.removeFromCombo(t)}static onFocus(){xi.activeCombo=[]}static execute(e){for(let t=0;t<xi.actions.length;t++){const n=xi.actions[t];xi.matchCombo(xi.activeCombo,n.keyCombo)&&n.action(e)}}static isInCombo(e){return xi.activeCombo.indexOf(e)>=0}static addToCombo(e){xi.activeCombo.push(e)}static removeFromCombo(e){const t=xi.activeCombo.indexOf(e);t>=0&&xi.activeCombo.splice(t,1)}static getKeyCodeFromEvent(e){return e.key}static matchCombo(e,t){return I.exports.isEmpty(I.exports.xor(e,t))}};let _i=xi;t(_i,"activeCombo",[]),t(_i,"actions",[]),t(_i,"contextHistory",[]);class Si extends i.Component{constructor(e){super(e),t(this,"imagesListRef"),t(this,"updateListSize",()=>{if(!this.imagesListRef)return;const e=this.imagesListRef.getBoundingClientRect();this.setState({size:{width:e.width,height:e.height}})}),t(this,"isImageChecked",e=>{const t=this.props.imagesData[e];switch(this.props.activeLabelType){case je.LINE:return t.labelLines.length>0;case je.VIDEO_RECOGNITION:return t.labelNameIds.length>0;case je.POINT:return t.labelPoints.filter(e=>e.status===zn.ACCEPTED).length>0;case je.POLYGON:return t.labelPolygons.length>0;case je.RECT:return t.labelRects.filter(e=>e.status===zn.ACCEPTED).length>0}}),t(this,"onClickHandler",e=>{di.getImageByIndex(e)}),t(this,"renderImagePreview",(e,t,n,i)=>o(gn,{style:i,size:{width:150,height:150},isScrolling:t,isChecked:this.isImageChecked(e),imageData:this.props.imagesData[e],onClick:()=>this.onClickHandler(e),isSelected:this.props.activeImageIndex===e},e)),this.state={size:null}}componentDidMount(){this.updateListSize(),window.addEventListener(Pn.RESIZE,this.updateListSize)}componentWillUnmount(){window.removeEventListener(Pn.RESIZE,this.updateListSize)}render(){const{size:e}=this.state;return o("div",{className:"ImagesList",ref:e=>this.imagesListRef=e,onClick:()=>_i.switchCtx(bn.LEFT_NAVBAR),children:!!e&&o(Vt,{size:e,childSize:{width:150,height:150},childCount:this.props.imagesData.length,childRender:this.renderImagePreview,overScanHeight:200})})}}const wi=$e(e=>({activeImageIndex:e.labels.activeImageIndex,imagesData:e.labels.imagesData,activeLabelType:e.labels.activeLabelType}),{})(Si),Ii=[{labelType:je.VIDEO_RECOGNITION,headerText:"Image recognition",imageSrc:"ico/object.png",imageAlt:"object",projectType:ri.VIDEO_RECOGNITION},{labelType:je.RECT,headerText:"Rect",imageSrc:"ico/rectangle.png",imageAlt:"rectangle",projectType:ri.OBJECT_DETECTION},{labelType:je.POINT,headerText:"Point",imageSrc:"ico/point.png",imageAlt:"point",projectType:ri.OBJECT_DETECTION},{labelType:je.LINE,headerText:"Line",imageSrc:"ico/line.png",imageAlt:"line",projectType:ri.OBJECT_DETECTION},{labelType:je.POLYGON,headerText:"Polygon",imageSrc:"ico/polygon.png",imageAlt:"polygon",projectType:ri.OBJECT_DETECTION},{labelType:je.RECT,headerText:"Video Annotation",imageSrc:"ico/video.png",imageAlt:"video",projectType:ri.VIDEO_RECOGNITION}],ki=n.exports.forwardRef((e,t)=>{const{buttonSize:n,padding:i,image:r,imageAlt:s,href:a,onClick:l,style:c,isActive:d,isDisabled:h,externalClassName:p}=e,f=i||10,m={...c,width:n.width,height:n.height},g={maxWidth:n.width-f,maxHeight:n.height-f};return u("div",{className:C("ImageButton",p,{active:d,disabled:h}),style:m,onClick:e=>{e.stopPropagation(),l&&l()},ref:t,children:[!!a&&o("a",{href:a,style:g,target:"_blank",rel:"noopener noreferrer",children:o("img",{draggable:!1,alt:s,src:r,style:g})}),!a&&o("img",{draggable:!1,alt:s,src:r,style:g})]})});class Ci extends i.Component{constructor(e){super(e),t(this,"dropdownOptionHeight",30),t(this,"dropdownOptionCount",6),t(this,"dropdownMargin",4),t(this,"dropdownLabel"),t(this,"dropdown"),t(this,"openDropdown",()=>{0===Nn.getLabelNames().length?this.props.updateActivePopupType(Ve.UPDATE_LABEL):(this.setState({isOpen:!0}),window.addEventListener(Pn.MOUSE_DOWN,this.closeDropdown))}),t(this,"closeDropdown",e=>{const t={x:e.clientX,y:e.clientY},n=this.dropdown.getBoundingClientRect(),i={x:n.left,y:n.top,width:n.width,height:n.height};Gt.isPointInside(i,t)||(this.setState({isOpen:!1}),window.removeEventListener(Pn.MOUSE_DOWN,this.closeDropdown))}),t(this,"getDropdownStyle",()=>{const e=this.dropdownLabel.getBoundingClientRect(),t=Math.min(this.props.options.length,this.dropdownOptionCount)*this.dropdownOptionHeight,n={width:e.width,height:t,left:e.left};return 2*window.innerHeight/3<e.top?Object.assign(n,{top:e.top-this.dropdownMargin-t}):Object.assign(n,{top:e.bottom+this.dropdownMargin})}),t(this,"getDropdownOptions",()=>{const e=e=>t=>{this.setState({isOpen:!1}),window.removeEventListener(Pn.MOUSE_DOWN,this.closeDropdown),this.props.onSelectLabel(this.props.id,e),this.props.updateHighlightedLabelId(null),this.props.updateActiveLabelId(this.props.id),t.stopPropagation()};return this.props.options.map(t=>o("div",{className:"DropdownOption",style:{height:this.dropdownOptionHeight},onClick:e(t.id),children:I.exports.truncate(t.name,{length:We.MAX_DROPDOWN_OPTION_LENGTH})},t.id))}),t(this,"mouseEnterHandler",()=>{this.props.updateHighlightedLabelId(this.props.id)}),t(this,"mouseLeaveHandler",()=>{this.props.updateHighlightedLabelId(null)}),t(this,"onClickHandler",()=>{this.props.updateActiveLabelId(this.props.id)}),t(this,"getToggleVisibilityButton",e=>void 0===this.props.toggleLabelVisibility?null:o(ki,{externalClassName:"icon",image:this.props.isVisible?"ico/eye.png":"ico/hide.png",imageAlt:"label is hidden",buttonSize:{width:28,height:28},onClick:()=>this.props.toggleLabelVisibility(e)})),this.state={animate:!1,isOpen:!1}}componentDidMount(){requestAnimationFrame(()=>{this.setState({animate:!0})})}getClassName(){return C("LabelInputField",{loaded:this.state.animate,active:this.props.isActive,highlighted:this.props.isHighlighted})}render(){const{size:e,id:t,value:n,onDelete:i}=this.props;return o("div",{className:this.getClassName(),style:{width:e.width,height:e.height},onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler,onClick:this.onClickHandler,children:u("div",{className:"LabelInputFieldWrapper",style:{width:e.width,height:e.height},children:[o("div",{className:"Marker",style:n?{backgroundColor:n.color}:{}}),u("div",{className:"Content",children:[u("div",{className:"ContentWrapper",children:[o("div",{className:"DropdownLabel",ref:e=>this.dropdownLabel=e,onClick:this.openDropdown,children:n?I.exports.truncate(n.name,{length:We.MAX_DROPDOWN_OPTION_LENGTH}):"Select label"}),this.state.isOpen&&o("div",{className:"Dropdown",style:this.getDropdownStyle(),ref:e=>this.dropdown=e,children:o(Bt,{renderTrackHorizontal:e=>o("div",{...e,className:"track-horizontal"}),children:o("div",{children:this.getDropdownOptions()})})})]}),u("div",{className:"ContentWrapper",children:[this.getToggleVisibilityButton(t),o(ki,{externalClassName:"icon",image:"ico/trash.png",imageAlt:"remove label",buttonSize:{width:28,height:28},onClick:()=>i(t)})]})]})]})},t)}}const Ei=$e(e=>({}),{updateHighlightedLabelId:sn,updateActiveLabelId:rn,updateActivePopupType:yn})(Ci),Ai=$e(e=>({firstLabelCreatedFlag:e.labels.firstLabelCreatedFlag}),{})(({firstLabelCreatedFlag:e,labelBefore:t,labelAfter:n})=>{const i=u(d,{children:[o("img",{draggable:!1,alt:"lets_start",src:"ico/rocket.png"}),o("p",{className:"extraBold",children:t})]});return o("div",{className:"EmptyLabelList",children:e?u(d,{children:[o("img",{draggable:!1,alt:"no_labels",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:n})]}):i})}),Ri=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelRects.length},d=e=>{bi.deleteRectLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelRects:t.labelRects.map(t=>t.id===e?{...t,labelId:i,status:zn.ACCEPTED}:t)};n(t.id,s),r(i)};return o("div",{className:"RectLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelRects.filter(e=>e.status===zn.ACCEPTED).length?o(Ai,{labelBefore:"draw your first bounding box",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"RectLabelsListContent",style:u,children:t.labelRects.filter(e=>e.status===zn.ACCEPTED).map(t=>o(Ei,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),Ni=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelPoints.length},d=e=>{bi.deletePointLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelPoints:t.labelPoints.map(t=>t.id===e?{...t,labelId:i}:t)};n(t.id,s),r(i)};return o("div",{className:"PointLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelPoints.filter(e=>e.status===zn.ACCEPTED).length?o(Ai,{labelBefore:"mark your first point",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"PointLabelsListContent",style:u,children:t.labelPoints.filter(e=>e.status===zn.ACCEPTED).map(t=>o(Ei,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),Pi=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelPolygons.length},d=e=>{bi.deletePolygonLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelPolygons:t.labelPolygons.map(t=>t.id===e?{...t,labelId:i}:t)};n(t.id,s),r(i)};return o("div",{className:"PolygonLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelPolygons.length?o(Ai,{labelBefore:"draw your first polygon",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"PolygonLabelsListContent",style:u,children:t.labelPolygons.map(t=>o(Ei,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),Di=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelLines.length},d=e=>{bi.deleteLineLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelLines:t.labelLines.map(t=>t.id===e?{...t,labelId:i}:t)};n(t.id,s),r(i)};return o("div",{className:"LineLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelLines.length?o(Ai,{labelBefore:"draw your first line",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"LineLabelsListContent",style:u,children:t.labelLines.map(t=>o(Ei,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),Oi=$e(e=>({labelNames:e.labels.labels}),{updateImageDataById:on,updateActivePopupType:yn})(({size:e,imageData:t,updateImageDataById:n,labelNames:i,updateActivePopupType:r})=>{const s={width:e.width,height:e.height},a={width:e.width,height:40*t.labelPolygons.length},l=()=>{r(Ve.UPDATE_LABEL)};return o("div",{className:"TagLabelsList",style:s,children:0===i.length?u("div",{className:"EmptyLabelList",onClick:l,children:[o("img",{draggable:!1,alt:"upload",src:"ico/type-writer.png"}),o("p",{className:"extraBold",children:"Your label list is empty"})]},"empty-label-list"):o(Bt,{children:o("div",{className:"TagLabelsListContent",style:a,children:[...i.map(e=>{return o("div",{className:(i=e.id,C("TagItem",{active:t.labelNameIds.includes(i)})),onClickCapture:()=>(e=>{t.labelNameIds.includes(e)?n(t.id,{...t,labelNameIds:I.exports.remove(t.labelNameIds,t=>t!==e)}):n(t.id,{...t,labelNameIds:t.labelNameIds.concat(e)})})(e.id),children:e.name},e.id);var i}),o(ki,{image:"ico/plus.png",imageAlt:"plus",buttonSize:{width:32,height:32},onClick:l})]},"tag-labels-list-content")})},"tag-labels-list")});class Li extends i.Component{constructor(e){super(e),t(this,"labelsToolkitRef"),t(this,"tabs"),t(this,"updateToolkitSize",()=>{if(!this.labelsToolkitRef)return;const e=this.labelsToolkitRef.getBoundingClientRect();this.setState({size:{width:e.width,height:e.height}})}),t(this,"headerClickHandler",e=>{this.props.updateActiveLabelType(e),this.props.updateActiveLabelId(null)}),t(this,"renderChildren",()=>{const{size:e}=this.state,{activeImageIndex:t,imagesData:n,activeLabelType:i}=this.props;return this.tabs.reduce((r,s,a)=>{const l=s===i,c=I.exports.find(Ii,{labelType:s}),d=e.height-this.tabs.length*We.TOOLKIT_TAB_HEIGHT_PX,h=e=>C(e,{active:l}),p=u("div",{className:h("Header"),onClick:()=>this.headerClickHandler(s),style:{height:We.TOOLKIT_TAB_HEIGHT_PX},children:[o("div",{className:"Marker"}),u("div",{className:"HeaderGroupWrapper",children:[o("img",{draggable:!1,className:"Ico",src:c.imageSrc,alt:c.imageAlt}),c.headerText]}),o("div",{className:"HeaderGroupWrapper",children:o("img",{draggable:!1,className:"Arrow",src:"ico/down.png",alt:"down_arrow"})})]},"Header_"+a),f=u("div",{className:h("Content"),style:{height:l?d:0},children:[s===je.RECT&&o(Ri,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.POINT&&o(Ni,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.LINE&&o(Di,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.POLYGON&&o(Pi,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.VIDEO_RECOGNITION&&o(Oi,{size:{width:e.width-20,height:d-20},imageData:n[t]})]},"Content_"+a);return r.push([p,f]),r},[])}),this.state={size:null},this.tabs=e.projectType===ri.VIDEO_RECOGNITION?[je.VIDEO_RECOGNITION]:[je.RECT];const n=e.activeLabelType?e.activeLabelType:this.tabs[0];e.updateActiveLabelType(n)}componentDidMount(){this.updateToolkitSize(),window.addEventListener(Pn.RESIZE,this.updateToolkitSize)}componentWillUnmount(){window.removeEventListener(Pn.RESIZE,this.updateToolkitSize)}render(){return o("div",{className:"LabelsToolkit",ref:e=>this.labelsToolkitRef=e,onClick:()=>_i.switchCtx(bn.RIGHT_NAVBAR),children:this.state.size&&this.renderChildren()})}}const Mi=$e(e=>({activeImageIndex:e.labels.activeImageIndex,activeLabelType:e.labels.activeLabelType,imagesData:e.labels.imagesData,projectType:e.general.projectData.type}),{updateImageDataById:on,updateActiveLabelType:an,updateActiveLabelId:rn})(Li),Fi=e=>{const{direction:t,isOpen:n,isWithContext:i,renderContent:r,renderCompanion:s}=e;return u("div",{className:C("SideNavigationBar",{left:t===Ge.LEFT,right:t===Ge.RIGHT,"with-context":i,closed:!n}),children:[o("div",{className:"CompanionBar",children:s&&s()}),n&&o("div",{className:"NavigationBarContentWrapper",children:r&&r()})]})},$i=e=>{const{key:t,label:n,onClick:i,style:r,isActive:s,isDisabled:a,image:l,imageAlt:c}=e;return u("div",{className:C("VerticalEditorButton",{active:s,disabled:a}),onClick:i||void 0,style:r,children:[l&&o("img",{draggable:!1,alt:c,src:l}),n]},t)};class Bi{}t(Bi,"getIndicator",e=>{switch(e){case Rn.ADD:return"ico/plus.png";case Rn.RESIZE:return"ico/resize.png";case Rn.CLOSE:return"ico/close.png";case Rn.MOVE:return"ico/move.png";case Rn.CANCEL:return"ico/cancel.png";case Rn.GRAB:return"ico/hand-fill.png";case Rn.GRABBING:return"ico/hand-fill-grab.png";default:return null}}),t(Bi,"getCursorStyle",e=>C("Cursor",{move:e===Rn.MOVE,add:e===Rn.ADD,resize:e===Rn.RESIZE,close:e===Rn.CLOSE,cancel:e===Rn.CANCEL,grab:e===Rn.GRAB,grabbing:e===Rn.GRABBING}));class zi{}t(zi,"mobileDeviceData"),t(zi,"isMac"),t(zi,"isSafari"),t(zi,"isFirefox");const Ui=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId}),{updatePreventCustomCursorStatus:Tn,updateImageDataById:on})(({position:e,updatePreventCustomCursorStatus:t,activeLabelId:i,highlightedLabelId:r,labelData:s,imageData:a,updateImageDataById:l})=>{const[c,h]=n.exports.useState(!1),p=()=>c||s.id===i||s.id===r;return o("div",{className:C("LabelControlPanel",{"is-active":p()}),style:{top:e.y,left:e.x},onMouseEnter:()=>{t(!0),h(!0)},onMouseLeave:()=>{t(!1),h(!1)},children:p()&&u(d,{children:[o(ki,{image:"ico/plus.png",imageAlt:"plus",buttonSize:{width:30,height:30},padding:15,onClick:()=>{const e={...a,labelRects:a.labelRects.map(e=>{if(e.id===s.id){const t=I.exports.findLast(Nn.getLabelNames(),{name:e.suggestedLabel});return{...e,status:zn.ACCEPTED,labelId:t?t.id:e.labelId}}return e}),labelPoints:a.labelPoints.map(e=>{if(e.id===s.id){const t=I.exports.findLast(Nn.getLabelNames(),{name:e.suggestedLabel});return{...e,status:zn.ACCEPTED,labelId:t?t.id:e.labelId}}return e})};l(a.id,e),t(!1)}}),o(ki,{image:"ico/trash.png",imageAlt:"trash",buttonSize:{width:30,height:30},padding:15,onClick:()=>{bi.deleteImageLabelById(a.id,s.id),t(!1)}}),s.suggestedLabel&&bi.labelExistsInLabelNames(s.suggestedLabel)?o("div",{className:"SuggestedLabel",children:s.suggestedLabel}):null]})})});class Gi{static detectRectsForActiveImage(){const e=Nn.getActiveImageData();Gi.detectRects(e.id,Jt.getById(e.id))}static detectRects(e,t){!Nn.getImageDataById(e).isVisitedBySSDObjectDetector&&pn.isAISSDObjectDetectorModelLoaded()&&i6.dispatch(yn(Ve.LOADER))}static acceptAllSuggestedRectLabels(e){const t={...e,labelRects:e.labelRects.map(e=>{const t=I.exports.findLast(Nn.getLabelNames(),{name:e.suggestedLabel});return{...e,status:zn.ACCEPTED,labelId:t?t.id:e.labelId}})};i6.dispatch(on(t.id,t))}static rejectAllSuggestedRectLabels(e){const t={...e,labelRects:e.labelRects.filter(e=>e.status===zn.ACCEPTED)};i6.dispatch(on(t.id,t))}}class Vi{static detectPoseForActiveImage(){const e=Nn.getActiveImageData();Vi.detectPoses(e.id,Jt.getById(e.id))}static detectPoses(e,t){!Nn.getImageDataById(e).isVisitedByPoseDetector&&pn.isAIPoseDetectorModelLoaded()&&i6.dispatch(yn(Ve.LOADER))}static acceptAllSuggestedPointLabels(e){const t={...e,labelPoints:e.labelPoints.map(e=>{const t=I.exports.findLast(Nn.getLabelNames(),{name:e.suggestedLabel});return{...e,status:zn.ACCEPTED,labelId:t?t.id:e.labelId}})};i6.dispatch(on(t.id,t))}static rejectAllSuggestedPointLabels(e){const t={...e,labelPoints:e.labelPoints.filter(e=>e.status===zn.ACCEPTED)};i6.dispatch(on(t.id,t))}}class Hi{static detectRectsForActiveImage(){const e=Nn.getActiveImageData();Hi.detectRects(e.id,Jt.getById(e.id))}static detectRects(e,t){!Nn.getImageDataById(e).isVisitedByYOLOObjectDetector&&pn.isAIYOLOObjectDetectorModelLoaded()&&i6.dispatch(yn(Ve.LOADER))}static saveRectPredictions(e,t){const n=Nn.getImageDataById(e),i=Hi.mapPredictionsToRectLabels(t),r={...n,labelRects:n.labelRects.concat(i),isVisitedByYOLOObjectDetector:!0};i6.dispatch(on(n.id,r))}static mapPredictionsToRectLabels(e){return e.map(e=>({id:qn(),labelIndex:null,labelId:null,rect:{x:e.x,y:e.y,width:e.width,height:e.height},isVisible:!0,isCreatedByAI:!0,status:zn.UNDECIDED,suggestedLabel:e.class}))}static extractNewSuggestedLabelNames(e,t){return t.reduce((t,n)=>(t.includes(n.class)||I.exports.findLast(e,{name:n.class})||t.push(n.class),t),[])}static acceptAllSuggestedRectLabels(e){const t={...e,labelRects:e.labelRects.map(e=>{const t=I.exports.findLast(Nn.getLabelNames(),{name:e.suggestedLabel});return{...e,status:zn.ACCEPTED,labelId:t?t.id:e.labelId}})};i6.dispatch(on(t.id,t))}static rejectAllSuggestedRectLabels(e){const t={...e,labelRects:e.labelRects.filter(e=>e.status===zn.ACCEPTED)};i6.dispatch(on(t.id,t))}}class Wi{static detectRects(e){!e.isVisitedByRoboflowAPI&&pn.isRoboflowAPIModelLoaded()&&i6.dispatch(yn(Ve.LOADER))}static acceptAllSuggestedRectLabels(e){const t={...e,labelRects:e.labelRects.map(e=>{const t=I.exports.findLast(Nn.getLabelNames(),{name:e.suggestedLabel});return{...e,status:zn.ACCEPTED,labelId:t?t.id:e.labelId}})};i6.dispatch(on(t.id,t))}static rejectAllSuggestedRectLabels(e){const t={...e,labelRects:e.labelRects.filter(e=>e.status===zn.ACCEPTED)};i6.dispatch(on(t.id,t))}}class ji{static excludeRejectedLabelNames(e,t){return e.reduce((e,n)=>(t.includes(n)||e.push(n),e),[])}static detect(e,t){const n=Nn.getImageDataById(e),i=Nn.getActiveLabelType(),r=pn.isAIYOLOObjectDetectorModelLoaded(),s=pn.isAISSDObjectDetectorModelLoaded(),a=pn.isRoboflowAPIModelLoaded();switch(i){case je.RECT:s&&Gi.detectRects(e,t),r&&Hi.detectRects(e,t),a&&Wi.detectRects(n);break;case je.POINT:Vi.detectPoses(e,t)}}static rejectAllSuggestedLabels(e){const t=Nn.getActiveLabelType(),n=pn.isAIYOLOObjectDetectorModelLoaded(),i=pn.isAISSDObjectDetectorModelLoaded(),r=pn.isRoboflowAPIModelLoaded();switch(t){case je.RECT:i&&Gi.rejectAllSuggestedRectLabels(e),n&&Hi.rejectAllSuggestedRectLabels(e),r&&Wi.rejectAllSuggestedRectLabels(e);break;case je.POINT:Vi.rejectAllSuggestedPointLabels(e)}}static acceptAllSuggestedLabels(e){const t=Nn.getActiveLabelType(),n=pn.isAIYOLOObjectDetectorModelLoaded(),i=pn.isAISSDObjectDetectorModelLoaded(),r=pn.isRoboflowAPIModelLoaded();switch(t){case je.RECT:i&&Gi.acceptAllSuggestedRectLabels(e),n&&Hi.acceptAllSuggestedRectLabels(e),r&&Wi.acceptAllSuggestedRectLabels(e);break;case je.POINT:Vi.acceptAllSuggestedPointLabels(e)}}}class qi extends i.Component{constructor(e){super(e),t(this,"loadImage",async e=>{if(e.loadStatus)ci.setActiveImage(Jt.getById(e.id)),ji.detect(e.id,Jt.getById(e.id)),this.updateModelAndRender();else if(!In.isLoading){ci.setLoadingStatus(!0);const t=t=>this.saveLoadedImage(t,e);hn.loadImage(e.fileData).then(e=>t(e)).catch(e=>this.handleLoadImageError())}}),t(this,"saveLoadedImage",(e,t)=>{console.log("saveLoadedImage: ",t.fileData),t.loadStatus=!0,this.props.updateImageDataById(t.id,t),Jt.storeImage(t.id,e),ci.setActiveImage(e),ji.detect(t.id,e),ci.setLoadingStatus(!1),this.updateModelAndRender()}),t(this,"handleLoadImageError",()=>{}),t(this,"updateModelAndRender",()=>{ii.updateViewPortSize(),ii.updateDefaultViewPortImageRect(),ii.resizeViewPortContent(),ci.fullRender()}),t(this,"update",e=>{const t=ci.getEditorData(e);In.mousePositionOnViewPortContent=Yn.getMousePositionOnCanvasFromEvent(e,In.canvas),In.primaryRenderingEngine.update(t),this.props.imageDragMode?In.viewPortHelper.update(t):In.supportRenderingEngine&&In.supportRenderingEngine.update(t),!this.props.activePopupType&&ci.updateMousePositionIndicator(e),ci.fullRender()}),t(this,"handleZoom",e=>{if(e.ctrlKey||zi.isMac&&e.metaKey){const t=Math.sign(e.deltaY);zi.isMac&&-1===t||!zi.isMac&&1===t?ii.zoomOut():(zi.isMac&&1===t||!zi.isMac&&-1===t)&&ii.zoomIn()}In.mousePositionOnViewPortContent=Yn.getMousePositionOnCanvasFromEvent(e,In.canvas)}),t(this,"getOptionsPanels",()=>{const e=ci.getEditorData();return this.props.activeLabelType===je.RECT?this.props.imageData.labelRects.filter(e=>e.isCreatedByAI&&e.status!==zn.ACCEPTED).map(t=>{const n={x:t.rect.x,y:t.rect.y},i=$n.transferPointFromImageToViewPortContent(n,e);return o(Ui,{position:i,labelData:t,imageData:this.props.imageData},t.id)}):this.props.activeLabelType===je.POINT?this.props.imageData.labelPoints.filter(e=>e.isCreatedByAI&&e.status!==zn.ACCEPTED).map(t=>{const n={x:t.point.x,y:t.point.y},i=$n.transferPointFromImageToViewPortContent(n,e);return o(Ui,{position:i,labelData:t,imageData:this.props.imageData},t.id)}):null}),t(this,"onScrollbarsUpdate",e=>{const t={width:e.scrollWidth,height:e.scrollHeight};I.exports.isEqual(t,this.state.viewPortSize)||this.setState({viewPortSize:t})}),this.state={viewPortSize:{width:0,height:0}}}componentDidMount(){this.mountEventListeners();const{imageData:e,activeLabelType:t}=this.props;_i.switchCtx(bn.EDITOR),ci.mountRenderEnginesAndHelpers(t),Zt.addAndRun(this.loadImage(e)),ii.resizeCanvas(this.props.size)}componentWillUnmount(){this.unmountEventListeners()}componentDidUpdate(e,t,n){const{imageData:i,activeLabelType:r}=this.props;e.imageData.id!==i.id&&Zt.addAndRun(this.loadImage(i)),e.activeLabelType!==r&&(ci.swapSupportRenderingEngine(r),ji.detect(i.id,Jt.getById(i.id))),this.updateModelAndRender()}mountEventListeners(){window.addEventListener(Pn.MOUSE_MOVE,this.update),window.addEventListener(Pn.MOUSE_UP,this.update),In.canvas.addEventListener(Pn.MOUSE_DOWN,this.update),In.canvas.addEventListener(Pn.MOUSE_WHEEL,this.handleZoom)}unmountEventListeners(){window.removeEventListener(Pn.MOUSE_MOVE,this.update),window.removeEventListener(Pn.MOUSE_UP,this.update),In.canvas.removeEventListener(Pn.MOUSE_DOWN,this.update),In.canvas.removeEventListener(Pn.MOUSE_WHEEL,this.handleZoom)}render(){return u("div",{className:"Editor",ref:e=>In.editor=e,draggable:!1,children:[o(Bt,{ref:e=>In.viewPortScrollbars=e,renderTrackHorizontal:e=>o("div",{...e,className:"track-horizontal"}),renderTrackVertical:e=>o("div",{...e,className:"track-vertical"}),onUpdate:this.onScrollbarsUpdate,children:u("div",{className:"ViewPortContent",children:[o("canvas",{className:"ImageCanvas",ref:e=>In.canvas=e,draggable:!1,onContextMenu:e=>e.preventDefault()}),this.getOptionsPanels()]})}),o("div",{className:"MousePositionIndicator",ref:e=>In.mousePositionIndicator=e,draggable:!1}),o("div",{className:Bi.getCursorStyle(this.props.customCursorStyle),ref:e=>In.cursor=e,draggable:!1,children:o("img",{draggable:!1,alt:"indicator",src:Bi.getIndicator(this.props.customCursorStyle)})})]})}}const Xi=$e(e=>({activeLabelType:e.labels.activeLabelType,activePopupType:e.general.activePopupType,activeLabelId:e.labels.activeLabelId,customCursorStyle:e.general.customCursorStyle,imageDragMode:e.general.imageDragMode,zoom:e.general.zoom}),{updateImageDataById:on})(qi),Ki=$e(e=>({activeImageIndex:e.labels.activeImageIndex,activeContext:e.general.activeContext}),{})(({size:e,imageData:t,totalImageCount:n,activeImageIndex:i,activeContext:r})=>u("div",{className:C("EditorBottomNavigationBar",{"with-context":r===bn.EDITOR}),children:[o(ki,{image:"ico/left.png",imageAlt:"previous",buttonSize:{width:25,height:25},onClick:()=>di.getPreviousImage(),isDisabled:0===i,externalClassName:"left"}),e.width>400?u("div",{className:"CurrentImageName",children:[" ",t.fileData.name," "]}):u("div",{className:"CurrentImageCount",children:[" ",i+1+" / "+n," "]}),o(ki,{image:"ico/right.png",imageAlt:"next",buttonSize:{width:25,height:25},onClick:()=>di.getNextImage(),isDisabled:i===n-1,externalClassName:"right"})]})),Yi={width:30,height:30},Zi=h(({className:e,...t})=>o(p,{...t,classes:{popper:e}}))(({theme:e})=>({[`& .${f.tooltip}`]:{backgroundColor:"#171717",color:"#ffffff",boxShadow:e.shadows[1],fontSize:12,maxWidth:200,textAlign:"center"}})),Qi=(e,t,n,i,r,s,a)=>o(Zi,{disableFocusListener:!0,title:t,TransitionComponent:m,TransitionProps:{timeout:600},placement:"bottom",children:o("div",{children:o(ki,{buttonSize:Yi,padding:10,image:n,imageAlt:i,href:s,onClick:a,isActive:r})})},e),Ji=$e(e=>({activeContext:e.general.activeContext,imageDragMode:e.general.imageDragMode,crossHairVisible:e.general.crossHairVisible,activeLabelType:e.labels.activeLabelType}),{updateImageDragModeStatusAction:xn,updateCrossHairVisibleStatusAction:_n})(({activeContext:e,updateImageDragModeStatusAction:t,updateCrossHairVisibleStatusAction:n,imageDragMode:i,crossHairVisible:r,activeLabelType:s})=>{const a=s===je.RECT&&pn.isAISSDObjectDetectorModelLoaded()||s===je.RECT&&pn.isAIYOLOObjectDetectorModelLoaded()||s===je.RECT&&pn.isRoboflowAPIModelLoaded()||s===je.POINT&&pn.isAIPoseDetectorModelLoaded();return u("div",{className:C("EditorTopNavigationBar",{"with-context":e===bn.EDITOR}),children:[u("div",{className:"ButtonWrapper",children:[Qi("zoom-in","zoom in","ico/zoom-in.png","zoom-in",!1,void 0,()=>ii.zoomIn()),Qi("zoom-out","zoom out","ico/zoom-out.png","zoom-out",!1,void 0,()=>ii.zoomOut()),Qi("zoom-fit","fit image to available space","ico/zoom-fit.png","zoom-fit",!1,void 0,()=>ii.setDefaultZoom()),Qi("zoom-max","maximum allowed image zoom","ico/zoom-max.png","zoom-max",!1,void 0,()=>ii.setOneForOneZoom())]}),u("div",{className:"ButtonWrapper",children:[Qi("image-drag-mode",i?"turn-off image drag mode":"turn-on image drag mode - works only when image is zoomed","ico/hand.png","image-drag-mode",i,void 0,()=>{(i||On.getZoom()!==Jn.MIN_ZOOM)&&t(!i)}),Qi("cursor-cross-hair",r?"turn-off cursor cross-hair":"turn-on cursor cross-hair","ico/cross-hair.png","cross-hair",r,void 0,()=>{n(!r)})]}),a&&u("div",{className:"ButtonWrapper",children:[Qi("accept-all","accept all proposed detections","ico/accept-all.png","accept-all",!1,void 0,()=>ji.acceptAllSuggestedLabels(Nn.getActiveImageData())),Qi("reject-all","reject all proposed detections","ico/reject-all.png","reject-all",!1,void 0,()=>ji.rejectAllSuggestedLabels(Nn.getActiveImageData()))]})]})}),er=$e(e=>({windowSize:e.general.windowSize,activeImageIndex:e.labels.activeImageIndex,imagesData:e.labels.imagesData,activeContext:e.general.activeContext,projectType:e.general.projectData.type}))(({windowSize:e,activeImageIndex:t,imagesData:i,activeContext:r,projectType:s})=>{const[a,l]=n.exports.useState(!0),[c,h]=n.exports.useState(!0),p=()=>{if(e){const t=a?We.SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX:We.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX,n=c?We.SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX:We.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX;return{width:e.width-t-n,height:e.height-We.TOP_NAVIGATION_BAR_HEIGHT_PX-We.EDITOR_BOTTOM_NAVIGATION_BAR_HEIGHT_PX-We.EDITOR_TOP_NAVIGATION_BAR_HEIGHT_PX}}return null},f=()=>{a?a&&r===bn.LEFT_NAVBAR&&_i.restoreCtx():_i.switchCtx(bn.LEFT_NAVBAR),l(!a)},m=()=>{c?c&&r===bn.RIGHT_NAVBAR&&_i.restoreCtx():_i.switchCtx(bn.RIGHT_NAVBAR),h(!c)};return u("div",{className:"EditorContainer",children:[o(Fi,{direction:Ge.LEFT,isOpen:a,isWithContext:r===bn.LEFT_NAVBAR,renderCompanion:()=>o(d,{children:o($i,{label:"Images",image:"/ico/camera.png",imageAlt:"images",onClick:f,isActive:a})}),renderContent:()=>o(wi,{})},"left-side-navigation-bar"),u("div",{className:"EditorWrapper",onMouseDown:()=>_i.switchCtx(bn.EDITOR),children:[s===ri.OBJECT_DETECTION&&o(Ji,{},"editor-top-navigation-bar"),o(Xi,{size:p(),imageData:i[t]},"editor"),o(Ki,{imageData:i[t],size:p(),totalImageCount:i.length},"editor-bottom-navigation-bar")]},"editor-wrapper"),o(Fi,{direction:Ge.RIGHT,isOpen:c,isWithContext:r===bn.RIGHT_NAVBAR,renderCompanion:()=>o(d,{children:o($i,{label:"Labels",image:"/ico/tags.png",imageAlt:"labels",onClick:m,isActive:c})}),renderContent:()=>o(Mi,{})},"right-side-navigation-bar")]})}),tr=$e(e=>({imagesData:e.labels.imagesData,activeLabelType:e.labels.activeLabelType}),{})(({imagesData:e,activeLabelType:t})=>{const n=e.reduce((e,t)=>e+(t.labelPoints.length>0?1:0),0),i=e.reduce((e,t)=>e+(t.labelRects.length>0?1:0),0),r=e.reduce((e,t)=>e+(t.labelPolygons.length>0?1:0),0),s=e.reduce((e,t)=>e+(t.labelLines.length>0?1:0),0),a=e.reduce((e,t)=>e+(0!==t.labelNameIds.length?1:0),0);return o("div",{className:"StateBar",children:o("div",{style:{width:(()=>{switch(t){case je.POINT:return 100*n/e.length;case je.RECT:return 100*i/e.length;case je.POLYGON:return 100*r/e.length;case je.LINE:return 100*s/e.length;case je.VIDEO_RECOGNITION:return 100*a/e.length;default:return 0}})()+"%"},className:"done"})})}),nr=e=>{const{label:t,isPassword:n,onChange:i,onFocus:r,inputStyle:s,labelStyle:a,barStyle:l,value:c,onKeyUp:d}=e;return u("div",{className:"TextInput",children:[o("input",{value:c||void 0,type:n?"password":"text",style:s,onChange:i||void 0,onFocus:r||void 0,onKeyUp:d}),!!t&&o("label",{style:a,children:t}),o("div",{className:"Bar",style:l})]})},ir=[{name:"Actions",imageSrc:"ico/actions.png",imageAlt:"actions",disabled:!1,children:[{name:"Edit Labels",description:"Modify labels list",imageSrc:"ico/tags.png",imageAlt:"labels",disabled:!1,onClick:()=>i6.dispatch(yn(Ve.UPDATE_LABEL))},{name:"Import Images",description:"Load more images",imageSrc:"ico/camera.png",imageAlt:"images",disabled:!1,onClick:()=>i6.dispatch(yn(Ve.IMPORT_IMAGES))},{name:"Import Annotations",description:"Import annotations from file",imageSrc:"ico/import-labels.png",imageAlt:"import-labels",disabled:!1,onClick:()=>i6.dispatch(yn(Ve.IMPORT_ANNOTATIONS))},{name:"Export Annotations",description:"Export annotations to file",imageSrc:"ico/export-labels.png",imageAlt:"export-labels",disabled:!1,onClick:()=>i6.dispatch(yn(Ve.EXPORT_ANNOTATIONS))},{name:"Run AI locally",description:"Run annotation model in browser",imageSrc:"ico/ai.png",imageAlt:"load-ai-model-in-browser",disabled:!1,onClick:()=>i6.dispatch(yn(Ve.LOAD_AI_MODEL))},{name:"Connect AI server",description:"Run annotation model on server",imageSrc:"ico/api.png",imageAlt:"connect-ai-server",disabled:!1,onClick:()=>i6.dispatch(yn(Ve.CONNECT_AI_MODEL_VIA_API))}]},{name:"Community",imageSrc:"ico/plant.png",imageAlt:"community",disabled:!1,children:[{name:"Documentation",description:"Read more about Make Sense",imageSrc:"ico/documentation.png",imageAlt:"documentation",disabled:!1,onClick:()=>window.open("https://skalskip.github.io/make-sense","_blank")},{name:"Bugs and Features",description:"Report a bug or propose a new feature",imageSrc:"ico/bug.png",imageAlt:"bug",disabled:!1,onClick:()=>window.open("https://github.com/SkalskiP/make-sense/issues","_blank")}]}],rr=$e(e=>({}),{updatePreventCustomCursorStatusAction:Tn})(({updatePreventCustomCursorStatusAction:e})=>{const[t,i]=n.exports.useState(null),[r,s]=n.exports.useState(null),a=t=>{e(!0)},l=t=>{e(!1)},c=e=>{e.target.classList.contains("DropDownMenuTab")||e.target.classList.contains("DropDownMenuContentOption")||(i(null),document.removeEventListener(Pn.MOUSE_DOWN,c))},h=(t,n)=>()=>{n||(t&&t(),i(null),e(!1),document.removeEventListener(Pn.MOUSE_DOWN,c))},p=(e,n)=>{return u("div",{className:(r=n,C("DropDownMenuTab",{active:r===t})),onClick:e=>((e,n)=>{null===t&&document.addEventListener(Pn.MOUSE_DOWN,c),t===e?(i(null),s(null)):(i(e),s({x:n.target.offsetLeft,y:35}))})(n,e),onMouseEnter:e=>((e,n)=>{null!==t&&t!==e&&(i(e),s({x:n.target.offsetLeft,y:35}))})(n,e),children:[o("img",{draggable:!1,src:e.imageSrc,alt:e.imageAlt}),e.name]},n);var r};return o("div",{className:"DropDownMenuWrapper",children:u(d,{children:[ir.map((e,t)=>p(e,t)),(e=>{if(null!==t){const t={top:35,left:r.x,height:40*e.children.length+10};return o("div",{className:"DropDownMenuContent",style:t,onMouseEnter:a,onMouseLeave:l,children:e.children.map((e,t)=>{return u("div",{className:(n=e.disabled,C("DropDownMenuContentOption",{active:!n})),onClick:h(e.onClick,e.disabled),children:[o("div",{className:"Marker"}),o("img",{src:e.imageSrc,alt:e.imageAlt}),e.name]},t);var n})})}return null})(ir[t])]})})}),sr=$e(e=>({projectData:e.general.projectData}),{updateActivePopupTypeAction:yn,updateProjectDataAction:Sn})(e=>u("div",{className:"TopNavigationBar",children:[o(tr,{}),u("div",{className:"TopNavigationBarWrapper",children:[o("div",{className:"NavigationBarGroupWrapper",children:u("div",{className:"Header",onClick:()=>e.updateActivePopupTypeAction(Ve.EXIT_PROJECT),children:[o("img",{draggable:!1,alt:"make-sense",src:"/make-sense-ico-transparent.png"}),"Make Sense"]})}),o("div",{className:"NavigationBarGroupWrapper",children:o(rr,{})}),u("div",{className:"NavigationBarGroupWrapper middle",children:[o("div",{className:"ProjectName",children:"Project Name:"}),o(nr,{isPassword:!1,value:e.projectData.name,onChange:t=>{const n=t.target.value.toLowerCase().replace(" ","-");e.updateProjectDataAction({...e.projectData,name:n})},onFocus:e=>{e.target.setSelectionRange(0,e.target.value.length)}})]}),o("div",{className:"NavigationBarGroupWrapper",children:o(ki,{image:"ico/github-logo.png",imageAlt:"github-logo.png",buttonSize:{width:30,height:30},href:We.GITHUB_URL})})]})]})),ar=$e(e=>({activePopupType:e.general.activePopupType}))(({activePopupType:e})=>u("div",{className:C("EditorView",{withPopup:!!e}),draggable:!1,children:[o(sr,{}),o(er,{})]})),or=e=>{const{key:t,label:n,onClick:i,style:r,isActive:s,isDisabled:a,externalClassName:l}=e;return o("div",{className:C("TextButton",l,{active:s,disabled:a}),onClick:e=>{e.stopPropagation(),i&&i()},style:r,children:n},t)},lr=[{displayName:"Github",imageSrc:"/ico/github-logo.png",imageAlt:"GitHub",href:We.GITHUB_URL,tooltipMessage:"Show us some love ⭐ on GitHub"},{displayName:"Medium",imageSrc:"/ico/medium-logo.png",imageAlt:"Medium",href:We.MEDIUM_URL,tooltipMessage:"Read our AI content on Medium"},{displayName:"YouTube",imageSrc:"/ico/youtube-logo.png",imageAlt:"YouTube",href:We.YOUTUBE_URL,tooltipMessage:"Watch our AI tutorials on YouTube"},{displayName:"Twitch",imageSrc:"/ico/twitch-logo.png",imageAlt:"Twitch",href:We.TWITCH_URL,tooltipMessage:"Fight along with us in Kaggle competitions on Twitch"}],cr=[{displayText:"Open source and free to use under GPLv3 license",imageSrc:"ico/open-source.png",imageAlt:"open-source"},{displayText:"No advanced installation required, just open up your browser",imageSrc:"ico/online.png",imageAlt:"online"},{displayText:"We don't store your images, because we don't send them anywhere",imageSrc:"ico/private.png",imageAlt:"private"},{displayText:"Support multiple label types - rects, lines, points and polygons",imageSrc:"ico/labels.png",imageAlt:"labels"},{displayText:"Support output file formats like YOLO, VOC XML, VGG JSON, CSV",imageSrc:"ico/file.png",imageAlt:"file"},{displayText:"Use AI to make your work more productive",imageSrc:"ico/robot.png",imageAlt:"robot"}];function ur(e,t,n,i){return new(n||(n=Promise))(function(r,s){function a(e){try{l(i.next(e))}catch(t){s(t)}}function o(e){try{l(i.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const dr=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function hr(e,t,n){const i=function(e){const{name:t}=e;if(t&&-1!==t.lastIndexOf(".")&&!e.type){const n=t.split(".").pop().toLowerCase(),i=dr.get(n);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}(e),{webkitRelativePath:r}=e,s="string"==typeof t?t:"string"==typeof r&&r.length>0?r:`./${e.name}`;return"string"!=typeof i.path&&pr(i,"path",s),void 0!==n&&Object.defineProperty(i,"handle",{value:n,writable:!1,configurable:!1,enumerable:!0}),pr(i,"relativePath",s),i}function pr(e,t,n){Object.defineProperty(e,t,{value:n,writable:!1,configurable:!1,enumerable:!0})}const fr=[".DS_Store","Thumbs.db"];function mr(e){return"object"==typeof e&&null!==e}function gr(e){return e.filter(e=>-1===fr.indexOf(e.name))}function br(e){if(null===e)return[];const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(i)}return t}function yr(e){if("function"!=typeof e.webkitGetAsEntry)return Tr(e);const t=e.webkitGetAsEntry();return t&&t.isDirectory?_r(t):Tr(e,t)}function vr(e){return e.reduce((e,t)=>[...e,...Array.isArray(t)?vr(t):[t]],[])}function Tr(e,t){return ur(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&"function"==typeof e.getAsFileSystemHandle){const t=yield e.getAsFileSystemHandle();if(null===t)throw new Error(`${e} is not a File`);if(void 0!==t){const e=yield t.getFile();return e.handle=t,hr(e)}}const i=e.getAsFile();if(!i)throw new Error(`${e} is not a File`);return hr(i,null!==(n=null==t?void 0:t.fullPath)&&void 0!==n?n:void 0)})}function xr(e){return ur(this,void 0,void 0,function*(){return e.isDirectory?_r(e):function(e){return ur(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.file(n=>{const i=hr(n,e.fullPath);t(i)},e=>{n(e)})})})}(e)})}function _r(e){const t=e.createReader();return new Promise((e,n)=>{const i=[];!function r(){t.readEntries(t=>ur(this,void 0,void 0,function*(){if(t.length){const e=Promise.all(t.map(xr));i.push(e),r()}else try{const t=yield Promise.all(i);e(t)}catch(s){n(s)}}),e=>{n(e)})}()})}var Sr=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(",");if(0===n.length)return!0;var i=e.name||"",r=(e.type||"").toLowerCase(),s=r.replace(/\/.*$/,"");return n.some(function(e){var t=e.trim().toLowerCase();return"."===t.charAt(0)?i.toLowerCase().endsWith(t):t.endsWith("/*")?s===t.replace(/\/.*$/,""):r===t})}return!0};function wr(e){return function(e){if(Array.isArray(e))return Rr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ar(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function kr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ir(Object(n),!0).forEach(function(t){Cr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ir(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Er(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(l){o=!0,r=l}finally{try{a||null==n.return||n.return()}finally{if(o)throw r}}return s}(e,t)||Ar(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ar(e,t){if(e){if("string"==typeof e)return Rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rr(e,t):void 0}}function Rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Nr=Sr,Pr=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(","),t=e.length>1?"one of ".concat(e.join(", ")):e[0];return{code:"file-invalid-type",message:"File type must be ".concat(t)}},Dr=function(e){return{code:"file-too-large",message:"File is larger than ".concat(e," ").concat(1===e?"byte":"bytes")}},Or=function(e){return{code:"file-too-small",message:"File is smaller than ".concat(e," ").concat(1===e?"byte":"bytes")}},Lr={code:"too-many-files",message:"Too many files"};function Mr(e,t){var n="application/x-moz-file"===e.type||Nr(e,t);return[n,n?null:Pr(t)]}function Fr(e,t,n){if($r(e.size))if($r(t)&&$r(n)){if(e.size>n)return[!1,Dr(n)];if(e.size<t)return[!1,Or(t)]}else{if($r(t)&&e.size<t)return[!1,Or(t)];if($r(n)&&e.size>n)return[!1,Dr(n)]}return[!0,null]}function $r(e){return null!=e}function Br(e){return"function"==typeof e.isPropagationStopped?e.isPropagationStopped():void 0!==e.cancelBubble&&e.cancelBubble}function zr(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(e){return"Files"===e||"application/x-moz-file"===e}):!!e.target&&!!e.target.files}function Ur(e){e.preventDefault()}function Gr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return t.some(function(t){return!Br(e)&&t&&t.apply(void 0,[e].concat(i)),Br(e)})}}function Vr(e){return"audio/*"===e||"video/*"===e||"image/*"===e||"text/*"===e||"application/*"===e||/\w+\/[-+.\w]+/g.test(e)}function Hr(e){return/^.*\.[\w]+$/.test(e)}var Wr=["children"],jr=["open"],qr=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Xr=["refKey","onChange","onClick"];function Kr(e){return function(e){if(Array.isArray(e))return Qr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Zr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(l){o=!0,r=l}finally{try{a||null==n.return||n.return()}finally{if(o)throw r}}return s}(e,t)||Zr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zr(e,t){if(e){if("string"==typeof e)return Qr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qr(e,t):void 0}}function Qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Jr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function es(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jr(Object(n),!0).forEach(function(t){ts(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ts(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ns(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var is=n.exports.forwardRef(function(e,t){var i=e.children,r=as(ns(e,Wr)),s=r.open,a=ns(r,jr);return n.exports.useImperativeHandle(t,function(){return{open:s}},[s]),o(n.exports.Fragment,{children:i(es(es({},a),{},{open:s}))})});is.displayName="Dropzone";var rs={disabled:!1,getFilesFromEvent:function(e){return ur(this,void 0,void 0,function*(){return mr(e)&&mr(e.dataTransfer)?function(e,t){return ur(this,void 0,void 0,function*(){if(e.items){const n=br(e.items).filter(e=>"file"===e.kind);if("drop"!==t)return n;return gr(vr(yield Promise.all(n.map(yr))))}return gr(br(e.files).map(e=>hr(e)))})}(e.dataTransfer,e.type):function(e){return mr(e)&&mr(e.target)}(e)?function(e){return br(e.target.files).map(e=>hr(e))}(e):Array.isArray(e)&&e.every(e=>"getFile"in e&&"function"==typeof e.getFile)?function(e){return ur(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>e.getFile()))).map(e=>hr(e))})}(e):[]})},maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};is.defaultProps=rs,is.propTypes={children:c.exports.func,accept:c.exports.objectOf(c.exports.arrayOf(c.exports.string)),multiple:c.exports.bool,preventDropOnDocument:c.exports.bool,noClick:c.exports.bool,noKeyboard:c.exports.bool,noDrag:c.exports.bool,noDragEventsBubbling:c.exports.bool,minSize:c.exports.number,maxSize:c.exports.number,maxFiles:c.exports.number,disabled:c.exports.bool,getFilesFromEvent:c.exports.func,onFileDialogCancel:c.exports.func,onFileDialogOpen:c.exports.func,useFsAccessApi:c.exports.bool,autoFocus:c.exports.bool,onDragEnter:c.exports.func,onDragLeave:c.exports.func,onDragOver:c.exports.func,onDrop:c.exports.func,onDropAccepted:c.exports.func,onDropRejected:c.exports.func,onError:c.exports.func,validator:c.exports.func};var ss={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function as(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=es(es({},rs),e),i=t.accept,r=t.disabled,s=t.getFilesFromEvent,a=t.maxSize,o=t.minSize,l=t.multiple,c=t.maxFiles,u=t.onDragEnter,d=t.onDragLeave,h=t.onDragOver,p=t.onDrop,f=t.onDropAccepted,m=t.onDropRejected,g=t.onFileDialogCancel,b=t.onFileDialogOpen,y=t.useFsAccessApi,v=t.autoFocus,T=t.preventDropOnDocument,x=t.noClick,_=t.noKeyboard,S=t.noDrag,w=t.noDragEventsBubbling,I=t.onError,k=t.validator,C=n.exports.useMemo(function(){return function(e){if($r(e))return Object.entries(e).reduce(function(e,t){var n=Er(t,2),i=n[0],r=n[1];return[].concat(wr(e),[i],wr(r))},[]).filter(function(e){return Vr(e)||Hr(e)}).join(",")}(i)},[i]),E=n.exports.useMemo(function(){return function(e){return $r(e)?[{description:"Files",accept:Object.entries(e).filter(function(e){var t=Er(e,2),n=t[0],i=t[1],r=!0;return Vr(n)||(console.warn('Skipped "'.concat(n,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),r=!1),Array.isArray(i)&&i.every(Hr)||(console.warn('Skipped "'.concat(n,'" because an invalid file extension was provided.')),r=!1),r}).reduce(function(e,t){var n=Er(t,2),i=n[0],r=n[1];return kr(kr({},e),{},Cr({},i,r))},{})}]:e}(i)},[i]),A=n.exports.useMemo(function(){return"function"==typeof b?b:ls},[b]),R=n.exports.useMemo(function(){return"function"==typeof g?g:ls},[g]),N=n.exports.useRef(null),P=n.exports.useRef(null),D=Yr(n.exports.useReducer(os,ss),2),O=D[0],L=D[1],M=O.isFocused,F=O.isFileDialogActive,$=n.exports.useRef("undefined"!=typeof window&&window.isSecureContext&&y&&"showOpenFilePicker"in window),B=function(){!$.current&&F&&setTimeout(function(){P.current&&(P.current.files.length||(L({type:"closeDialog"}),R()))},300)};n.exports.useEffect(function(){return window.addEventListener("focus",B,!1),function(){window.removeEventListener("focus",B,!1)}},[P,F,R,$]);var z=n.exports.useRef([]),U=function(e){N.current&&N.current.contains(e.target)||(e.preventDefault(),z.current=[])};n.exports.useEffect(function(){return T&&(document.addEventListener("dragover",Ur,!1),document.addEventListener("drop",U,!1)),function(){T&&(document.removeEventListener("dragover",Ur),document.removeEventListener("drop",U))}},[N,T]),n.exports.useEffect(function(){return!r&&v&&N.current&&N.current.focus(),function(){}},[N,v,r]);var G=n.exports.useCallback(function(e){I?I(e):console.error(e)},[I]),V=n.exports.useCallback(function(e){e.preventDefault(),e.persist(),ne(e),z.current=[].concat(Kr(z.current),[e.target]),zr(e)&&Promise.resolve(s(e)).then(function(t){if(!Br(e)||w){var n=t.length,i=n>0&&function(e){var t=e.files,n=e.accept,i=e.minSize,r=e.maxSize,s=e.multiple,a=e.maxFiles,o=e.validator;return!(!s&&t.length>1||s&&a>=1&&t.length>a)&&t.every(function(e){var t=Er(Mr(e,n),1)[0],s=Er(Fr(e,i,r),1)[0],a=o?o(e):null;return t&&s&&!a})}({files:t,accept:C,minSize:o,maxSize:a,multiple:l,maxFiles:c,validator:k});L({isDragAccept:i,isDragReject:n>0&&!i,isDragActive:!0,type:"setDraggedFiles"}),u&&u(e)}}).catch(function(e){return G(e)})},[s,u,G,w,C,o,a,l,c,k]),H=n.exports.useCallback(function(e){e.preventDefault(),e.persist(),ne(e);var t=zr(e);if(t&&e.dataTransfer)try{e.dataTransfer.dropEffect="copy"}catch(n){}return t&&h&&h(e),!1},[h,w]),W=n.exports.useCallback(function(e){e.preventDefault(),e.persist(),ne(e);var t=z.current.filter(function(e){return N.current&&N.current.contains(e)}),n=t.indexOf(e.target);-1!==n&&t.splice(n,1),z.current=t,t.length>0||(L({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),zr(e)&&d&&d(e))},[N,d,w]),j=n.exports.useCallback(function(e,t){var n=[],i=[];e.forEach(function(e){var t=Yr(Mr(e,C),2),r=t[0],s=t[1],l=Yr(Fr(e,o,a),2),c=l[0],u=l[1],d=k?k(e):null;if(r&&c&&!d)n.push(e);else{var h=[s,u];d&&(h=h.concat(d)),i.push({file:e,errors:h.filter(function(e){return e})})}}),(!l&&n.length>1||l&&c>=1&&n.length>c)&&(n.forEach(function(e){i.push({file:e,errors:[Lr]})}),n.splice(0)),L({acceptedFiles:n,fileRejections:i,isDragReject:i.length>0,type:"setFiles"}),p&&p(n,i,t),i.length>0&&m&&m(i,t),n.length>0&&f&&f(n,t)},[L,l,C,o,a,c,p,f,m,k]),q=n.exports.useCallback(function(e){e.preventDefault(),e.persist(),ne(e),z.current=[],zr(e)&&Promise.resolve(s(e)).then(function(t){Br(e)&&!w||j(t,e)}).catch(function(e){return G(e)}),L({type:"reset"})},[s,j,G,w]),X=n.exports.useCallback(function(){if($.current){L({type:"openDialog"}),A();var e={multiple:l,types:E};window.showOpenFilePicker(e).then(function(e){return s(e)}).then(function(e){j(e,null),L({type:"closeDialog"})}).catch(function(e){var t;(t=e)instanceof DOMException&&("AbortError"===t.name||t.code===t.ABORT_ERR)?(R(e),L({type:"closeDialog"})):!function(e){return e instanceof DOMException&&("SecurityError"===e.name||e.code===e.SECURITY_ERR)}(e)?G(e):($.current=!1,P.current?(P.current.value=null,P.current.click()):G(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided.")))})}else P.current&&(L({type:"openDialog"}),A(),P.current.value=null,P.current.click())},[L,A,R,y,j,G,E,l]),K=n.exports.useCallback(function(e){N.current&&N.current.isEqualNode(e.target)&&(" "!==e.key&&"Enter"!==e.key&&32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),X()))},[N,X]),Y=n.exports.useCallback(function(){L({type:"focus"})},[]),Z=n.exports.useCallback(function(){L({type:"blur"})},[]),Q=n.exports.useCallback(function(){x||(!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return function(e){return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident/")}(e)||function(e){return-1!==e.indexOf("Edge/")}(e)}()?X():setTimeout(X,0))},[x,X]),J=function(e){return r?null:e},ee=function(e){return _?null:J(e)},te=function(e){return S?null:J(e)},ne=function(e){w&&e.stopPropagation()},ie=n.exports.useMemo(function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,i=e.role,s=e.onKeyDown,a=e.onFocus,o=e.onBlur,l=e.onClick,c=e.onDragEnter,u=e.onDragOver,d=e.onDragLeave,h=e.onDrop,p=ns(e,qr);return es(es(ts({onKeyDown:ee(Gr(s,K)),onFocus:ee(Gr(a,Y)),onBlur:ee(Gr(o,Z)),onClick:J(Gr(l,Q)),onDragEnter:te(Gr(c,V)),onDragOver:te(Gr(u,H)),onDragLeave:te(Gr(d,W)),onDrop:te(Gr(h,q)),role:"string"==typeof i&&""!==i?i:"presentation"},n,N),r||_?{}:{tabIndex:0}),p)}},[N,K,Y,Z,Q,V,H,W,q,_,S,r]),re=n.exports.useCallback(function(e){e.stopPropagation()},[]),se=n.exports.useMemo(function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,i=e.onChange,r=e.onClick,s=ns(e,Xr);return es(es({},ts({accept:C,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:J(Gr(i,q)),onClick:J(Gr(r,re)),tabIndex:-1},n,P)),s)}},[P,i,l,q,r]);return es(es({},O),{},{isFocused:M&&!r,getRootProps:ie,getInputProps:se,rootRef:N,inputRef:P,open:J(X)})}function os(e,t){switch(t.type){case"focus":return es(es({},e),{},{isFocused:!0});case"blur":return es(es({},e),{},{isFocused:!1});case"openDialog":return es(es({},ss),{},{isFileDialogActive:!0});case"closeDialog":return es(es({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return es(es({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return es(es({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections,isDragReject:t.isDragReject});case"reset":return es({},ss);default:return e}}function ls(){}class cs{static createImageDataFromFileData(e){return{id:qn(),fileData:e,loadStatus:!1,labelRects:[],labelPoints:[],labelLines:[],labelPolygons:[],labelNameIds:[],isVisitedByYOLOObjectDetector:!1,isVisitedBySSDObjectDetector:!1,isVisitedByPoseDetector:!1,isVisitedByRoboflowAPI:!1}}static cleanAnnotations(e){return{...e,labelRects:[],labelPoints:[],labelLines:[],labelPolygons:[],labelNameIds:[]}}static arrange(e,t){return e.sort((e,n)=>t.indexOf(e.id)-t.indexOf(n.id))}static loadMissingImages(e){return new Promise((t,n)=>{const i=e.filter(e=>!e.loadStatus),r=i.map(e=>e.fileData);hn.loadImages(r).then(e=>{Jt.storeImages(i.map(e=>e.id),e),t()}).catch(e=>n(e))})}}const us=$e(e=>({projectData:e.general.projectData}),{updateActiveImageIndexAction:tn,addImageDataAction:ln,updateProjectDataAction:Sn,updateActivePopupTypeAction:yn})(e=>{const{acceptedFiles:t,getRootProps:n,getInputProps:i}=as({accept:{"image/*":[".jpeg",".png"],"video/*":[".mp4",".mov",".avi",".mkv",".webm"]}}),r=n=>{if(t.length>0){const i=I.exports.sortBy(t,e=>e.name),r=i.filter(e=>e.type.startsWith("video/")),s=i.filter(e=>e.type.startsWith("image/"));if(r.length>0){const t=r[0];e.updateProjectDataAction({...e.projectData,type:ri.VIDEO}),e.updateActiveImageIndexAction(0),e.addImageDataAction([cs.createImageDataFromFileData(t)]),e.updateActivePopupTypeAction(Ve.INSERT_LABEL_NAMES)}else e.updateProjectDataAction({...e.projectData,type:n}),e.updateActiveImageIndexAction(0),e.addImageDataAction(s.map(e=>cs.createImageDataFromFileData(e))),e.updateActivePopupTypeAction(Ve.INSERT_LABEL_NAMES)}};return u("div",{className:"ImagesDropZone",children:[o("div",{...n({className:"DropZone"}),children:0===t.length?u(d,{children:[o("input",{...i()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:"Drop images"}),o("p",{children:"or"}),o("p",{className:"extraBold",children:"Click here to select them"})]}):1===t.length?u(d,{children:[o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"}),o("p",{className:"extraBold",children:"1 image loaded"})]}):u(d,{children:[o("input",{...i()}),o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"},1),u("p",{className:"extraBold",children:[t.length," images loaded"]},2)]})}),u("div",{className:"DropZoneButtons",children:[o(or,{label:"Object Detection",isDisabled:!t.length,onClick:()=>r(ri.OBJECT_DETECTION)}),o(or,{label:"Image recognition",isDisabled:!t.length,onClick:()=>r(ri.VIDEO)})]})]})}),ds=()=>{const[e,t]=n.exports.useState(!1),[i,r]=n.exports.useState(!1),s=h(({className:e,...t})=>o(p,{...t,classes:{popper:e}}))(({theme:e})=>({[`& .${f.tooltip}`]:{backgroundColor:"#171717",color:"#ffffff",boxShadow:e.shadows[1],fontSize:11,maxWidth:120}}));return u("div",{className:C("MainView",{InProgress:e,Canceled:!e&&i}),children:[o("div",{className:"Slider",id:"lower",children:o("div",{className:"TriangleVertical",children:o("div",{className:"TriangleVerticalContent"})})}),o("div",{className:"Slider",id:"upper",children:o("div",{className:"TriangleVertical",children:o("div",{className:"TriangleVerticalContent"})})}),u("div",{className:"LeftColumn",children:[o("div",{className:"LogoWrapper",children:o("img",{draggable:!1,alt:"main-logo",src:"ico/main-image-color.png"})}),o("div",{className:"EditorFeaturesWrapper",children:cr.map(e=>o("div",{className:"EditorFeaturesTiles",children:u("div",{className:"EditorFeaturesTilesWrapper",children:[o("img",{draggable:!1,alt:e.imageAlt,src:e.imageSrc}),o("div",{className:"EditorFeatureLabel",children:e.displayText})]})},e.displayText))}),o("div",{className:"TriangleVertical",children:o("div",{className:"TriangleVerticalContent"})}),e&&o(or,{label:"Go Back",onClick:()=>{t(!1),r(!0)}})]}),u("div",{className:"RightColumn",children:[o("div",{}),o(us,{}),o("div",{className:"SocialMediaWrapper",children:(a={width:30,height:30},lr.map((e,t)=>o(s,{disableFocusListener:!0,title:e.tooltipMessage,TransitionComponent:m,TransitionProps:{timeout:600},placement:"left",children:o("div",{children:o(ki,{buttonSize:a,image:e.imageSrc,imageAlt:e.imageAlt,href:e.href})})},t)))}),!e&&o(or,{label:"Get Started",onClick:()=>{t(!0)},externalClassName:"get-started-button"})]})]});var a},hs=({title:e,renderContent:t,acceptLabel:i,onAccept:r,skipAcceptButton:s,disableAcceptButton:a,rejectLabel:l,onReject:c,skipRejectButton:d,disableRejectButton:h})=>{const[p,f]=n.exports.useState(!1);return n.exports.useEffect(()=>{p||(_i.switchCtx(bn.POPUP),f(!0))},[p]),u("div",{className:"GenericYesNoPopup",children:[o("div",{className:"Header",children:e}),o("div",{className:"Content",children:t()}),u("div",{className:"Footer",children:[!d&&o(or,{label:l||"NO, THANKS",onClick:c,externalClassName:"reject",isDisabled:h}),!s&&o(or,{label:i||"YES",onClick:r,externalClassName:"accept",isDisabled:a})]})]})};class ps extends Error{constructor(e){super(e),this.name="YOLOAnnotationsLoadingError"}}class fs extends ps{constructor(){super("For YOLO labels to be loaded correctly, labels.txt file is required"),this.name="NoLabelNamesFileProvidedError"}}class ms extends ps{constructor(){super("Label names listed in labels.txt file should be unique"),this.name="LabelNamesNotUniqueError"}}class gs extends ps{constructor(e){super(`Unexpected error occurred during parsing of ${e} annotations file`),this.name="AnnotationsParsingError"}}class bs{static parseLabelsNamesFromString(e){const t=e.split(/[\r\n]/).filter(Boolean).map(e=>e.replace(/\s/g,""));if(I.exports.uniq(t).length!==t.length)throw new ms;return t.map(e=>Xn.createLabelName(e))}static loadLabelsList(e,t,n){const i=new FileReader;i.onloadend=e=>{try{const n=e.target.result,i=bs.parseLabelsNamesFromString(n);t(i)}catch(i){n(i)}},i.readAsText(e)}static parseYOLOAnnotationsFromString(e,t,n,i){return e.split(/[\r\n]/).filter(Boolean).map(e=>bs.parseYOLOAnnotationFromString(e,t,n,i))}static parseYOLOAnnotationFromString(e,t,n,i){const r=e.split(" ");if(!bs.validateYOLOAnnotationComponents(r,t.length))throw new gs(i);const s=t[parseInt(r[0])].id,a=parseFloat(r[1]),o=parseFloat(r[2]),l=parseFloat(r[3]),c=parseFloat(r[4]),u={x:(a-l/2)*n.width,y:(o-c/2)*n.height,width:l*n.width,height:c*n.height};return Xn.createLabelRect(s,u)}static validateYOLOAnnotationComponents(e,t){const n=e=>{const t=Number(e);return!isNaN(t)&&0<=t&&t<=1};return[5===e.length,(e=>{const n=parseInt(e);return!isNaN(n)&&0<=n&&n<t})(e[0]),n(e[1]),n(e[2]),n(e[3]),n(e[4])].every(Boolean)}}var ys=(e=>(e.ERROR="ERROR",e.SUCCESS="SUCCESS",e.MESSAGE="MESSAGE",e.WARNING="WARNING",e))(ys||{});class vs{static createErrorNotification(e){return{id:qn(),type:ys.ERROR,header:e.header,description:e.description}}static createMessageNotification(e){return{id:qn(),type:ys.MESSAGE,header:e.header,description:e.description}}static createWarningNotification(e){return{id:qn(),type:ys.WARNING,header:e.header,description:e.description}}}var Ts=(e=>(e[e.EMPTY_LABEL_NAME_ERROR=0]="EMPTY_LABEL_NAME_ERROR",e[e.NON_UNIQUE_LABEL_NAMES_ERROR=1]="NON_UNIQUE_LABEL_NAMES_ERROR",e[e.MODEL_DOWNLOAD_ERROR=2]="MODEL_DOWNLOAD_ERROR",e[e.MODEL_INFERENCE_ERROR=3]="MODEL_INFERENCE_ERROR",e[e.MODEL_LOAD_ERROR=4]="MODEL_LOAD_ERROR",e[e.LABELS_FILE_UPLOAD_ERROR=5]="LABELS_FILE_UPLOAD_ERROR",e[e.ANNOTATION_FILE_PARSE_ERROR=6]="ANNOTATION_FILE_PARSE_ERROR",e[e.ANNOTATION_IMPORT_ASSERTION_ERROR=7]="ANNOTATION_IMPORT_ASSERTION_ERROR",e[e.UNSUPPORTED_INFERENCE_SERVER_MESSAGE=8]="UNSUPPORTED_INFERENCE_SERVER_MESSAGE",e[e.ROBOFLOW_INFERENCE_SERVER_ERROR=9]="ROBOFLOW_INFERENCE_SERVER_ERROR",e))(Ts||{});const xs={[Ts.EMPTY_LABEL_NAME_ERROR]:{header:"Empty label name",description:"Looks like you didn't assign name to one of your labels. Unfortunately it is mandatory for every label to have unique name value. Insert correct name or delete empty label and try again."},[Ts.NON_UNIQUE_LABEL_NAMES_ERROR]:{header:"Non unique label names",description:"Looks like not all your label names are unique. Unique names are necessary to guarantee correct data export when you complete your work. Make your names unique and try again."},[Ts.MODEL_DOWNLOAD_ERROR]:{header:"Model could not be downloaded",description:"Looks like we ware unable to download tensorflow.js model from external server. Make sure that you are connected to internet and try again."},[Ts.MODEL_INFERENCE_ERROR]:{header:"Inference failed",description:"Looks like we were unable to run inference of your image. Please help us improve Make Sense and let us know."},[Ts.MODEL_LOAD_ERROR]:{header:"Model could not be loaded",description:"Looks like we ware unable to load your tensorflow.js model from uploaded files. Make sure that you uploaded all model shard files. Please re-upload all model files once again."},[Ts.LABELS_FILE_UPLOAD_ERROR]:{header:"Labels file was not uploaded",description:"Looks like you forgot to upload text file containing list of detected classes names. We need it to map YOLOv5 model output to labels. Please re-upload all model files once again."},[Ts.ANNOTATION_FILE_PARSE_ERROR]:{header:"Annotation files could not be parsed",description:"The contents of an annotation file is not valid JSON, CSV, or XML. Please fix the files selected to import and try again."},[Ts.ANNOTATION_IMPORT_ASSERTION_ERROR]:{header:"Annotation files did not contain valid data",description:"Missing or invalid annotations provided during import. Please fix the files selected to import and try again."},[Ts.UNSUPPORTED_INFERENCE_SERVER_MESSAGE]:{header:"Selected inference server is not yet supported",description:"Integration with selected inference server is still under construction. Stay tuned for more updates on our GitHub."},[Ts.ROBOFLOW_INFERENCE_SERVER_ERROR]:{header:"Roboflow connection failed",description:"Looks like we ware unable to connect to your Roboflow model. Please, make sure that the model specification and Roboflow API key, are correct."}};function _s(e){return{type:en.SUBMIT_NEW_NOTIFICATION,payload:{notification:e}}}const Ss=$e(e=>({}),{updateActivePopupTypeAction:yn,updateLabelNamesAction:un,submitNewNotificationAction:_s})(({updateActivePopupTypeAction:e,updateLabelNamesAction:t,submitNewNotificationAction:i})=>{const[r,s]=n.exports.useState([]),[a,l]=n.exports.useState(!1),c=e=>{s(e),l(!1)},h=e=>{l(!0),e instanceof ms&&i(vs.createErrorNotification(xs[Ts.NON_UNIQUE_LABEL_NAMES_ERROR]))},{acceptedFiles:p,getRootProps:f,getInputProps:m}=as({accept:{"text/plain":[".txt"]},multiple:!1,onDrop:e=>{1===e.length&&bs.loadLabelsList(e[0],c,h)}});return o(hs,{title:"Load file with labels description",renderContent:()=>u("div",{className:"LoadLabelsPopupContent",children:[o("div",{className:"Message",children:"Load a text file with a list of labels you are planning to use. The names of each label should be separated by new line. If you don't have a prepared file, no problem. You can create your own list now."}),o("div",{...f({className:"DropZone"}),children:a?u(d,{children:[o("input",{...m()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:"Loading of labels file was unsuccessful"}),o("p",{className:"extraBold",children:"Try again"})]}):0===p.length?u(d,{children:[o("input",{...m()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:"Drop labels file"}),o("p",{children:"or"}),o("p",{className:"extraBold",children:"Click here to select it"})]}):1===r.length?u(d,{children:[o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"}),o("p",{className:"extraBold",children:"only 1 label found"})]}):u(d,{children:[o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"}),u("p",{className:"extraBold",children:[r.length," labels found"]})]})})]}),acceptLabel:"Start project",onAccept:()=>{r.length>0&&(t(r),e(null))},disableAcceptButton:0===r.length,rejectLabel:"Back",onReject:()=>{e(Ve.INSERT_LABEL_NAMES)}})}),ws=({color:e,onClick:t})=>o("div",{className:"ColorSelectorView",style:{backgroundColor:e},onClick:t,children:o("img",{draggable:!1,alt:"refresh",src:"ico/refresh.png"})}),Is=g(b)({"& .MuiInputBase-root":{color:"white"},"& label":{color:"white"},"& .MuiInput-underline:before":{borderBottomColor:"white"},"& .MuiInput-underline:hover:before":{borderBottomColor:"white"},"& label.Mui-focused":{color:We.SECONDARY_COLOR},"& .MuiInput-underline:after":{borderBottomColor:We.SECONDARY_COLOR}}),ks=$e(e=>({projectType:e.general.projectData.type,enablePerClassColoration:e.general.enablePerClassColoration}),{updateActivePopupTypeAction:yn,updateLabelNamesAction:un,updatePerClassColorationStatusAction:function(e){return{type:en.UPDATE_ENABLE_PER_CLASS_COLORATION_STATUS,payload:{enablePerClassColoration:e}}},submitNewNotificationAction:_s})(({updateActivePopupTypeAction:e,updateLabelNamesAction:t,updatePerClassColorationStatusAction:i,submitNewNotificationAction:r,isUpdate:s,projectType:a,enablePerClassColoration:l})=>{const[c,d]=n.exports.useState(Nn.getLabelNames()),h=e=>()=>{0===I.exports.filter(c,e=>""===e.name).length?I.exports.uniq(c.map(e=>e.name)).length===c.length?e():r(vs.createErrorNotification(xs[Ts.NON_UNIQUE_LABEL_NAMES_ERROR])):r(vs.createErrorNotification(xs[Ts.EMPTY_LABEL_NAME_ERROR]))},p=()=>{const e=[...c,Xn.createLabelName("")];d(e)},f=()=>h(p)(),m=()=>{i(!l)},g=e=>{"Enter"===e.key&&f()},b=c.map(e=>u("div",{className:"LabelEntry",children:[o(Is,{variant:"standard",id:"key",autoComplete:"off",autoFocus:!0,type:"text",margin:"dense",label:"Insert label",onKeyUp:g,value:e.name,onChange:t=>((e,t)=>{const n=c.map(n=>n.id===e?{...n,name:t}:n);d(n)})(e.id,t.target.value),style:{width:200},InputLabelProps:{shrink:!0}}),o(Is,{variant:"standard",id:"shortcut",autoComplete:"off",type:"text",margin:"dense",label:"Shortcut",value:e.shortcut||"",onChange:t=>((e,t)=>{const n=t.toLowerCase().replace(/[^a-z]/g,"").slice(0,1),i=c.map(t=>t.id===e?{...t,shortcut:n}:t);d(i)})(e.id,t.target.value),style:{width:80,marginLeft:10},InputLabelProps:{shrink:!0},inputProps:{maxLength:1,style:{textTransform:"lowercase"}}}),a===ri.OBJECT_DETECTION&&l&&o(ws,{color:e.color,onClick:()=>(e=>{const t=c.map(t=>t.id===e?{...t,color:I.exports.sample(We.LABEL_COLORS_PALETTE)}:t);d(t)})(e.id)}),o(ki,{image:"ico/trash.png",imageAlt:"remove_label",buttonSize:{width:30,height:30},onClick:()=>(e=>{const t=I.exports.reject(c,{id:e});d(t)})(e.id)})]},e.id)),y=()=>{const n=I.exports.reject(c,e=>0===e.name.length);c.length>0&&t(n),e(null)},v=()=>{const n=I.exports.reject(c,e=>0===e.name.length),i=Xn.labelNamesIdsDiff(Nn.getLabelNames(),n);bi.removeLabelNames(i),t(n),e(null)};return o(hs,{title:s?"Edit labels":"Create labels",renderContent:()=>u("div",{className:"InsertLabelNamesPopup",children:[u("div",{className:"LeftContainer",children:[o(ki,{image:"ico/plus.png",imageAlt:"plus",buttonSize:{width:40,height:40},padding:25,onClick:f,externalClassName:"monochrome"}),c.length>0&&o(ki,{image:l?"ico/colors-on.png":"ico/colors-off.png",imageAlt:"per-class-coloration",buttonSize:{width:40,height:40},padding:15,onClick:m,isActive:l,externalClassName:l?"":"monochrome"})]}),u("div",{className:"RightContainer",children:[o("div",{className:"Message",children:s?"You can now edit the label names you use to describe the objects in the photos. Use the + button to add a new empty text field.":"Before you start, you can create a list of labels you plan to assign to objects in your project. You can also choose to skip that part for now and define label names as you go."}),o("div",{className:"LabelsContainer",children:0!==Object.keys(c).length?o(Bt,{children:o("div",{className:"InsertLabelNamesPopupContent",children:b})}):u("div",{className:"EmptyList",onClick:p,children:[o("img",{draggable:!1,alt:"upload",src:"ico/type-writer.png"}),o("p",{className:"extraBold",children:"Your label list is empty"})]})})]})]}),acceptLabel:s?"Accept":"Start project",onAccept:s?()=>h(v)():()=>h(y)(),rejectLabel:s?"Cancel":"Load labels from file",onReject:s?()=>{e(null)}:()=>{e(Ve.LOAD_LABEL_NAMES)}})}),Cs=$e(e=>({}),{updateActiveLabelNameId:nn,updateLabelNames:un,updateProjectData:Sn,updateActiveImageIndex:tn,updateImageData:cn,updateFirstLabelCreatedFlag:dn})(({updateActiveLabelNameId:e,updateLabelNames:t,updateActiveImageIndex:n,updateImageData:i,updateFirstLabelCreatedFlag:r,updateProjectData:s})=>o(hs,{title:"Exit project",renderContent:()=>o("div",{className:"ExitProjectPopupContent",children:o("div",{className:"Message",children:"Are you sure you want to leave the editor? You will permanently lose all your progress."})}),acceptLabel:"Exit",onAccept:()=>{e(null),t([]),s({type:null,name:"my-project-name"}),n(null),i([]),r(!1),vi.close()},rejectLabel:"Back",onReject:()=>{vi.close()}})),Es=$e(e=>({}),{addImageData:ln})(({addImageData:e})=>{const{acceptedFiles:t,getRootProps:n,getInputProps:i}=as({accept:{"image/*":[".jpeg",".png"]}});return o(hs,{title:"Load more images",renderContent:()=>o("div",{className:"LoadMoreImagesPopupContent",children:o("div",{...n({className:"DropZone"}),children:0===t.length?u(d,{children:[o("input",{...i()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:"Add new images"}),o("p",{children:"or"}),o("p",{className:"extraBold",children:"Click here to select them"})]}):1===t.length?u(d,{children:[o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"}),o("p",{className:"extraBold",children:"1 new image loaded"})]}):u(d,{children:[o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"},1),u("p",{className:"extraBold",children:[t.length," new images loaded"]},2)]})})}),acceptLabel:"Load",disableAcceptButton:t.length<1,onAccept:()=>{t.length>0&&(e(t.map(e=>cs.createImageDataFromFileData(e))),vi.close())},rejectLabel:"Cancel",onReject:()=>{vi.close()}})});class As extends Error{constructor(){super("Given predicate results in more than one value being matched."),this.name="ArrayUtilAmbiguousMatchError"}}class Rs extends Error{constructor(){super("Given array is empty."),this.name="EmptyArrayError"}}class Ns extends Error{constructor(){super("Index can not be negative."),this.name="NegativeIndexError"}}class Ps{static partition(e,t){return e.reduce((e,n)=>(t(n)?e.pass.push(n):e.fail.push(n),e),{pass:[],fail:[]})}static match(e,t,n){return e.reduce((e,i)=>{const r=t.filter(e=>n(i,e));if(1===r.length)e.push([i,r[0]]);else if(r.length>1)throw new As;return e},[])}static unzip(e){return e.reduce((e,t)=>(e[0].push(t[0]),e[1].push(t[1]),e),[[],[]])}static getByInfiniteIndex(e,t){if(0===e.length)throw new Rs;if(t<0)throw new Ns;return e[t%e.length]}}const Ds=$e(e=>({}),{updateLabelNames:un,updateSuggestedLabelList:function(e){return{type:en.UPDATE_SUGGESTED_LABEL_LIST,payload:{labelList:e}}},updateRejectedSuggestedLabelList:function(e){return{type:en.UPDATE_REJECTED_SUGGESTED_LABEL_LIST,payload:{labelList:e}}}})(({updateLabelNames:e,updateSuggestedLabelList:t,updateRejectedSuggestedLabelList:i})=>{const[r,s]=n.exports.useState(!1),[a,l]=n.exports.useState(pn.getSuggestedLabelList().map(e=>({name:e,flag:!1})));const c=()=>a.reduce((e,t)=>(t.flag&&e.push(t.name),e),[]),d=()=>a.reduce((e,t)=>(t.flag||e.push(t.name),e),[]),h=()=>a.map(e=>e.name),p=()=>a.map((e,t)=>u("div",{className:"OptionsItem",onClick:()=>(e=>{const t=a.map((t,n)=>e===n?{...t,flag:!t.flag}:t);l(t);const n=t.reduce((e,t)=>e&&t.flag,!0);s(n)})(t),children:[e.flag?o("img",{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}):o("img",{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),e.name]},t));return o(hs,{title:"New classes found",renderContent:()=>u("div",{className:"SuggestLabelNamesPopupContent",children:[o("div",{className:"Message",children:"We found objects of classes that are not yet included in the list of labels. Select the names you would like to add. This will help to speed up the labeling process."}),o("div",{className:"AllToggle",children:u("div",{className:"OptionsItem",onClick:()=>r?(s(!1),void l(a.map(e=>({...e,flag:!1})))):(s(!0),void l(a.map(e=>({...e,flag:!0})))),children:[o("img",r?{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}:{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),r?"Deselect all":"Select all"]})}),o("div",{className:"LabelNamesContainer",children:o(Bt,{autoHeight:!0,children:o("div",{className:"LabelNamesContent",children:p()})})})]}),acceptLabel:"Accept",onAccept:()=>{e(c().reduce((e,t,n)=>(e.push({name:t,id:qn(),color:Ps.getByInfiniteIndex(We.LABEL_COLORS_PALETTE,n)}),e),Nn.getLabelNames())),i(pn.getRejectedSuggestedLabelList().concat(d())),t([]),vi.close()},rejectLabel:"Reject",onReject:()=>{i(pn.getRejectedSuggestedLabelList().concat(h())),t([]),vi.close()}})}),Os=$e(e=>({projectType:e.general.projectData.type}),{})(({title:e,activeLabelType:t,projectType:i,onLabelTypeChange:r,acceptLabel:s,onAccept:a,skipAcceptButton:l,disableAcceptButton:c,rejectLabel:d,onReject:h,renderInternalContent:p})=>{const[f,m]=n.exports.useState(t);return o(hs,{title:e,renderContent:()=>u("div",{className:"GenericLabelTypePopupContent",children:[o("div",{className:"LeftContainer",children:Ii.filter(e=>e.projectType===i).map(e=>o(ki,{image:e.imageSrc,imageAlt:e.imageAlt,buttonSize:{width:40,height:40},padding:20,onClick:()=>{m(e.labelType),r(e.labelType)},isActive:f===e.labelType},e.labelType))}),o("div",{className:"RightContainer",children:p(f)})]}),acceptLabel:s,onAccept:()=>a(f),skipAcceptButton:l,disableAcceptButton:c,rejectLabel:d,onReject:()=>h(f)})});var Ls=(e=>(e.YOLO="YOLO",e.COCO="COCO",e.CSV="CSV",e.JSON="JSON",e.VOC="VOC",e.VGG="VGG",e))(Ls||{});const Ms={[je.RECT]:[{type:Ls.COCO,label:"Single file in COCO JSON format."},{type:Ls.YOLO,label:"Multiple files in YOLO format along with labels names definition - labels.txt file."},{type:Ls.VOC,label:"Multiple files in VOC XML format."},{type:Ls.CSV,label:"Single CSV file with behavior annotations (start_frame, end_frame, behavior columns)."}],[je.POINT]:[],[je.LINE]:[],[je.POLYGON]:[{type:Ls.COCO,label:"Single file in COCO JSON format."}],[je.VIDEO_RECOGNITION]:[]},Fs=()=>u("div",{className:"FeatureInProgress",children:[o("img",{draggable:!1,alt:"take_off",src:"ico/take-off.png"}),u("p",{className:"extraBold",children:["new feature ",o("br",{})," coming soon..."]})]});class $s extends Error{constructor(){super("CSV annotation import accepts only one file."),Object.setPrototypeOf(this,$s.prototype)}}class Bs extends Error{constructor(){super("Problem with reading CSV annotation file."),Object.setPrototypeOf(this,Bs.prototype)}}class zs extends Error{constructor(){super("Problem with CSV annotation file deserialization."),Object.setPrototypeOf(this,zs.prototype)}}class Us extends Error{constructor(e){super(e||"CSV format validation failed."),Object.setPrototypeOf(this,Us.prototype)}}class Gs{constructor(e){t(this,"labelType"),this.labelType=e}import(e,t,n){throw new Error("Method not implemented.")}}const Vs=class extends Gs{import(e,t,n){e.length>1&&n(new $s);const i=new FileReader;i.readAsText(e[0]),i.onloadend=e=>{try{const n=Nn.getImagesData(),i=Vs.parseCSV(e.target.result),{imagesData:r,labelNames:s}=this.applyLabels(n,i);t(r,s)}catch(i){n(i)}},i.onerror=()=>n(new Bs)}static parseCSV(e){try{const t=e.trim().split("\n");if(t.length<2)throw new Us("CSV file must contain at least a header and one data row");const n=t[0].split(We.CSV_SEPARATOR).map(e=>e.trim());Vs.validateCSVFormat(n);const i=[];for(let e=1;e<t.length;e++){const r=t[e].split(We.CSV_SEPARATOR).map(e=>e.trim());if(r.length!==n.length)continue;const s={startFrame:parseInt(r[n.indexOf("start_frame")]||"0"),endFrame:parseInt(r[n.indexOf("end_frame")]||"0"),behavior:r[n.indexOf("behavior")]||""};i.push(s)}return i}catch(t){throw new zs}}applyLabels(e,t){const n=e.map(e=>cs.cleanAnnotations(e)),i=Nn.getLabelNames();let r=[...i];const s=new Map,a=[...new Set(t.map(e=>e.behavior).filter(e=>e))];for(const o of a){const e=i.find(e=>e.name===o);if(e)s.set(o,e.id);else{const e=Xn.createLabelName(o);r.push(e),s.set(o,e.id)}}for(const o of t){if(!o.behavior)continue;const e=s.get(o.behavior);if(e)for(const t of n){const n=Xn.createLabelRect(e,o.startFrame,o.endFrame,o.behavior,t);t.labelRects.push(n)}}return{imagesData:cs.arrange(n,e.map(e=>e.id)),labelNames:r}}static validateCSVFormat(e){const t=Vs.requiredColumns.filter(t=>!e.includes(t));if(0!==t.length)throw new Us(`CSV file does not contain all required columns: ${t.join(", ")}`)}};let Hs=Vs;t(Hs,"requiredColumns",["start_frame","end_frame","behavior"]);class Ws extends Error{constructor(e){super(e),this.name="COCOAnnotationsLoadingError"}}class js extends Ws{constructor(e){super(e),this.name="COCOFormatValidationError"}}class qs extends Ws{constructor(){super("Unexpected error occurred during reading annotations from file"),this.name="COCOAnnotationReadingError"}}class Xs extends Ws{constructor(){super("COCO annotation file need to be in JSON format"),this.name="COCOAnnotationDeserializationError"}}class Ks extends Ws{constructor(){super("COCO annotation requires single file but multiple were given"),this.name="COCOAnnotationFileCountError"}}class Ys{static bbox2rect(e){return{x:e[0],y:e[1],width:e[2],height:e[3]}}static segmentation2vertices(e){return e.map(e=>I.exports.chunk(e,2).map(e=>({x:e[0],y:e[1]})))}}const Zs=class extends Gs{import(e,t,n){e.length>1&&n(new Ks);const i=new FileReader;i.readAsText(e[0]),i.onloadend=e=>{try{const n=Nn.getImagesData(),i=Zs.deserialize(e.target.result),{imagesData:r,labelNames:s}=this.applyLabels(n,i);t(r,s)}catch(i){n(i)}},i.onerror=()=>n(new qs)}static deserialize(e){try{return JSON.parse(e)}catch(t){throw new Xs}}applyLabels(e,t){Zs.validateCocoFormat(t);const{images:n,categories:i,annotations:r}=t,s=Zs.mapCOCOCategories(i),a=e.map(e=>cs.cleanAnnotations(e)),o=Zs.partitionImageData(a,n),l=Zs.mapImageData(o.pass,n);for(const u of r)if(l[u.image_id]&&1!==u.iscrowd&&(this.labelType.includes(je.RECT)&&l[u.image_id].labelRects.push(Xn.createLabelRect(s[u.category_id].id,Ys.bbox2rect(u.bbox))),this.labelType.includes(je.POLYGON))){const e=Ys.segmentation2vertices(u.segmentation);for(const t of e)l[u.image_id].labelPolygons.push(Xn.createLabelPolygon(s[u.category_id].id,t))}const c=Object.values(l).concat(o.fail);return{imagesData:cs.arrange(c,e.map(e=>e.id)),labelNames:Object.values(s)}}static partitionImageData(e,t){const n=t.map(e=>e.file_name);return Ps.partition(e,e=>n.includes(e.fileData.name))}static mapCOCOCategories(e){return e.reduce((e,t,n)=>(e[t.id]={id:qn(),name:t.name,color:Ps.getByInfiniteIndex(We.LABEL_COLORS_PALETTE,n)},e),{})}static mapImageData(e,t){const n=t.reduce((e,t)=>(e[t.file_name]=t.id,e),{});return e.reduce((e,t)=>(e[n[t.fileData.name]]=t,e),{})}static validateCocoFormat(e){const t=Zs.requiredKeys.filter(t=>!e.hasOwnProperty(t));if(0!==t.length)throw new js(`Uploaded file does not contain all required keys: ${t}`)}};let Qs=Zs;t(Qs,"requiredKeys",["images","annotations","categories"]);const Js=class extends Gs{import(e,t,n){try{const i=Nn.getImagesData().map(e=>cs.cleanAnnotations(e)),{labelNameFile:r,annotationFiles:s}=Js.filterFilesData(e,i),[a,o]=Js.matchImagesWithAnnotations(i,s),l=hn.readFile(r).then(e=>bs.parseLabelsNamesFromString(e)),c=cs.loadMissingImages(a),u=hn.readFiles(o);Promise.all([l,c,u]).then(e=>{const[n,,r]=e,s=I.exports.zip(a,r).map(e=>Js.applyAnnotations(e[0],e[1],n));t(Js.injectImageDataWithAnnotations(i,s),n)}).catch(e=>n(e))}catch(i){n(i)}}static filterFilesData(e,t){const n=Ps.partition(e,e=>e.name===Js.labelsFileName);if(1!==n.pass.length)throw new fs;const i=t.map(e=>e.fileData.name).map(e=>hn.extractFileName(e)),r=Ps.partition(e,e=>i.includes(hn.extractFileName(e.name)));return{labelNameFile:n.pass[0],annotationFiles:r.pass}}static matchImagesWithAnnotations(e,t){return Ps.unzip(Ps.match(e,t,(e,t)=>hn.extractFileName(e.fileData.name)===hn.extractFileName(t.name)))}static applyAnnotations(e,t,n){const i=Jt.getById(e.id);return e.labelRects=bs.parseYOLOAnnotationsFromString(t,n,{width:i.width,height:i.height},e.fileData.name),e}static injectImageDataWithAnnotations(e,t){return e.map(e=>{const n=I.exports.find(t,{id:e.id});return n||e})}};let ea=Js;t(ea,"labelsFileName","labels.txt");class ta extends Error{constructor(e){super(e),this.name="DocumentParsingError"}}class na extends Error{constructor(e){super(e),this.name="AnnotationAssertionError"}}const ia=new DOMParser;class ra extends Gs{import(e,t,n){try{const i=ra.mapImageData();this.loadAndParseFiles(e).then(e=>{for(const t of e.fileParseResults)i[t.filename]&&(i[t.filename].labelRects=t.labeledBoxes);t(Array.from(Object.values(i)),Array.from(Object.values(e.labelNames)))}).catch(e=>n(e))}catch(i){n(i)}}loadAndParseFiles(e){return Promise.all(e.map(e=>e.text())).then(t=>t.reduce((t,n,i)=>{const r=e[i].name;try{return ra.parseDocumentIntoImageData(ra.tryParseVOCDocument(n),t)}catch(s){throw s instanceof ta?new ta(`Failed trying to parse ${r} as VOC XML document.`):s instanceof na?new na(`Failed trying to find required VOC annotations for ${r}.`):s}},{labelNames:{},fileParseResults:[]}))}static tryParseVOCDocument(e){try{return ia.parseFromString(e,"application/xml")}catch{throw new ta}}static parseDocumentIntoImageData(e,{fileParseResults:t,labelNames:n}){try{const i=e.getElementsByTagName("annotation")[0].getElementsByTagName("filename")[0].textContent,[r,s]=this.parseAnnotationsFromFileString(e,n);return{labelNames:s,fileParseResults:t.concat({filename:i,labeledBoxes:r})}}catch{throw new na}}static parseAnnotationsFromFileString(e,t){const n=Object.assign({},t);return[Array.from(e.getElementsByTagName("object")).map(e=>{const t=e.getElementsByTagName("name")[0].textContent,i=e.getElementsByTagName("bndbox")[0],r=parseInt(i.getElementsByTagName("xmin")[0].textContent),s=parseInt(i.getElementsByTagName("xmax")[0].textContent),a=parseInt(i.getElementsByTagName("ymin")[0].textContent),o={x:r,y:a,height:parseInt(i.getElementsByTagName("ymax")[0].textContent)-a,width:s-r};n[t]||(n[t]=Xn.createLabelName(t));const l=n[t].id;return Xn.createLabelRect(l,o)}),n]}static mapImageData(){return Nn.getImagesData().reduce((e,t)=>(e[t.fileData.name]=t,e),{})}}const sa={[Ls.COCO]:Qs,[Ls.CSV]:Hs,[Ls.JSON]:void 0,[Ls.VGG]:void 0,[Ls.VOC]:ra,[Ls.YOLO]:ea},aa=$e(e=>({activeLabelType:e.labels.activeLabelType}),{updateImageDataAction:cn,updateLabelNamesAction:un,updateActiveLabelTypeAction:an})(({activeLabelType:e,updateImageDataAction:t,updateLabelNamesAction:i,updateActiveLabelTypeAction:r})=>{const s=e=>{const t=Ms[e];return 1===t.length?t[0].type:null},[a,l]=n.exports.useState(e),[c,h]=n.exports.useState(s(e)),[p,f]=n.exports.useState([]),[m,g]=n.exports.useState([]),[b,y]=n.exports.useState(null),v=(e,t)=>{f(t),g(e),y(null)},T=e=>{f([]),g([]),y(e);const t=(e=>e instanceof ta?Ts.ANNOTATION_FILE_PARSE_ERROR:e instanceof ms?Ts.NON_UNIQUE_LABEL_NAMES_ERROR:e instanceof $s||e instanceof Bs||e instanceof zs||e instanceof Us?Ts.ANNOTATION_FILE_PARSE_ERROR:Ts.ANNOTATION_IMPORT_ASSERTION_ERROR)(e);_s(vs.createErrorNotification(xs[t]))},{getRootProps:x,getInputProps:_}=as({accept:{"application/json":[".json"],"text/plain":[".txt"],"application/xml":[".xml"],"text/csv":[".csv"]},multiple:!0,onDrop:e=>{new sa[c]([a]).import(e,v,T)}}),S=e=>e.map(e=>u("div",{className:"OptionsItem",onClick:()=>{return t=e.type,void h(t);var t},children:[e.type===c?o("img",{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}):o("img",{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),e.label]},e.type));return o(Os,{activeLabelType:a,title:`Import ${a.toLowerCase()} annotations`,onLabelTypeChange:e=>{l(e),h(s(e)),f([]),g([]),y(null)},acceptLabel:"Import",onAccept:e=>{0!==p.length&&0!==m.length&&(t(m),i(p),r(e),vi.close())},skipAcceptButton:0===Ms[a].length,disableAcceptButton:0===m.length||0===p.length||!!b,rejectLabel:"Cancel",onReject:e=>{vi.close()},renderInternalContent:e=>{if(!c&&0!==Ms[e].length)return u(d,{children:[o("div",{className:"Message",children:"Select file format you would like to use to import labels."}),",",o("div",{className:"Options",children:S(Ms[e])})]});return 0===Ms[e].length?o(Fs,{}):o("div",{...x({className:"DropZone"}),children:b?u(d,{children:[o("input",{..._()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:"Annotation import was unsuccessful"}),b.message,o("p",{className:"extraBold",children:"Try again"})]}):0!==m.length&&0!==p.length?u(d,{children:[o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"}),o("p",{className:"extraBold",children:"Annotation ready for import"}),"After import you will lose all your current annotations"]}):u(d,{children:[o("input",{..._()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:`Drop ${c} annotations`}),o("p",{children:"or"}),o("p",{className:"extraBold",children:"Click here to select them"})]})})}})});function oa(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var la={exports:{}};
/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/la.exports=function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){if(!o&&oa)return oa(a);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){return r(t[a][1][e]||e)},c,c.exports,e,t,n,i)}return n[a].exports}for(var s=oa,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i=e("./utils"),r=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,r,a,o,l,c,u=[],d=0,h=e.length,p=h,f="string"!==i.getTypeOf(e);d<e.length;)p=h-d,r=f?(t=e[d++],n=d<h?e[d++]:0,d<h?e[d++]:0):(t=e.charCodeAt(d++),n=d<h?e.charCodeAt(d++):0,d<h?e.charCodeAt(d++):0),a=t>>2,o=(3&t)<<4|n>>4,l=1<p?(15&n)<<2|r>>6:64,c=2<p?63&r:64,u.push(s.charAt(a)+s.charAt(o)+s.charAt(l)+s.charAt(c));return u.join("")},n.decode=function(e){var t,n,i,a,o,l,c=0,u=0,d="data:";if(e.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var h,p=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&p--,e.charAt(e.length-2)===s.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=r.uint8array?new Uint8Array(0|p):new Array(0|p);c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(a=s.indexOf(e.charAt(c++)))>>4,n=(15&a)<<4|(o=s.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(l=s.indexOf(e.charAt(c++))),h[u++]=t,64!==o&&(h[u++]=n),64!==l&&(h[u++]=i);return h}},{"./support":30,"./utils":32}],2:[function(e,t,n){var i=e("./external"),r=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function o(e,t,n,i,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=r}o.prototype={getContentWorker:function(){var e=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,n){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){var i=e("./utils"),r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?function(e,t,n,i){var s=r,a=i+n;e^=-1;for(var o=i;o<a;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}(0|t,e,e.length,0):function(e,t,n,i){var s=r,a=i+n;e^=-1;for(var o=i;o<a;o++)e=e>>>8^s[255&(e^t.charCodeAt(o))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:37}],7:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=e("pako"),s=e("./utils"),a=e("./stream/GenericWorker"),o=i?"uint8array":"array";function l(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",s.inherits(l,a),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,e.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){function i(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i}function r(e,t,n,r,a,u){var d,h,p=e.file,f=e.compression,m=u!==o.utf8encode,g=s.transformTo("string",u(p.name)),b=s.transformTo("string",o.utf8encode(p.name)),y=p.comment,v=s.transformTo("string",u(y)),T=s.transformTo("string",o.utf8encode(y)),x=b.length!==p.name.length,_=T.length!==y.length,S="",w="",I="",k=p.dir,C=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(E.crc32=e.crc32,E.compressedSize=e.compressedSize,E.uncompressedSize=e.uncompressedSize);var A=0;t&&(A|=8),m||!x&&!_||(A|=2048);var R,N,P,D=0,O=0;k&&(D|=16),"UNIX"===a?(O=798,D|=(R=p.unixPermissions,N=k,P=R,R||(P=N?16893:33204),(65535&P)<<16)):(O=20,D|=function(e){return 63&(e||0)}(p.dosPermissions)),d=C.getUTCHours(),d<<=6,d|=C.getUTCMinutes(),d<<=5,d|=C.getUTCSeconds()/2,h=C.getUTCFullYear()-1980,h<<=4,h|=C.getUTCMonth()+1,h<<=5,h|=C.getUTCDate(),x&&(w=i(1,1)+i(l(g),4)+b,S+="up"+i(w.length,2)+w),_&&(I=i(1,1)+i(l(v),4)+T,S+="uc"+i(I.length,2)+I);var L="";return L+="\n\0",L+=i(A,2),L+=f.magic,L+=i(d,2),L+=i(h,2),L+=i(E.crc32,4),L+=i(E.compressedSize,4),L+=i(E.uncompressedSize,4),L+=i(g.length,2),L+=i(S.length,2),{fileRecord:c.LOCAL_FILE_HEADER+L+g+S,dirRecord:c.CENTRAL_FILE_HEADER+i(O,2)+L+i(v.length,2)+"\0\0\0\0"+i(D,4)+i(r,4)+g+S+v}}var s=e("../utils"),a=e("../stream/GenericWorker"),o=e("../utf8"),l=e("../crc32"),c=e("../signature");function u(e,t,n,i){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(u,a),u.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,a.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=r(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t,n=this.streamFiles&&!e.file.dir,s=r(e,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(s.dirRecord),n)this.push({data:(t=e,c.DATA_DESCRIPTOR+i(t.crc32,4)+i(t.compressedSize,4)+i(t.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:s.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n,r,a,o,l,u,d=this.bytesWritten-e,h=(n=this.dirRecords.length,r=d,a=e,o=this.zipComment,l=this.encodeFileName,u=s.transformTo("string",l(o)),c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(n,2)+i(n,2)+i(r,4)+i(a,4)+i(u.length,2)+u);this.push({data:h,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},u.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!a.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(i){}return!0},u.prototype.lock=function(){a.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){var i=e("../compressions"),r=e("./ZipFileWorker");n.generateWorker=function(e,t,n){var s=new r(t.streamFiles,n,t.platform,t.encodeFileName),a=0;try{e.forEach(function(e,n){a++;var r=function(e,t){var n=e||t,r=i[n];if(!r)throw new Error(n+" is not a valid compression method !");return r}(n.options.compression,t.compression),o=n.options.compressionOptions||t.compressionOptions||{},l=n.dir,c=n.date;n._compressWorker(r,o).withStreamInfo("file",{name:e,dir:l,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(s)}),s.entriesCount=a}catch(o){s.error(o)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){var i=e("./utils"),r=e("./external"),s=e("./utf8"),a=e("./zipEntries"),o=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new r.Promise(function(t,n){var i=e.decompressed.getContentWorker().pipe(new o);i.on("error",function(e){n(e)}).on("end",function(){i.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}t.exports=function(e,t){var n=this;return t=i.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(e)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var n=new a(t);return n.load(e),n}).then(function(e){var n=[r.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var s=0;s<i.length;s++)n.push(c(i[s]));return r.Promise.all(n)}).then(function(e){for(var r=e.shift(),s=r.files,a=0;a<s.length;a++){var o=s[a],l=o.fileNameStr,c=i.resolve(o.fileNameStr);n.file(c,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders}),o.dir||(n.file(c).unsafeOriginalName=l)}return r.zipComment.length&&(n.comment=r.zipComment),n})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){var i=e("../utils"),r=e("../stream/GenericWorker");function s(e,t){r.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(s,r),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},s.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){var i=e("readable-stream").Readable;function r(e,t,n){i.call(this,t),this._helper=e;var r=this;e.on("data",function(e,t){r.push(e)||r._helper.pause(),n&&n(t)}).on("error",function(e){r.emit("error",e)}).on("end",function(){r.push(null)})}e("../utils").inherits(r,i),r.prototype._read=function(){this._helper.resume()},t.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){function i(e,t,n){var i,r=s.getTypeOf(t),o=s.extend(n||{},l);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(e=m(e)),o.createFolders&&(i=f(e))&&g.call(this,i,!0);var d="string"===r&&!1===o.binary&&!1===o.base64;n&&void 0!==n.binary||(o.binary=!d),(t instanceof c&&0===t.uncompressedSize||o.dir||!t||0===t.length)&&(o.base64=!1,o.binary=!0,t="",o.compression="STORE",r="string");var b=null;b=t instanceof c||t instanceof a?t:h.isNode&&h.isStream(t)?new p(e,t):s.prepareContent(e,t,o.binary,o.optimizedBinaryString,o.base64);var y=new u(e,b,o);this.files[e]=y}var r=e("./utf8"),s=e("./utils"),a=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),l=e("./defaults"),c=e("./compressedObject"),u=e("./zipObject"),d=e("./generate"),h=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:l.createFolders,e=m(e),this.files[e]||i.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function b(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i)},filter:function(e){var t=[];return this.forEach(function(n,i){e(n,i)&&t.push(i)}),t},file:function(e,t,n){if(1!==arguments.length)return e=this.root+e,i.call(this,e,t,n),this;if(b(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}var s=this.files[this.root+e];return s&&!s.dir?s:null},folder:function(e){if(!e)return this;if(b(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=g.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");s.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var i=n.comment||this.comment||"";t=d.generateWorker(this,n,i)}catch(l){(t=new a("error")).error(l)}return new o(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){var i=e("./DataReader");function r(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(r,i),r.prototype.byteAt=function(e){return this.data[this.zero+e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===i&&this.data[s+3]===r)return s-this.zero;return-1},r.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&n===s[1]&&i===s[2]&&r===s[3]},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){var i=e("../utils");function r(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=r},{"../utils":32}],19:[function(e,t,n){var i=e("./Uint8ArrayReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){var i=e("./DataReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},r.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){var i=e("./ArrayReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){var i=e("../utils"),r=e("../support"),s=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new o(e):r.uint8array?new l(i.transformTo("uint8array",e)):new s(i.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){var i=e("./GenericWorker"),r=e("../utils");function s(e){i.call(this,"ConvertWorker to "+e),this.destType=e}r.inherits(s,i),s.prototype.processChunk=function(e){this.push({data:r.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){var i=e("./GenericWorker"),r=e("../crc32");function s(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,i),s.prototype.processChunk=function(e){this.streamInfo.crc32=r(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){var i=e("../utils"),r=e("./GenericWorker");function s(e){r.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(s,r),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}r.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){var i=e("../utils"),r=e("./GenericWorker");function s(e){r.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}i.inherits(s,r),s.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,n){var i=e("../utils"),r=e("./ConvertWorker"),s=e("./GenericWorker"),a=e("../base64"),o=e("../support"),l=e("../external"),c=null;if(o.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(h){}function u(e,t){return new l.Promise(function(n,r){var s=[],o=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",function(e,n){s.push(e),t&&t(n)}).on("error",function(e){s=[],r(e)}).on("end",function(){try{var e=function(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return a.encode(t);default:return i.transformTo(e,t)}}(l,function(e,t){var n,i=0,r=null,s=0;for(n=0;n<t.length;n++)s+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(s),n=0;n<t.length;n++)r.set(t[n],i),i+=t[n].length;return r;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(o,s),c);n(e)}catch(t){r(t)}s=[]}).resume()})}function d(e,t,n){var a=t;switch(t){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=t,this._mimeType=n,i.checkSupport(a),this._worker=e.pipe(new r(a)),e.lock()}catch(o){this._worker=new s("error"),this._worker.error(o)}}d.prototype={accumulate:function(e){return u(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){i.delay(t,arguments,n)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(s){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),n.blob=0===r.getBlob("application/zip").size}catch(a){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(s){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){for(var i=e("./utils"),r=e("./support"),s=e("./nodejsUtils"),a=e("./stream/GenericWorker"),o=new Array(256),l=0;l<256;l++)o[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){a.call(this,"utf-8 decode"),this.leftOver=null}function u(){a.call(this,"utf-8 encode")}o[254]=o[254]=1,n.utf8encode=function(e){return r.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,n,i,s,a,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=r.uint8array?new Uint8Array(l):new Array(l),s=a=0;a<l;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t}(e)},n.utf8decode=function(e){return r.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,r,s,a=e.length,l=new Array(2*a);for(t=n=0;t<a;)if((r=e[t++])<128)l[n++]=r;else if(4<(s=o[r]))l[n++]=65533,t+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&t<a;)r=r<<6|63&e[t++],s--;1<s?l[n++]=65533:r<65536?l[n++]=r:(r-=65536,l[n++]=55296|r>>10&1023,l[n++]=56320|1023&r)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)}(e=i.transformTo(r.uint8array?"uint8array":"array",e))},i.inherits(c,a),c.prototype.processChunk=function(e){var t=i.transformTo(r.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var s=t;(t=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),t.set(s,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var a=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}(t),l=t;a!==t.length&&(r.uint8array?(l=t.subarray(0,a),this.leftOver=t.subarray(a,t.length)):(l=t.slice(0,a),this.leftOver=t.slice(a,t.length))),this.push({data:n.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,i.inherits(u,a),u.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){var i=e("./support"),r=e("./base64"),s=e("./nodejsUtils"),a=e("./external");function o(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}e("setimmediate"),n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(t)}catch(s){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,n){var i=[],r=0,s=e.length;if(s<=n)return String.fromCharCode.apply(null,e);for(;r<s;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+n,s)))):i.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+n,s)))),r+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,i=n.getTypeOf(e),r=!0;if("uint8array"===i?r=c.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=c.applyCanBeUsed.nodebuffer),r)for(;1<t;)try{return c.stringifyByChunk(e,i,t)}catch(s){t=Math.floor(t/2)}return c.stringifyByChar(e)}function d(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.applyFromCharCode=u;var h={};h.string={string:o,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,s.allocBuffer(e.length))}},h.array={string:u,array:o,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},h.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:o,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},h.uint8array={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:o,nodebuffer:function(e){return s.newBufferFrom(e)}},h.nodebuffer={string:u,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:o},n.transformTo=function(e,t){if(t=t||"",!e)return t;n.checkSupport(e);var i=n.getTypeOf(t);return h[i][e](t)},n.resolve=function(e){for(var t=e.split("/"),n=[],i=0;i<t.length;i++){var r=t[i];"."===r||""===r&&0!==i&&i!==t.length-1||(".."===r?n.pop():n.push(r))}return n.join("/")},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&s.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},n.delay=function(e,t,n){setImmediate(function(){e.apply(n||null,t||[])})},n.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,s,o,c){return a.Promise.resolve(t).then(function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise(function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e.target.error)},i.readAsArrayBuffer(e)}):e}).then(function(t){var u,d=n.getTypeOf(t);return d?("arraybuffer"===d?t=n.transformTo("uint8array",t):"string"===d&&(c?t=r.decode(t):s&&!0!==o&&(t=l(u=t,i.uint8array?new Uint8Array(u.length):new Array(u.length)))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,n){var i=e("./reader/readerFor"),r=e("./utils"),s=e("./signature"),a=e("./zipEntry"),o=e("./support");function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(t)+", expected "+r.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",n=r.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(0<i)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){var i=e("./reader/readerFor"),r=e("./utils"),s=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),l=e("./compressions"),c=e("./support");function u(e,t){this.options=e,this.loadOptions=t}u.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(Object.prototype.hasOwnProperty.call(l,t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,n,i,r=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<r;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i};e.setIndex(r)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=r.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var s=r.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)||a(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)||a(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){function i(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var r=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),l=e("./stream/GenericWorker");i.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(t=t.pipe(new a.Utf8EncodeWorker)),!s&&i&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(o){(t=new l("error")).error(o)}return new r(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<c.length;d++)i.prototype[c[d]]=u;t.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){var n,i,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var s=0,a=new r(u),o=e.document.createTextNode("");a.observe(o,{characterData:!0}),n=function(){o.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;i=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}i=!1}t.exports=function(e){1!==c.push(e)||i||n()}}).call(this,void 0!==S?S:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){var i=e("immediate");function r(){}var s={},a=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==r&&p(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){i(function(){var i;try{i=t(n)}catch(r){return s.reject(e,r)}i===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,i)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function i(t){n||(n=!0,s.reject(e,t))}function r(t){n||(n=!0,s.resolve(e,t))}var a=f(function(){t(r,i)});"error"===a.status&&i(a.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(i){n.status="error",n.value=i}return n}(t.exports=c).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(r);return this.state!==l?d(n,this.state===o?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=f(h,t);if("error"===n.status)return s.reject(e,n.value);var i=n.value;if(i)p(e,i);else{e.state=o,e.outcome=t;for(var r=-1,a=e.queue.length;++r<a;)e.queue[r].callFulfilled(t)}return e},s.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:s.resolve(new this(r),e)},c.reject=function(e){var t=new this(r);return s.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),o=0,l=-1,c=new this(r);++l<n;)u(e[l],l);return c;function u(e,r){t.resolve(e).then(function(e){a[r]=e,++o!==n||i||(i=!0,s.resolve(c,a))},function(e){i||(i=!0,s.reject(c,e))})}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a,o=-1,l=new this(r);++o<n;)a=e[o],t.resolve(a).then(function(e){i||(i=!0,s.resolve(l,e))},function(e){i||(i=!0,s.reject(l,e))});return l}},{immediate:36}],38:[function(e,t,n){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){var i=e("./zlib/deflate"),r=e("./utils/common"),s=e("./utils/strings"),a=e("./zlib/messages"),o=e("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,d=0,h=8;function p(e){if(!(this instanceof p))return new p(e);this.options=r.assign({level:u,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==c)throw new Error(a[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=i.deflateSetDictionary(this.strm,f))!==c)throw new Error(a[n]);this._dict_set=!0}}function f(e,t){var n=new p(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}p.prototype.push=function(e,t){var n,a,o=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?o.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(u),o.next_out=0,o.avail_out=u),1!==(n=i.deflate(o,a))&&n!==c)return this.onEnd(n),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==a||(this.onEnd(c),!(o.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=p,n.deflate=f,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){var i=e("./zlib/inflate"),r=e("./utils/common"),s=e("./utils/strings"),a=e("./zlib/constants"),o=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(o[n]);this.header=new c,i.inflateGetHeader(this.strm,this.header)}function h(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}d.prototype.push=function(e,t){var n,o,l,c,d,h,p=this.strm,f=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?p.input=s.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(n=i.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(h="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===u.call(m)?new Uint8Array(m):m,n=i.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(p.output,p.next_out),c=p.next_out-l,d=s.buf2string(p.output,l),p.next_out=c,p.avail_out=f-c,c&&r.arraySet(p.output,p.output,l,c,0),this.onData(d)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((0<p.avail_in||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(p.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=d,n.inflate=h,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},n.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var s=0;s<i;s++)e[r+s]=t[n+s]},flattenChunks:function(e){var t,n,i,r,s,a;for(t=i=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),t=r=0,n=e.length;t<n;t++)s=e[t],a.set(s,r),r+=s.length;return a}},s={arraySet:function(e,t,n,i,r){for(var s=0;s<i;s++)e[r+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(i)},{}],42:[function(e,t,n){var i=e("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(c){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(c){s=!1}for(var a=new i.Buf8(256),o=0;o<256;o++)a[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,r,s,a,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),s=a=0;a<l;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(r=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(r-56320),s++),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,r,s,o=t||e.length,c=new Array(2*o);for(n=i=0;n<o;)if((r=e[n++])<128)c[i++]=r;else if(4<(s=a[r]))c[i++]=65533,n+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&n<o;)r=r<<6|63&e[n++],s--;1<s?c[i++]=65533:r<65536?c[i++]=r:(r-=65536,c[i++]=55296|r>>10&1023,c[i++]=56320|1023&r)}return l(c,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){t.exports=function(e,t,n,i){for(var r=65535&e,s=e>>>16&65535,a=0;0!==n;){for(n-=a=2e3<n?2e3:n;s=s+(r=r+t[i++]|0)|0,--a;);r%=65521,s%=65521}return r|s<<16}},{}],44:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,r){var s=i,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}},{}],46:[function(e,t,n){var i,r=e("../utils/common"),s=e("./trees"),a=e("./adler32"),o=e("./crc32"),l=e("./messages"),c=0,u=4,d=0,h=-2,p=-1,f=4,m=2,g=8,b=9,y=286,v=30,T=19,x=2*y+1,_=15,S=3,w=258,I=w+S+1,k=42,C=113,E=1,A=2,R=3,N=4;function P(e,t){return e.msg=l[t],t}function D(e){return(e<<1)-(4<e?9:0)}function O(e){for(var t=e.length;0<=--t;)e[t]=0}function L(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function M(e,t){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,L(e.strm)}function F(e,t){e.pending_buf[e.pending++]=t}function $(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function B(e,t){var n,i,r=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-I?e.strstart-(e.w_size-I):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+w,p=c[s+a-1],f=c[s+a];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(n=t)+a]===f&&c[n+a-1]===p&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<h);if(i=w-(h-s),s=h-w,a<i){if(e.match_start=t,o<=(a=i))break;p=c[s+a-1],f=c[s+a]}}}while((t=d[t&u])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function z(e){var t,n,i,s,l,c,u,d,h,p,f=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-I)){for(r.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=n=e.hash_size;i=e.head[--t],e.head[t]=f<=i?i-f:0,--n;);for(t=n=f;i=e.prev[--t],e.prev[t]=f<=i?i-f:0,--n;);s+=f}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,d=e.strstart+e.lookahead,p=void 0,(h=s)<(p=c.avail_in)&&(p=h),n=0===p?0:(c.avail_in-=p,r.arraySet(u,c.input,c.next_in,p,d),1===c.state.wrap?c.adler=a(c.adler,u,p,d):2===c.state.wrap&&(c.adler=o(c.adler,u,p,d)),c.next_in+=p,c.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=S)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+S-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<S)););}while(e.lookahead<I&&0!==e.strm.avail_in)}function U(e,t){for(var n,i;;){if(e.lookahead<I){if(z(e),e.lookahead<I&&t===c)return E;if(0===e.lookahead)break}if(n=0,e.lookahead>=S&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-I&&(e.match_length=B(e,n)),e.match_length>=S)if(i=s._tr_tally(e,e.strstart-e.match_start,e.match_length-S),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=S){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(M(e,!1),0===e.strm.avail_out))return E}return e.insert=e.strstart<S-1?e.strstart:S-1,t===u?(M(e,!0),0===e.strm.avail_out?R:N):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?E:A}function G(e,t){for(var n,i,r;;){if(e.lookahead<I){if(z(e),e.lookahead<I&&t===c)return E;if(0===e.lookahead)break}if(n=0,e.lookahead>=S&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=S-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-I&&(e.match_length=B(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===S&&4096<e.strstart-e.match_start)&&(e.match_length=S-1)),e.prev_length>=S&&e.match_length<=e.prev_length){for(r=e.strstart+e.lookahead-S,i=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-S),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=S-1,e.strstart++,i&&(M(e,!1),0===e.strm.avail_out))return E}else if(e.match_available){if((i=s._tr_tally(e,0,e.window[e.strstart-1]))&&M(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return E}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<S-1?e.strstart:S-1,t===u?(M(e,!0),0===e.strm.avail_out?R:N):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?E:A}function V(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*x),this.dyn_dtree=new r.Buf16(2*(2*v+1)),this.bl_tree=new r.Buf16(2*(2*T+1)),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(_+1),this.heap=new r.Buf16(2*y+1),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*y+1),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function W(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=m,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?k:C,e.adler=2===t.wrap?0:1,t.last_flush=c,s._tr_init(t),d):P(e,h)}function j(e){var t,n=W(e);return n===d&&((t=e.state).window_size=2*t.w_size,O(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0),n}function q(e,t,n,i,s,a){if(!e)return h;var o=1;if(t===p&&(t=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),s<1||b<s||n!==g||i<8||15<i||t<0||9<t||a<0||f<a)return P(e,h);8===i&&(i=9);var l=new H;return(e.state=l).strm=e,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+S-1)/S),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,j(e)}i=[new V(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(z(e),0===e.lookahead&&t===c)return E;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,M(e,!1),0===e.strm.avail_out))return E;if(e.strstart-e.block_start>=e.w_size-I&&(M(e,!1),0===e.strm.avail_out))return E}return e.insert=0,t===u?(M(e,!0),0===e.strm.avail_out?R:N):(e.strstart>e.block_start&&(M(e,!1),e.strm.avail_out),E)}),new V(4,4,8,4,U),new V(4,5,16,8,U),new V(4,6,32,32,U),new V(4,4,16,16,G),new V(8,16,32,32,G),new V(8,16,128,128,G),new V(8,32,128,256,G),new V(32,128,258,1024,G),new V(32,258,258,4096,G)],n.deflateInit=function(e,t){return q(e,t,g,15,8,0)},n.deflateInit2=q,n.deflateReset=j,n.deflateResetKeep=W,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?h:(e.state.gzhead=t,d):h},n.deflate=function(e,t){var n,r,a,l;if(!e||!e.state||5<t||t<0)return e?P(e,h):h;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&t!==u)return P(e,0===e.avail_out?-5:h);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===k)if(2===r.wrap)e.adler=0,F(r,31),F(r,139),F(r,8),r.gzhead?(F(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),F(r,255&r.gzhead.time),F(r,r.gzhead.time>>8&255),F(r,r.gzhead.time>>16&255),F(r,r.gzhead.time>>24&255),F(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),F(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(F(r,255&r.gzhead.extra.length),F(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=o(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(F(r,0),F(r,0),F(r,0),F(r,0),F(r,0),F(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),F(r,3),r.status=C);else{var p=g+(r.w_bits-8<<4)<<8;p|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(p|=32),p+=31-p%31,r.status=C,$(r,p),0!==r.strstart&&($(r,e.adler>>>16),$(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=o(e.adler,r.pending_buf,r.pending-a,a)),L(e),a=r.pending,r.pending!==r.pending_buf_size));)F(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=o(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=o(e.adler,r.pending_buf,r.pending-a,a)),L(e),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,F(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(e.adler=o(e.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=o(e.adler,r.pending_buf,r.pending-a,a)),L(e),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,F(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(e.adler=o(e.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&L(e),r.pending+2<=r.pending_buf_size&&(F(r,255&e.adler),F(r,e.adler>>8&255),e.adler=0,r.status=C)):r.status=C),0!==r.pending){if(L(e),0===e.avail_out)return r.last_flush=-1,d}else if(0===e.avail_in&&D(t)<=D(n)&&t!==u)return P(e,-5);if(666===r.status&&0!==e.avail_in)return P(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==c&&666!==r.status){var f=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(z(e),0===e.lookahead)){if(t===c)return E;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(M(e,!1),0===e.strm.avail_out))return E}return e.insert=0,t===u?(M(e,!0),0===e.strm.avail_out?R:N):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?E:A}(r,t):3===r.strategy?function(e,t){for(var n,i,r,a,o=e.window;;){if(e.lookahead<=w){if(z(e),e.lookahead<=w&&t===c)return E;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=S&&0<e.strstart&&(i=o[r=e.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){a=e.strstart+w;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<a);e.match_length=w-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=S?(n=s._tr_tally(e,1,e.match_length-S),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(M(e,!1),0===e.strm.avail_out))return E}return e.insert=0,t===u?(M(e,!0),0===e.strm.avail_out?R:N):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?E:A}(r,t):i[r.level].func(r,t);if(f!==R&&f!==N||(r.status=666),f===E||f===R)return 0===e.avail_out&&(r.last_flush=-1),d;if(f===A&&(1===t?s._tr_align(r):5!==t&&(s._tr_stored_block(r,0,0,!1),3===t&&(O(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),L(e),0===e.avail_out))return r.last_flush=-1,d}return t!==u?d:r.wrap<=0?1:(2===r.wrap?(F(r,255&e.adler),F(r,e.adler>>8&255),F(r,e.adler>>16&255),F(r,e.adler>>24&255),F(r,255&e.total_in),F(r,e.total_in>>8&255),F(r,e.total_in>>16&255),F(r,e.total_in>>24&255)):($(r,e.adler>>>16),$(r,65535&e.adler)),L(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?d:1)},n.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==k&&69!==t&&73!==t&&91!==t&&103!==t&&t!==C&&666!==t?P(e,h):(e.state=null,t===C?P(e,-3):d):h},n.deflateSetDictionary=function(e,t){var n,i,s,o,l,c,u,p,f=t.length;if(!e||!e.state)return h;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==k||n.lookahead)return h;for(1===o&&(e.adler=a(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(O(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new r.Buf8(n.w_size),r.arraySet(p,t,f-n.w_size,n.w_size,0),t=p,f=n.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,z(n);n.lookahead>=S;){for(i=n.strstart,s=n.lookahead-(S-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+S-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=S-1,z(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=S-1,n.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,n.wrap=o,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){t.exports=function(e,t){var n,i,r,s,a,o,l,c,u,d,h,p,f,m,g,b,y,v,T,x,_,S,w,I,k;n=e.state,i=e.next_in,I=e.input,r=i+(e.avail_in-5),s=e.next_out,k=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,d=n.wnext,h=n.window,p=n.hold,f=n.bits,m=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{f<15&&(p+=I[i++]<<f,f+=8,p+=I[i++]<<f,f+=8),v=m[p&b];t:for(;;){if(p>>>=T=v>>>24,f-=T,0==(T=v>>>16&255))k[s++]=65535&v;else{if(!(16&T)){if(!(64&T)){v=m[(65535&v)+(p&(1<<T)-1)];continue t}if(32&T){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&v,(T&=15)&&(f<T&&(p+=I[i++]<<f,f+=8),x+=p&(1<<T)-1,p>>>=T,f-=T),f<15&&(p+=I[i++]<<f,f+=8,p+=I[i++]<<f,f+=8),v=g[p&y];n:for(;;){if(p>>>=T=v>>>24,f-=T,!(16&(T=v>>>16&255))){if(!(64&T)){v=g[(65535&v)+(p&(1<<T)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(_=65535&v,f<(T&=15)&&(p+=I[i++]<<f,(f+=8)<T&&(p+=I[i++]<<f,f+=8)),l<(_+=p&(1<<T)-1)){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=T,f-=T,(T=s-a)<_){if(u<(T=_-T)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(w=h,(S=0)===d){if(S+=c-T,T<x){for(x-=T;k[s++]=h[S++],--T;);S=s-_,w=k}}else if(d<T){if(S+=c+d-T,(T-=d)<x){for(x-=T;k[s++]=h[S++],--T;);if(S=0,d<x){for(x-=T=d;k[s++]=h[S++],--T;);S=s-_,w=k}}}else if(S+=d-T,T<x){for(x-=T;k[s++]=h[S++],--T;);S=s-_,w=k}for(;2<x;)k[s++]=w[S++],k[s++]=w[S++],k[s++]=w[S++],x-=3;x&&(k[s++]=w[S++],1<x&&(k[s++]=w[S++]))}else{for(S=s-_;k[s++]=k[S++],k[s++]=k[S++],k[s++]=k[S++],2<(x-=3););x&&(k[s++]=k[S++],1<x&&(k[s++]=k[S++]))}break}}break}}while(i<r&&s<o);i-=x=f>>3,p&=(1<<(f-=x<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=s<o?o-s+257:257-(s-o),n.hold=p,n.bits=f}},{}],49:[function(e,t,n){var i=e("../utils/common"),r=e("./adler32"),s=e("./crc32"),a=e("./inffast"),o=e("./inftrees"),l=1,c=2,u=0,d=-2,h=1,p=852,f=592;function m(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=h,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(p),t.distcode=t.distdyn=new i.Buf32(f),t.sane=1,t.back=-1,u):d}function y(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,b(e)):d}function v(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?d:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,y(e))):d}function T(e,t){var n,i;return e?(i=new g,(e.state=i).window=null,(n=v(e,t))!==u&&(e.state=null),n):d}var x,_,S=!0;function w(e){if(S){var t;for(x=new i.Buf32(512),_=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(l,e.lens,0,288,x,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(c,e.lens,0,32,_,0,e.work,{bits:5}),S=!1}e.lencode=x,e.lenbits=9,e.distcode=_,e.distbits=5}function I(e,t,n,r){var s,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(r<(s=a.wsize-a.wnext)&&(s=r),i.arraySet(a.window,t,n-r,s,a.wnext),(r-=s)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}n.inflateReset=y,n.inflateReset2=v,n.inflateResetKeep=b,n.inflateInit=function(e){return T(e,15)},n.inflateInit2=T,n.inflate=function(e,t){var n,p,f,g,b,y,v,T,x,_,S,k,C,E,A,R,N,P,D,O,L,M,F,$,B=0,z=new i.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return d;12===(n=e.state).mode&&(n.mode=13),b=e.next_out,f=e.output,v=e.avail_out,g=e.next_in,p=e.input,y=e.avail_in,T=n.hold,x=n.bits,_=y,S=v,M=u;e:for(;;)switch(n.mode){case h:if(0===n.wrap){n.mode=13;break}for(;x<16;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(2&n.wrap&&35615===T){z[n.check=0]=255&T,z[1]=T>>>8&255,n.check=s(n.check,z,2,0),x=T=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&T)<<8)+(T>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&T)){e.msg="unknown compression method",n.mode=30;break}if(x-=4,L=8+(15&(T>>>=4)),0===n.wbits)n.wbits=L;else if(L>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<L,e.adler=n.check=1,n.mode=512&T?10:12,x=T=0;break;case 2:for(;x<16;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(n.flags=T,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=T>>8&1),512&n.flags&&(z[0]=255&T,z[1]=T>>>8&255,n.check=s(n.check,z,2,0)),x=T=0,n.mode=3;case 3:for(;x<32;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}n.head&&(n.head.time=T),512&n.flags&&(z[0]=255&T,z[1]=T>>>8&255,z[2]=T>>>16&255,z[3]=T>>>24&255,n.check=s(n.check,z,4,0)),x=T=0,n.mode=4;case 4:for(;x<16;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}n.head&&(n.head.xflags=255&T,n.head.os=T>>8),512&n.flags&&(z[0]=255&T,z[1]=T>>>8&255,n.check=s(n.check,z,2,0)),x=T=0,n.mode=5;case 5:if(1024&n.flags){for(;x<16;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}n.length=T,n.head&&(n.head.extra_len=T),512&n.flags&&(z[0]=255&T,z[1]=T>>>8&255,n.check=s(n.check,z,2,0)),x=T=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(y<(k=n.length)&&(k=y),k&&(n.head&&(L=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,p,g,k,L)),512&n.flags&&(n.check=s(n.check,p,k,g)),y-=k,g+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===y)break e;for(k=0;L=p[g+k++],n.head&&L&&n.length<65536&&(n.head.name+=String.fromCharCode(L)),L&&k<y;);if(512&n.flags&&(n.check=s(n.check,p,k,g)),y-=k,g+=k,L)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===y)break e;for(k=0;L=p[g+k++],n.head&&L&&n.length<65536&&(n.head.comment+=String.fromCharCode(L)),L&&k<y;);if(512&n.flags&&(n.check=s(n.check,p,k,g)),y-=k,g+=k,L)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;x<16;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(T!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}x=T=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;x<32;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}e.adler=n.check=m(T),x=T=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=b,e.avail_out=v,e.next_in=g,e.avail_in=y,n.hold=T,n.bits=x,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){T>>>=7&x,x-=7&x,n.mode=27;break}for(;x<3;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}switch(n.last=1&T,x-=1,3&(T>>>=1)){case 0:n.mode=14;break;case 1:if(w(n),n.mode=20,6!==t)break;T>>>=2,x-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}T>>>=2,x-=2;break;case 14:for(T>>>=7&x,x-=7&x;x<32;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if((65535&T)!=(T>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&T,x=T=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(y<k&&(k=y),v<k&&(k=v),0===k)break e;i.arraySet(f,p,g,k,b),y-=k,g+=k,v-=k,b+=k,n.length-=k;break}n.mode=12;break;case 17:for(;x<14;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(n.nlen=257+(31&T),T>>>=5,x-=5,n.ndist=1+(31&T),T>>>=5,x-=5,n.ncode=4+(15&T),T>>>=4,x-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;x<3;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}n.lens[U[n.have++]]=7&T,T>>>=3,x-=3}for(;n.have<19;)n.lens[U[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,F={bits:n.lenbits},M=o(0,n.lens,0,19,n.lencode,0,n.work,F),n.lenbits=F.bits,M){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;R=(B=n.lencode[T&(1<<n.lenbits)-1])>>>16&255,N=65535&B,!((A=B>>>24)<=x);){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(N<16)T>>>=A,x-=A,n.lens[n.have++]=N;else{if(16===N){for($=A+2;x<$;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(T>>>=A,x-=A,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}L=n.lens[n.have-1],k=3+(3&T),T>>>=2,x-=2}else if(17===N){for($=A+3;x<$;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}x-=A,L=0,k=3+(7&(T>>>=A)),T>>>=3,x-=3}else{for($=A+7;x<$;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}x-=A,L=0,k=11+(127&(T>>>=A)),T>>>=7,x-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=L}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,F={bits:n.lenbits},M=o(l,n.lens,0,n.nlen,n.lencode,0,n.work,F),n.lenbits=F.bits,M){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,F={bits:n.distbits},M=o(c,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,F),n.distbits=F.bits,M){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=y&&258<=v){e.next_out=b,e.avail_out=v,e.next_in=g,e.avail_in=y,n.hold=T,n.bits=x,a(e,S),b=e.next_out,f=e.output,v=e.avail_out,g=e.next_in,p=e.input,y=e.avail_in,T=n.hold,x=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;R=(B=n.lencode[T&(1<<n.lenbits)-1])>>>16&255,N=65535&B,!((A=B>>>24)<=x);){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(R&&!(240&R)){for(P=A,D=R,O=N;R=(B=n.lencode[O+((T&(1<<P+D)-1)>>P)])>>>16&255,N=65535&B,!(P+(A=B>>>24)<=x);){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}T>>>=P,x-=P,n.back+=P}if(T>>>=A,x-=A,n.back+=A,n.length=N,0===R){n.mode=26;break}if(32&R){n.back=-1,n.mode=12;break}if(64&R){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&R,n.mode=22;case 22:if(n.extra){for($=n.extra;x<$;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}n.length+=T&(1<<n.extra)-1,T>>>=n.extra,x-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;R=(B=n.distcode[T&(1<<n.distbits)-1])>>>16&255,N=65535&B,!((A=B>>>24)<=x);){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(!(240&R)){for(P=A,D=R,O=N;R=(B=n.distcode[O+((T&(1<<P+D)-1)>>P)])>>>16&255,N=65535&B,!(P+(A=B>>>24)<=x);){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}T>>>=P,x-=P,n.back+=P}if(T>>>=A,x-=A,n.back+=A,64&R){e.msg="invalid distance code",n.mode=30;break}n.offset=N,n.extra=15&R,n.mode=24;case 24:if(n.extra){for($=n.extra;x<$;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}n.offset+=T&(1<<n.extra)-1,T>>>=n.extra,x-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===v)break e;if(k=S-v,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}C=k>n.wnext?(k-=n.wnext,n.wsize-k):n.wnext-k,k>n.length&&(k=n.length),E=n.window}else E=f,C=b-n.offset,k=n.length;for(v<k&&(k=v),v-=k,n.length-=k;f[b++]=E[C++],--k;);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;f[b++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;x<32;){if(0===y)break e;y--,T|=p[g++]<<x,x+=8}if(S-=v,e.total_out+=S,n.total+=S,S&&(e.adler=n.check=n.flags?s(n.check,f,S,b-S):r(n.check,f,S,b-S)),S=v,(n.flags?T:m(T))!==n.check){e.msg="incorrect data check",n.mode=30;break}x=T=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;x<32;){if(0===y)break e;y--,T+=p[g++]<<x,x+=8}if(T!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}x=T=0}n.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;default:return d}return e.next_out=b,e.avail_out=v,e.next_in=g,e.avail_in=y,n.hold=T,n.bits=x,(n.wsize||S!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&I(e,e.output,e.next_out,S-e.avail_out)?(n.mode=31,-4):(_-=e.avail_in,S-=e.avail_out,e.total_in+=_,e.total_out+=S,n.total+=S,n.wrap&&S&&(e.adler=n.check=n.flags?s(n.check,f,S,e.next_out-S):r(n.check,f,S,e.next_out-S)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==_&&0===S||4===t)&&M===u&&(M=-5),M)},n.inflateEnd=function(e){if(!e||!e.state)return d;var t=e.state;return t.window&&(t.window=null),e.state=null,u},n.inflateGetHeader=function(e,t){var n;return e&&e.state&&2&(n=e.state).wrap?((n.head=t).done=!1,u):d},n.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?d:11===n.mode&&r(1,t,i,0)!==n.check?-3:I(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,u):d},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){var i=e("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,l,c,u,d,h){var p,f,m,g,b,y,v,T,x,_=h.bits,S=0,w=0,I=0,k=0,C=0,E=0,A=0,R=0,N=0,P=0,D=null,O=0,L=new i.Buf16(16),M=new i.Buf16(16),F=null,$=0;for(S=0;S<=15;S++)L[S]=0;for(w=0;w<l;w++)L[t[n+w]]++;for(C=_,k=15;1<=k&&0===L[k];k--);if(k<C&&(C=k),0===k)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(I=1;I<k&&0===L[I];I++);for(C<I&&(C=I),S=R=1;S<=15;S++)if(R<<=1,(R-=L[S])<0)return-1;if(0<R&&(0===e||1!==k))return-1;for(M[1]=0,S=1;S<15;S++)M[S+1]=M[S]+L[S];for(w=0;w<l;w++)0!==t[n+w]&&(d[M[t[n+w]]++]=w);if(y=0===e?(D=F=d,19):1===e?(D=r,O-=257,F=s,$-=257,256):(D=a,F=o,-1),S=I,b=u,A=w=P=0,m=-1,g=(N=1<<(E=C))-1,1===e&&852<N||2===e&&592<N)return 1;for(;;){for(v=S-A,x=d[w]<y?(T=0,d[w]):d[w]>y?(T=F[$+d[w]],D[O+d[w]]):(T=96,0),p=1<<S-A,I=f=1<<E;c[b+(P>>A)+(f-=p)]=v<<24|T<<16|x,0!==f;);for(p=1<<S-1;P&p;)p>>=1;if(0!==p?(P&=p-1,P+=p):P=0,w++,0==--L[S]){if(S===k)break;S=t[n+d[w]]}if(C<S&&(P&g)!==m){for(0===A&&(A=C),b+=I,R=1<<(E=S-A);E+A<k&&!((R-=L[E+A])<=0);)E++,R<<=1;if(N+=1<<E,1===e&&852<N||2===e&&592<N)return 1;c[m=P&g]=C<<24|E<<16|b-u}}return 0!==P&&(c[b+P]=S-A<<24|64<<16),h.bits=C,0}},{"../utils/common":41}],51:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){var i=e("../utils/common"),r=0,s=1;function a(e){for(var t=e.length;0<=--t;)e[t]=0}var o=0,l=29,c=256,u=c+1+l,d=30,h=19,p=2*u+1,f=15,m=16,g=7,b=256,y=16,v=17,T=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(u+2));a(I);var k=new Array(2*d);a(k);var C=new Array(512);a(C);var E=new Array(256);a(E);var A=new Array(l);a(A);var R,N,P,D=new Array(d);function O(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function L(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function M(e){return e<256?C[e]:C[256+(e>>>7)]}function F(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function $(e,t,n){e.bi_valid>m-n?(e.bi_buf|=t<<e.bi_valid&65535,F(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=n-m):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function B(e,t,n){$(e,n[2*t],n[2*t+1])}function z(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function U(e,t,n){var i,r,s=new Array(f+1),a=0;for(i=1;i<=f;i++)s[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var o=e[2*r+1];0!==o&&(e[2*r]=z(s[o]++,o))}}function G(e){var t;for(t=0;t<u;t++)e.dyn_ltree[2*t]=0;for(t=0;t<d;t++)e.dyn_dtree[2*t]=0;for(t=0;t<h;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function V(e){8<e.bi_valid?F(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,n,i){var r=2*t,s=2*n;return e[r]<e[s]||e[r]===e[s]&&i[t]<=i[n]}function W(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&H(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!H(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function j(e,t,n){var i,r,s,a,o=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],r=e.pending_buf[e.l_buf+o],o++,0===i?B(e,r,t):(B(e,(s=E[r])+c+1,t),0!==(a=x[s])&&$(e,r-=A[s],a),B(e,s=M(--i),n),0!==(a=_[s])&&$(e,i-=D[s],a)),o<e.last_lit;);B(e,b,t)}function q(e,t){var n,i,r,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=p,n=0;n<l;n++)0!==s[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,o&&(e.static_len-=a[2*r+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)W(e,s,n);for(r=l;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],W(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,s[2*r]=s[2*n]+s[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,s[2*n+1]=s[2*i+1]=r,e.heap[1]=r++,W(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,s,a,o,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,g=t.stat_desc.max_length,b=0;for(s=0;s<=f;s++)e.bl_count[s]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<p;n++)g<(s=l[2*l[2*(i=e.heap[n])+1]+1]+1)&&(s=g,b++),l[2*i+1]=s,c<i||(e.bl_count[s]++,a=0,m<=i&&(a=h[i-m]),o=l[2*i],e.opt_len+=o*(s+a),d&&(e.static_len+=o*(u[2*i+1]+a)));if(0!==b){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,b-=2}while(0<b);for(s=g;0!==s;s--)for(i=e.bl_count[s];0!==i;)c<(r=e.heap[--n])||(l[2*r+1]!==s&&(e.opt_len+=(s-l[2*r+1])*l[2*r],l[2*r+1]=s),i--)}}(e,t),U(s,c,e.bl_count)}function X(e,t,n){var i,r,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++o<l&&r===a||(o<c?e.bl_tree[2*r]+=o:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[2*y]++):o<=10?e.bl_tree[2*v]++:e.bl_tree[2*T]++,s=r,c=(o=0)===a?(l=138,3):r===a?(l=6,3):(l=7,4))}function K(e,t,n){var i,r,s=-1,a=t[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++o<l&&r===a)){if(o<c)for(;B(e,r,e.bl_tree),0!=--o;);else 0!==r?(r!==s&&(B(e,r,e.bl_tree),o--),B(e,y,e.bl_tree),$(e,o-3,2)):o<=10?(B(e,v,e.bl_tree),$(e,o-3,3)):(B(e,T,e.bl_tree),$(e,o-11,7));s=r,c=(o=0)===a?(l=138,3):r===a?(l=6,3):(l=7,4)}}a(D);var Y=!1;function Z(e,t,n,r){var s,a,l,c;$(e,(o<<1)+(r?1:0),3),a=t,l=n,c=!0,V(s=e),c&&(F(s,l),F(s,~l)),i.arraySet(s.pending_buf,s.window,a,l,s.pending),s.pending+=l}n._tr_init=function(e){Y||(function(){var e,t,n,i,r,s=new Array(f+1);for(i=n=0;i<l-1;i++)for(A[i]=n,e=0;e<1<<x[i];e++)E[n++]=i;for(E[n-1]=i,i=r=0;i<16;i++)for(D[i]=r,e=0;e<1<<_[i];e++)C[r++]=i;for(r>>=7;i<d;i++)for(D[i]=r<<7,e=0;e<1<<_[i]-7;e++)C[256+r++]=i;for(t=0;t<=f;t++)s[t]=0;for(e=0;e<=143;)I[2*e+1]=8,e++,s[8]++;for(;e<=255;)I[2*e+1]=9,e++,s[9]++;for(;e<=279;)I[2*e+1]=7,e++,s[7]++;for(;e<=287;)I[2*e+1]=8,e++,s[8]++;for(U(I,u+1,s),e=0;e<d;e++)k[2*e+1]=5,k[2*e]=z(e,5);R=new O(I,x,c+1,u,f),N=new O(k,_,0,d,f),P=new O(new Array(0),S,0,h,g)}(),Y=!0),e.l_desc=new L(e.dyn_ltree,R),e.d_desc=new L(e.dyn_dtree,N),e.bl_desc=new L(e.bl_tree,P),e.bi_buf=0,e.bi_valid=0,G(e)},n._tr_stored_block=Z,n._tr_flush_block=function(e,t,n,i){var a,o,l=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return r;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return s;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return s;return r}(e)),q(e,e.l_desc),q(e,e.d_desc),l=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),q(e,e.bl_desc),t=h-1;3<=t&&0===e.bl_tree[2*w[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=a&&(a=o)):a=o=n+5,n+4<=a&&-1!==t?Z(e,t,n,i):4===e.strategy||o===a?($(e,2+(i?1:0),3),j(e,I,k)):($(e,4+(i?1:0),3),function(e,t,n,i){var r;for($(e,t-257,5),$(e,n-1,5),$(e,i-4,4),r=0;r<i;r++)$(e,e.bl_tree[2*w[r]+1],3);K(e,e.dyn_ltree,t-1),K(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),j(e,e.dyn_ltree,e.dyn_dtree)),G(e),i&&V(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(E[n]+c+1)]++,e.dyn_dtree[2*M(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){var t;$(e,2,3),B(e,b,I),16===(t=e).bi_valid?(F(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,n){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){if(!e.setImmediate){var n,i,r,s,a=1,o={},l=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,n="[object process]"==={}.toString.call(e.process)?function(e){process.nextTick(function(){h(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(s="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",p,!1):e.attachEvent("onmessage",p),function(t){e.postMessage(s+t,"*")}):e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){r.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(i=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):function(e){setTimeout(h,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return o[a]=r,n(a),a++},u.clearImmediate=d}function d(e){delete o[e]}function h(e){if(l)setTimeout(h,0,e);else{var n=o[e];if(n){l=!0;try{!function(e){var n=e.callback,i=e.args;switch(i.length){case 0:n();break;case 1:n(i[0]);break;case 2:n(i[0],i[1]);break;case 3:n(i[0],i[1],i[2]);break;default:n.apply(t,i)}}(n)}finally{d(e),l=!1}}}}function p(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&h(+t.data.slice(s.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==S?S:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10);const ca=la.exports;var ua={exports:{}};!function(e){!function(){function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){o(i.response,t,n)},i.onerror=function(){console.error("could not download file")},i.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(n){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof S&&S.global===S?S:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(e,t,a){var o=s.URL||s.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):i(l.href)?n(e,t,a):r(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(l.href)},4e4),setTimeout(function(){r(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,s,a){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),s);else if(i(e))n(e,s,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){r(o)})}}:function(e,t,i,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,i);var o="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&l||a)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},u.readAsDataURL(e)}else{var d=s.URL||s.webkitURL,h=d.createObjectURL(e);r?r.location=h:location.href=h,r=null,setTimeout(function(){d.revokeObjectURL(h)},4e4)}});s.saveAs=o.saveAs=o,e.exports=o}()}(ua);class da{static sanitize(e){return e.replace("<","&lt;").replace(">","&gt;").replace("&","&amp;").replace("'","&#39;").replace("/","&#x2F;")}}class ha{static getExportFileName(){return`labels_${On.getProjectName()}_${E().format("YYYY-MM-DD-hh-mm-ss")}`}static saveAs(e,t){const n=new Blob([e],{type:"text/plain;charset=utf-8"});try{ua.exports.saveAs(n,t)}catch(i){throw new Error(i)}}}class pa{static export(e){switch(e){case Ls.YOLO:pa.exportAsYOLO();break;case Ls.VOC:pa.exportAsVOC();break;case Ls.CSV:pa.exportAsCSV();break;default:return}}static exportAsYOLO(){const e=new ca;Nn.getImagesData().forEach(t=>{const n=pa.wrapRectLabelsIntoYOLO(t);if(n){const r=t.fileData.name.replace(/\.[^/.]+$/,".txt");try{e.file(r,n)}catch(i){throw new Error(i)}}});try{e.generateAsync({type:"blob"}).then(e=>{ua.exports.saveAs(e,`${ha.getExportFileName()}.zip`)})}catch(t){throw new Error(t)}}static wrapRectLabelIntoYOLO(e,t,n){return I.exports.findIndex(t,{id:e.labelId}).toString(),""}static wrapRectLabelIntoCSV(e,t){return[t,e.frame.toString(),e.endFrame.toString(),e.behavior||""].join(We.CSV_SEPARATOR)}static wrapRectLabelsIntoYOLO(e){if(0===e.labelRects.length||!e.loadStatus)return null;const t=Nn.getLabelNames(),n=Jt.getById(e.id),i={width:n.width,height:n.height};return e.labelRects.filter(e=>null!==e.labelId).map(e=>pa.wrapRectLabelIntoYOLO(e,t,i)).join("\n")}static exportAsVOC(){const e=new ca;Nn.getImagesData().forEach(t=>{const n=pa.wrapImageIntoVOC(t);if(n){const r=t.fileData.name.replace(/\.[^/.]+$/,".xml");try{e.file(r,n)}catch(i){throw new Error(i)}}});try{e.generateAsync({type:"blob"}).then(e=>{ua.exports.saveAs(e,`${ha.getExportFileName()}.zip`)})}catch(t){throw new Error(t)}}static wrapRectLabelsIntoVOC(e){if(0===e.labelRects.length||!e.loadStatus)return null;const t=Nn.getLabelNames();return e.labelRects.map(e=>{const n=I.exports.findLast(t,{id:e.labelId});return(n?["\t<object>",`\t\t<name>${n.name}</name>`,"\t\t<pose>Unspecified</pose>","\t\t<truncated>0</truncated>","\t\t<difficult>0</difficult>","\t\t<bndbox>","\t\t</bndbox>","\t</object>"]:[]).join("\n")}).join("\n")}static wrapImageIntoVOC(e){const t=pa.wrapRectLabelsIntoVOC(e),n=da.sanitize(On.getProjectName());if(t){const i=Jt.getById(e.id);return["<annotation>",`\t<folder>${n}</folder>`,`\t<filename>${e.fileData.name}</filename>`,`\t<path>/${n}/${e.fileData.name}</path>`,"\t<source>","\t\t<database>Unspecified</database>","\t</source>","\t<size>",`\t\t<width>${i.width}</width>`,`\t\t<height>${i.height}</height>`,"\t\t<depth>3</depth>","\t</size>",t,"</annotation>"].join("\n")}return null}static exportAsCSV(){try{const e=Nn.getImagesData().map(e=>pa.wrapRectLabelsIntoCSV(e)).filter(e=>!!e);e.unshift(We.RECT_LABELS_EXPORT_CSV_COLUMN_NAMES);const t=e.join("\n"),n=`${ha.getExportFileName()}.csv`;ha.saveAs(t,n)}catch(e){throw new Error(e)}}static wrapRectLabelsIntoCSV(e){if(0===e.labelRects.length)return null;return e.labelRects.filter(e=>null!==e.labelId).map(t=>pa.wrapRectLabelIntoCSV(t,e.fileData.name)).join("\n")}}class fa{static export(e){e===Ls.CSV&&fa.exportAsCSV()}static exportAsCSV(){const e=Nn.getImagesData().map(e=>fa.wrapRectLabelsIntoCSV(e)).filter(e=>!!e).join("\n"),t=`${ha.getExportFileName()}.csv`;ha.saveAs(e,t)}static wrapRectLabelsIntoCSV(e){if(0===e.labelPoints.length||!e.loadStatus)return null;const t=Jt.getById(e.id),n=Nn.getLabelNames();return e.labelPoints.map(i=>{const r=I.exports.findLast(n,{id:i.labelId});return(r?[r.name,Math.round(i.point.x).toString(),Math.round(i.point.y).toString(),e.fileData.name,t.width.toString(),t.height.toString()]:[]).join(",")}).join("\n")}}class ma{static export(){const e=Nn.getImagesData(),t=Nn.getLabelNames(),n=JSON.stringify(ma.mapImagesDataToVGGObject(e,t)),i=`${ha.getExportFileName()}.json`;ha.saveAs(n,i)}static mapImagesDataToVGGObject(e,t){return e.reduce((e,n)=>{const i=ma.mapImageDataToVGGFileData(n,t);return i&&(e[n.fileData.name]=i),e},{})}static mapImageDataToVGGFileData(e,t){const n=ma.mapImageDataToVGG(e,t);return n?{fileref:"",size:e.fileData.size,filename:e.fileData.name,base64_img_data:"",file_attributes:{},regions:n}:null}static mapImageDataToVGG(e,t){if(!(e.loadStatus&&e.labelPolygons&&e.labelPolygons.length&&t&&t.length))return null;const n=ma.getValidPolygonLabels(e);return n.length?n.reduce((e,n,i)=>{const r=I.exports.findLast(t,{id:n.labelId});return r&&(e[i.toString()]={shape_attributes:ma.mapPolygonToVGG(n.vertices),region_attributes:{label:r.name}}),e},{}):null}static getValidPolygonLabels(e){return e.labelPolygons.filter(e=>null!==e.labelId&&!!e.vertices.length)}static mapPolygonToVGG(e){if(!e||!e.length)return null;return{name:"polygon",all_points_x:e.map(e=>e.x).concat(e[0].x),all_points_y:e.map(e=>e.y).concat(e[0].y)}}}class ga{static export(){const e=Nn.getImagesData(),t=Nn.getLabelNames(),n=On.getProjectName(),i=ga.mapImagesDataToCOCOObject(e,t,n),r=JSON.stringify(i),s=`${ha.getExportFileName()}.json`;ha.saveAs(r,s)}static mapImagesDataToCOCOObject(e,t,n){return{info:ga.getInfoComponent(n),images:ga.getImagesComponent(e),annotations:ga.getAnnotationsComponent(e,t),categories:ga.getCategoriesComponent(t)}}static getInfoComponent(e){return{description:e}}static getCategoriesComponent(e){return e.map((e,t)=>({id:t+1,name:e.name}))}static getImagesComponent(e){return e.filter(e=>e.loadStatus).filter(e=>0!==e.labelPolygons.length).map((e,t)=>{const n=Jt.getById(e.id);return{id:t+1,width:n.width,height:n.height,file_name:e.fileData.name}})}static getAnnotationsComponent(e,t){const n=ga.mapLabelsData(t);let i=0;const r=e.filter(e=>e.loadStatus).filter(e=>0!==e.labelPolygons.length).map((e,t)=>e.labelPolygons.map(e=>({id:i++,iscrowd:0,image_id:t+1,category_id:n[e.labelId],segmentation:ga.getCOCOSegmentation(e.vertices),bbox:ga.getCOCOBbox(e.vertices),area:ga.getCOCOArea(e.vertices)})));return I.exports.flatten(r)}static mapLabelsData(e){return e.reduce((e,t,n)=>(e[t.id]=n+1,e),{})}static getCOCOSegmentation(e){const t=e.map(e=>[e.x,e.y]);return[I.exports.flatten(t)]}static getCOCOBbox(e){let t=e[0].x,n=e[0].x,i=e[0].y,r=e[0].y;for(const s of e)t>s.x&&(t=s.x),n<s.x&&(n=s.x),i>s.y&&(i=s.y),r<s.y&&(r=s.y);return[t,i,n-t,r-i]}static getCOCOArea(e){let t=0,n=e.length-1;for(let i=0;i<e.length;i++)t+=(e[n].x+e[i].x)*(e[n].y-e[i].y),n=i;return Math.abs(t/2)}}class ba{static export(e){switch(e){case Ls.VGG:ma.export();break;case Ls.COCO:ga.export();break;default:return}}}class ya{static export(e){e===Ls.CSV&&ya.exportAsCSV()}static exportAsCSV(){const e=Nn.getImagesData().map(e=>ya.wrapLineLabelsIntoCSV(e)).filter(e=>!!e).join("\n"),t=`${ha.getExportFileName()}.csv`;ha.saveAs(e,t)}static wrapLineLabelsIntoCSV(e){if(0===e.labelLines.length||!e.loadStatus)return null;const t=Jt.getById(e.id),n=Nn.getLabelNames();return e.labelLines.map(i=>{const r=I.exports.findLast(n,{id:i.labelId});return(r?[r.name,Math.round(i.line.start.x).toString(),Math.round(i.line.start.y).toString(),Math.round(i.line.end.x).toString(),Math.round(i.line.end.y).toString(),e.fileData.name,t.width.toString(),t.height.toString()]:[]).join(",")}).join("\n")}}class va{static export(e){switch(e){case Ls.CSV:va.exportAsCSV();break;case Ls.JSON:va.exportAsJSON();break;default:return}}static exportAsCSV(){const e=Nn.getImagesData().filter(e=>e.labelNameIds.length>0).map(e=>va.wrapLabelNamesIntoCSV(e)).join("\n"),t=`${ha.getExportFileName()}.csv`;ha.saveAs(e,t)}static exportAsJSON(){const e=Nn.getImagesData().filter(e=>e.labelNameIds.length>0).map(e=>({image:e.fileData.name,annotations:va.wrapLabelNamesIntoJSON(e)})),t=JSON.stringify(e),n=`${ha.getExportFileName()}.json`;ha.saveAs(t,n)}static wrapLabelNamesIntoCSV(e){if(0===e.labelNameIds.length||!e.loadStatus)return null;const t=Nn.getLabelNames(),n=e.labelNameIds.map(e=>I.exports.findLast(t,{id:e}).name);return(0!==n.length?[e.fileData.name,`"[${n.toString()}]"`]:[]).join(",")}static wrapLabelNamesIntoJSON(e){if(0===e.labelNameIds.length||!e.loadStatus)return[];const t=Nn.getLabelNames();return e.labelNameIds.map(e=>I.exports.findLast(t,{id:e}).name)}}const Ta={[je.RECT]:[{type:Ls.YOLO,label:"A .zip package containing files in YOLO format."},{type:Ls.VOC,label:"A .zip package containing files in VOC XML format."},{type:Ls.CSV,label:"Single CSV file."}],[je.POINT]:[{type:Ls.CSV,label:"Single CSV file."}],[je.LINE]:[{type:Ls.CSV,label:"Single CSV file."}],[je.POLYGON]:[{type:Ls.VGG,label:"Single file in VGG JSON format."},{type:Ls.COCO,label:"Single file in COCO JSON format."}],[je.VIDEO_RECOGNITION]:[{type:Ls.CSV,label:"Single CSV file."},{type:Ls.JSON,label:"Single JSON file."}]},xa=$e(e=>({activeLabelType:e.labels.activeLabelType}),{})(({activeLabelType:e})=>{const[t,i]=n.exports.useState(e),[r,s]=n.exports.useState(null),a=e=>e.map(e=>u("div",{className:"OptionsItem",onClick:()=>{return t=e.type,void s(t);var t},children:[e.type===r?o("img",{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}):o("img",{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),e.label]},e.type));return o(Os,{activeLabelType:t,title:`Export ${t.toLowerCase()} annotations`,onLabelTypeChange:e=>{i(e),s(null)},acceptLabel:"Export",onAccept:e=>{switch(e){case je.RECT:pa.export(r);break;case je.POINT:fa.export(r);break;case je.LINE:ya.export(r);break;case je.POLYGON:ba.export(r);break;case je.VIDEO_RECOGNITION:va.export(r)}vi.close()},disableAcceptButton:!r,rejectLabel:"Cancel",onReject:e=>{vi.close()},renderInternalContent:e=>u(d,{children:[o("div",{className:"Message",children:"Select label type and the file format you would like to use to export labels."}),",",o("div",{className:"Options",children:a(Ta[e])})]})})});var _a=(e=>(e.YOLO_V5_OBJECT_DETECTION="YOLO_V5_OBJECT_DETECTION",e.SSD_OBJECT_DETECTION="SSD_OBJECT_DETECTION",e.POSE_DETECTION="POSE_DETECTION",e))(_a||{});const Sa=[{model:_a.YOLO_V5_OBJECT_DETECTION,name:"YOLOv5 - object detection using rectangles",flag:!1},{model:_a.SSD_OBJECT_DETECTION,name:"COCO SSD - object detection using rectangles",flag:!1},{model:_a.POSE_DETECTION,name:"POSE-NET - pose estimation using points",flag:!1}],wa=$e(e=>({}),{updateActivePopupType:yn})(({updateActivePopupType:e})=>{const[t,i]=n.exports.useState(!1),[r,s]=n.exports.useState(Sa),a=()=>{const e=I.exports.findLast(r,{flag:!0});return e?e.model:null},l=()=>r.map(e=>u("div",{className:"OptionsItem",onClick:()=>(e=>{const t=r.map(t=>t.model===e?{...t,flag:!t.flag}:{...t,flag:!1});s(t)})(e.model),children:[e.flag?o("img",{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}):o("img",{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),e.name]},e.model));return o(hs,{title:"Say hello to AI",renderContent:()=>u("div",{className:"LoadModelPopupContent",children:[o("div",{className:"Message",children:"Speed up your annotation process using AI. Don't worry, your photos are still safe. To take care of your privacy, we decided not to send your images to the server, but instead bring AI to you. Make sure that you have a fast and stable connection - it may take a while to load the model."}),o("div",{className:"Companion",children:t?o(Kt,{size:40,color:fn.getLeadingColor(),loading:!0}):o("div",{className:"Options",children:l()})})]}),acceptLabel:"Use model!",onAccept:()=>{if(i(!0),a()===_a.YOLO_V5_OBJECT_DETECTION)e(Ve.LOAD_YOLO_V5_MODEL)},disableAcceptButton:t||!a(),rejectLabel:"I'm going on my own",onReject:()=>{vi.close()},disableRejectButton:t})});class Ia{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class ka{refCount(e){return Ca("refCount")}incRef(e){return Ca("incRef")}timerAvailable(){return!0}time(e){return Ca("time")}read(e){return Ca("read")}readSync(e){return Ca("readSync")}readToGPU(e,t){return Ca("readToGPU")}numDataIds(){return Ca("numDataIds")}disposeData(e,t){return Ca("disposeData")}write(e,t,n){return Ca("write")}move(e,t,n,i,r){return Ca("move")}memory(){return Ca("memory")}floatPrecision(){return Ca("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return Ca("dispose")}}function Ca(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ea(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Na(e,t,n)}function Aa(e,t,n){return Math.max(e,Math.min(t,n))}function Ra(e){return e%2==0?e:e+1}function Na(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Pa(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Da(e,t,n=""){Pa(Fa(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Oa(e){Pa(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function La(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||Xa(e)&&!n)for(let i=0;i<e.length;++i)La(e[i],t,n);else t.push(e);return t}function Ma(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function Fa(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function $a(e){return e%1==0}function Ba(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function za(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ua(e,t=e=>0,n,i=setTimeout){return new Promise((r,s)=>{let a=0;const o=()=>{if(e())return void r();a++;const l=t(a);null!=n&&a>=n?s():i(o,l)};o()})}function Ga(e,t){let n=1,i=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(-1===e[s]){if(-1!==i)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${s}`);i=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(-1===i){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const r=e.slice();return r[i]=t/n,r}function Va(e,t){const n=t.length;return e=null==e?t.map((e,t)=>t):[].concat(e),Pa(e.every(e=>e>=-n&&e<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),Pa(e.every(e=>$a(e)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(e=>e<0?n+e:e)}function Ha(e,t){const n=[],i=[],r=null!=t&&Array.isArray(t)&&0===t.length,s=null==t||r?null:Va(t,e).sort();let a=0;for(let o=0;o<e.length;++o){if(null!=s){if(s[a]===o&&1!==e[o])throw new Error(`Can't squeeze axis ${o} since its dim '${e[o]}' is not 1`);(null==s[a]||s[a]>o)&&1===e[o]&&(n.push(e[o]),i.push(o)),s[a]<=o&&a++}1!==e[o]&&(n.push(e[o]),i.push(o))}return{newShape:n,keptDims:i}}function Wa(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error(`Unknown data type ${e}`);n=new Uint8Array(t)}return n}function ja(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error(`Unknown data type ${e}`);n=new Array(t)}return n}function qa(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function Xa(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function Ka(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error(`Unknown dtype ${e}`)}function Ya(e){return"string"==typeof e||e instanceof String}function Za(e){return"number"==typeof e}function Qa(e){return Array.isArray(e)?Qa(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Za(e)?"float32":Ya(e)?"string":"boolean"==typeof e?"bool":"float32"}function Ja(e){return!!(e&&e.constructor&&e.call&&e.apply)}function eo(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function to(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let i=t-3;i>=0;--i)n[i]=n[i+1]*e[i+1];return n}function no(e,t,n,i=!1){const r=new Array;if(1===t.length){const s=t[0]*(i?2:1);for(let t=0;t<s;t++)r[t]=n[e+t]}else{const s=t[0],a=t.slice(1),o=a.reduce((e,t)=>e*t)*(i?2:1);for(let t=0;t<s;t++)r[t]=no(e+t*o,a,n,i)}return r}function io(e,t,n=!1){if(0===e.length)return t[0];const i=e.reduce((e,t)=>e*t)*(n?2:1);if(0===i)return[];if(i!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return no(0,e,t,n)}function ro(e,t){const n=so(e,t);for(let i=0;i<n.length;i++)n[i]=1;return n}function so(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function ao(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return io(e,new Float32Array(n));if("int32"===t)return io(e,new Int32Array(n));if("bool"===t)return io(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function oo(e){e.forEach(t=>{Pa(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function lo(e,t,n){if(0===t)return 0;if(1===t)return e[0];let i=e[e.length-1];for(let r=0;r<e.length-1;++r)i+=n[r]*e[r];return i}function co(e,t,n){if(0===t)return[];if(1===t)return[e];const i=new Array(t);for(let r=0;r<i.length-1;++r)i[r]=Math.floor(e/n[r]),e-=i[r]*n[r];return i[i.length-1]=e,i}function uo(e){return e&&e.then&&"function"==typeof e.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ho="tfjsflags";class po{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=fo,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(mo().getBool("IS_TEST")||mo().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];mo().getBool("IS_TEST")||mo().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(uo(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(ho in e){e[ho].split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)})}}}function fo(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("="))),t}function mo(){return bo}let go,bo=null;function yo(){if(null==go){let e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}go=e}return go}function vo(e,t){const n=function(){const e=yo();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const i=t();return n.set(e,i),n.get(e)}}const To="Abs",xo="Acos",_o="Acosh",So="Add",wo="AddN",Io="All",ko="Any",Co="ArgMax",Eo="ArgMin",Ao="Asin",Ro="Asinh",No="Atan",Po="Atanh",Do="Atan2",Oo="AvgPool",Lo="AvgPoolGrad",Mo="AvgPool3D",Fo="AvgPool3DGrad",$o="BatchMatMul",Bo="BatchToSpaceND",zo="Bincount",Uo="BroadcastArgs",Go="Cast",Vo="Ceil",Ho="ClipByValue",Wo="Complex",jo="ComplexAbs",qo="Concat",Xo="Conv2D",Ko="Conv2DBackpropFilter",Yo="Conv2DBackpropInput",Zo="Conv3D",Qo="Conv3DBackpropFilterV2",Jo="Conv3DBackpropInputV2",el="Cos",tl="Cosh",nl="Cumprod",il="Cumsum",rl="CropAndResize",sl="DenseBincount",al="DepthToSpace",ol="DepthwiseConv2dNative",ll="DepthwiseConv2dNativeBackpropFilter",cl="DepthwiseConv2dNativeBackpropInput",ul="Diag",dl="Dilation2D",hl="Dilation2DBackpropInput",pl="Dilation2DBackpropFilter",fl="RealDiv",ml="Einsum",gl="Elu",bl="EluGrad",yl="Erf",vl="Equal",Tl="Exp",xl="ExpandDims",_l="Expm1",Sl="FFT",wl="Fill",Il="FlipLeftRight",kl="Floor",Cl="FloorDiv",El="FusedBatchNorm",Al="GatherV2",Rl="GatherNd",Nl="Greater",Pl="GreaterEqual",Dl="Identity",Ol="IFFT",Ll="Imag",Ml="IsFinite",Fl="IsInf",$l="IsNan",Bl="LeakyRelu",zl="Less",Ul="LessEqual",Gl="LinSpace",Vl="Log",Hl="Log1p",Wl="LogicalAnd",jl="LogicalNot",ql="LogicalOr",Xl="LRN",Kl="LRNGrad",Yl="Max",Zl="Maximum",Ql="MaxPool",Jl="MaxPoolGrad",ec="MaxPool3D",tc="MaxPool3DGrad",nc="MaxPoolWithArgmax",ic="Mean",rc="Min",sc="Minimum",ac="MirrorPad",oc="Mod",lc="Multinomial",cc="Multiply",uc="Neg",dc="NotEqual",hc="NonMaxSuppressionV3",pc="NonMaxSuppressionV4",fc="NonMaxSuppressionV5",mc="OnesLike",gc="OneHot",bc="Pack",yc="PadV2",vc="Pow",Tc="Prelu",xc="Prod",_c="RaggedGather",Sc="RaggedTensorToTensor",wc="Range",Ic="Real",kc="Reciprocal",Cc="Relu",Ec="Reshape",Ac="ResizeNearestNeighbor",Rc="ResizeNearestNeighborGrad",Nc="ResizeBilinear",Pc="ResizeBilinearGrad",Dc="Relu6",Oc="Reverse",Lc="Round",Mc="Rsqrt",Fc="ScatterNd",$c="SearchSorted",Bc="Select",zc="Selu",Uc="Slice",Gc="Sin",Vc="Sinh",Hc="Sign",Wc="Sigmoid",jc="Softplus",qc="Sqrt",Xc="Sum",Kc="SpaceToBatchND",Yc="SplitV",Zc="Softmax",Qc="SparseFillEmptyRows",Jc="SparseReshape",eu="SparseSegmentMean",tu="SparseSegmentSum",nu="SparseToDense",iu="SquaredDifference",ru="Square",su="StridedSlice",au="StringNGrams",ou="StringSplit",lu="StringToHashBucketFast",cu="Sub",uu="Tan",du="Tanh",hu="Tile",pu="TopK",fu="Transform",mu="Transpose",gu="Unique",bu="Unpack",yu="UnsortedSegmentSum",vu="ZerosLike",Tu="Step",xu="RotateWithOffset",_u="_FusedMatMul",Su="FusedConv2D",wu="FusedDepthwiseConv2D";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Iu(...e){mo().getBool("IS_TEST")||mo().getBool("PROD")||console.warn(...e)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const ku=vo("kernelRegistry",()=>new Map),Cu=vo("gradRegistry",()=>new Map);function Eu(e,t){const n=Du(e,t);return ku.get(n)}function Au(e){return Cu.get(e)}function Ru(e){const t=ku.entries(),n=[];for(;;){const{done:i,value:r}=t.next();if(i)break;const[s,a]=r,[o]=s.split("_");o===e&&n.push(a)}return n}function Nu(e){const{kernelName:t,backendName:n}=e,i=Du(t,n);ku.has(i)&&Iu(`The kernel '${t}' for backend '${n}' is already registered`),ku.set(i,e)}function Pu(e){const{kernelName:t}=e;Cu.has(t)&&mo().getBool("DEBUG")&&Iu(`Overriding the gradient for '${t}'`),Cu.set(t,e)}function Du(e,t){return`${t}_${e}`}var Ou=Mu,Lu=null;try{Lu=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(r6){}function Mu(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function Fu(e){return!0===(e&&e.__isLong__)}Mu.prototype.__isLong__,Object.defineProperty(Mu.prototype,"__isLong__",{value:!0}),Mu.isLong=Fu;var $u={},Bu={};function zu(e,t){var n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=Bu[e])?i:(n=Gu(e,(0|e)<0?-1:0,!0),r&&(Bu[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=$u[e])?i:(n=Gu(e,e<0?-1:0,!1),r&&($u[e]=n),n)}function Uu(e,t){if(isNaN(e))return t?Zu:Yu;if(t){if(e<0)return Zu;if(e>=qu)return nd}else{if(e<=-Xu)return id;if(e+1>=Xu)return td}return e<0?Uu(-e,t).neg():Gu(e%ju|0,e/ju|0,t)}function Gu(e,t,n){return new Mu(e,t,n)}Mu.fromInt=zu,Mu.fromNumber=Uu,Mu.fromBits=Gu;var Vu=Math.pow;function Hu(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Yu;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return Hu(e.substring(1),t,n).neg();for(var r=Uu(Vu(n,8)),s=Yu,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),l=parseInt(e.substring(a,a+o),n);if(o<8){var c=Uu(Vu(n,o));s=s.mul(c).add(Uu(l))}else s=(s=s.mul(r)).add(Uu(l))}return s.unsigned=t,s}function Wu(e,t){return"number"==typeof e?Uu(e,t):"string"==typeof e?Hu(e,t):Gu(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Mu.fromString=Hu,Mu.fromValue=Wu;var ju=4294967296,qu=ju*ju,Xu=qu/2,Ku=zu(1<<24),Yu=zu(0);Mu.ZERO=Yu;var Zu=zu(0,!0);Mu.UZERO=Zu;var Qu=zu(1);Mu.ONE=Qu;var Ju=zu(1,!0);Mu.UONE=Ju;var ed=zu(-1);Mu.NEG_ONE=ed;var td=Gu(-1,2147483647,!1);Mu.MAX_VALUE=td;var nd=Gu(-1,-1,!0);Mu.MAX_UNSIGNED_VALUE=nd;var id=Gu(0,-2147483648,!1);Mu.MIN_VALUE=id;var rd=Mu.prototype;rd.toInt=function(){return this.unsigned?this.low>>>0:this.low},rd.toNumber=function(){return this.unsigned?(this.high>>>0)*ju+(this.low>>>0):this.high*ju+(this.low>>>0)},rd.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(id)){var t=Uu(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=Uu(Vu(e,6),this.unsigned),s=this,a="";;){var o=s.div(r),l=(s.sub(o.mul(r)).toInt()>>>0).toString(e);if((s=o).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},rd.getHighBits=function(){return this.high},rd.getHighBitsUnsigned=function(){return this.high>>>0},rd.getLowBits=function(){return this.low},rd.getLowBitsUnsigned=function(){return this.low>>>0},rd.getNumBitsAbs=function(){if(this.isNegative())return this.eq(id)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},rd.isZero=function(){return 0===this.high&&0===this.low},rd.eqz=rd.isZero,rd.isNegative=function(){return!this.unsigned&&this.high<0},rd.isPositive=function(){return this.unsigned||this.high>=0},rd.isOdd=function(){return!(1&~this.low)},rd.isEven=function(){return!(1&this.low)},rd.equals=function(e){return Fu(e)||(e=Wu(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},rd.eq=rd.equals,rd.notEquals=function(e){return!this.eq(e)},rd.neq=rd.notEquals,rd.ne=rd.notEquals,rd.lessThan=function(e){return this.comp(e)<0},rd.lt=rd.lessThan,rd.lessThanOrEqual=function(e){return this.comp(e)<=0},rd.lte=rd.lessThanOrEqual,rd.le=rd.lessThanOrEqual,rd.greaterThan=function(e){return this.comp(e)>0},rd.gt=rd.greaterThan,rd.greaterThanOrEqual=function(e){return this.comp(e)>=0},rd.gte=rd.greaterThanOrEqual,rd.ge=rd.greaterThanOrEqual,rd.compare=function(e){if(Fu(e)||(e=Wu(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},rd.comp=rd.compare,rd.negate=function(){return!this.unsigned&&this.eq(id)?id:this.not().add(Qu)},rd.neg=rd.negate,rd.add=function(e){Fu(e)||(e=Wu(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=e.high>>>16,a=65535&e.high,o=e.low>>>16,l=0,c=0,u=0,d=0;return u+=(d+=r+(65535&e.low))>>>16,c+=(u+=i+o)>>>16,l+=(c+=n+a)>>>16,l+=t+s,Gu((u&=65535)<<16|(d&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},rd.subtract=function(e){return Fu(e)||(e=Wu(e)),this.add(e.neg())},rd.sub=rd.subtract,rd.multiply=function(e){if(this.isZero())return Yu;if(Fu(e)||(e=Wu(e)),Lu)return Gu(Lu.mul(this.low,this.high,e.low,e.high),Lu.get_high(),this.unsigned);if(e.isZero())return Yu;if(this.eq(id))return e.isOdd()?id:Yu;if(e.eq(id))return this.isOdd()?id:Yu;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ku)&&e.lt(Ku))return Uu(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=e.high>>>16,a=65535&e.high,o=e.low>>>16,l=65535&e.low,c=0,u=0,d=0,h=0;return d+=(h+=r*l)>>>16,u+=(d+=i*l)>>>16,d&=65535,u+=(d+=r*o)>>>16,c+=(u+=n*l)>>>16,u&=65535,c+=(u+=i*o)>>>16,u&=65535,c+=(u+=r*a)>>>16,c+=t*l+n*o+i*a+r*s,Gu((d&=65535)<<16|(h&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},rd.mul=rd.multiply,rd.divide=function(e){if(Fu(e)||(e=Wu(e)),e.isZero())throw Error("division by zero");var t,n,i;if(Lu)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Gu((this.unsigned?Lu.div_u:Lu.div_s)(this.low,this.high,e.low,e.high),Lu.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Zu:Yu;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Zu;if(e.gt(this.shru(1)))return Ju;i=Zu}else{if(this.eq(id))return e.eq(Qu)||e.eq(ed)?id:e.eq(id)?Qu:(t=this.shr(1).div(e).shl(1)).eq(Yu)?e.isNegative()?Qu:ed:(n=this.sub(e.mul(t)),i=t.add(n.div(e)));if(e.eq(id))return this.unsigned?Zu:Yu;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Yu}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),s=r<=48?1:Vu(2,r-48),a=Uu(t),o=a.mul(e);o.isNegative()||o.gt(n);)o=(a=Uu(t-=s,this.unsigned)).mul(e);a.isZero()&&(a=Qu),i=i.add(a),n=n.sub(o)}return i},rd.div=rd.divide,rd.modulo=function(e){return Fu(e)||(e=Wu(e)),Lu?Gu((this.unsigned?Lu.rem_u:Lu.rem_s)(this.low,this.high,e.low,e.high),Lu.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},rd.mod=rd.modulo,rd.rem=rd.modulo,rd.not=function(){return Gu(~this.low,~this.high,this.unsigned)},rd.and=function(e){return Fu(e)||(e=Wu(e)),Gu(this.low&e.low,this.high&e.high,this.unsigned)},rd.or=function(e){return Fu(e)||(e=Wu(e)),Gu(this.low|e.low,this.high|e.high,this.unsigned)},rd.xor=function(e){return Fu(e)||(e=Wu(e)),Gu(this.low^e.low,this.high^e.high,this.unsigned)},rd.shiftLeft=function(e){return Fu(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Gu(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Gu(0,this.low<<e-32,this.unsigned)},rd.shl=rd.shiftLeft,rd.shiftRight=function(e){return Fu(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Gu(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Gu(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},rd.shr=rd.shiftRight,rd.shiftRightUnsigned=function(e){if(Fu(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?Gu(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Gu(32===e?t:t>>>e-32,0,this.unsigned)},rd.shru=rd.shiftRightUnsigned,rd.shr_u=rd.shiftRightUnsigned,rd.toSigned=function(){return this.unsigned?Gu(this.low,this.high,!1):this},rd.toUnsigned=function(){return this.unsigned?this:Gu(this.low,this.high,!0)},rd.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},rd.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},rd.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Mu.fromBytes=function(e,t,n){return n?Mu.fromBytesLE(e,t):Mu.fromBytesBE(e,t)},Mu.fromBytesLE=function(e,t){return new Mu(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Mu.fromBytesBE=function(e,t){return new Mu(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const sd=Ou||A({__proto__:null,default:Ou},[Ou]);
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ad(e){return sd.fromString(e,!0,16)}const od=ad("c3a5c85c97cb3127"),ld=ad("b492b66fbe98f273"),cd=ad("9ae16a3b2f90404f");function ud(e){return e.xor(e.shru(47))}function dd(e,t,n){const i=e.slice(t,t+n);return sd.fromBytes(Array.from(i),!0,!0)}function hd(e,t){return dd(e,t,8)}function pd(e,t){return dd(e,t,4)}function fd(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function md(e,t,n=ad("9ddfea08eb382d69")){let i=e.xor(t).mul(n);i=i.xor(i.shru(47));let r=t.xor(i).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function gd(e,t,n,i){return function(e,t,n,i,r,s){r=r.add(e),s=fd(s.add(r).add(i),21);const a=r;return r=(r=r.add(t)).add(n),s=s.add(fd(r,44)),[r.add(i),s.add(a)]}(hd(e,t),hd(e,t+8),hd(e,t+16),hd(e,t+24),n,i)}function bd(e,t=e.length){const n=sd.fromNumber(81,!0);if(t<=32)return t<=16?function(e,t=e.length){if(t>=8){const n=cd.add(2*t),i=hd(e,0).add(cd),r=hd(e,t-8);return md(fd(r,37).mul(n).add(i),fd(i,25).add(r).mul(n),n)}if(t>=4){const n=cd.add(2*t);return md(pd(e,0).shl(3).add(t),pd(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),i=t+(e[t-1]<<2);return ud(cd.mul(n).xor(od.mul(i))).mul(cd)}return cd}(e,t):function(e,t=e.length){const n=cd.add(2*t),i=hd(e,0).mul(ld),r=hd(e,8),s=hd(e,t-8).mul(n),a=hd(e,t-16).mul(cd);return md(fd(i.add(r),43).add(fd(s,30)).add(a),i.add(fd(r.add(cd),18)).add(s),n)}(e,t);if(t<=64)return function(e,t=e.length){const n=cd.add(2*t),i=hd(e,0).mul(cd),r=hd(e,8),s=hd(e,t-8).mul(n),a=hd(e,t-16).mul(cd),o=fd(i.add(r),43).add(fd(s,30)).add(a),l=md(o,i.add(fd(r.add(cd),18)).add(s),n),c=hd(e,16).mul(n),u=hd(e,24),d=o.add(hd(e,t-32)).mul(n),h=l.add(hd(e,t-24)).mul(n);return md(fd(c.add(u),43).add(fd(d,30)).add(h),c.add(fd(u.add(i),18)).add(d),n)}(e,t);let i=n,r=n.mul(ld).add(113),s=ud(r.mul(cd).add(113)).mul(cd),a=[sd.UZERO,sd.UZERO],o=[sd.UZERO,sd.UZERO];i=i.mul(cd).add(hd(e,0));let l=0;const c=64*(t-1>>6),u=c+(t-1&63)-63;do{i=fd(i.add(r).add(a[0]).add(hd(e,l+8)),37).mul(ld),r=fd(r.add(a[1]).add(hd(e,l+48)),42).mul(ld),i=i.xor(o[1]),r=r.add(a[0]).add(hd(e,l+40)),s=fd(s.add(o[0]),33).mul(ld),a=gd(e,l,a[1].mul(ld),i.add(o[0])),o=gd(e,l+32,s.add(o[1]),r.add(hd(e,l+16))),[s,i]=[i,s],l+=64}while(l!==c);const d=ld.add(s.and(255).shl(1));return l=u,o[0]=o[0].add(t-1&63),a[0]=a[0].add(o[0]),o[0]=o[0].add(a[0]),i=fd(i.add(r).add(a[0]).add(hd(e,l+8)),37).mul(d),r=fd(r.add(a[1]).add(hd(e,l+48)),42).mul(d),i=i.xor(o[1].mul(9)),r=r.add(a[0].mul(9).add(hd(e,l+40))),s=fd(s.add(o[0]),33).mul(d),a=gd(e,l,a[1].mul(d),i.add(o[0])),o=gd(e,l+32,s.add(o[1]),r.add(hd(e,l+16))),[s,i]=[i,s],md(md(a[0],o[0],d).add(ud(r).mul(od)).add(s),md(a[1],o[1],d).add(i),d)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yd(e,t){return"string"===t?xd(e):vd([e],t)}function vd(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=La(e)),mo().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${t} being uploaded contains ${i}.`)}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error(`Unknown data type ${t}`)}function Td(){return mo().platform.now()}function xd(e,t="utf-8"){return t=t||"utf-8",mo().platform.encode(e,t)}function _d(e,t="utf-8"){return t=t||"utf-8",mo().platform.decode(e,t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sd{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Id)}profileKernel(e,t,n){let i;const r=()=>{i=n()};let s;const a=Td();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(r);else{r();for(const e of i)e.dataSync();s=Promise.resolve({kernelMs:Td()-a})}if(mo().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let o=0;o<i.length;o++){const t=i[o];t.data().then(n=>{wd(n,t.dtype,e)})}return{kernelName:e,outputs:i,inputs:t,timeMs:s.then(e=>e.kernelMs),extraInfo:s.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:i,inputs:r,extraInfo:s}=e;n.forEach(e=>{Promise.all([e.data(),i,s]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],r,n[2])})})}}function wd(e,t,n){if("float32"!==t)return!1;for(let i=0;i<e.length;i++){const t=e[i];if(isNaN(t)||!isFinite(t))return console.warn(`Found ${t} in the result of '${n}'`),!0}return!1}class Id{logKernelProfile(e,t,n,i,r,s){const a="number"==typeof i?za(`${i}ms`,9):i.error,o=za(e,25),l=t.rank,c=t.size,u=za(t.shape.toString(),14);let d="";for(const h in r){const e=r[h];if(null!=e){const n=e.shape||t.shape,i=n.length;d+=`${h}: ${i}D ${i>0?n:""} `}}console.log(`%c${o}\t%c${a}\t%c${l}D ${u}\t%c${c}\t%c${d}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kd(e,t,n,i){const r=to(t),s=function(e,t,n,i){const r=Ma(t),s=i[i.length-1],a=new Array(s).fill(0),o=t.length,l="complex64"===n?Rd(e):e;if(o>1)for(let c=0;c<r/s;c++){const e=c*s;for(let t=0;t<s;t++)a[t]=Math.max(a[t],Cd(l[e+t],0,n).length)}return a}(e,t,n,r),a=t.length,o=Ad(e,t,n,r,s),l=["Tensor"];return i&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${a}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(o.map(e=>"    "+e).join("\n")),l.join("\n")}function Cd(e,t,n){let i;return i=Array.isArray(e)?`${parseFloat(e[0].toFixed(7))} + ${parseFloat(e[1].toFixed(7))}j`:Ya(e)?`'${e}'`:"bool"===n?Ed(e):parseFloat(e.toFixed(7)).toString(),za(i,t)}function Ed(e){return 0===e?"false":"true"}function Ad(e,t,n,i,r,s=!0){const a="complex64"===n?2:1,o=t[0],l=t.length;if(0===l){if("complex64"===n){return[Cd(Rd(e)[0],0,n)]}return"bool"===n?[Ed(e[0])]:[e[0].toString()]}if(1===l){if(o>20){const t=3*a;let i=Array.from(e.slice(0,t)),s=Array.from(e.slice((o-3)*a,o*a));return"complex64"===n&&(i=Rd(i),s=Rd(s)),["["+i.map((e,t)=>Cd(e,r[t],n)).join(", ")+", ..., "+s.map((e,t)=>Cd(e,r[o-3+t],n)).join(", ")+"]"]}return["["+("complex64"===n?Rd(e):Array.from(e)).map((e,t)=>Cd(e,r[t],n)).join(", ")+"]"]}const c=t.slice(1),u=i.slice(1),d=i[0]*a,h=[];if(o>20){for(let t=0;t<3;t++){const i=t*d,s=i+d;h.push(...Ad(e.slice(i,s),c,n,u,r,!1))}h.push("...");for(let t=o-3;t<o;t++){const i=t*d,s=i+d;h.push(...Ad(e.slice(i,s),c,n,u,r,t===o-1))}}else for(let m=0;m<o;m++){const t=m*d,i=t+d;h.push(...Ad(e.slice(t,i),c,n,u,r,m===o-1))}const p=2===l?",":"";h[0]="["+h[0]+p;for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let f=",\n";for(let m=2;m<l;m++)f+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(s?"":f),h}function Rd(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nd{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=Ma(e),null!=n){const e=n.length;Pa(e===this.size,()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`)}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ja(t,this.size),this.strides=to(e)}set(e,...t){0===t.length&&(t=[0]),Pa(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const i of e){if(i<0||i>=this.shape[t]){const t=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(t)}t++}let n=e[e.length-1];for(let i=0;i<e.length-1;++i)n+=this.strides[i]*e[i];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Pd().makeTensor(this.values,this.shape,this.dtype)}}let Pd=null,Dd=null;class Od{constructor(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ma(e),this.strides=to(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Dd.buffer(this.shape,this.dtype,e)}bufferSync(){return Dd.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return io(this.shape,e,"complex64"===this.dtype)}arraySync(){return io(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=Pd().read(this.dataId);if("string"===this.dtype){const n=await e;try{return n.map(e=>_d(e))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Pd().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Pd().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>_d(e))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Pd().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Pd().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Dd.print(this,e)}clone(){return this.throwIfDisposed(),Dd.clone(this)}toString(e=!1){return kd(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Dd.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Pd().makeVariable(this,e,t,n)}}function Ld(){return vo("Tensor",()=>Od)}Object.defineProperty(Od,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),Ld();class Md extends Od{constructor(e,t,n,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Fa(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Pd().disposeTensor(this),this.dataId=e.dataId,Pd().incRef(this,null)}dispose(){Pd().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Fd,$d,Bd,zd,Ud,Gd,Vd,Hd,Wd,jd;Object.defineProperty(Md,Symbol.hasInstance,{value:e=>e instanceof Od&&null!=e.assign&&e.assign instanceof Function}),($d=Fd||(Fd={})).R0="R0",$d.R1="R1",$d.R2="R2",$d.R3="R3",$d.R4="R4",$d.R5="R5",$d.R6="R6",(zd=Bd||(Bd={})).float32="float32",zd.int32="int32",zd.bool="int32",zd.complex64="complex64",(Gd=Ud||(Ud={})).float32="float32",Gd.int32="int32",Gd.bool="bool",Gd.complex64="complex64",(Hd=Vd||(Vd={})).float32="float32",Hd.int32="float32",Hd.bool="float32",Hd.complex64="complex64",(jd=Wd||(Wd={})).float32="complex64",jd.int32="complex64",jd.bool="complex64",jd.complex64="complex64";const qd={float32:Vd,int32:Bd,bool:Ud,complex64:Wd};function Xd(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return qd[e][t]}function Kd(e){return Xd(e,"int32")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yd(e,t){if(e.dtype===t.dtype)return[e,t];const n=Xd(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Zd(e){const t=[];return Qd(e,t,new Set),t}function Qd(e,t,n){if(null==e)return;if(e instanceof Od)return void t.push(e);if(!function(e){return Array.isArray(e)||"object"==typeof e}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e))return;const i=e;for(const r in i){const e=i[r];n.has(e)||(n.add(e),Qd(e,t,n))}}function Jd(e){return null!=e.kernelName}class eh{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class th{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new eh}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void(await this.setBackend(n))}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(Iu(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Sd(this.backendInstance),!0}setupRegisteredKernels(){Ru(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Ru(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof ka||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,i=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,Iu(`Initialization of backend ${e} failed`),Iu(n.stack||n.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}}catch(n){return Iu(`Initialization of backend ${e} failed`),Iu(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:i,asyncInit:r}=this.initializeBackend(n);if(r||i)return{name:n,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),i=n.backend,r=this.readSync(t),s=i.refCount(t);i.disposeData(t,!0),n.backend=e,e.move(t,r,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun(()=>this.startScope(i),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(i){throw t(),i}}nextTensorId(){return th.nextTensorId++}nextVariableId(){return th.nextVariableId++}clone(e){const t=ih.runKernel(Dl,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],e=>({x:()=>{const t={x:e},n={dtype:"float32"};return ih.runKernel(Go,t,n)}}),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=Eu(e,this.backendName)))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const i=this.backend.numDataIds();let r=0;n.forEach(e=>{r+="complex64"===e.dtype?3:1});const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-t-r-s;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[];const i=this.isTapeOn(),r=this.state.numBytes,s=this.state.numTensors;let a,o;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=Jd(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Jd(e)){const{kernelName:t,inputs:r,attrs:s}=e;null==this.backendName&&this.backend;const l=Eu(t,this.backendName);Pa(null!=l,()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`),a=()=>{const e=this.backend.numDataIds();o=l.kernelFunc({inputs:r,attrs:s,backend:this.backend});const a=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,a);const c=a.map(e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e));if(i){const e=this.getTensorsForGradient(t,r,c);n=this.saveTensorsForBackwardMode(e)}return c}}else{const{forwardFunc:t}=e,r=e=>{i&&(n=e.map(e=>this.keep(this.clone(e))))};a=()=>{const e=this.backend.numDataIds();o=this.tidy(()=>t(this.backend,r));const n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:c,attrs:u}=e,d=Jd(e)?null:e.backwardsFunc;let h;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(l,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),t=h.outputs):t=a()}),i&&this.addTapeNode(l,c,t,d,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(e=>null!=c[e]?c[e].shape:null),outputShapes:t.map(e=>e.shape),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(o)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){const i=Au(e);if(null!=i){const e=i.inputsToSave||[],r=i.outputsToSave||[];let s;i.saveAllInputs?(Pa(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(e=>t[e])):s=e.map(e=>t[e]);const a=n.filter((e,t)=>r[t]);return s.concat(a)}return[]}makeTensor(e,t,n,i){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;let r=e;"string"===n&&Ya(e[0])&&(r=e.map(e=>xd(e)));const s=i.write(r,t,n),a=new Od(t,n,s,this.nextTensorId());if(this.trackTensor(a,i),"string"===n){const e=this.state.tensorInfo.get(s),t=function(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}(r);this.state.numBytes+=t-e.bytes,e.bytes=t}return a}makeTensorFromDataId(e,t,n,i){const r={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(r,i)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:i,dtype:r}=e,s=new Od(i,r,n,this.nextTensorId());return this.trackTensor(s,t),s}makeVariable(e,t=!0,n,i){n=n||this.nextVariableId().toString(),null!=i&&i!==e.dtype&&(e=e.cast(i));const r=new Md(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[r.name])throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Ka(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Md||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*Ka(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,i,r,s){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:r},o=Au(e);null!=o&&(i=o.gradFunc),null!=i&&(a.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],i=so(e.size,e.dtype);return this.makeTensor(i,e.shape,e.dtype)}return e}),i(e.length>1?e:e[0],r,s))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Zd(e),n=new Set(t.map(e=>e.id));for(let r=0;r<this.state.activeScope.track.length;r++){const e=this.state.activeScope.track[r];e.kept||n.has(e.id)||e.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==i.id||this.track(e)})}gradients(e,t,n,i=!1){if(Pa(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));Pa(r instanceof Od,()=>"The result y returned by f() must be a tensor.");const s=function(e,t,n){const i={},r={};for(let l=0;l<t.length;l++)i[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],s=n.inputs;for(const e in s){const a=s[e];let o=!1;for(let e=0;e<t.length;e++)if(i[a.id]){n.outputs.forEach(e=>i[e.id]=!0),o=!0,r[n.id]=!0;break}if(o)break}}const s={};s[n.id]=!0;const a={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(s[t.outputs[e].id]){for(const e in n)s[n[e].id]=!0,a[t.id]=!0;break}}const o=[];for(let l=0;l<e.length;l++){const t=e[l];if(r[t.id]&&a[t.id]){const e={};for(const r in t.inputs){const n=t.inputs[r];i[n.id]&&(e[r]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,o.push(n)}}return o}(this.state.activeTape,t,r);if(!i&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[r.id]=null==n?function(e){const t=ro(Ma(e),"float32");return ih.makeTensor(t,e,"float32")}(r.shape):n,function(e,t,n,i){for(let r=t.length-1;r>=0;r--){const s=t[r],a=[];if(s.outputs.forEach(t=>{const n=e[t.id];null!=n?a.push(n):a.push(null)}),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const o=s.gradient(a);for(const t in s.inputs){if(!(t in o))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(o)}.`);const r=n(()=>o[t]());if("float32"!==r.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${r.dtype}'`);const a=s.inputs[t];if(!Fa(r.shape,a.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${t}' has shape '${r.shape}', which does not match the shape of the input '${a.shape}'`);if(null==e[a.id])e[a.id]=r;else{const t=e[a.id];e[a.id]=i(t,r),t.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,s,e=>this.tidy(e),rh);const i=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:r,grads:i}})}customGrad(e){return Pa(Ja(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{let n;Pa(t.every(e=>e instanceof Od),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const i={};t.forEach((e,t)=>{i[t]=e});return this.runKernelFunc({forwardFunc:(i,r)=>(n=e(...t,r),Pa(n.value instanceof Od,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),Pa(Ja(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),backwardsFunc:(e,i)=>{const r=n.gradFunc(e,i),s=Array.isArray(r)?r:[r];Pa(s.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),Pa(s.every(e=>e instanceof Od),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const a={};return s.forEach((e,t)=>{a[t]=()=>e}),a},inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Td(),n=await this.backend.time(e);return n.wallMs=Td()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new eh;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function nh(){const e=yo();if(null==e._tfengine){const t=new po(e);e._tfengine=new th(t)}var t;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */return t=e._tfengine.ENV,bo=t,function(e){Pd=e}(()=>e._tfengine),e._tfengine}th.nextTensorId=0,th.nextVariableId=0;const ih=nh();function rh(e,t){const n={a:e,b:t};return ih.runKernel(So,n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sh(e){if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function ah(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oh=mo();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lh(e,t){let n=e;if(Xa(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const i=[];for(;Array.isArray(n)||Xa(n)&&"string"!==t;)i.push(n.length),n=n[0];return Array.isArray(e)&&mo().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&ch(e,i,[]),i}function ch(e,t,n){if(n=n||[],!Array.isArray(e)&&!Xa(e))return void Pa(0===t.length,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);Pa(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),Pa(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);const i=t.slice(1);for(let r=0;r<e.length;++r)ch(e[r],i,n.concat(r))}function uh(e,t,n,i){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${i}' must be ${e} tensor, but got ${t} tensor`)}}function dh(e,t,n,i="numeric"){if(e instanceof Od)return uh(i,e.dtype,t,n),e;let r=Qa(e);if("string"!==r&&["bool","int32","float32"].indexOf(i)>=0&&(r=i),uh(i,r,t,n),null==e||!Xa(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const i=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${i}'`)}const s=lh(e,r);Xa(e)||Array.isArray(e)||(e=[e]);const a="string"!==r?vd(e,r):La(e,[],!0);return ih.makeTensor(a,s,r)}function hh(e,t,n,i="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((e,r)=>dh(e,`${t}[${r}]`,n,i))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oh.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),oh.registerFlag("IS_BROWSER",()=>ah()),oh.registerFlag("IS_NODE",()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node),oh.registerFlag("IS_CHROME",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),oh.registerFlag("PROD",()=>!1),oh.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>oh.getBool("DEBUG")),oh.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),oh.registerFlag("IS_TEST",()=>!1),oh.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0),oh.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),oh.registerFlag("ENGINE_COMPILE_ONLY",()=>!1),oh.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),oh.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function ph(e){const t=Object.keys(e);if(1!==t.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const i=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const r=(...e)=>{ih.startScope(n);try{const t=i(...e);return uo(t)&&console.error("Cannot return a Promise inside of tidy."),ih.endScope(t),t}catch(t){throw ih.endScope(null),t}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fh=ph({complex_:function(e,t){const n=dh(e,"real","complex"),i=dh(t,"imag","complex");Da(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const r={real:n,imag:i};return ih.runKernel(Wo,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mh(e,t,n,i){if(null==i&&(i=Qa(e)),"complex64"===i)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Xa(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){oo(t);const e=Ma(t),i=Ma(n);Pa(e===i,()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${i}`);for(let r=0;r<n.length;++r){const e=n[r],i=r!==n.length-1||e!==Ma(t.slice(r));Pa(n[r]===t[r]||!i,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return Xa(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==i?vd(e,i):La(e,[],!0),ih.makeTensor(e,t,i)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gh(e,t){const n=[],i=[],r=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let s=0;s<r.length;++s){const a=r[s],o=Array.isArray(e)?e[s].tensor:e[a];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error(`Unsupported dtype in weight '${a}': ${o.dtype}`);const l={name:a,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const e=new Promise(async e=>{const t=await o.bytes(),n=t.reduce((e,t)=>e+t.length,0)+4*t.length,i=new Uint8Array(n);let r=0;for(let s=0;s<t.length;s++){const e=t[s],n=new Uint8Array(new Uint32Array([e.length]).buffer);i.set(n,r),r+=4,i.set(e,r),r+=e.length}e(i)});i.push(e)}else i.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:bh(await Promise.all(i)),specs:n}}function bh(e){if(null===e)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${e.constructor.name}`)});const i=new Uint8Array(t);let r=0;return n.forEach(e=>{i.set(new Uint8Array(e.buffer),r),r+=e.byteLength}),i.buffer}const yh="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function vh(e){return yh?Buffer.byteLength(e):new Blob([e]).size}function Th(e){if(1===e.length)return e[0];let t=0;e.forEach(e=>{t+=e.byteLength});const n=new Uint8Array(t);let i=0;return e.forEach(e=>{n.set(new Uint8Array(e),i),i+=e.byteLength}),n.buffer}function xh(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}async function _h(e,t){let n,i;return null!=e.weightsManifest&&([n,i]=await t(e.weightsManifest)),function(e,t,n){const i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(i.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=t,i.weightData=n}return null!=e.signature&&(i.signature=e.signature),null!=e.userDefinedMetadata&&(i.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(i.modelInitializer=e.modelInitializer),i}(e,n,i)}function Sh(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:vh(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:vh(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class wh{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==wh.instance&&(wh.instance=new wh),wh.instance}static registerSaveRouter(e){wh.getInstance().saveRouters.push(e)}static registerLoadRouter(e){wh.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return wh.getHandlers(e,"save")}static getLoadHandlers(e,t){return wh.getHandlers(e,"load",t)}static getHandlers(e,t,n){const i=[];return("load"===t?wh.getInstance().loadRouters:wh.getInstance().saveRouters).forEach(t=>{const r=t(e,n);null!==r&&i.push(r)}),i}}const Ih="tensorflowjs",kh="models_store",Ch="model_info_store";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eh(){if(!mo().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Ah(e){const t=e.result;t.createObjectStore(kh,{keyPath:"modelPath"}),t.createObjectStore(Ch,{keyPath:"modelPath"})}class Rh{constructor(e){if(this.indexedDB=Eh(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const i=this.indexedDB.open(Ih,1);i.onupgradeneeded=()=>Ah(i),i.onsuccess=()=>{const r=i.result;if(null==t){const t=r.transaction(kh,"readonly"),i=t.objectStore(kh).get(this.modelPath);i.onsuccess=()=>{if(null==i.result)return r.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(i.result.modelArtifacts)},i.onerror=e=>(r.close(),n(i.error)),t.oncomplete=()=>r.close()}else{const i=Sh(t),s=r.transaction(Ch,"readwrite");let a=s.objectStore(Ch);const o=a.put({modelPath:this.modelPath,modelArtifactsInfo:i});let l;o.onsuccess=()=>{l=r.transaction(kh,"readwrite");const o=l.objectStore(kh).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:i});o.onsuccess=()=>e({modelArtifactsInfo:i}),o.onerror=e=>{a=s.objectStore(Ch);const t=a.delete(this.modelPath);t.onsuccess=()=>(r.close(),n(o.error)),t.onerror=e=>(r.close(),n(o.error))}},o.onerror=e=>(r.close(),n(o.error)),s.oncomplete=()=>{null==l?r.close():l.oncomplete=()=>r.close()}}},i.onerror=e=>n(i.error)})}}Rh.URL_SCHEME="indexeddb://";const Nh=e=>{return mo().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Rh.URL_SCHEME)?(t=e.slice(Rh.URL_SCHEME.length),new Rh(t)):null;var t};wh.registerSaveRouter(Nh),wh.registerLoadRouter(Nh);class Ph{constructor(){this.indexedDB=Eh()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(Ih,1);n.onupgradeneeded=()=>Ah(n),n.onsuccess=()=>{const i=n.result,r=i.transaction(Ch,"readonly"),s=r.objectStore(Ch).getAll();s.onsuccess=()=>{const t={};for(const e of s.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},s.onerror=e=>(i.close(),t(s.error)),r.oncomplete=()=>i.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith(Rh.URL_SCHEME)?t.slice(Rh.URL_SCHEME.length):t,new Promise((t,n)=>{const i=this.indexedDB.open(Ih,1);i.onupgradeneeded=()=>Ah(i),i.onsuccess=()=>{const r=i.result,s=r.transaction(Ch,"readwrite"),a=s.objectStore(Ch),o=a.get(e);let l;o.onsuccess=()=>{if(null==o.result)return r.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const i=a.delete(e),s=()=>{l=r.transaction(kh,"readwrite");const i=l.objectStore(kh).delete(e);i.onsuccess=()=>t(o.result.modelArtifactsInfo),i.onerror=e=>n(o.error)};i.onsuccess=s,i.onerror=e=>(s(),r.close(),n(o.error))}},o.onerror=e=>(r.close(),n(o.error)),s.oncomplete=()=>{null==l?r.close():l.oncomplete=()=>r.close()}},i.onerror=e=>n(i.error)})}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dh="/",Oh="tensorflowjs_models",Lh="info",Mh="model_topology",Fh="weight_specs",$h="weight_data",Bh="model_metadata";function zh(e){return{info:[Oh,e,Lh].join(Dh),topology:[Oh,e,Mh].join(Dh),weightSpecs:[Oh,e,Fh].join(Dh),weightData:[Oh,e,$h].join(Dh),modelMetadata:[Oh,e,Bh].join(Dh)}}function Uh(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function Gh(e){const t=e.split(Dh);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Dh)}class Vh{constructor(e){if(!mo().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=zh(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),i=JSON.stringify(e.weightSpecs),r=Sh(e);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,function(e){if(yh)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let i=0,r=t.length;i<r;i++)n+=String.fromCharCode(t[i]);return btoa(n)}(e.weightData));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:r}}catch(t){throw Uh(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==i)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=i;const r=this.LS.getItem(this.keys.modelMetadata);if(null!=r){const e=JSON.parse(r);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(yh){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n.set([t.charCodeAt(i)],i);return n.buffer}(s),t}}Vh.URL_SCHEME="localstorage://";const Hh=e=>{return mo().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Vh.URL_SCHEME)?(t=e.slice(Vh.URL_SCHEME.length),new Vh(t)):null;var t};wh.registerSaveRouter(Hh),wh.registerLoadRouter(Hh);class Wh{constructor(){Pa(mo().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),Pa("undefined"==typeof window||void 0!==window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Oh+Dh,n=Dh+Lh;for(let i=0;i<this.LS.length;++i){const r=this.LS.key(i);if(r.startsWith(t)&&r.endsWith(n)){e[Gh(r)]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){var t;const n=zh(e=(t=e).startsWith(Vh.URL_SCHEME)?t.slice(Vh.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const i=JSON.parse(this.LS.getItem(n.info));return Uh(n),i}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jh{constructor(){this.managers={}}static getInstance(){return null==jh.instance&&(jh.instance=new jh),jh.instance}static registerManager(e,t){Pa(null!=e,()=>"scheme must not be undefined or null."),e.endsWith("://")&&(e=e.slice(0,e.indexOf("://"))),Pa(e.length>0,()=>"scheme must not be an empty string.");const n=jh.getInstance();Pa(null==n.managers[e],()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=t}static getManager(e){const t=jh.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(jh.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qh{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){window&&mo().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))):setTimeout(e,t)}}if(mo().get("IS_BROWSER")){mo().setPlatform("browser",new qh);try{jh.registerManager(Vh.URL_SCHEME,new Wh)}catch(s6){}try{jh.registerManager(Rh.URL_SCHEME,new Ph)}catch(s6){}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xh=()=>require("node-fetch");let Kh;class Yh{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=mo().global.fetch?mo().global.fetch(e,t):(null==Kh&&(Kh=Xh()),Kh(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zh(e,t="float32",n){return t=t||"float32",oo(e),new Nd(e,t,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mo().get("IS_NODE")&&!mo().get("IS_BROWSER")&&mo().setPlatform("node",new Yh);const Qh=ph({cast_:function(e,t){const n=dh(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const i={x:n},r={dtype:t};return ih.runKernel(Go,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jh=ph({clone_:function(e){const t={x:dh(e,"x","clone","string_or_numeric")};return ih.runKernel(Dl,t)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
nh();Dd={buffer:Zh,cast:Qh,clone:Jh,print:function(e,t=!1){console.log(e.toString(t))}};function ep(e){return new Promise(e=>setTimeout(e)).then(e)}class tp{constructor(e){if(!mo().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(tp.URL_SCHEME)&&(e=e.slice(tp.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=xh(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),i=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),r=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(r.download=this.modelJsonFileName,r.href=i,await ep(()=>r.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=t,await ep(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Sh(e)}}}}tp.URL_SCHEME="downloads://";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function np(e,t,n,i){var r,s,a;Pa(null!=(r=e)&&Array.isArray(r)&&r.length>0,()=>"promises must be a none empty array"),a=i=null==i?1:i,Pa((s=n=null==n?0:n)>=0&&s<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${s}`),Pa(a>=0&&a<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${a}`),Pa(a>=s,()=>`startFraction must be no more than endFraction, but got startFraction ${s} and endFraction ${a}`);let o=0;return Promise.all(e.map(r=>(r.then(r=>{const s=n+ ++o/e.length*(i-n);return t(s),r}),r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */wh.registerSaveRouter(e=>mo().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(tp.URL_SCHEME)?function(e="model"){return new tp(e)}(e.slice(tp.URL_SCHEME.length)):null);class ip{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(Pa("function"==typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=mo().platform.fetch,Pa(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&Pa(2===e.length,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=xh(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Sh(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch(r6){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,i=t.weightsManifest;if(null==n&&null==i)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return _h(t,e=>this.loadWeights(e))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,i]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),i=e.substring(0,t),r=n>t?e.substring(n):"";return[i+"/",r]}(t),r=this.weightPathPrefix||n,s=function(e){const t=[];for(const n of e)t.push(...n.weights);return t}(e),a=[],o=[];for(const c of e)for(const e of c.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):a.push(r+e+i);this.weightUrlConverter&&a.push(...await Promise.all(o));const l=await async function(e,t){null==t&&(t={});const n=null==t.fetchFunc?mo().platform.fetch:t.fetchFunc,i=e.map(e=>n(e,t.requestInit,{isBinary:!0})),r=(null==t.onProgress?await Promise.all(i):await np(i,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(r):await np(r,t.onProgress,.5,1)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[s,Th(l)]}}function rp(e){return null!=e.match(ip.URL_SCHEME_REGEX)}ip.URL_SCHEME_REGEX=/^https?:\/\//;const sp=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>rp(e)):rp(e),n)return function(e,t){return new ip(e,t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,t)}return null};wh.registerSaveRouter(sp),wh.registerLoadRouter(sp);const ap=ph({matMul_:function(e,t,n=!1,i=!1){let r=dh(e,"a","matMul"),s=dh(t,"b","matMul");[r,s]=Yd(r,s);const a={a:r,b:s},o={transposeA:n,transposeB:i};return ih.runKernel($o,a,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const op=ph({oneHot_:function(e,t,n=1,i=0,r="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const s={indices:dh(e,"indices","oneHot","int32")},a={dtype:r,depth:t,onValue:n,offValue:i};return ih.runKernel(gc,s,a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lp(){return ih}function cp(){return ih.memory()}function up(e,t){return ih.tidy(e,t)}function dp(e){Zd(e).forEach(e=>e.dispose())}function hp(e){return ih.keep(e)}function pp(e,t,n=1){return ih.registerBackend(e,t,n)}const fp=ph({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const t={input:dh(e,"input","imag")};return ih.runKernel(Ll,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mp=ph({neg_:function(e){const t={x:dh(e,"x","neg")};return ih.runKernel(uc,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gp=ph({real_:function(e){const t={input:dh(e,"input","real")};return ih.runKernel(Ic,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bp=ph({transpose_:function(e,t,n){const i=dh(e,"x","transpose");if(null==t&&(t=i.shape.map((e,t)=>t).reverse()),Pa(i.rank===t.length,()=>`Error in transpose: rank of input ${i.rank} must match length of perm ${t}.`),t.forEach(e=>{Pa(e>=0&&e<i.rank,()=>`All entries in 'perm' must be between 0 and ${i.rank-1} but got ${t}`)}),i.rank<=1)return i.clone();const r={x:i},s={perm:t};return"complex64"===i.dtype?up(()=>{let e=gp(i),t=fp(i);return e=ih.runKernel(mu,{x:e},s),t=ih.runKernel(mu,{x:t},s),n&&(t=mp(t)),fh(e,t)}):ih.runKernel(mu,r,s)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yp(e,t){const n=e.length,i=[];for(let r=0;r<n;r++){const s=n-1-r,a=e[s]||1;(t[t.length-1-r]||1)>1&&1===a&&i.unshift(s)}return i}function vp(e,t){const n=[];for(let i=0;i<t.length;i++){const r=e[e.length-i-1],s=t.length-i-1,a=t[s];(null==r||1===r&&a>1)&&n.unshift(s)}return n}function Tp(e,t){const n=[],i=Math.max(e.length,t.length);for(let r=0;r<i;r++){let i=e[e.length-r-1];null==i&&(i=1);let s=t[t.length-r-1];if(null==s&&(s=1),1===i)n.unshift(s);else if(1===s)n.unshift(i);else{if(i!==s){throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`)}n.unshift(i)}}return n}function xp(e,t){const n=e.shape.length,i=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[i-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[i-1]} vs. ${n}`);if(0===Ma(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const r=t.shape,s=r[r.length-1];let a=1;for(let d=0;d<r.length-1;++d)a*=r[d];const o=e.shape,l=r.slice();l.pop();let c=1;for(let d=s;d<n;++d)c*=o[d],l.push(o[d]);const u=[...to(e.shape).map(e=>e/c),1].slice(0,s);return[l,a,c,u]}function _p(e,t,n){const i=t.rank>1?t.shape[t.rank-1]:1,r=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${i}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(s+` update.rank < ${r}. `);if(e.length<i+(n.rank-r))throw new Error(s+` Output shape length < ${i+(n.rank-r)}`);if(n.rank!==r+e.length-i)throw new Error(s+" update.rank != "+(r+e.length-i));for(let a=0;a<r;++a)if(n.shape[a]!==t.shape[a])throw new Error(s+` updates.shape[${a}] (${n.shape[a]}) != indices.shape[${a}] (${t.shape[a]}).`);for(let a=0;a<n.rank-r;++a)if(n.shape[a+r]!==e[a+i])throw new Error(s+` updates.shape[${a+r}] (${n.shape[a+r]}) != shape[${a+r}] (${e[a+r]})`)}function Sp(e,t,n){const i=t.shape.length,r=i>1?t.shape[i-1]:1,s=n.length;let a=1;for(let l=r;l<s;++l)a*=n[l];const o=r<1?1:r;return{sliceRank:r,numUpdates:Ma(t.shape)/o,sliceSize:a,strides:[...to(n.slice(0,r)),1],outputSize:Ma(n)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(e,t,n){const i=e.shape.length;Pa(i===t.length,()=>`Error in slice${i}D: Length of begin ${t} must match the rank of the array (${i}).`),Pa(i===n.length,()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`);for(let r=0;r<i;++r)Pa(t[r]+n[r]<=e.shape[r],()=>`Error in slice${i}D: begin[${r}] + size[${r}] (${t[r]+n[r]}) would overflow input.shape[${r}] (${e.shape[r]})`)}function Ip(e,t,n){const i=[];for(let r=0;r<e.length;r++)i[r]=Math.ceil((t[r]-e[r])/n[r]);return i}function kp(e,t,n,i){const r=[...e];for(let s=r.length;s<i.length;s++)r.push(1);for(let s=0;s<n;s++)0===s?r[t]=1:(r.splice(t,0,1),r.pop());return r}function Cp(e,t,n){return n<=e?n:n-(t-1)}function Ep(e,t){const n=[];for(let i=0;i<e;i++)n.push(t+i);return n}function Ap(e,t,n,i,r){const s=[...r],a=Ep(n,t);for(let o=0;o<s.length;o++)if(a.indexOf(o)>-1)s[o]=0;else{const r=Cp(t,n,o);let a=i[r];e&1<<r&&(a=0),s[o]=a}return s}function Rp(e,t,n,i,r){const s=[...r],a=Ep(n,t);for(let o=0;o<s.length;o++)if(a.indexOf(o)>-1)s[o]=Number.MAX_SAFE_INTEGER;else{const r=Cp(t,n,o);let a=i[r];e&1<<r&&(a=Number.MAX_SAFE_INTEGER),s[o]=a}for(let o=0;o<s.length;o++){const e=r[o];s[o]<0&&(s[o]+=e),s[o]=Aa(0,s[o],r[o])}return s}function Np(e,t,n){let i=e[t];return(n&1<<t||null==i)&&(i=1),i}function Pp(e,t,n,i,r,s){let a=t[r];const o=n[r]||1;(e&1<<r||s&1<<r||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=i[r];return a<0&&(a+=l),a=Aa(0,a,l-1),a}function Dp(e,t,n,i,r,s){let a=t[r];const o=n[r]||1;(e&1<<r||s&1<<r||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=i[r];return a<0&&(a+=l),a=o>0?Aa(0,a,l):Aa(-1,a,l-1),a}function Op(e,t,n){let i=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){i=r;break}for(let r=i+1;r<n.length;r++)if(t[r]>0||n[r]!==e[r])return!1;return!0}function Lp(e,t){let n=e.length>0?e[e.length-1]:1;for(let i=0;i<e.length-1;i++)n+=e[i]*t[i];return n}function Mp(e,t,n){let i;const r=e.shape.length;let s;return i="number"==typeof t?[t,...new Array(r-1).fill(0)]:t.length<r?t.concat(new Array(r-t.length).fill(0)):t.slice(),i.forEach(e=>{Pa(-1!==e,()=>"slice() does not support negative begin indexing.")}),s=null==n?new Array(r).fill(-1):"number"==typeof n?[n,...new Array(r-1).fill(-1)]:n.length<r?n.concat(new Array(r-n.length).fill(-1)):n,s=s.map((t,n)=>t>=0?t:(Pa(-1===t,()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`),e.shape[n]-i[n])),[i,s]}function Fp(e,t,n,i,r,s,a,o,l){let c;if(null==i?(c=new Array(t.length),c.fill(1)):c=i,null!=a&&a&a-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};for(let v=0;v<d.dims;v++)u&&1<<v&o&&d.numAddAxisAfterEllipsis++,1<<v&a&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let i=0;i<e.dims;i++)if(1<<i&e.ellipsisMask){const r=Math.min(t.dims-(e.dims-i)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<r;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=i}else if(1<<i&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[i]),null!=e.end&&(t.end[n]=e.end[i]),t.strides[n]=e.strides[i],e.beginMask&1<<i&&(t.beginMask|=1<<n),e.endMask&1<<i&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<i?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(i)),t.inputShapeGatherIndicesSparse[n]=i,n++}}(d,h);let p=!0,f=!0,m=!0;const g=[],b=[];for(let v=0;v<e.length;++v){if(0===h.strides[v])throw Error(`strides[${v}] must be non-zero`);const t=!!(h.shrinkAxisMask&1<<v),n=e[v];if(-1===n){g.push(t?1:-1);continue}const i=[h.beginMask&1<<v,h.endMask&1<<v],r=[h.strides[v]>0?0:-1,h.strides[v]>0?n:n-1];if(t&&h.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[v];const s=!!(h.beginMask&1<<v&&h.endMask&1<<v);if(h.beginValid&&h.endValid){if(t){const e=h.begin[v]<0?n+h.begin[v]:h.begin[v];if(h.begin[v]=e,h.end[v]=h.begin[v]+1,e<0||e>=n)throw Error(`slice index ${h.begin[v]} of dimension ${v} out of bounds.`)}else h.begin[v]=$p(h.begin[v],0,h.strides[v],n,i,r),h.end[v]=$p(h.end[v],1,h.strides[v],n,i,r);const e=1===h.strides[v]&&0===h.begin[v]&&h.end[v]===n;p=p&&e,f=f&&(0===v&&1===h.strides[v]||e)}else p=p&&1===h.strides[v]&&s,f=f&&(0===v&&1===h.strides[v]||s);let a,o=!1;if(h.beginValid&&h.endValid?(a=h.end[v]-h.begin[v],o=!0):t?(a=1,o=!0):s&&n>=0&&(a=h.strides[v]<0?-n:n,o=!0),o){let e;e=0===a||a<0!=h.strides[v]<0?0:Math.trunc(a/h.strides[v])+(a%h.strides[v]!==0?1:0),g.push(e)}else g.push(-1)}for(let v=0;v<h.finalShapeGatherIndices.length;++v){const e=h.finalShapeGatherIndices[v];e>=0?b.push(g[e]):-2===e&&b.push(1)}const y=b.filter((e,t)=>-2!==h.finalShapeGatherIndices[t]);return{finalShapeSparse:y,finalShape:b,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function $p(e,t,n,i,r,s){if(r[t])return n>0?s[t]:s[t+1&1];{const t=e<0?i+e:e;return t<s[0]?s[0]:t>s[1]?s[1]:t}}const Bp=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:wp,maskToAxes:function(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t},computeOutShape:Ip,stridesWithElidedDims:kp,getNormalizedAxes:function(e,t,n,i,r,s,a,o,l){const c=e.length;let u=new Array(c),d=new Array(c),h=new Array(c);if(t.length&&n>0){const l=t[0],c=n+1;u=Ap(a,l,c,i,e),d=Rp(o,l,c,r,e),h=kp(s,l,c,e)}else for(let p=0;p<c;p++)u[p]=Pp(a,i,s,e,p,l),d[p]=Dp(o,r,s,e,p,l),h[p]=Np(s,p,l);return{begin:u,end:d,strides:h}},startIndicesWithElidedDims:Ap,stopIndicesWithElidedDims:Rp,stridesForAxis:Np,startForAxis:Pp,stopForAxis:Dp,isSliceContinous:Op,computeFlatOffset:Lp,parseSliceParams:Mp,sliceInfo:Fp},Symbol.toStringTag,{value:"Module"}));
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zp{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Up{constructor(){this.classNameMap={}}static getMap(){return null==Up.instance&&(Up.instance=new Up),Up.instance}static register(e){Up.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Gp(e){Pa(null!=e.className,()=>"Class being registered does not have the static className property defined."),Pa("string"==typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),Pa(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Up.register(e)}
/** @license See the LICENSE file. */const Vp=ph({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t){let n=dh(e,"a","add"),i=dh(t,"b","add");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(So,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hp=ph({floorDiv_:function(e,t){let n=dh(e,"a","floorDiv"),i=dh(t,"b","floorDiv");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(Cl,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wp=ph({div_:function(e,t){let n=dh(e,"a","div"),i=dh(t,"b","div");if([n,i]=Yd(n,i),"int32"===n.dtype&&"int32"===i.dtype)return Hp(n,i);const r={a:n,b:i};return ih.runKernel(fl,r,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jp=ph({mul_:function(e,t){let n=dh(e,"a","mul"),i=dh(t,"b","mul");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(cc,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qp=ph({abs_:function(e){const t=dh(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return ih.runKernel(jo,e)}{const e={x:t};return ih.runKernel(To,e)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xp=ph({acos_:function(e){const t={x:dh(e,"x","acos")};return ih.runKernel(xo,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kp=ph({acosh_:function(e){const t={x:dh(e,"x","acosh")};return ih.runKernel(_o,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yp=ph({all_:function(e,t=null,n=!1){const i={x:dh(e,"x","all","bool")},r={axis:t,keepDims:n};return ih.runKernel(Io,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zp=ph({any_:function(e,t=null,n=!1){const i={x:dh(e,"x","any","bool")},r={axis:t,keepDims:n};return ih.runKernel(ko,i,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qp=ph({argMax_:function(e,t=0){const n={x:dh(e,"x","argMax")},i={axis:t};return ih.runKernel(Co,n,i)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jp=ph({argMin_:function(e,t=0){const n={x:dh(e,"x","argMin")},i={axis:t};return ih.runKernel(Eo,n,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ef=ph({asin_:function(e){const t={x:dh(e,"x","asin")};return ih.runKernel(Ao,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tf=ph({asinh_:function(e){const t={x:dh(e,"x","asinh")};return ih.runKernel(Ro,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nf=ph({atan_:function(e){const t={x:dh(e,"x","atan")};return ih.runKernel(No,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rf=ph({atan2_:function(e,t){let n=dh(e,"a","atan2"),i=dh(t,"b","atan2");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(Do,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sf=ph({atanh_:function(e){const t={x:dh(e,"x","atanh")};return ih.runKernel(Po,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function af(e,t,n,i,r="NHWC",s){return cf(e,[...t,e[3]],n,s,i,null,null,yf(r))}function of(e,t,n,i,r,s,a="channelsLast"){const[o,l]=hf(t);let c;if("channelsLast"===a)c=[o,l,e[3],e[3]];else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);c=[o,l,e[1],e[1]]}return cf(e,c,n,i,r,s,!1,a)}function lf(e,t,n,i,r,s,a="NDHWC"){const[o,l,c]=pf(t);let u,d;if("NDHWC"===a)d="channelsLast",u=[o,l,c,e[4],e[4]];else{if("NCDHW"!==a)throw new Error(`Unknown dataFormat ${a}`);d="channelsFirst",u=[o,l,c,e[1],e[1]]}return uf(e,u,n,i,r,!1,d,s)}function cf(e,t,n,i,r,s,a=!1,o="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if("channelsLast"===o)[l,c,u,d]=e;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[l,d,c,u]=e}const[h,p,,f]=t,[m,g]=hf(n),[b,y]=hf(i),v=ff(h,b),T=ff(p,y),{padInfo:x,outHeight:_,outWidth:S}=function(e,t,n,i,r,s,a,o,l){let c,u,d;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const r=function(e,t,n,i,r){null==i&&(i=df(e,t,n));const s=e[0],a=e[1],o=mf((s-t+2*i)/n+1,r),l=mf((a-t+2*i)/n+1,r);return[o,l]}([t,n],s,i,e,o);u=r[0],d=r[1]}else if("same"===e){u=Math.ceil(t/i),d=Math.ceil(n/r);const e=Math.max(0,(u-1)*i+s-t),o=Math.max(0,(d-1)*r+a-n),l=Math.floor(e/2),h=e-l,p=Math.floor(o/2);c={top:l,bottom:h,left:p,right:o-p,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-s+1)/i),d=Math.ceil((n-a+1)/r);else{if("object"!=typeof e)throw Error(`Unknown padding parameter: ${e}`);{const h="channelsLast"===l?e[1][0]:e[2][0],p="channelsLast"===l?e[1][1]:e[2][1],f="channelsLast"===l?e[2][0]:e[3][0],m="channelsLast"===l?e[2][1]:e[3][1];c={top:h,bottom:p,left:f,right:m,type:0===h&&0===p&&0===f&&0===m?"VALID":"EXPLICIT"},u=mf((t-s+h+p)/i+1,o),d=mf((n-a+f+m)/r+1,o)}}return{padInfo:c,outHeight:u,outWidth:d}}(r,c,u,m,g,v,T,s,o),w=a?f*d:f;let I;return"channelsFirst"===o?I=[l,w,_,S]:"channelsLast"===o&&(I=[l,_,S,w]),{batchSize:l,dataFormat:o,inHeight:c,inWidth:u,inChannels:d,outHeight:_,outWidth:S,outChannels:w,padInfo:x,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:T,dilationHeight:b,dilationWidth:y,inShape:e,outShape:I,filterShape:t}}function uf(e,t,n,i,r,s=!1,a="channelsLast",o){let[l,c,u,d,h]=[-1,-1,-1,-1,-1];if("channelsLast"===a)[l,c,u,d,h]=e;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[l,h,c,u,d]=e}const[p,f,m,,g]=t,[b,y,v]=pf(n),[T,x,_]=pf(i),S=ff(p,T),w=ff(f,x),I=ff(m,_),{padInfo:k,outDepth:C,outHeight:E,outWidth:A}=function(e,t,n,i,r,s,a,o,l,c,u){let d,h,p,f;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const s=function(e,t,n,i,r,s){null==r&&(r=df(e,t,i));const a=e[0],o=e[1],l=e[2],c=mf((a-t+2*r)/i+1,s),u=mf((o-t+2*r)/i+1,s),d=mf((l-t+2*r)/i+1,s);return[c,u,d,n]}([t,n,i,1],o,1,r,e,u);h=s[0],p=s[1],f=s[2]}else if("same"===e){h=Math.ceil(t/r),p=Math.ceil(n/s),f=Math.ceil(i/a);const e=(h-1)*r+o-t,u=(p-1)*s+l-n,m=(f-1)*a+c-i,g=Math.floor(e/2),b=e-g,y=Math.floor(u/2),v=u-y,T=Math.floor(m/2);d={top:y,bottom:v,left:T,right:m-T,front:g,back:b,type:"SAME"}}else{if("valid"!==e)throw Error(`Unknown padding parameter: ${e}`);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-o+1)/r),p=Math.ceil((n-l+1)/s),f=Math.ceil((i-c+1)/a)}return{padInfo:d,outDepth:h,outHeight:p,outWidth:f}}(r,c,u,d,b,y,v,S,w,I,o),R=s?g*h:g;let N;return"channelsFirst"===a?N=[l,R,C,E,A]:"channelsLast"===a&&(N=[l,C,E,A,R]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:u,inWidth:d,inChannels:h,outDepth:C,outHeight:E,outWidth:A,outChannels:R,padInfo:k,strideDepth:b,strideHeight:y,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:w,effectiveFilterWidth:I,dilationDepth:T,dilationHeight:x,dilationWidth:_,inShape:e,outShape:N,filterShape:t}}function df(e,t,n,i=1){const r=ff(t,i);return Math.floor((e[0]*(n-1)-n+r)/2)}function hf(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function pf(e){return"number"==typeof e?[e,e,e]:e}function ff(e,t){return t<=1?e:e+(e-1)*(t-1)}function mf(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function gf(e){const[t,n,i]=hf(e);return 1===t&&1===n&&1===i}function bf(e,t){return gf(e)||gf(t)}function yf(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function vf(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)Pa($a(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else{if("object"!=typeof t)throw Error(`Error in ${e}: Unknown padding parameter: ${t}`);t.forEach(t=>{t.forEach(t=>{Pa($a(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`)})})}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tf=ph({reshape_:function(e,t){const n={x:dh(e,"x","reshape","string_or_numeric")},i={shape:t};return ih.runKernel(Ec,n,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xf=ph({avgPool_:function(e,t,n,i,r){const s=dh(e,"x","avgPool","float32");Pa(bf(n,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`);let a=s,o=!1;3===s.rank&&(o=!0,a=Tf(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Pa(4===a.rank,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),vf("avgPool",i,r);const l={x:a},c={filterSize:t,strides:n,pad:i,dimRoundingMode:r};let u=ih.runKernel(Oo,l,c);return u=Qh(u,s.dtype),o?Tf(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _f=ph({avgPool3d_:function(e,t,n,i,r,s="NDHWC"){const a=dh(e,"x","avgPool3d","float32");let o=a,l=!1;4===a.rank&&(l=!0,o=Tf(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),Pa(5===o.rank,()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`),Pa("NDHWC"===s,()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),vf("avgPool3d",i,r);const c={x:o},u={filterSize:t,strides:n,pad:i,dimRoundingMode:r,dataFormat:s};let d=ih.runKernel(Mo,c,u);return d=Qh(d,o.dtype),l?Tf(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sf=ph({concat_:function(e,t=0){Pa(e.length>=1,()=>"Pass at least one tensor to concat");const n=hh(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)}),1===n.length)return Jh(n[0]);const i=n,r={axis:t};return ih.runKernel(qo,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wf=ph({sigmoid_:function(e){const t={x:dh(e,"x","sigmoid","float32")};return ih.runKernel(Wc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const If=ph({slice_:function(e,t,n){const i=dh(e,"x","slice","string_or_numeric");if(0===i.rank)throw new Error("Slicing scalar is not possible");const r={x:i},s={begin:t,size:n};return ih.runKernel(Uc,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kf=ph({tanh_:function(e){const t={x:dh(e,"x","tanh","float32")};return ih.runKernel(du,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cf=ph({batchToSpaceND_:function(e,t,n){const i=dh(e,"x","batchToSpaceND"),r=t.reduce((e,t)=>e*t);Pa(i.rank>=1+t.length,()=>`input rank is ${i.rank} but should be > than blockShape.length ${t.length}`),Pa(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),Pa(i.shape[0]%r===0,()=>`input tensor batch is ${i.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${r}`);const s={x:i},a={blockShape:t,crops:n};return ih.runKernel(Bo,s,a)}});const Ef=ph({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i,r,s){null==s&&(s=.001);const a=dh(e,"x","batchNorm"),o=dh(t,"mean","batchNorm"),l=dh(n,"variance","batchNorm");let c,u;null!=r&&(c=dh(r,"scale","batchNorm")),null!=i&&(u=dh(i,"offset","batchNorm")),Pa(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Pa(null==u||o.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Pa(null==c||o.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:function(e){let t;return t=0===e.rank||1===e.rank?Tf(e,[1,1,1,e.size]):2===e.rank?Tf(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Tf(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(a),scale:c,offset:u,mean:o,variance:l},h={varianceEpsilon:s},p=ih.runKernel(El,d,h);return Tf(p,a.shape)}});const Af=ph({batchNorm2d_:function(e,t,n,i,r,s){const a=dh(e,"x","batchNorm"),o=dh(t,"mean","batchNorm"),l=dh(n,"variance","batchNorm");let c,u;return null!=r&&(c=dh(r,"scale","batchNorm")),null!=i&&(u=dh(i,"offset","batchNorm")),Pa(2===a.rank,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`),Pa(2===o.rank||1===o.rank,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`),Pa(2===l.rank||1===l.rank,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),null!=c&&Pa(2===c.rank||1===c.rank,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),null!=u&&Pa(2===u.rank||1===u.rank,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Ef(a,o,l,u,c,s)}});const Rf=ph({batchNorm3d_:function(e,t,n,i,r,s){const a=dh(e,"x","batchNorm"),o=dh(t,"mean","batchNorm"),l=dh(n,"variance","batchNorm");let c,u;return null!=r&&(c=dh(r,"scale","batchNorm")),null!=i&&(u=dh(i,"offset","batchNorm")),Pa(3===a.rank,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`),Pa(3===o.rank||1===o.rank,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`),Pa(3===l.rank||1===l.rank,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),null!=c&&Pa(3===c.rank||1===c.rank,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),null!=u&&Pa(3===u.rank||1===u.rank,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Ef(a,o,l,u,c,s)}});const Nf=ph({batchNorm4d_:function(e,t,n,i,r,s){const a=dh(e,"x","batchNorm"),o=dh(t,"mean","batchNorm"),l=dh(n,"variance","batchNorm");let c,u;return null!=r&&(c=dh(r,"scale","batchNorm")),null!=i&&(u=dh(i,"offset","batchNorm")),Pa(4===a.rank,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`),Pa(4===o.rank||1===o.rank,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`),Pa(4===l.rank||1===l.rank,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),null!=c&&Pa(4===c.rank||1===c.rank,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),null!=u&&Pa(4===u.rank||1===u.rank,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Ef(a,o,l,u,c,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pf=ph({bincount_:function(e,t,n){const i=dh(e,"x","bincount"),r=dh(t,"weights","bincount");Pa("int32"===i.dtype,()=>`Error in bincount: input dtype must be int32, but got ${i.dtype}`),Pa(n>=0,()=>`size must be non-negative, but got ${n}.`),Pa(r.size===i.size||0===r.size,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${i.shape}, weights shape: ${r.shape}.`);const s={x:i,weights:r},a={size:n};return ih.runKernel(zo,s,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Df=ph({broadcastTo_:function(e,t){let n=dh(e,"broadcastTo","x");const i=n.shape;if(t.some(e=>!(e>0)||e%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=Tf(n,e)}const r=n.shape,s=Array.from(t);for(let c=t.length-1;c>=0;c--)if(r[c]===t[c])s[c]=1;else if(1!==n.shape[c])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${t}].`);const a=s.map((e,t)=>e>1?t:-1).filter(e=>e>=0);if(0===a.length)return Jh(n);const o={x:n},l={reps:s};return ih.runKernel(hu,o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Of=ph({ceil_:function(e){const t={x:dh(e,"x","ceil","float32")};return ih.runKernel(Vo,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lf(e,t,n){const i={shape:e,value:t,dtype:n};return ih.runKernel(wl,{},i)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mf=ph({clipByValue_:function(e,t,n){const i=dh(e,"x","clipByValue");if(Pa(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return Lf(i.shape,t,i.dtype);const r={x:i},s={clipValueMin:t,clipValueMax:n};return ih.runKernel(Ho,r,s)}});const Ff=ph({concat1d_:function(e){return Sf(e,0)}});const $f=ph({concat2d_:function(e,t){return Sf(e,t)}});const Bf=ph({concat3d_:function(e,t){return Sf(e,t)}});const zf=ph({concat4d_:function(e,t){return Sf(e,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uf=ph({conv2d_:function(e,t,n,i,r="NHWC",s=[1,1],a){const o=dh(e,"x","conv2d","float32"),l=dh(t,"filter","conv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=Tf(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Pa(4===c.rank,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),Pa(4===l.rank,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),vf("conv2d",i,a);const d="NHWC"===r?c.shape[3]:c.shape[1];Pa(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),Pa(bf(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const h={x:c,filter:l},p={strides:n,pad:i,dataFormat:r,dilations:s,dimRoundingMode:a},f=ih.runKernel(Xo,h,p);return u?Tf(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Gf=ph({conv1d_:function(e,t,n,i,r="NWC",s=1,a){const o=dh(e,"x","conv1d"),l=dh(t,"filter","conv1d");let c=o,u=!1;2===o.rank&&(u=!0,c=Tf(o,[1,o.shape[0],o.shape[1]])),Pa(3===c.rank,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),Pa(3===l.rank,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),vf("conv1d",i,a),Pa(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),Pa(bf(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),Pa("NWC"===r,()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=Tf(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=Tf(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=Uf(h,d,[1,n],i,"NHWC",[1,s],a);return Tf(p,u?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vf=ph({conv2DBackpropInput_:function(e,t,n,i,r,s="NHWC",a){Pa(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let o=e,l=t,c=!1;3===t.rank&&(c=!0,l=Tf(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),Pa(4===o.length,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`),Pa(4===l.rank,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),Pa(4===n.rank,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u="NHWC"===s?o[3]:o[1],d="NHWC"===s?l.shape[3]:l.shape[1];Pa(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),Pa(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),vf("conv2dDerInput",r,a);const h={dy:l,filter:n},p={strides:i,pad:r,dataFormat:s,dimRoundingMode:a,inputShape:o},f=ih.runKernel(Yo,h,p);return c?Tf(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const Hf=ph({conv2dTranspose_:function(e,t,n,i,r,s){const a=dh(e,"x","conv2dTranspose"),o=dh(t,"filter","conv2dTranspose");return Vf(n,a,o,i,r,"NHWC",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wf=ph({conv3d_:function(e,t,n,i,r="NDHWC",s=[1,1,1]){const a=dh(e,"x","conv3d"),o=dh(t,"filter","conv3d");let l=a,c=!1;4===a.rank&&(c=!0,l=Tf(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),Pa(5===l.rank,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),Pa(5===o.rank,()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`),Pa(l.shape[4]===o.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`),Pa(bf(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Pa("NDHWC"===r,()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`);const u={x:l,filter:o},d={strides:n,pad:i,dataFormat:r,dilations:s},h=ih.runKernel(Zo,u,d);return c?Tf(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jf=ph({conv3DBackpropInput_:function(e,t,n,i,r){Pa(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,a=t,o=!1;4===t.rank&&(o=!0,a=Tf(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);const l=s[4],c=a.shape[4];Pa(5===s.length,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),Pa(5===a.rank,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`),Pa(5===n.rank,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),Pa(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),Pa(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:a,filter:n},d={pad:r,strides:i,inputShape:s},h=ih.runKernel(Jo,u,d);return o?Tf(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const qf=ph({conv3dTranspose_:function(e,t,n,i,r){const s=dh(e,"x","conv3dTranspose"),a=dh(t,"filter","conv3dTranspose");return jf(n,s,a,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xf=ph({cos_:function(e){const t={x:dh(e,"x","cos","float32")};return ih.runKernel(el,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kf=ph({cosh_:function(e){const t={x:dh(e,"x","cosh","float32")};return ih.runKernel(tl,t)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yf=ph({cumprod_:function(e,t=0,n=!1,i=!1){const r={x:dh(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:i};return ih.runKernel(nl,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zf=ph({cumsum_:function(e,t=0,n=!1,i=!1){const r={x:dh(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:i};return ih.runKernel(il,r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qf=ph({depthToSpace_:function(e,t,n="NHWC"){const i=dh(e,"x","depthToSpace","float32"),r="NHWC"===n?i.shape[1]:i.shape[2],s="NHWC"===n?i.shape[2]:i.shape[3],a="NHWC"===n?i.shape[3]:i.shape[1];Pa(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),Pa(r*t>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${r} and ${t}  for depthToSpace with input shape\n    ${i.shape}`),Pa(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${t} for depthToSpace with input shape\n        ${i.shape}`),Pa(a%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${a} for depthToSpace with input shape ${i.shape}`);const o={x:i},l={blockSize:t,dataFormat:n};return ih.runKernel(al,o,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jf=ph({depthwiseConv2d_:function(e,t,n,i,r="NHWC",s=[1,1],a){const o=dh(e,"x","depthwiseConv2d","float32"),l=dh(t,"filter","depthwiseConv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=Tf(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Pa(4===c.rank,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),Pa(4===l.rank,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d="NHWC"===r?c.shape[3]:c.shape[1];Pa(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),vf("depthwiseConv2d",i,a);const h={x:c,filter:l},p={strides:n,pad:i,dataFormat:r,dilations:s,dimRoundingMode:a},f=ih.runKernel(ol,h,p);return u?Tf(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const em=ph({dilation2d_:function(e,t,n,i,r=[1,1],s="NHWC"){const a=dh(e,"x","dilation2d"),o=dh(t,"filter","dilation2d");Pa(3===a.rank||4===a.rank,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`),Pa(3===o.rank,()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`),Pa("NHWC"===s,()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=a,c=!1;3===a.rank&&(l=Tf(a,[1,a.shape[0],a.shape[1],a.shape[2]]),c=!0);const u={x:l,filter:o},d={strides:n,pad:i,dilations:r},h=ih.runKernel(dl,u,d);return c?Tf(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tm=ph({equal_:function(e,t){let n=dh(e,"a","equal","string_or_numeric"),i=dh(t,"b","equal","string_or_numeric");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(vl,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nm=ph({where_:function(e,t,n){const i=dh(t,"a","where"),r=dh(n,"b","where"),s=dh(e,"condition","where","bool"),a=Tp(Tp(s.shape,i.shape),r.shape),o={condition:Df(s,a),t:Df(i,a),e:Df(r,a)};return ih.runKernel(Bc,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const im=ph({zerosLike_:function(e){const t={x:dh(e,"x","zerosLike")};return ih.runKernel(vu,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rm=ph({divNoNan_:function(e,t){let n=dh(e,"a","div"),i=dh(t,"b","div");[n,i]=Yd(n,i);const r=Wp(n,i),s=im(r),a=tm(i,s);return nm(a,s,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sm=ph({dot_:function(e,t){const n=dh(e,"t1","dot"),i=dh(t,"t2","dot");Pa(!(1!==n.rank&&2!==n.rank||1!==i.rank&&2!==i.rank),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${i.rank}.`);const r=1===n.rank?n.size:n.shape[1],s=1===i.rank?i.size:i.shape[0];if(Pa(r===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${s}.`),1===n.rank&&1===i.rank){const e=Tf(n,[1,-1]),t=Tf(i,[-1,1]),r=ap(e,t);return Tf(r,[])}if(1===n.rank&&2===i.rank){const e=Tf(n,[1,-1]),t=Tf(i,[i.shape[0],i.shape[1]]),r=ap(e,t);return Tf(r,[r.size])}if(2===n.rank&&1===i.rank){const e=Tf(i,[-1,1]),t=ap(n,e);return Tf(t,[t.size])}{const e=Tf(i,[i.shape[0],i.shape[1]]);return ap(n,e)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const am=ph({elu_:function(e){const t={x:dh(e,"x","elu","float32")};return ih.runKernel(gl,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const om=ph({erf_:function(e){let t=dh(e,"x","erf");Pa("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=Qh(t,"float32"));const n={x:t};return ih.runKernel(yl,n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lm(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function cm(e,t,n){const i=e.length+t.length,r=[];let s=0,a=0;for(let o=0;o<i;o++)-1===n.indexOf(o)?r.push(e[s++]):r.push(t[a++]);return r}function um(e,t){const n=[],i=e.length;for(let r=0;r<i;r++)-1===t.indexOf(r)&&n.push(e[r]);return[n,t.map(t=>e[t])]}function dm(e,t){return cm(e,t.map(e=>1),t)}function hm(e,t,n){Pa(lm(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function pm(e,t){if(lm(e,t))return null;const n=[];for(let i=0;i<t;++i)-1===e.indexOf(i)&&n.push(i);return e.forEach(e=>n.push(e)),n}function fm(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function mm(e,t){const n=[];for(let i=t-e;i<t;++i)n.push(i);return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gm=ph({max_:function(e,t=null,n=!1){const i={x:dh(e,"x","max")},r={reductionIndices:t,keepDims:n};return ih.runKernel(Yl,i,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bm=ph({min_:function(e,t=null,n=!1){const i={x:dh(e,"x","min")},r={axis:t,keepDims:n};return ih.runKernel(rc,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ym=ph({pow_:function(e,t){let n=dh(e,"base","pow"),i=dh(t,"exp","pow");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(vc,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vm(e,t){if((Xa(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Xa(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return mh(e,[],[],t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tm=ph({sqrt_:function(e){const t={x:dh(e,"x","sqrt","float32")};return ih.runKernel(qc,t)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xm=ph({square_:function(e){const t=dh(e,"x","square");return ih.runKernel("Square",{x:t},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _m=ph({sum_:function(e,t=null,n=!1){let i=dh(e,"x","sum");"bool"===i.dtype&&(i=Qh(i,"int32"));const r={x:i},s={axis:t,keepDims:n};return ih.runKernel(Xc,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sm(e,t,n=null){if(0===e.rank)return qp(e);if(1!==e.rank&&null===n)return Sm(Tf(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return _m(qp(e),n);if(t===1/0)return gm(qp(e),n);if(t===-1/0)return bm(qp(e),n);if("euclidean"===t||2===t)return Tm(_m(ym(qp(e),vm(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return gm(_m(qp(e),n[0]),n[1]-1);if(t===1/0)return gm(_m(qp(e),n[1]),n[0]);if(t===-1/0)return bm(_m(qp(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Tm(_m(xm(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const wm=ph({norm_:function(e,t="euclidean",n=null,i=!1){const r=Sm(e=dh(e,"x","norm"),t,n);let s=r.shape;if(i){const t=Va(n,e.shape);s=dm(r.shape,t)}return Tf(r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Im=ph({euclideanNorm_:function(e,t=null,n=!1){return wm(e,"euclidean",t,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const km=ph({exp_:function(e){const t={x:dh(e,"x","exp")};return ih.runKernel(Tl,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cm=ph({expandDims_:function(e,t=0){const n=dh(e,"x","expandDims","string_or_numeric");Pa(t<=n.rank,()=>"Axis must be <= rank of the tensor");const i={input:n},r={dim:t};return ih.runKernel(xl,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Em=ph({expm1_:function(e){const t={x:dh(e,"x","expm1")};return ih.runKernel(_l,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Am=ph({tile_:function(e,t){const n=dh(e,"x","tile","string_or_numeric");Pa(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const i={x:n},r={reps:t};return ih.runKernel(hu,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rm=ph({eye_:function(e,t,n,i="float32"){null==t&&(t=e);const r=Zh([e,t],i),s=e<=t?e:t;for(let o=0;o<s;++o)r.set(1,o,o);const a=Tf(r.toTensor(),[e,t]);if(null==n)return a;if(1===n.length)return Am(Cm(a,0),[n[0],1,1]);if(2===n.length)return Am(Cm(Cm(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return Am(Cm(Cm(Cm(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nm=ph({floor_:function(e){const t={x:dh(e,"x","floor","float32")};return ih.runKernel(kl,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pm=ph({gather_:function(e,t,n=0,i=0){const r={x:dh(e,"x","gather"),indices:dh(t,"indices","gather","int32")},s={axis:n,batchDims:i};return ih.runKernel(Al,r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dm=ph({greater_:function(e,t){let n=dh(e,"a","greater","string_or_numeric"),i=dh(t,"b","greater","string_or_numeric");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(Nl,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Om=ph({greaterEqual_:function(e,t){let n=dh(e,"a","greaterEqual","string_or_numeric"),i=dh(t,"b","greaterEqual","string_or_numeric");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(Pl,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lm=ph({isFinite_:function(e){const t={x:dh(e,"x","isFinite")};return ih.runKernel(Ml,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mm=ph({isInf_:function(e){const t={x:dh(e,"x","isInf")};return ih.runKernel(Fl,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fm=ph({isNaN_:function(e){const t={x:dh(e,"x","isNaN")};return ih.runKernel($l,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $m=ph({leakyRelu_:function(e,t=.2){const n={x:dh(e,"x","leakyRelu")},i={alpha:t};return ih.runKernel(Bl,n,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bm=ph({less_:function(e,t){let n=dh(e,"a","less","string_or_numeric"),i=dh(t,"b","less","string_or_numeric");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(zl,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zm=ph({lessEqual_:function(e,t){let n=dh(e,"a","lessEqual","string_or_numeric"),i=dh(t,"b","lessEqual","string_or_numeric");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(Ul,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Um=ph({localResponseNormalization_:function(e,t=5,n=1,i=1,r=.5){const s=dh(e,"x","localResponseNormalization");Pa(4===s.rank||3===s.rank,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`),Pa($a(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let a=s,o=!1;3===s.rank&&(o=!0,a=Tf(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:a},c={depthRadius:t,bias:n,alpha:i,beta:r},u=ih.runKernel(Xl,l,c);return o?Tf(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gm=ph({log_:function(e){const t={x:dh(e,"x","log","float32")};return ih.runKernel(Vl,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vm=ph({log1p_:function(e){const t={x:dh(e,"x","log1p")};return ih.runKernel(Hl,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hm(e){return ih.customGrad(e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wm=ph({softplus_:function(e){const t={x:dh(e,"x","softplus")};return ih.runKernel(jc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jm=ph({logSigmoid_:function(e){const t=dh(e,"x","logSigmoid");return Hm(e=>({value:mp(Wm(mp(e))),gradFunc:t=>jp(t,wf(mp(e)))}))(t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qm=ph({sub_:function(e,t){let n=dh(e,"a","sub"),i=dh(t,"b","sub");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(cu,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xm=ph({logSoftmax_:function(e,t=-1){const n=dh(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Hm((e,n)=>{const i=gm(e,t,!0),r=qm(e,i),s=qm(Qh(r,"float32"),Gm(_m(km(r),t,!0)));n([s]);return{value:s,gradFunc:(e,n)=>{const[i]=n,r=km(i);return qm(e,jp(_m(e,t,!0),r))}}})(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Km=ph({logSumExp_:function(e,t=null,n=!1){const i=dh(e,"x","logSumExp"),r=Va(t,i.shape),s=gm(i,r,!0),a=qm(i,s),o=km(a),l=_m(o,r),c=Gm(l),u=Vp(Tf(s,c.shape),c);if(n){const e=dm(u.shape,r);return Tf(u,e)}return u}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ym=ph({logicalAnd_:function(e,t){const n=dh(e,"a","logicalAnd","bool"),i=dh(t,"b","logicalAnd","bool");Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(Wl,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zm=ph({logicalNot_:function(e){const t={x:dh(e,"x","logicalNot","bool")};return ih.runKernel(jl,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qm=ph({logicalOr_:function(e,t){const n=dh(e,"a","logicalOr","bool"),i=dh(t,"b","logicalOr","bool");Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(ql,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jm=ph({logicalXor_:function(e,t){const n=dh(e,"a","logicalXor","bool"),i=dh(t,"b","logicalXor","bool");return Tp(n.shape,i.shape),Ym(Qm(e,t),Zm(Ym(e,t)))}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eg=ph({maxPool_:function(e,t,n,i,r){const s=dh(e,"x","maxPool");let a=s,o=!1;3===s.rank&&(o=!0,a=Tf(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Pa(4===a.rank,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),Pa(bf(n,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`),vf("maxPool",i,r);const l={x:a},c={filterSize:t,strides:n,pad:i,dimRoundingMode:r},u=ih.runKernel(Ql,l,c);return o?Tf(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tg=ph({maxPool3d_:function(e,t=[1,1,1],n,i,r,s="NDHWC"){const a=dh(e,"x","maxPool3d");let o=a,l=!1;4===a.rank&&(l=!0,o=Tf(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),Pa(5===o.rank,()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`),Pa("NDHWC"===s,()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),vf("maxPool3d",i,r);const c={x:o},u={filterSize:t,strides:n,pad:i,dimRoundingMode:r,dataFormat:s},d=ih.runKernel(ec,c,u);return l?Tf(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ng=ph({maximum_:function(e,t){let n=dh(e,"a","maximum"),i=dh(t,"b","maximum");[n,i]=Yd(n,i),"bool"===n.dtype&&(n=Qh(n,"int32"),i=Qh(i,"int32")),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(Zl,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ig=ph({mean_:function(e,t=null,n=!1){const i={x:dh(e,"x","mean")},r={axis:t,keepDims:n};return ih.runKernel(ic,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rg(e,t="float32"){if("complex64"===t){const t=rg(e,"float32"),n=rg(e,"float32");return fh(t,n)}const n=so(Ma(e),t);return ih.makeTensor(n,e,t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sg(e,t="float32"){if("complex64"===t){const t=sg(e,"float32"),n=rg(e,"float32");return fh(t,n)}const n=ro(Ma(e),t);return ih.makeTensor(n,e,t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ag=ph({minimum_:function(e,t){let n=dh(e,"a","minimum"),i=dh(t,"b","minimum");[n,i]=Yd(n,i),"bool"===n.dtype&&(n=Qh(n,"int32"),i=Qh(i,"int32")),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(sc,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const og=ph({mirrorPad_:function(e,t,n){Pa("reflect"===n||"symmetric"===n,()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const i=dh(e,"x","mirrorPad");if(0===i.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Pa(t.length===i.rank,()=>`Padding doesn't match input. Must be ${i.rank}. Got ${t.length}.`);const r="reflect"===n?1:0;for(let o=0;o<i.rank;o++)Pa(2===t[o].length,()=>"Invalid number of paddings. Must be length of 2 each."),Pa(t[o][0]>=0&&t[o][0]<=i.shape[o]-r&&t[o][1]>=0&&t[o][1]<=i.shape[o]-r,()=>`Padding in dimension ${o} cannot be greater than or equal to ${i.shape[o]-r} or less than 0 for input of shape ${i.shape}`);const s={paddings:t,mode:n},a={x:i};return ih.runKernel(ac,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lg=ph({mod_:function(e,t){let n=dh(e,"a","mod"),i=dh(t,"b","mod");[n,i]=Yd(n,i);const r={a:n,b:i};return ih.runKernel(oc,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cg=ph({moments_:function(e,t=null,n=!1){const i=Va(t,(e=dh(e,"x","moments")).shape),r=ig(e,i,n);let s=r.shape;n||(s=dm(r.shape,i));const a=xm(qm(Qh(e,"float32"),Tf(r,s)));return{mean:r,variance:ig(a,i,n)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ug=ph({notEqual_:function(e,t){let n=dh(e,"a","notEqual","string_or_numeric"),i=dh(t,"b","notEqual","string_or_numeric");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(dc,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dg=ph({onesLike_:function(e){const t={x:dh(e,"x","onesLike")};return ih.runKernel(mc,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hg=ph({pad_:function(e,t,n=0){const i=dh(e,"x","pad");if(0===i.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:t,constantValue:n},s={x:i};return ih.runKernel(yc,s,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pg=ph({spaceToBatchND_:function(e,t,n){const i=dh(e,"x","spaceToBatchND");Pa(i.rank>=1+t.length,()=>`input rank ${i.rank} should be > than [blockShape] ${t.length}`),Pa(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),Pa(i.shape.reduce((e,i,r)=>r>0&&r<=t.length?e&&(i+n[r-1][0]+n[r-1][1])%t[r-1]===0:e,!0),()=>`input spatial dimensions ${i.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const r={x:i},s={blockShape:t,paddings:n};return ih.runKernel(Kc,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fg=ph({pool_:function(e,t,n,i,r,s,a){null==r&&(r=[1,1]),null==s&&(s=1),0===i&&(i="valid");const o=dh(e,"x","maxPool");let l=o,c=!1;3===o.rank&&(c=!0,l=Tf(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Pa(bf(s,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${r}'`);const u=of(l.shape,t,s,r,i),d=[u.dilationHeight,u.dilationWidth];let h;h="same"===i?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)),i=n.map(e=>e-1),r=i.map(e=>Math.floor(e/2)),s=i.map((e,t)=>e-r[t]);return i.map((e,t)=>[r[t],s[t]])}([u.filterHeight,u.filterWidth],d):[[0,0],[0,0]];const p=1===d[0]&&1===d[1],[f,m]=function(e,t,n){const i=n.map(e=>e[0]),r=n.map(e=>e[1]),s=e.concat(i,r),a=t.map((e,t)=>(e-s[t]%e)%e),o=r.map((e,t)=>e+a[t]),l=t.map((e,t)=>[i[t],o[t]]),c=t.map((e,t)=>[0,a[t]]);return[l,c]}([u.inHeight,u.inWidth],d,h),g=p?i:"valid",b=p?l:pg(l,d,f),y=("avg"===n?()=>xf(b,t,s,g,a):()=>eg(b,t,s,g,a))(),v=p?y:Cf(y,d,m);return c?Tf(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mg=ph({prelu_:function(e,t){const n={x:dh(e,"x","prelu"),alpha:dh(t,"alpha","prelu")};return ih.runKernel(Tc,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gg=ph({prod_:function(e,t=null,n=!1){let i=dh(e,"x","prod");"bool"===i.dtype&&(i=Qh(i,"int32"));const r={x:i},s={axis:t,keepDims:n};return ih.runKernel(xc,r,s)}});var bg={exports:{}};!function(e,t){function n(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function r(e,t){var r=new n(e),s=t&&t.state,a=r.next;return a.int32=function(){return 4294967296*r.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,s&&("object"==typeof s&&i(s,r),a.state=function(){return i(r,{})}),a}t&&t.exports?t.exports=r:this.alea=r}(0,bg);var yg={exports:{}};!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function r(e,t){var r=new n(e),s=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,s&&("object"==typeof s&&i(s,r),a.state=function(){return i(r,{})}),a}t&&t.exports?t.exports=r:this.xor128=r}(0,yg);var vg={exports:{}};!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function r(e,t){var r=new n(e),s=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,s&&("object"==typeof s&&i(s,r),a.state=function(){return i(r,{})}),a}t&&t.exports?t.exports=r:this.xorwow=r}(0,vg);var Tg={exports:{}};!function(e,t){function n(e){var t=this;t.next=function(){var e,n,i=t.x,r=t.i;return e=i[r],n=(e^=e>>>7)^e<<24,n^=(e=i[r+1&7])^e>>>10,n^=(e=i[r+3&7])^e>>>3,n^=(e=i[r+4&7])^e<<7,e=i[r+7&7],n^=(e^=e<<13)^e<<9,i[r]=n,t.i=r+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,n=0;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function r(e,t){null==e&&(e=+new Date);var r=new n(e),s=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,s&&(s.x&&i(s,r),a.state=function(){return i(r,{})}),a}t&&t.exports?t.exports=r:this.xorshift7=r}(0,Tg);var xg={exports:{}};!function(e,t){function n(e){var t=this;t.next=function(){var e,n,i=t.w,r=t.X,s=t.i;return t.w=i=i+1640531527|0,n=r[s+34&127],e=r[s=s+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=r[s]=n^e,t.i=s,n+(i^i>>>16)|0},function(e,t){var n,i,r,s,a,o=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),r=0,s=-32;s<l;++s)t&&(i^=t.charCodeAt((s+32)%t.length)),0===s&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,s>=0&&(a=a+1640531527|0,r=0==(n=o[127&s]^=i+a)?r+1:0);for(r>=128&&(o[127&(t&&t.length||0)]=-1),r=127,s=512;s>0;--s)i=o[r+34&127],n=o[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,o[r]=i^n;e.w=a,e.X=o,e.i=r}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function r(e,t){null==e&&(e=+new Date);var r=new n(e),s=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,s&&(s.X&&i(s,r),a.state=function(){return i(r,{})}),a}t&&t.exports?t.exports=r:this.xor4096=r}(0,xg);var _g={exports:{}};!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,r=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function r(e,t){var r=new n(e),s=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,s&&("object"==typeof s&&i(s,r),a.state=function(){return i(r,{})}),a}t&&t.exports?t.exports=r:this.tychei=r}(0,_g);var Sg={exports:{}};const wg=k(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));!function(e){!function(t,n,i){var r,s=256,a="random",o=i.pow(s,6),l=i.pow(2,52),c=2*l,u=255;function d(e,u,d){var b=[],y=m(f((u=1==u?{entropy:!0}:u||{}).entropy?[e,g(n)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(s):(e=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(e)),g(e)}catch(r6){var i=t.navigator,a=i&&i.plugins;return[+new Date,t,a,t.screen,g(n)]}}():e,3),b),v=new h(b),T=function(){for(var e=v.g(6),t=o,n=0;e<l;)e=(e+n)*s,t*=s,n=v.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return T.int32=function(){return 0|v.g(4)},T.quick=function(){return v.g(4)/4294967296},T.double=T,m(g(v.S),n),(u.pass||d||function(e,t,n,r){return r&&(r.S&&p(r,v),e.state=function(){return p(v,{})}),n?(i[a]=e,t):e})(T,y,"global"in u?u.global:this==i,u.state)}function h(e){var t,n=e.length,i=this,r=0,a=i.i=i.j=0,o=i.S=[];for(n||(e=[n++]);r<s;)o[r]=r++;for(r=0;r<s;r++)o[r]=o[a=u&a+e[r%n]+(t=o[r])],o[a]=t;(i.g=function(e){for(var t,n=0,r=i.i,a=i.j,o=i.S;e--;)t=o[r=u&r+1],n=n*s+o[u&(o[r]=o[a=u&a+t])+(o[a]=t)];return i.i=r,i.j=a,n})(s)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,i=[],r=typeof e;if(t&&"object"==r)for(n in e)try{i.push(f(e[n],t-1))}catch(r6){}return i.length?i:"string"==r?e:e+"\0"}function m(e,t){for(var n,i=e+"",r=0;r<i.length;)t[u&r]=u&(n^=19*t[u&r])+i.charCodeAt(r++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(m(i.random(),n),e.exports){e.exports=d;try{r=wg}catch(b){}}else i["seed"+a]=d}("undefined"!=typeof self?self:S,[],Math)}(Sg);var Ig=bg.exports,kg=yg.exports,Cg=vg.exports,Eg=Tg.exports,Ag=xg.exports,Rg=_g.exports,Ng=Sg.exports;Ng.alea=Ig,Ng.xor128=kg,Ng.xorwow=Cg,Ng.xorshift7=Eg,Ng.xor4096=Ag,Ng.tychei=Rg;var Pg=Ng;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dg{constructor(e,t,n,i,r){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=r||Math.random();this.random=Pg.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let i,r,s;do{i=2*this.random()-1,r=2*this.random()-1,s=i*i+r*r}while(s>=1||0===s);const a=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*a,t=this.mean+this.stdDev*r*a,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Og{constructor(e=0,t=1,n,i){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Pg.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lg=ph({randomNormal_:function(e,t=0,n=1,i,r){if(null!=i&&"bool"===i)throw new Error(`Unsupported data type ${i}`);const s=new Dg(t,n,i,!1,r),a=Zh(e,i);for(let o=0;o<a.values.length;o++)a.values[o]=s.nextValue();return a.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mg=ph({randomUniform_:function(e,t=0,n=1,i="float32",r){const s=Zh(e,i),a=new Og(t,n,null,r);for(let o=0;o<s.values.length;o++)s.values[o]=a.nextValue();return s.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fg(e,t,n=1,i="float32"){if(0===n)throw new Error("Cannot have a step of zero");const r={start:e,stop:t,step:n,dtype:i};return ih.runKernel(wc,{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $g=ph({reciprocal_:function(e){const t={x:dh(e,"x","reciprocal")};return ih.runKernel(kc,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bg=ph({relu_:function(e){const t={x:dh(e,"x","relu")};return ih.runKernel(Cc,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zg=ph({relu6_:function(e){const t={x:dh(e,"x","relu6")};return ih.runKernel(Dc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ug=ph({reverse_:function(e,t){const n={x:dh(e,"x","reverse")},i={dims:t};return ih.runKernel(Oc,n,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gg=ph({round_:function(e){const t={x:dh(e,"x","round")};return ih.runKernel(Lc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vg=ph({rsqrt_:function(e){const t={x:dh(e,"x","rsqrt","float32")};return ih.runKernel(Mc,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hg=ph({selu_:function(e){const t={x:dh(e,"x","selu")};return ih.runKernel(zc,t)}});const Wg=ph({separableConv2d_:function(e,t,n,i,r,s=[1,1],a="NHWC"){const o=dh(e,"x","separableConv2d"),l=dh(t,"depthwiseFilter","separableConv2d"),c=dh(n,"pointwiseFilter","separableConv2d");let u=o,d=!1;if(3===o.rank&&(d=!0,u=Tf(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Pa(4===u.rank,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),Pa(4===l.rank,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),Pa(4===c.rank,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),Pa(1===c.shape[0],()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),Pa(1===c.shape[1],()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const h=l.shape[2],p=l.shape[3];Pa(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);const f=Jf(u,l,i,r,a,s),m=Uf(f,c,1,"valid",a);return d?Tf(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jg=ph({sign_:function(e){const t={x:dh(e,"x","sign")};return ih.runKernel(Hc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qg=ph({sin_:function(e){const t={x:dh(e,"x","sin","float32")};return ih.runKernel(Gc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xg=ph({sinh_:function(e){const t={x:dh(e,"x","sinh")};return ih.runKernel(Vc,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kg=ph({slice1d_:function(e,t,n){const i=dh(e,"x","slice1d");return Pa(1===i.rank,()=>`slice1d expects a rank-1 tensor, but got a rank-${i.rank} tensor`),If(i,[t],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yg=ph({slice2d_:function(e,t,n){const i=dh(e,"x","slice2d");return Pa(2===i.rank,()=>`slice2d expects a rank-2 tensor, but got a rank-${i.rank} tensor`),If(i,t,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zg=ph({slice3d_:function(e,t,n){const i=dh(e,"x","slice3d");return Pa(3===i.rank,()=>`slice3d expects a rank-3 tensor, but got a rank-${i.rank} tensor`),If(i,t,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qg=ph({slice4d_:function(e,t,n){const i=dh(e,"x","slice4d");return Pa(4===i.rank,()=>`slice4d expects a rank-4 tensor, but got a rank-${i.rank} tensor`),If(i,t,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jg=ph({softmax_:function(e,t=-1){const n=dh(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const i={logits:n},r={dim:t};return ih.runKernel(Zc,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eb=ph({fft_:function(e){Pa("complex64"===e.dtype,()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);const t={input:e};return ih.runKernel(Sl,t)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tb=ph({ifft_:function(e){Pa("complex64"===e.dtype,()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);const t={input:e};return ih.runKernel(Ol,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nb=ph({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let i;if(t<=2){const r=Tf(e,[n,t]);i=tb(r)}else{const r=[n,2*(t-1)],s=Tf(gp(e),[n,t]),a=Tf(fp(e),[n,t]),o=Ug(If(s,[0,1],[n,t-2]),1),l=jp(Ug(If(a,[0,1],[n,t-2]),1),vm(-1)),c=Sf([s,o],1),u=Sf([a,l],1),d=Tf(fh(c,u),[r[0],r[1]]);i=tb(d)}if(i=gp(i),3===e.rank&&0!==e.shape[0]){const t=i,n=e.shape[0];i=Tf(i,[n,i.shape[0]/n,i.shape[1]]),t.dispose()}return i}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ib=ph({split_:function(e,t,n=0){const i={x:dh(e,"x","split")},r={numOrSizeSplits:t,axis:n};return ih.runKernel(Yc,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rb=ph({rfft_:function(e,t){Pa("float32"===e.dtype,()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1];const i=e.size/n;let r;if(null!=t&&t<n){const i=e.shape.map(e=>0),s=e.shape.map(e=>e);s[e.shape.length-1]=t,r=If(e,i,s),n=t}else if(null!=t&&t>n){const i=e.shape.map(e=>e);i[e.shape.length-1]=t-n,r=Sf([e,rg(i)],e.shape.length-1),n=t}else r=e;const s=im(r),a=Tf(fh(r,s),[i,n]),o=eb(a),l=Math.floor(n/2)+1,c=gp(o),u=fp(o),d=ib(c,[l,n-l],c.shape.length-1),h=ib(u,[l,n-l],u.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,Tf(fh(d[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sb=ph({squaredDifference_:function(e,t){let n=dh(e,"a","squaredDifference"),i=dh(t,"b","squaredDifference");[n,i]=Yd(n,i),Tp(n.shape,i.shape);const r={a:n,b:i};return ih.runKernel(iu,r,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ab=ph({squeeze_:function(e,t){const n=dh(e,"x","squeeze","string_or_numeric");return Tf(n,Ha(n.shape,t).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ob=ph({stack_:function(e,t=0){const n=hh(e,"tensors","stack","string_or_numeric");Pa(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&Pa(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const i=n,r={axis:t};return ih.runKernel(bc,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lb=ph({step_:function(e,t=0){const n={x:dh(e,"x","step")},i={alpha:t};return ih.runKernel(Tu,n,i)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cb=ph({stridedSlice_:function(e,t,n,i,r=0,s=0,a=0,o=0,l=0){const c={x:dh(e,"x","stridedSlice","string_or_numeric")},u={begin:t,end:n,strides:i,beginMask:r,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};return ih.runKernel(su,c,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ub=ph({tan_:function(e){const t={x:dh(e,"x","tan","float32")};return ih.runKernel(uu,t)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function db(e,t){Oa(e);const n=lh(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return mh(e,null,n,t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hb(e,t,n){if(Oa(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const i=lh(e,n);if(2!==i.length&&1!==i.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===i.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return mh(e,t,i,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pb=ph({topk_:function(e,t=1,n=!0){const i=dh(e,"x","topk");if(0===i.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const r=i.shape[i.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${t}`);const s={x:i},a={k:t,sorted:n},[o,l]=ih.runKernel(pu,s,a);return{values:o,indices:l}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fb=ph({truncatedNormal_:function(e,t=0,n=1,i,r){if(null!=i&&"bool"===i)throw new Error("Unsupported data type $ { dtype }");const s=new Dg(t,n,i,!0,r),a=Zh(e,i);for(let o=0;o<a.values.length;o++)a.values[o]=s.nextValue();return a.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mb=ph({unique_:function(e,t=0){const n=dh(e,"x","unique","string_or_numeric");Pa(n.rank>0,()=>"The input tensor must be at least 1D");const i={x:n},r={axis:t},[s,a]=ih.runKernel(gu,i,r);return{values:s,indices:a}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gb=ph({unsortedSegmentSum_:function(e,t,n){const i=dh(e,"x","unsortedSegmentSum"),r=dh(t,"segmentIds","unsortedSegmentSum","int32");Pa($a(n),()=>"numSegments must be of dtype int");const s={x:i,segmentIds:r},a={numSegments:n};return ih.runKernel(yu,s,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bb=ph({unstack_:function(e,t=0){const n=dh(e,"x","unstack","string_or_numeric");Pa(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const i={value:n},r={axis:t};return ih.runKernel(bu,i,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yb(e,t){const n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);const i=Zh(e,"int32"),r=Zh([n.length,e.length],"int32");for(let s=0;s<n.length;s++){const t=i.indexToLoc(n[s]),a=s*e.length;r.values.set(t,a)}return r.toTensor()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vb=ph({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i){const r=dh(e,"x","dropout");if(Pa("float32"===r.dtype,()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),Pa(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),0===t)return e instanceof Od?r.clone():r;const s=function(e,t){if(null==t)return e.shape.slice();if(Fa(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let i=0;i<e.shape.length;i++)null==t[i]&&null!=e.shape[i]?n.push(e.shape[i]):n.push(t[i]);return n}return t}(r,n),a=1-t,o=Wp(Nm(Vp(Mg(s,0,1,"float32",i),a)),a);return jp(r,o)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tb(e,t,n){const i=1-e%2,r=new Float32Array(e);for(let s=0;s<e;++s){const a=2*Math.PI*s/(e+i-1);r[s]=t-n*Math.cos(a)}return db(r,"float32")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xb=ph({conv2DBackpropFilter_:function(e,t,n,i,r,s="NHWC",a){let o=e;3===e.rank&&(o=Tf(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=Tf(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Pa(4===o.rank,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`),Pa(4===l.rank,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),Pa(4===n.length,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c="NHWC"===s?o.shape[3]:o.shape[1],u="NHWC"===s?l.shape[3]:l.shape[1];Pa(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),Pa(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),vf("conv2dDerFilter",r,a);const d={x:o,dy:l},h={strides:i,pad:r,dataFormat:s,dimRoundingMode:a,filterShape:n};return ih.runKernel(Ko,d,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _b(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return jp(e,lb(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Sb(e,t){let n=t;const i=vp(e.shape,t.shape);return i.length>0&&(n=_m(n,i)),Tf(n,e.shape)}function wb(e,t,n,i){if("linear"===t)return e;if("relu"===t)return Bg(e);if("elu"===t)return am(e);if("relu6"===t)return zg(e);if("prelu"===t)return mg(e,n);if("leakyrelu"===t)return $m(e,i);if("sigmoid"===t)return wf(e);throw new Error(`Unknown fused activation ${t}.`)}const Ib=(e,t)=>!(e>0)||"linear"===t;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kb=ph({fusedConv2d_:function({x:e,filter:t,strides:n,pad:i,dataFormat:r="NHWC",dilations:s=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",!1===Ib(ih.state.gradientDepth,l)){Pa("NHWC"===r,()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let d=Uf(e,t,n,i,r,s,a);return null!=o&&(d=Vp(d,o)),wb(d,l,c,u)}const d=dh(e,"x","conv2d","float32"),h=dh(t,"filter","conv2d","float32");let p=d,f=!1;3===d.rank&&(f=!0,p=Tf(d,[1,d.shape[0],d.shape[1],d.shape[2]])),Pa(4===p.rank,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),Pa(4===h.rank,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),vf("fused conv2d",i,a);const m="NHWC"===r?p.shape[3]:p.shape[1];Pa(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),Pa(bf(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const g=cf(p.shape,h.shape,n,s,i,a);let b,y;if(null!=o&&(b=dh(o,"bias","fused conv2d"),[b]=Yd(b,d),"NHWC"===r?Tp(g.outShape,b.shape):(Pa(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),Pa(0===b.shape.length||b.shape[0]===g.outChannels||1===b.shape[0],()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${g.outChannels})`))),null!=c){const e=c.shape;if(Pa(e.length<=1||3===e.length,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${e.length}.`),1===e.length)Pa(1===e[0]||e[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the number of output channels (${g.outChannels}).`);else if(3===e.length)try{Tp(e,g.outShape)}catch(r6){const n=`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(n)}y=dh(c,"prelu weights","fused conv2d")}const v=(e,t)=>{Pa("NHWC"===r,()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[a,o,c,u]=t,d=_b(e,c,l);Pa(gf(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const h=[Vf(o.shape,d,a,n,i),xb(o,d,a.shape,n,i)];if(null!=u){const e=Sb(u,d);h.push(e)}return h},T={x:p,filter:h,bias:b,preluActivationWeights:y},x={strides:n,pad:i,dataFormat:r,dilations:s,dimRoundingMode:a,activation:l,leakyreluAlpha:u};if(null==o){return Hm((e,t,n)=>{let i=ih.runKernel(Su,T,x);return n([t,e,i]),f&&(i=Tf(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}})(p,h)}return Hm((e,t,n,i)=>{let r=ih.runKernel(Su,T,x);return i([t,e,r,n]),f&&(r=Tf(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}})(p,h,b)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cb=ph({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,i,r,s=[1,1],a){let o=e;3===e.rank&&(o=Tf(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=Tf(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={x:o,dy:l},u={strides:i,pad:r,dimRoundingMode:a,dilations:s,filterShape:n};return ih.runKernel(ll,c,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eb=ph({depthwiseConv2dNativeBackpropInput_:function(e,t,n,i,r,s=[1,1],a){let o=t,l=!1;3===t.rank&&(l=!0,o=Tf(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={dy:o,filter:n},u={strides:i,pad:r,dimRoundingMode:a,dilations:s,inputShape:e},d=ih.runKernel(cl,c,u);return l?Tf(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ab=ph({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:i=!1,bias:r,activation:s="linear",preluActivationWeights:a,leakyreluAlpha:o=.2}){if(!1===Ib(ih.state.gradientDepth,s)){let l=ap(e,t,n,i);return null!=r&&(l=Vp(l,r)),wb(l,s,a,o)}let l=dh(e,"a","fused matMul"),c=dh(t,"b","fused matMul");[l,c]=Yd(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=i?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=i?c.shape[c.rank-2]:c.shape[c.rank-1],f=l.shape.slice(0,-2),m=c.shape.slice(0,-2),g=Ma(f),b=Ma(m);Pa(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${i} must match.`);const y=Tp(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),v=Tf(l,n?[g,u,h]:[g,h,u]),T=Tf(c,i?[b,p,d]:[b,d,p]);let x,_;null!=r&&(x=dh(r,"bias","fused matMul"),[x]=Yd(x,l),Tp(y,x.shape)),null!=a&&(_=dh(a,"prelu weights","fused matMul"));const S=(e,t)=>{const[a,o,l,c]=t,u=_b(Tf(e,l.shape),l,s);let d,h;if(n||i?!n&&i?(d=ap(u,o,!1,!1),h=ap(u,a,!0,!1)):n&&!i?(d=ap(o,u,!1,!0),h=ap(a,u,!1,!1)):(d=ap(o,u,!0,!0),h=ap(u,a,!0,!0)):(d=ap(u,o,!1,!0),h=ap(a,u,!0,!1)),null!=r){return[d,h,Sb(c,u)]}return[d,h]},w={a:v,b:T,bias:x,preluActivationWeights:_},I={transposeA:n,transposeB:i,activation:s,leakyreluAlpha:o};if(null==r){return Hm((e,t,n)=>{const i=ih.runKernel(_u,w,I);return n([e,t,i]),{value:Tf(i,y),gradFunc:S}})(v,T)}return Hm((e,t,n,i)=>{const r=ih.runKernel(_u,w,I);return i([e,t,r,n]),{value:Tf(r,y),gradFunc:S}})(v,T,x)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({hammingWindow_:function(e){return Tb(e,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rb=ph({hannWindow_:function(e){return Tb(e,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nb=ph({frame_:function(e,t,n,i=!1,r=0){let s=0;const a=[];for(;s+t<=e.size;)a.push(If(e,s,t)),s+=n;if(i)for(;s<e.size;){const i=s+t-e.size,o=Sf([If(e,s,t-i),Lf([i],r)]);a.push(o),s+=n}return 0===a.length?hb([],[0,t]):Tf(Sf(a),[a.length,t])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({stft_:function(e,t,n,i,r=Rb){var s;null==i&&(s=t,i=Math.floor(Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)))));const a=Nb(e,t,n),o=jp(a,r(t));return rb(o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pb=ph({cropAndResize_:function(e,t,n,i,r="bilinear",s=0){const a=dh(e,"image","cropAndResize"),o=dh(t,"boxes","cropAndResize","float32"),l=dh(n,"boxInd","cropAndResize","int32"),c=o.shape[0];Pa(4===a.rank,()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`),Pa(2===o.rank&&4===o.shape[1],()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${o.shape}.`),Pa(1===l.rank&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${o.shape}.`),Pa(2===i.length,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${i.length}.`),Pa(i[0]>=1&&i[1]>=1,()=>`cropSize must be atleast [1,1], but was ${i}`),Pa("bilinear"===r||"nearest"===r,()=>`method must be bilinear or nearest, but was ${r}`);const u={image:a,boxes:o,boxInd:l},d={method:r,extrapolationValue:s,cropSize:i};return ih.runKernel(rl,u,d)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Db=ph({flipLeftRight_:function(e){const t=dh(e,"image","flipLeftRight","float32");Pa(4===t.rank,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return ih.runKernel(Il,n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ob=ph({grayscaleToRGB_:function(e){const t=dh(e,"image","grayscaleToRGB"),n=t.rank-1,i=t.shape[n];Pa(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),Pa(1===i,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${i}.`);const r=new Array(t.rank);return r.fill(1,0,n),r[n]=3,Am(t,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lb=ph({rotateWithOffset_:function(e,t,n=0,i=.5){const r=dh(e,"image","rotateWithOffset","float32");Pa(4===r.rank,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const s={image:r},a={radians:t,fillValue:n,center:i};return ih.runKernel(xu,s,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mb(e,t,n,i,r,s){null==i&&(i=.5),null==r&&(r=Number.NEGATIVE_INFINITY),null==s&&(s=0);const a=e.shape[0];return n=Math.min(n,a),Pa(0<=i&&i<=1,()=>`iouThreshold must be in [0, 1], but was '${i}'`),Pa(2===e.rank,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),Pa(4===e.shape[1],()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),Pa(1===t.rank,()=>"scores must be a 1D tensor"),Pa(t.shape[0]===a,()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${t.shape[0]}`),Pa(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:i,scoreThreshold:r,softNmsSigma:s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fb=ph({nonMaxSuppression_:function(e,t,n,i=.5,r=Number.NEGATIVE_INFINITY){const s=dh(e,"boxes","nonMaxSuppression","float32"),a=dh(t,"scores","nonMaxSuppression","float32"),o=Mb(s,a,n,i,r),l={maxOutputSize:n=o.maxOutputSize,iouThreshold:i=o.iouThreshold,scoreThreshold:r=o.scoreThreshold};return ih.runKernel(hc,{boxes:s,scores:a},l)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $b(e,t,n){const i=function(e,t,n){return function(e,t,n){let i=0,r=e.length,s=0,a=!1;for(;i<r;){s=i+(r-i>>>1);const o=n(t,e[s]);o>0?i=s+1:(r=s,a=!o)}return a?i:-i-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,t,n||Bb)}(e,t,n),r=i<0?-(i+1):i;e.splice(r,0,t)}function Bb(e,t){return e>t?1:e<t?-1:0}function zb(e,t,n,i,r){return Vb(e,t,n,i,r,0)}function Ub(e,t,n,i,r,s){return Vb(e,t,n,i,r,0,!1,s,!0)}function Gb(e,t,n,i,r,s){return Vb(e,t,n,i,r,s,!0)}function Vb(e,t,n,i,r,s,a=!1,o=!1,l=!1){const c=[];for(let g=0;g<t.length;g++)t[g]>r&&c.push({score:t[g],boxIndex:g,suppressBeginIndex:0});c.sort(jb);const u=s>0?-.5/s:0,d=[],h=[];for(;d.length<n&&c.length>0;){const t=c.pop(),{score:n,boxIndex:s,suppressBeginIndex:a}=t;if(n<r)break;let o=!1;for(let l=d.length-1;l>=a;--l){const n=Hb(e,s,d[l]);if(n>=i){o=!0;break}if(t.score=t.score*Wb(i,u,n),t.score<=r)break}t.suppressBeginIndex=d.length,o||(t.score===n?(d.push(s),h.push(t.score)):t.score>r&&$b(c,t,jb))}const p=d.length,f=n-p;o&&f>0&&(d.push(...new Array(f).fill(0)),h.push(...new Array(f).fill(0)));const m={selectedIndices:d};return a&&(m.selectedScores=h),l&&(m.validOutputs=p),m}function Hb(e,t,n){const i=e.subarray(4*t,4*t+4),r=e.subarray(4*n,4*n+4),s=Math.min(i[0],i[2]),a=Math.min(i[1],i[3]),o=Math.max(i[0],i[2]),l=Math.max(i[1],i[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),p=(o-s)*(l-a),f=(d-c)*(h-u);if(p<=0||f<=0)return 0;const m=Math.max(s,c),g=Math.max(a,u),b=Math.min(o,d),y=Math.min(l,h),v=Math.max(b-m,0)*Math.max(y-g,0);return v/(p+f-v)}function Wb(e,t,n){const i=Math.exp(t*n*n);return n<=e?i:0}function jb(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qb=async function(e,t,n,i=.5,r=Number.NEGATIVE_INFINITY){const s=dh(e,"boxes","nonMaxSuppressionAsync"),a=dh(t,"scores","nonMaxSuppressionAsync"),o=Mb(s,a,n,i,r);n=o.maxOutputSize,i=o.iouThreshold,r=o.scoreThreshold;const l=await Promise.all([s.data(),a.data()]),c=l[0],u=l[1],{selectedIndices:d}=zb(c,u,n,i,r);return s!==e&&s.dispose(),a!==t&&a.dispose(),db(d,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xb=ph({nonMaxSuppressionWithScore_:function(e,t,n,i=.5,r=Number.NEGATIVE_INFINITY,s=0){const a=dh(e,"boxes","nonMaxSuppression"),o=dh(t,"scores","nonMaxSuppression"),l=Mb(a,o,n,i,r,s),c={boxes:a,scores:o},u={maxOutputSize:n=l.maxOutputSize,iouThreshold:i=l.iouThreshold,scoreThreshold:r=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma},d=ih.runKernel(fc,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kb=async function(e,t,n,i=.5,r=Number.NEGATIVE_INFINITY,s=0){const a=dh(e,"boxes","nonMaxSuppressionAsync"),o=dh(t,"scores","nonMaxSuppressionAsync"),l=Mb(a,o,n,i,r,s);n=l.maxOutputSize,i=l.iouThreshold,r=l.scoreThreshold,s=l.softNmsSigma;const c=await Promise.all([a.data(),o.data()]),u=c[0],d=c[1],{selectedIndices:h,selectedScores:p}=Gb(u,d,n,i,r,s);return a!==e&&a.dispose(),o!==t&&o.dispose(),{selectedIndices:db(h,"int32"),selectedScores:db(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yb=ph({nonMaxSuppressionPadded_:function(e,t,n,i=.5,r=Number.NEGATIVE_INFINITY,s=!1){const a=dh(e,"boxes","nonMaxSuppression"),o=dh(t,"scores","nonMaxSuppression"),l=Mb(a,o,n,i,r,null),c={boxes:a,scores:o},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:s},d=ih.runKernel(pc,c,u);return{selectedIndices:d[0],validOutputs:d[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zb=async function(e,t,n,i=.5,r=Number.NEGATIVE_INFINITY,s=!1){const a=dh(e,"boxes","nonMaxSuppressionAsync"),o=dh(t,"scores","nonMaxSuppressionAsync"),l=Mb(a,o,n,i,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[h,p]=await Promise.all([a.data(),o.data()]),{selectedIndices:f,validOutputs:m}=Ub(h,p,c,u,d,s);return a!==e&&a.dispose(),o!==t&&o.dispose(),{selectedIndices:db(f,"int32"),validOutputs:vm(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qb=ph({resizeBilinear_:function(e,t,n=!1,i=!1){const r=dh(e,"images","resizeBilinear");Pa(3===r.rank||4===r.rank,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),Pa(2===t.length,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),Pa(!1===i||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=r,a=!1;3===r.rank&&(a=!0,s=Tf(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const o={images:s},l={alignCorners:n,halfPixelCenters:i,size:t},c=ih.runKernel(Nc,o,l);return a?Tf(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jb=ph({resizeNearestNeighbor_:function(e,t,n=!1,i=!1){const r=dh(e,"images","resizeNearestNeighbor");Pa(3===r.rank||4===r.rank,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),Pa(2===t.length,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),Pa("float32"===r.dtype||"int32"===r.dtype,()=>"`images` must have `int32` or `float32` as dtype"),Pa(!1===i||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=r,a=!1;3===r.rank&&(a=!0,s=Tf(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const o={images:s},l={alignCorners:n,halfPixelCenters:i,size:t},c=ih.runKernel(Ac,o,l);return a?Tf(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ey=ph({threshold_:function(e,t="binary",n=!1,i=.5){const r=dh(e,"image","threshold"),s=r.shape[0]*r.shape[1];let a,o,l,c,u=jp(db([i]),255);if(Pa(3===r.rank,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),Pa(3===r.shape[2]||1===r.shape[2],()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),Pa("int32"===r.dtype||"float32"===r.dtype,()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),Pa("otsu"===t||"binary"===t,()=>`Method must be binary or otsu, but was ${t}`),3===r.shape[2]){[a,o,l]=ib(r,[1,1,1],-1);const e=jp(a,.2989),t=jp(o,.587),n=jp(l,.114);c=Vp(Vp(e,t),n)}else c=e;if("otsu"===t){u=function(e,t){let n,i,r,s,a,o,l=db([-1]),c=db([0]),u=db([0]);for(let d=0;d<e.size-1;d++){n=If(e,0,d+1),i=If(e,d+1),a=Wp(_m(n),t),o=Wp(_m(i),t);const h=_m(jp(n,Fg(0,n.size)));r=Wp(h,_m(n));const p=Lf(i.shape,n.size),f=Vp(Fg(0,i.size),p),m=jp(i,f);s=Wp(_m(m),_m(i));const g=qm(r,s),b=qm(r,s),y=jp(a,o);u=jp(jp(y,g),b);const v=Dm(u,c);c=nm(v,u,c),l=nm(v,db([d]),l)}return l}(Pf(Qh(Gg(c),"int32"),mh(d=[],h,lh(d,p),p),256),s)}var d,h,p;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f=n?zm(c,u):Dm(c,u);return Qh(jp(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ty=ph({transform_:function(e,t,n="nearest",i="constant",r=0,s){const a=dh(e,"image","transform","float32"),o=dh(t,"transforms","transform","float32");Pa(4===a.rank,()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`),Pa(2===o.rank&&(o.shape[0]===a.shape[0]||1===o.shape[0])&&8===o.shape[1],()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),Pa(null==s||2===s.length,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);const l={image:a,transforms:o},c={interpolation:n,fillMode:i,fillValue:r,outputShape:s};return ih.runKernel(fu,l,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ny=ph({bandPart_:function(e,t,n){Pa(t%1==0,()=>`bandPart(): numLower must be an integer, got ${t}.`),Pa(n%1==0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const i=dh(e,"a","bandPart");Pa(i.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${i.rank}.`);const r=i.shape,[s,a]=i.shape.slice(-2);if(!(t<=s))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`);if(!(n<=a))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${a}).`);t<0&&(t=s),n<0&&(n=a);const o=Tf(Fg(0,s,1,"int32"),[-1,1]),l=Fg(0,a,1,"int32"),c=qm(o,l),u=Ym(zm(c,vm(+t,"int32")),Om(c,vm(-n,"int32"))),d=rg([s,a],i.dtype);return Tf(ob(bb(Tf(i,[-1,s,a])).map(e=>nm(u,e,d))),r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iy=ph({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,Pa(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)Pa(e[t].shape[0]===n,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`)}else t=!0,e=ib(e,e.shape[0],0).map(e=>ab(e,[0]));Pa(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],i=e;for(let r=0;r<e.length;++r)n.push(ih.tidy(()=>{let e=i[r];if(r>0)for(let t=0;t<r;++t){const i=jp(_m(jp(n[t],e)),n[t]);e=qm(e,i)}return Wp(e,wm(e,"euclidean"))}));return t?ob(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ry(e,t=!1){return ih.tidy(()=>{Pa(2===e.shape.length,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],i=e.shape[1];let r=Rm(n),s=Jh(e);const a=hb([[1]],[1,1]);let o=Jh(a);const l=n>=i?i:n;for(let e=0;e<l;++e){const t=s,l=o,c=r;[o,s,r]=ih.tidy(()=>{const t=If(s,[e,e],[n-e,1]),l=wm(t),c=If(s,[e,e],[1,1]),u=nm(Dm(c,0),hb([[-1]]),hb([[1]])),d=qm(c,jp(u,l)),h=Wp(t,d);o=1===h.shape[0]?Jh(a):Sf([a,If(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=mp(Wp(ap(u,d),l)),f=If(s,[e,0],[n-e,i]),m=jp(p,o),g=bp(o);if(0===e)s=qm(f,ap(m,ap(g,f)));else{const t=qm(f,ap(m,ap(g,f)));s=Sf([If(s,[0,0],[e,i]),t],0)}const b=bp(m),y=If(r,[0,e],[n,r.shape[1]-e]);if(0===e)r=qm(y,ap(ap(y,o),b));else{const t=qm(y,ap(ap(y,o),b));r=Sf([If(r,[0,0],[n,e]),t],1)}return[o,s,r]}),dp([t,l,c])}return!t&&n>i&&(r=If(r,[0,0],[n,i]),s=If(s,[0,0],[i,i])),[r,s]})}const sy=ph({qr_:function(e,t=!1){if(Pa(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),2===e.rank)return ry(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),i=bb(Tf(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),r=[],s=[];i.forEach(e=>{const[n,i]=ry(e,t);r.push(n),s.push(i)});return[Tf(ob(r,0),e.shape),Tf(ob(s,0),e.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ay,oy;(oy=ay||(ay={}))[oy.NONE=0]="NONE",oy[oy.MEAN=1]="MEAN",oy[oy.SUM=2]="SUM",oy[oy.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS";const ly=ph({computeWeightedLoss_:function(e,t,n=ay.SUM_BY_NONZERO_WEIGHTS){const i=dh(e,"losses","computeWeightedLoss");let r=null;null!=t&&(r=dh(t,"weights","computeWeightedLoss"));const s=null==r?i:jp(i,r);if(n===ay.NONE)return s;if(n===ay.SUM)return _m(s);if(n===ay.MEAN){if(null==r)return ig(s);{const e=i.size/r.size,t=Wp(_m(s),_m(r));return e>1?Wp(t,vm(e)):t}}if(n===ay.SUM_BY_NONZERO_WEIGHTS){if(null==r)return Wp(_m(s),vm(i.size));{const e=jp(r,sg(i.shape)),t=Qh(_m(ug(e,vm(0))),"float32");return Wp(_m(s),t)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({absoluteDifference_:function(e,t,n,i=ay.SUM_BY_NONZERO_WEIGHTS){const r=dh(e,"labels","absoluteDifference"),s=dh(t,"predictions","absoluteDifference");let a=null;null!=n&&(a=dh(n,"weights","absoluteDifference")),Da(r.shape,s.shape,"Error in absoluteDifference: ");const o=qp(qm(r,s));return ly(o,a,i)}});ph({cosineDistance_:function(e,t,n,i,r=ay.SUM_BY_NONZERO_WEIGHTS){const s=dh(e,"labels","cosineDistance"),a=dh(t,"predictions","cosineDistance");let o=null;null!=i&&(o=dh(i,"weights","cosineDistance")),Da(s.shape,a.shape,"Error in cosineDistance: ");const l=vm(1),c=qm(l,_m(jp(s,a),n,!0));return ly(c,o,r)}});ph({hingeLoss_:function(e,t,n,i=ay.SUM_BY_NONZERO_WEIGHTS){let r=dh(e,"labels","hingeLoss");const s=dh(t,"predictions","hingeLoss");let a=null;null!=n&&(a=dh(n,"weights","hingeLoss")),Da(r.shape,s.shape,"Error in hingeLoss: ");const o=vm(1);r=qm(jp(vm(2),r),o);const l=Bg(qm(o,jp(r,s)));return ly(l,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({huberLoss_:function(e,t,n,i=1,r=ay.SUM_BY_NONZERO_WEIGHTS){const s=dh(e,"labels","huberLoss"),a=dh(t,"predictions","huberLoss");let o=null;null!=n&&(o=dh(n,"weights","huberLoss")),Da(s.shape,a.shape,"Error in huberLoss: ");const l=vm(i),c=qp(qm(a,s)),u=ag(c,l),d=qm(c,u),h=Vp(jp(vm(.5),xm(u)),jp(l,d));return ly(h,o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({logLoss_:function(e,t,n,i=1e-7,r=ay.SUM_BY_NONZERO_WEIGHTS){const s=dh(e,"labels","logLoss"),a=dh(t,"predictions","logLoss");let o=null;null!=n&&(o=dh(n,"weights","logLoss")),Da(s.shape,a.shape,"Error in logLoss: ");const l=vm(1),c=vm(i),u=mp(jp(s,Gm(Vp(a,c)))),d=jp(qm(l,s),Gm(Vp(qm(l,a),c))),h=qm(u,d);return ly(h,o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({meanSquaredError_:function(e,t,n,i=ay.SUM_BY_NONZERO_WEIGHTS){const r=dh(e,"labels","meanSquaredError"),s=dh(t,"predictions","meanSquaredError");let a=null;null!=n&&(a=dh(n,"weights","meanSquaredError")),Da(r.shape,s.shape,"Error in meanSquaredError: ");const o=sb(r,s);return ly(o,a,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({sigmoidCrossEntropy_:function(e,t,n,i=0,r=ay.SUM_BY_NONZERO_WEIGHTS){let s=dh(e,"multiClassLabels","sigmoidCrossEntropy");const a=dh(t,"logits","sigmoidCrossEntropy");let o=null;if(null!=n&&(o=dh(n,"weights","sigmoidCrossEntropy")),Da(s.shape,a.shape,"Error in sigmoidCrossEntropy: "),i>0){const e=vm(i),t=vm(1),n=vm(.5);s=Vp(jp(s,qm(t,e)),jp(n,e))}const l=function(e,t){const n=dh(e,"labels","sigmoidCrossEntropyWithLogits"),i=dh(t,"logits","sigmoidCrossEntropyWithLogits");Da(n.shape,i.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=Bg(i),s=jp(i,n),a=Vm(km(mp(qp(i))));return Vp(qm(r,s),a)}(s,a);return ly(l,o,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({softmaxCrossEntropy_:function(e,t,n,i=0,r=ay.SUM_BY_NONZERO_WEIGHTS){let s=dh(e,"onehotLabels","softmaxCrossEntropy");const a=dh(t,"logits","softmaxCrossEntropy");let o=null;if(null!=n&&(o=dh(n,"weights","softmaxCrossEntropy")),Da(s.shape,a.shape,"Error in softmaxCrossEntropy: "),i>0){const e=vm(i),t=vm(1),n=vm(s.shape[1]);s=Vp(jp(s,qm(t,e)),Wp(e,n))}const l=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Hm((e,t,i)=>{const r=Km(t,[n],!0),s=qm(Qh(t,"float32"),r);i([e,s]);const a=mp(jp(s,e));return{value:_m(a,[n]),gradFunc:(e,t)=>{const[i,r]=t,s=dm(e.shape,[n]);return[jp(Tf(e,s),qm(Qh(i,"float32"),km(r))),jp(Tf(e,s),qm(km(r),Qh(i,"float32")))]}}})(e,t)}(s,a);return ly(l,o,r)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({sparseFillEmptyRows_:function(e,t,n,i){const r=dh(e,"indices","sparseFillEmptyRows","int32"),s=dh(t,"values","sparseFillEmptyRows"),a=dh(n,"denseShape","sparseFillEmptyRows","int32"),o=dh(i,"defaultValue","sparseFillEmptyRows",s.dtype);if(2!==r.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(1!==a.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${a.shape}`);if(0!==o.rank)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);const l={indices:r,values:s,denseShape:a,defaultValue:o},c=ih.runKernel(Qc,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({sparseReshape_:function(e,t,n){const i=dh(e,"inputIndices","sparseReshape","int32"),r=dh(t,"inputShape","sparseReshape","int32"),s=dh(n,"newShape","sparseReshape","int32");if(2!==i.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${i.shape}`);if(1!==r.rank)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(1!==s.rank)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const a={inputIndices:i,inputShape:r,newShape:s},o=ih.runKernel(Jc,a);return{outputIndices:o[0],outputShape:o[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({sparseSegmentMean_:function(e,t,n){const i=dh(e,"data","sparseSegmentMean"),r=dh(t,"indices","sparseSegmentMean","int32"),s=dh(n,"segmentIds","sparseSegmentMean","int32");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${r.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${s.shape}`);const a={data:i,indices:r,segmentIds:s};return ih.runKernel(eu,a)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({sparseSegmentSum_:function(e,t,n){const i=dh(e,"data","sparseSegmentSum"),r=dh(t,"indices","sparseSegmentSum","int32"),s=dh(n,"segmentIds","sparseSegmentSum","int32");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${r.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${s.shape}`);const a={data:i,indices:r,segmentIds:s};return ih.runKernel(tu,a)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({stringNGrams_:function(e,t,n,i,r,s,a,o){const l=dh(e,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=dh(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:i,leftPad:r,rightPad:s,padWidth:a,preserveShortSequences:o},d={data:l,dataSplits:c},h=ih.runKernel(au,d,u);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({stringSplit_:function(e,t,n=!0){const i=dh(e,"input","stringSplit","string"),r=dh(t,"delimiter","stringSplit","string");if(1!==i.rank)throw new Error(`Input should be Tensor1D but received shape ${i.shape}`);if(0!==r.rank)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const s={skipEmpty:n},a={input:i,delimiter:r},o=ih.runKernel(ou,a,s);return{indices:o[0],values:o[1],shape:o[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ph({stringToHashBucketFast_:function(e,t){const n=dh(e,"input","stringToHashBucketFast","string"),i={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return ih.runKernel(lu,r,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cy={flipLeftRight:Db,grayscaleToRGB:Ob,resizeNearestNeighbor:Jb,resizeBilinear:Qb,rotateWithOffset:Lb,cropAndResize:Pb,nonMaxSuppression:Fb,nonMaxSuppressionAsync:qb,nonMaxSuppressionWithScore:Xb,nonMaxSuppressionWithScoreAsync:Kb,nonMaxSuppressionPadded:Yb,nonMaxSuppressionPaddedAsync:Zb,threshold:ey,transform:ty},uy={bandPart:ny,gramSchmidt:iy,qr:sy};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class dy extends zp{minimize(e,t=!1,n){const{value:i,grads:r}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:r[e.name]}));this.applyGradients(e)}else this.applyGradients(r);return dp(r),t?i:(i.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){Pa(Ja(e),()=>"The f passed in variableGrads(f) must be a function"),Pa(null==t||Array.isArray(t)&&t.every(e=>e instanceof Md),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in ih.registeredVariables)t.push(ih.registeredVariables[e])}const i=n?t.filter(e=>!e.trainable):null,r=t.length;Pa((t=t.filter(e=>e.trainable)).length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const{value:s,grads:a}=ih.gradients(e,t,null,!0);Pa(a.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),Pa(0===s.rank,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);const o={};return t.forEach((e,t)=>{null!=a[t]&&(o[e.name]=a[t])}),null!=i&&i.forEach(e=>o[e.name]=null),{value:s,grads:o}}(e,t)}dispose(){null!=this.iterations_&&dp(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:vm(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(dy,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hy extends dy{constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=ih.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=ih.registeredVariables[t],r=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:up(()=>im(i).variable(r))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:up(()=>im(i).variable(r))});const s=Array.isArray(e)?e[n].tensor:e[t];if(null==s)return;const a=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;up(()=>{const e=Vp(jp(a,this.rho),jp(xm(s),1-this.rho)),t=jp(Wp(Tm(Vp(o,this.epsilon)),Tm(Vp(a,this.epsilon))),s),n=Vp(jp(o,this.rho),jp(xm(t),1-this.rho));a.assign(e),o.assign(n);const r=Vp(jp(t,-this.learningRate),i);i.assign(r)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(dp(this.accumulatedGrads.map(e=>e.variable)),dp(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}hy.className="Adadelta",Gp(hy);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class py extends dy{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=ih.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:up(()=>Lf(i.shape,this.initialAccumulatorValue).variable(e))}}const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const s=this.accumulatedGrads[n].variable;up(()=>{const e=Vp(s,xm(r));s.assign(e);const t=Vp(jp(Wp(r,Tm(Vp(e,ih.backend.epsilon()))),-this.learningRate),i);i.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&dp(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}py.className="Adagrad",Gp(py);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class fy extends dy{constructor(e,t,n,i=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],up(()=>{this.accBeta1=vm(t).variable(),this.accBeta2=vm(n).variable()}),null==i&&(this.epsilon=ih.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);up(()=>{const n=qm(1,this.accBeta1),i=qm(1,this.accBeta2);t.forEach((t,r)=>{const s=ih.registeredVariables[t],a=!1;null==this.accumulatedFirstMoment[r]&&(this.accumulatedFirstMoment[r]={originalName:`${t}/m`,variable:up(()=>im(s).variable(a))}),null==this.accumulatedSecondMoment[r]&&(this.accumulatedSecondMoment[r]={originalName:`${t}/v`,variable:up(()=>im(s).variable(a))});const o=Array.isArray(e)?e[r].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[r].variable,c=this.accumulatedSecondMoment[r].variable,u=Vp(jp(l,this.beta1),jp(o,1-this.beta1)),d=Vp(jp(c,this.beta2),jp(xm(o),1-this.beta2)),h=Wp(u,n),p=Wp(d,i);l.assign(u),c.assign(d);const f=Vp(jp(Wp(h,Vp(Tm(p),this.epsilon)),-this.learningRate),s);s.assign(f)}),this.accBeta1.assign(jp(this.accBeta1,this.beta1)),this.accBeta2.assign(jp(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&dp(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&dp(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),up(()=>{this.accBeta1.assign(ym(this.beta1,this.iterations_+1)),this.accBeta2.assign(ym(this.beta2,this.iterations_+1))});const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}fy.className="Adam",Gp(fy);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class my extends dy{constructor(e,t,n,i=null,r=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=i,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],up(()=>{this.iteration=vm(0).variable(),this.accBeta1=vm(t).variable()}),null==i&&(this.epsilon=ih.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);up(()=>{const n=qm(1,this.accBeta1),i=Wp(-this.learningRate,Vp(jp(this.iteration,this.decay),1));t.forEach((t,r)=>{const s=ih.registeredVariables[t],a=!1;null==this.accumulatedFirstMoment[r]&&(this.accumulatedFirstMoment[r]={originalName:`${t}/m`,variable:im(s).variable(a)}),null==this.accumulatedWeightedInfNorm[r]&&(this.accumulatedWeightedInfNorm[r]={originalName:`${t}/v`,variable:im(s).variable(a)});const o=Array.isArray(e)?e[r].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[r].variable,c=this.accumulatedWeightedInfNorm[r].variable,u=Vp(jp(l,this.beta1),jp(o,1-this.beta1)),d=jp(c,this.beta2),h=qp(o),p=ng(d,h);l.assign(u),c.assign(p);const f=Vp(jp(Wp(i,n),Wp(u,Vp(p,this.epsilon))),s);s.assign(f)}),this.iteration.assign(Vp(this.iteration,1)),this.accBeta1.assign(jp(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&dp(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&dp(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}my.className="Adamax",Gp(my);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class gy extends dy{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const r=ih.registeredVariables[t];up(()=>{const e=Vp(jp(this.c,i),r);r.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=hp(vm(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}gy.className="SGD",Gp(gy);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class by extends gy{constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=vm(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=ih.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:`${t}/momentum`,variable:up(()=>im(i).variable(e))}}const r=this.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[t];null!=s&&up(()=>{let e;const t=Vp(jp(this.m,r),s);e=this.useNesterov?Vp(jp(this.c,Vp(s,jp(t,this.m))),i):Vp(jp(this.c,t),i),r.assign(t),i.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&dp(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}by.className="Momentum",Gp(by);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yy extends dy{constructor(e,t=.9,n=0,i=null,r=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,null==i&&(this.epsilon=ih.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const i=ih.registeredVariables[t],r=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:up(()=>im(i).variable(r))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:up(()=>im(i).variable(r))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:up(()=>im(i).variable(r))});const s=Array.isArray(e)?e[n].tensor:e[t];if(null==s)return;const a=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;up(()=>{const e=Vp(jp(a,this.decay),jp(xm(s),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,r=Vp(jp(t,this.decay),jp(s,1-this.decay)),l=Wp(jp(s,this.learningRate),Tm(qm(e,Vp(xm(r),this.epsilon)))),c=Vp(jp(o,this.momentum),l);a.assign(e),t.assign(r),o.assign(c);const u=qm(i,c);i.assign(u)}else{const e=Vp(jp(a,this.decay),jp(xm(s),1-this.decay)),t=Vp(jp(o,this.momentum),Wp(jp(s,this.learningRate),Tm(Vp(e,this.epsilon))));a.assign(e),o.assign(t);const n=qm(i,t);i.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&dp(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&dp(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&dp(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}yy.className="RMSProp",Gp(yy);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class vy{static sgd(e){return new gy(e)}static momentum(e,t,n=!1){return new by(e,t,n)}static rmsprop(e,t=.9,n=0,i=null,r=!1){return new yy(e,t,n,i,r)}static adam(e=.001,t=.9,n=.999,i=null){return new fy(e,t,n,i)}static adadelta(e=.001,t=.95,n=null){return new hy(e,t,n)}static adamax(e=.002,t=.9,n=.999,i=null,r=0){return new my(e,t,n,i,r)}static adagrad(e,t=.1){return new py(e,t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ty={sgd:vy.sgd,momentum:vy.momentum,adadelta:vy.adadelta,adagrad:vy.adagrad,rmsprop:vy.rmsprop,adamax:vy.adamax,adam:vy.adam},xy="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _y(){return new Promise(e=>xy(()=>e()))}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sy(e,t){const n=e[0].length;e.forEach((e,t)=>{Pa(e.length===n,()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`)}),Pa(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const i=e[0];e.forEach((e,r)=>{for(let s=0;s<n;s++)Pa(s===t||e[s]===i[s],()=>`Error in concat${n}D: Shape of tensors[${r}] (${e}) does not match the shape of the rest (${i}) along the non-concatenated axis ${r}.`)})}function wy(e,t){const n=e[0].slice();for(let i=1;i<e.length;i++)n[t]+=e[i][t];return n}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Iy,ky;function Cy(e,t,n){let i=new Array;if(null==n&&null==t)return i;if(null==t)for(;i.length<e+n.length;)i.push(-1);else i=t.slice();if(null==n)return i;if(e+n.length!==i.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${i.length}`);for(let r=1;r<n.length;++r){const s=n[r],a=i[i.length-n.length+r],o=i[a];if(s>=0)if(o>=0){if(o!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${r+e}] = ${s} but shape[${r+e}] = ${o}`)}else i[a]=s}return i}function Ey(e){const t={FIRST_DIM_SIZE:Iy.FIRST_DIM_SIZE,VALUE_ROWIDS:Iy.VALUE_ROWIDS,ROW_LENGTHS:Iy.ROW_LENGTHS,ROW_SPLITS:Iy.ROW_SPLITS,ROW_LIMITS:Iy.ROW_LIMITS,ROW_STARTS:Iy.ROW_STARTS},n=[];for(const i of e){if(!(i in t))break;n.push(t[i])}return n}function Ay(e){return 0===e.length?0:e[0]===Iy.FIRST_DIM_SIZE?e.length-1:e.length}function Ry(e,t){if(null==e||null==t)return;const n=e.length,i=t.length;if(n>=i)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${i})`);for(let r=0;r<Math.min(n,i-1);++r){const n=e[r],i=t[r+1];if(n>=0&&i>=0&&1!==n&&n!==i)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${r-e.length}] = ${n} but ragged tensor input.flatValues.shape[${r-e.length}] = ${i}`)}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(ky=Iy||(Iy={}))[ky.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",ky[ky.VALUE_ROWIDS=1]="VALUE_ROWIDS",ky[ky.ROW_LENGTHS=2]="ROW_LENGTHS",ky[ky.ROW_SPLITS=3]="ROW_SPLITS",ky[ky.ROW_LIMITS=4]="ROW_LIMITS",ky[ky.ROW_STARTS=5]="ROW_STARTS";function Ny(e){return e<=30?e:eo(e,Math.floor(Math.sqrt(e)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Py(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dy(e,t,n,i=!0){let r=[];if(i)r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const n=t.length;for(let i=0;i<n;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(n+1))}return r}function Oy(e,t,n=!0){const i=[];if(n){i.push(t);for(let n=t+1;n<e;++n)n<=2*t?(i.push(n),i.push(n-(t+1))):i.push(n)}else{const n=[],r=[];for(let i=1;i<e;++i)i>=2*t+1||i%2==1?r.push(i):n.push(i);i.push(...n),i.push(0),i.push(...r)}return i}function Ly(e,t,n,i=!0){const r=[];i?r.push(e[0]/n):r.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?i?r.push(t[s-1]*e[s]):r.push(e[s]/t[s-1]):r.push(e[s]);return r}function My(e,t){const n=[0];for(let i=0;i<t;++i)n.push(e[i][0]);return n}function Fy(e,t,n){const i=e.slice(0,1);for(let r=0;r<n;++r)i.push(e[r+1]-t[r][0]-t[r][1]);return i}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $y=1.7580993408473768,By=1.0507009873554805,zy=.3275911,Uy=.254829592,Gy=-.284496736,Vy=1.421413741,Hy=-1.453152027,Wy=1.061405429;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jy(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let i=0;i<n.length;i+=2)n[i]=e[i/2],n[i+1]=t[i/2];return n}function qy(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let i=0;i<e.length;i+=2)t[i/2]=e[i],n[i/2]=e[i+1];return{real:t,imag:n}}function Xy(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),i=new Float32Array(t);for(let r=0;r<e.length;r+=4)n[Math.floor(r/4)]=e[r],i[Math.floor(r/4)]=e[r+1];return{real:n,imag:i}}function Ky(e){const t=Math.floor(e.length/4),n=new Float32Array(t),i=new Float32Array(t);for(let r=2;r<e.length;r+=4)n[Math.floor(r/4)]=e[r],i[Math.floor(r/4)]=e[r+1];return{real:n,imag:i}}function Yy(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Zy(e,t,n,i){e[2*i]=t,e[2*i+1]=n}function Qy(e,t){const n=new Float32Array(e/2),i=new Float32Array(e/2);for(let r=0;r<Math.ceil(e/2);r++){const s=(t?2:-2)*Math.PI*(r/e);n[r]=Math.cos(s),i[r]=Math.sin(s)}return{real:n,imag:i}}function Jy(e,t,n){const i=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(i),imag:Math.sin(i)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ev="->",tv=/->/g;function nv(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(tv,"").length)/2;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${ev}").`);const[i,r]=e.split(ev);Pa(-1===i.indexOf("..."),()=>'The ellipsis notation ("...") is not supported yet.');const s=i.split(","),a=s.length;if(t!==a)throw new Error(`Expected ${a} input tensors, received ${t}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let d=0;d<r.length;++d){const e=r[d];if(!s.some(t=>-1!==t.indexOf(e)))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===o.indexOf(e)&&o.push(e)}for(let d=0;d<i.length;++d){const e=i[d];-1===o.indexOf(e)&&","!==e&&o.push(e)}const l=new Array(s.length);for(let d=0;d<a;++d){if(new Set(s[d].split("")).size!==s[d].length)throw new Error(`Found duplicate axes in input component ${s[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let e=0;e<s[d].length;++e)l[d].push(o.indexOf(s[d][e]))}const c=o.length,u=[];for(let d=r.length;d<c;++d)u.push(d);return{allDims:o,summedDims:u,idDims:l}}function iv(e,t){let n=new Array(e);n.fill(-1);for(let r=0;r<t.length;++r)n[t[r]]=r;const i=[];for(let r=0;r<e;++r)-1===n[r]&&i.push(r);return n=n.filter(e=>-1!==e),{permutationIndices:n,expandDims:i}}function rv(e,t,n){const i=new Array(e);for(let r=0;r<n.length;++r){const e=n[r].shape;for(let n=0;n<t[r].length;++n)void 0===i[t[r][n]]?i[t[r][n]]=e[n]:Pa(i[t[r][n]]===e[n],()=>`Expected dimension ${i[t[r][n]]} at axis ${n} of input shaped ${JSON.stringify(e)}, but got dimension ${e[n]}`)}}function sv(e,t){const n=e,i=[];let r=0;0===e.length&&n.push(-1),r=e.length+1;for(let a=0;a<r;++a)i.push([]);const s=[];for(let a=0;a<n.length;++a){const e=ov(t,n[a]);for(const t of e)-1===s.indexOf(t)&&(i[a].push(t),s.push(t))}return{path:n,steps:i}}function av(e){return e.every((e,t)=>e===t)}function ov(e,t){const n=[];for(let i=0;i<e.length;++i)0!==e[i].length&&-1===e[i].indexOf(t)&&-1!==t||n.push(i);return n}function lv(e,t,n=0){let i=[];if("number"==typeof t)Pa(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),i=new Array(t).fill(e.shape[n]/t);else{Pa(t.reduce((e,t)=>(-1===t&&(e+=1),e),0)<=1,()=>"There should be only one negative value in split array.");const r=t.indexOf(-1);if(-1!==r){const i=t.reduce((e,t)=>t>0?e+t:e);t[r]=e.shape[n]-i}Pa(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),i=t}return i}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cv(e){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${e}`}function uv(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function dv(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hv(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function pv(e,t){return`size ${e} must be non-negative, not ${t}`}function fv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function mv(e,t){return`Input to reshape is a SparseTensor with ${Ma(e)}\n  dense values, but the requested shape requires a multiple of ${Ma(t)}. inputShape=${e} outputShape= ${t}`}function gv(e,t){return`Input to reshape is a tensor with ${Ma(e)} dense values, but the requested shape has ${Ma(t)}. inputShape=${e} outputShape=${t}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bv(){return"segment ids must be >= 0"}function yv(){return"segment ids are not increasing"}function vv(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Tv(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(e,t){let n,i=!1;for(e<=30?(n=e,i=!0):n=eo(e,Math.floor(Math.sqrt(e)));!i;)n>t||n===e?i=!0:n=eo(e,n+1);return n}function _v(e,t,n){const i=[],r=e.length;for(let s=0;s<r;s++)s!==t?i.push(e[s]):i.push(n);return i}function Sv(e,t,n,i){const r=t.shape.length,s=e.shape.length;if(0!==i&&(i<-r||i>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${i}`);if(i<0&&(i+=r),i>s)throw new Error(`batchDims (${i}) must be less than rank(x) (\n    ${s}).`);if(n<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${n}).`);for(let d=0;d<i;++d)if(e.shape[d]!==t.shape[d])throw new Error(`x.shape[${d}]: ${e.shape[d]} should be equal to indices.shape[${d}]: ${t.shape[d]}.`);const a=e.shape[n],o=[];let l=1,c=1,u=1;for(let d=0;d<i;++d)o.push(e.shape[d]),l*=e.shape[d];for(let d=i;d<n;d++)o.push(e.shape[d]),c*=e.shape[d];for(let d=i;d<r;d++)o.push(t.shape[d]);for(let d=n+1;d<s;d++)o.push(e.shape[d]),u*=e.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:a,outputShape:o}}const wv=Object.freeze(Object.defineProperty({__proto__:null,segOpComputeOptimalWindowSize:xv,computeOutShape:_v,collectGatherOpShapeInfo:Sv},Symbol.toStringTag,{value:"Module"}));
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iv(e){try{return e.map(e=>_d(e))}catch(s6){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${s6}`)}}function kv(e){return e.map(e=>xd(e))}const Cv=Object.freeze(Object.defineProperty({__proto__:null,slice_util:Bp,segment_util:wv,fromUint8ToStringArray:Iv,fromStringArrayToUint8:kv,upcastType:Xd,axesAreInnerMostDims:lm,combineLocations:cm,computeOutAndReduceShapes:um,expandShapeToKeepDim:dm,assertAxesAreInnerMostDims:hm,getAxesPermutation:pm,getUndoAxesPermutation:fm,getInnerMostAxes:mm,getBroadcastDims:yp,getReductionAxes:vp,assertAndGetBroadcastShape:Tp,assertParamsConsistent:Sy,computeOutShape:wy,computeDilation2DInfo:af,computePool2DInfo:of,computePool3DInfo:lf,computeConv2DInfo:cf,computeConv3DInfo:uf,computeDefaultPad:df,tupleValuesAreOne:gf,eitherStridesOrDilationsAreOne:bf,convertConv2DDataFormat:yf,checkPadOnDimRoundingMode:vf,getFusedDyActivation:_b,getFusedBiasGradient:Sb,applyActivation:wb,shouldFuse:Ib,get RowPartitionType(){return Iy},combineRaggedTensorToTensorShapes:Cy,getRowPartitionTypesHelper:Ey,getRaggedRank:Ay,validateDefaultValueShape:Ry,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Ny,getImageCenter:Py,getReshaped:Dy,getPermuted:Oy,getReshapedPermuted:Ly,getSliceBeginCoords:My,getSliceSize:Fy,prepareAndValidate:xp,validateUpdateShape:_p,validateInput:function(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}_p(n,t,e)},calculateShapes:Sp,SELU_SCALEALPHA:$y,SELU_SCALE:By,ERF_P:zy,ERF_A1:Uy,ERF_A2:Gy,ERF_A3:Vy,ERF_A4:Hy,ERF_A5:Wy,warn:Iu,log:function(...e){mo().getBool("IS_TEST")||mo().getBool("PROD")||console.log(...e)},mergeRealAndImagArrays:jy,splitRealAndImagArrays:qy,complexWithEvenIndex:Xy,complexWithOddIndex:Ky,getComplexWithIndex:Yy,assignToTypedArray:Zy,exponents:Qy,exponent:Jy,decodeEinsumEquation:nv,getEinsumPermutation:iv,checkEinsumDimSizes:rv,getEinsumComputePath:sv,isIdentityPermutation:av,prepareSplitSize:lv,getSparseFillEmptyRowsIndicesDenseShapeMismatch:cv,getSparseFillEmptyRowsNegativeIndexErrorMessage:uv,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:dv,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:hv,getSparseReshapeNegativeOutputDimErrorMessage:pv,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:fv,getSparseReshapeInputOutputMultipleErrorMessage:mv,getSparseReshapeInputOutputMismatchErrorMessage:gv,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:bv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:yv,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:vv,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Tv},Symbol.toStringTag,{value:"Module"})),Ev={kernelName:To,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,lb(Qh(n,"float32"),-1))}}},Av={kernelName:xo,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=xm(Qh(n,"float32")),i=Tm(qm(vm(1),t));return mp(Wp(e,i))}}}},Rv={kernelName:_o,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Tm(qm(xm(Qh(n,"float32")),1));return Wp(e,t)}}}},Nv={kernelName:So,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{let t=e;const i=vp(n.shape,r);return i.length>0&&(t=_m(t,i)),Tf(t,n.shape)},b:()=>{let t=e;const n=vp(i.shape,r);return n.length>0&&(t=_m(t,n)),Tf(t,i.shape)}}}},Pv={kernelName:wo,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,i)=>{n[i]=()=>e.clone()}),n}},Dv={kernelName:Co,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>im(n)}}},Ov={kernelName:Eo,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>im(n)}}},Lv={kernelName:Ao,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,Tm(qm(vm(1),xm(Qh(n,"float32")))))}}},Mv={kernelName:Ro,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Tm(Vp(vm(1),xm(Qh(n,"float32"))));return Wp(e,t)}}}},Fv={kernelName:Do,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{const t=Vp(xm(n),xm(i));let s=jp(e,Wp(i,t));const a=vp(n.shape,r);return a.length>0&&(s=_m(s,a)),Tf(s,n.shape)},b:()=>{const t=Vp(xm(n),xm(i));let s=mp(jp(e,Wp(n,t)));const a=vp(i.shape,r);return a.length>0&&(s=_m(s,a)),Tf(s,i.shape)}}}},$v={kernelName:No,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,Vp(xm(Qh(n,"float32")),1))}}},Bv={kernelName:Po,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,qm(vm(1),xm(Qh(n,"float32"))))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zv=ph({avgPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i,r,s){const a=dh(e,"dy","avgPool3dGrad"),o=dh(t,"input","avgPool3dGrad");let l=a,c=o,u=!1;4===o.rank&&(u=!0,l=Tf(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=Tf(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Pa(5===l.rank,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),Pa(5===c.rank,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),vf("avgPool3dGrad",r,s);const d={dy:l,input:c},h={filterSize:n,strides:i,pad:r,dimRoundingMode:s},p=ih.runKernel(Fo,d,h);return u?Tf(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),Uv={kernelName:Mo,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{filterSize:r,strides:s,pad:a,dimRoundingMode:o}=n;return{x:()=>zv(e,i,r,s,a,o)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gv=ph({avgPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i,r){const s=dh(e,"dy","avgPoolGrad"),a=dh(t,"input","avgPoolGrad");Pa(a.rank===s.rank,()=>`Rank of input (${a.rank}) does not match rank of dy (${s.rank})`);let o=a,l=s,c=!1;3===a.rank&&(c=!0,o=Tf(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=Tf(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Pa(4===l.rank,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),Pa(4===o.rank,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`);const u={dy:l,input:o},d={filterSize:n,strides:i,pad:r},h=ih.runKernel(Lo,u,d);return c?Tf(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),Vv={kernelName:Oo,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{filterSize:r,strides:s,pad:a}=n;return{x:()=>Gv(e,i,r,s,a)}}},Hv={kernelName:$o,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[i,r]=t,{transposeA:s,transposeB:a}=n;return s||a?!s&&a?{a:()=>ap(e,r,!1,!1),b:()=>ap(e,i,!0,!1)}:s&&!a?{a:()=>ap(r,e,!1,!0),b:()=>ap(i,e,!1,!1)}:{a:()=>ap(r,e,!0,!0),b:()=>ap(e,i,!0,!0)}:{a:()=>ap(e,r,!1,!0),b:()=>ap(i,e,!0,!1)}}},Wv={kernelName:Bo,gradFunc:(e,t,n)=>{const{blockShape:i,crops:r}=n;return{x:()=>pg(e,i,r)}}},jv={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const i=n,r=i.inputShape,s=i.shape,a=Array.from(s);for(let l=r.length-1;l>=0;l--)if(r[l]===s[l])a[l]=1;else if(1!==r[l])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${s}].`);const o=[];for(let l=0;l<a.length;l++)a[l]>1&&o.push(l);return{x:()=>_m(e,o,!0)}}},qv={kernelName:Go,gradFunc:e=>({x:()=>e.clone()})},Xv={kernelName:Vo,gradFunc:e=>({x:()=>im(e)})},Kv={kernelName:Ho,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{clipValueMin:r,clipValueMax:s}=n;return{x:()=>nm(Ym(Om(i,r),zm(i,s)),e,im(e))}}},Yv={kernelName:jo,inputsToSave:["x"],gradFunc:Ev.gradFunc},Zv={kernelName:qo,saveAllInputs:!0,gradFunc:(e,t,n)=>{const i=t.map(e=>e.shape),{axis:r}=n,s=Va(r,t[0].shape)[0],a=i.map(e=>e[s]);return ib(e,a,s).map(e=>()=>e)}},Qv={kernelName:Xo,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,{dilations:s,strides:a,pad:o,dataFormat:l}=n;return Pa(gf(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>Vf(i.shape,e,r,a,o,l),filter:()=>xb(i,e,r.shape,a,o,l)}}},Jv={kernelName:Yo,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,{strides:s,pad:a,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>Uf(e,r,s,a,o,1,l),filter:()=>xb(e,i,r.shape,s,a,o,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eT=ph({conv3DBackpropFilter_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i,r){let s=e;4===e.rank&&(s=Tf(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let a=t;4===a.rank&&(a=Tf(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Pa(5===s.rank,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),Pa(5===a.rank,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`),Pa(5===n.length,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),Pa(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),Pa(a.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${n[4]}).`);const o={x:s,dy:a},l={strides:i,pad:r,filterShape:n};return ih.runKernel(Qo,o,l)}}),tT={kernelName:Zo,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:i,strides:r,pad:s}=n;Pa(gf(i),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const[a,o]=t;return{x:()=>jf(a.shape,e,o,r,s),filter:()=>eT(a,e,o.shape,r,s)}}},nT={kernelName:el,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(mp(qg(Qh(n,"float32"))),e)}}},iT={kernelName:tl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(Xg(Qh(n,"float32")),e)}}},rT={kernelName:il,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r,exclusive:s,reverse:a}=n;return{x:()=>{const t=pm([r],i.rank);let n=Zf(e,r,s,!a);return null!=t&&(n=bp(n,t)),n}}}},sT={kernelName:ol,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:i,strides:r,pad:s,dimRoundingMode:a}=n,o=null==i?[1,1]:i;Pa(gf(o),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);const[l,c]=t;return Pa(4===l.rank,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),Pa(4===c.rank,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),Pa(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),Pa(bf(r,o),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${o}'.`),vf("depthwiseConv2d",s,a),{x:()=>Eb(l.shape,e,c,r,s,o,a),filter:()=>Cb(l,e,c.shape,r,s,o,a)}}},aT={kernelName:dl,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,s={x:i,filter:r,dy:e},a={x:i,filter:r,dy:e};return{x:()=>ih.runKernel(hl,s,n),filter:()=>ih.runKernel(pl,a,n)}}},oT={kernelName:gl,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,i={dy:e,y:n};return{x:()=>ih.runKernel(bl,i)}}},lT={kernelName:yl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,i=jp(km(mp(xm(n))),2/Math.sqrt(Math.PI));return{x:()=>jp(e,i)}}},cT={kernelName:Tl,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,n)}}},uT={kernelName:xl,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>Tf(e,n.shape)}}},dT={kernelName:_l,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,km(n))}}},hT={kernelName:kl,gradFunc:e=>({x:()=>im(e)})},pT={kernelName:Cl,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{const t=Wp(e,Qh(i,"float32")),s=vp(n.shape,r);return s.length>0?Tf(_m(t,s),n.shape):t},b:()=>{let t=jp(e,Qh(n,"float32"));const s=vp(i.shape,r);s.length>0&&(t=Tf(_m(t,s),i.shape));const a=xm(i);return mp(Wp(t,Qh(a,"float32")))}}}},fT={kernelName:El,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:i}=n,[r,s,a,o]=t,l=null==o?vm(1):o,c=vp(s.shape,r.shape),u=[];if(1===s.rank){for(let e=0;e<r.shape.length-1;++e)u.push(r.shape[e]);u.push(1)}const d=qm(r,s),h=jp(e,l),p=Vg(Vp(a,vm(i))),f=jp(jp(jp(p,p),p),vm(-.5));return{x:()=>1===s.rank?Tf(jp(jp(e,Am(Tf(p,[1,1,1,s.shape[0]]),u)),l),r.shape):Tf(jp(jp(e,p),l),r.shape),mean:()=>{let e=jp(jp(p,vm(-1)),h);return 1===s.rank&&(e=_m(e,c)),Tf(e,s.shape)},variance:()=>{let e=jp(jp(f,d),h);return 1===s.rank&&(e=_m(e,c)),Tf(e,s.shape)},scale:()=>{const t=jp(d,p);let n=jp(e,t);return 1===s.rank&&(n=_m(n,c)),Tf(n,s.shape)},offset:()=>{let t=e;return 1===s.rank&&(t=_m(t,c)),Tf(t,s.shape)}}}},mT={kernelName:Al,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[i,r]=t,{axis:s}=n,a=Va(s,i.shape)[0];return{x:()=>{const t=i.shape,n=r.size,o=t.slice(0,a),l=o.length,c=t.slice(s,t.length).slice(1),u=c.length,d=gT(0,l),h=gT(l+1,l+1+u),p=bT([o,[n],c]),f=Tf(e,p),m=Tf(r,[n]),g=bT([[l],d,h]),b=bp(f,g);let y=gb(b,m,i.shape[a]);const v=fm(g);return y=bp(y,v),y},indices:()=>r}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gT(e,t){const n=[];for(let i=e;i<t;++i)n.push(i);return n}function bT(e){const t=[];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)t.push(e[n][i]);return t}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yT={kernelName:Pl,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>im(n),b:()=>im(i)}}},vT={kernelName:Dl,gradFunc:e=>({x:()=>Qh(e,"float32")})},TT={kernelName:Ml,gradFunc:e=>({x:()=>im(e)})},xT={kernelName:Fl,gradFunc:e=>({x:()=>im(e)})},_T={kernelName:$l,gradFunc:e=>({x:()=>im(e)})},ST={kernelName:Bl,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{alpha:r}=n,s=Dm(i,0);return{x:()=>nm(s,e,jp(e,r))}}},wT={kernelName:Hl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,Vp(n,1))}}},IT={kernelName:Vl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,Qh(n,"float32"))}}},kT={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n;return{logits:()=>{const t=km(i);return qm(e,jp(_m(e,r,!0),t))}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CT=ph({localResponseNormalizationBackprop_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i=5,r=1,s=1,a=.5){const o={x:e,y:t,dy:n},l={depthRadius:i,bias:r,alpha:s,beta:a};return ih.runKernel(Kl,o,l)}}),ET={kernelName:Xl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{depthRadius:s,bias:a,alpha:o,beta:l}=n;return{x:()=>CT(i,r,e,s,a,o,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AT(e,t,n,i){return t.rank<n.rank&&(t=Tf(t,dm(t.shape,i))),e.rank<n.rank&&(e=Tf(e,dm(e.shape,i))),{x:()=>jp(e,Qh(tm(n,t),e.dtype))}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RT={kernelName:Yl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const i=n,{reductionIndices:r}=i,s=t[0],a=AT(e,t[1],s,Va(r,s.shape));return{x:()=>a.x()}}},NT={kernelName:Zl,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>jp(e,Qh(Om(n,i),"float32")),b:()=>jp(e,Qh(Bm(n,i),"float32"))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PT=ph({maxPool3dGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i,r,s,a){const o=dh(e,"dy","maxPool3dGrad"),l=dh(t,"input","maxPool3dGrad"),c=dh(n,"output","maxPool3dGrad");let u=o,d=l,h=c,p=!1;4===l.rank&&(p=!0,u=Tf(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),d=Tf(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=Tf(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Pa(5===u.rank,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),Pa(5===d.rank,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),Pa(5===h.rank,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),vf("maxPool3dGrad",s,a);const f={dy:u,input:d,output:h},m={filterSize:i,strides:r,pad:s,dimRoundingMode:a},g=ih.runKernel(tc,f,m);return p?Tf(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),DT={kernelName:ec,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=n;return{x:()=>PT(e,i,r,s,a,o,l)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OT=ph({maxPoolGrad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i,r,s,a){const o=dh(e,"dy","maxPoolGrad"),l=dh(t,"input","maxPoolGrad"),c=dh(n,"output","maxPoolGrad");Pa(l.rank===o.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`),Pa(4===o.rank,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`),Pa(4===l.rank,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),vf("maxPoolGrad",s,a);const u={dy:o,input:l,output:c},d={filterSize:i,strides:r,pad:s,dimRoundingMode:a};return ih.runKernel(Jl,u,d)}}),LT={kernelName:sc,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>jp(e,Qh(zm(n,i),"float32")),b:()=>jp(e,Qh(Dm(n,i),"float32"))}}},MT={kernelName:oc,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{const t=vp(n.shape,r);return t.length>0?Tf(_m(e,t),n.shape):e},b:()=>{const t=jp(e,mp(Nm(Wp(n,i)))),s=vp(i.shape,r);return s.length>0?Tf(_m(t,s),i.shape):t}}}},FT={kernelName:cc,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{const t=jp(e,Qh(i,"float32")),s=vp(n.shape,r);return s.length>0?Tf(_m(t,s),n.shape):t},b:()=>{const t=jp(e,Qh(n,"float32")),s=vp(i.shape,r);return s.length>0?Tf(_m(t,s),i.shape):t}}}},$T={kernelName:yc,inputsToSave:["x"],gradFunc:(e,t,n)=>{const i=t[0],{paddings:r}=n,s=r.map(e=>e[0]);return{x:()=>If(e,s,i.shape)}}},BT={kernelName:vc,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,i,r]=t,s=n,a=i,o=Tp(s.shape,a.shape);return{a:()=>{const t=Qh(a,"float32");let n=jp(e,jp(t,ym(s,qm(t,vm(1)))));const i=vp(s.shape,o);return i.length>0&&(n=_m(n,i)),Tf(n,s.shape)},b:()=>{const t=Dm(s,0),n=nm(t,Gm(s),im(s));let i=jp(e,jp(r,n));const l=vp(a.shape,o);return l.length>0&&(i=_m(i,l)),Tf(i,a.shape)}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zT(e,t,n){const i=e.shape.length,r=i-n.length,s=pm(n,i);let a=e;null!=s&&(a=bp(e,s));const o=a.shape.slice(),l=o.splice(i-n.length,n.length).reduce((e,t)=>e*t,1);o.push(l);let c=
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n){const i=e.shape.slice();i[n]=1;const r=Tf(t,i),s=Yf(e,n,!0,!1),a=Yf(e,n,!0,!0),o=jp(s,a);return jp(r,o)}(a.reshape(o),t,r);if(c=c.reshape(a.shape),null!=s){const e=fm(s);c=bp(c,e)}return c}const UT={kernelName:xc,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n;let s=[];return s=null==r?i.shape.map((e,t)=>t):"number"==typeof r?[r]:r,{x:()=>zT(i,e,s)}}},GT={kernelName:fl,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{const t=Wp(e,Qh(i,"float32")),s=vp(n.shape,r);return s.length>0?Tf(_m(t,s),n.shape):t},b:()=>{let t=jp(e,Qh(n,"float32"));const s=vp(i.shape,r);s.length>0&&(t=Tf(_m(t,s),i.shape));const a=xm(i);return mp(Wp(t,Qh(a,"float32")))}}}},VT={kernelName:Uc,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{begin:r,size:s}=n,a=i.shape,[o,l]=Mp(i,r,s),c=[];for(let u=0;u<e.rank;u++)c.push([o[u],a[u]-o[u]-l[u]]);return{x:()=>hg(e,c)}}},HT={kernelName:Kc,gradFunc:(e,t,n)=>{const{blockShape:i,paddings:r}=n;return{x:()=>Cf(e,i,r)}}},WT={kernelName:Yc,gradFunc:(e,t,n)=>{const{axis:i}=n;return{x:()=>Sf(e,i)}}},jT={kernelName:iu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=vm(2);return{a:()=>jp(e,jp(r,qm(n,i))),b:()=>jp(e,jp(r,qm(i,n)))}}},qT={kernelName:cu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=Tp(n.shape,i.shape);return{a:()=>{let t=e;const i=vp(n.shape,r);return i.length>0&&(t=_m(t,i)),Tf(t,n.shape)},b:()=>{let t=e;const n=vp(i.shape,r);return n.length>0&&(t=_m(t,n)),Tf(mp(t),i.shape)}}}},XT={kernelName:hu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{reps:r}=n;return{x:()=>{let t=im(i);if(1===i.rank)for(let n=0;n<r[0];++n)t=Vp(t,If(e,[n*i.shape[0]],[i.shape[0]]));else if(2===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)t=Vp(t,If(e,[n*i.shape[0],s*i.shape[1]],[i.shape[0],i.shape[1]]));else if(3===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let a=0;a<r[2];++a)t=Vp(t,If(e,[n*i.shape[0],s*i.shape[1],a*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(4!==i.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let a=0;a<r[2];++a)for(let o=0;o<r[3];++o)t=Vp(t,If(e,[n*i.shape[0],s*i.shape[1],a*i.shape[2],o*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return t}}}},KT={kernelName:yu,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=ng(t,im(t)),i=Pm(e,n);let r=Om(t,vm(0,"int32"));const s=i.rank-r.rank;for(let o=0;o<s;++o)r=Cm(r,o+1);r=Ym(r,sg(i.shape,"bool"));const a=im(i);return nm(r,i,a)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,n)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YT=[Ev,Av,Rv,Nv,Pv,Dv,Ov,Lv,Mv,Fv,$v,Bv,Uv,Vv,Hv,Wv,jv,qv,Xv,Kv,Yv,Zv,Jv,Qv,tT,nT,iT,rT,sT,aT,GT,oT,lT,cT,uT,dT,pT,hT,fT,mT,yT,vT,TT,xT,_T,ST,wT,IT,kT,ET,RT,RT,NT,DT,{kernelName:Ql,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{filterSize:s,strides:a,pad:o}=n;return{x:()=>OT(e,i,r,s,a,o)}}},{kernelName:ic,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n,s=Va(r,i.shape),a=Ma(um(i.shape,s)[1]);return{x:()=>{const t=i.shape.slice();s.forEach(e=>{t[e]=1});const n=Tf(e,t);return Wp(jp(n,sg(i.shape,"float32")),a)}}}},{kernelName:rc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const i=n,{axis:r}=i,[s,a]=t,o=AT(e,a,s,Va(r,s.shape));return{x:()=>o.x()}}},LT,{kernelName:ac,inputsToSave:["x"],gradFunc:(e,t,n)=>{const i=t[0],{paddings:r}=n,s=r.map(e=>e[0]);return{x:()=>If(e,s,i.shape)}}},MT,FT,{kernelName:uc,gradFunc:e=>({x:()=>mp(e)})},{kernelName:gc,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>rg(n.shape,"float32")}}},{kernelName:mc,gradFunc:e=>({x:()=>im(e)})},{kernelName:bc,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:i}=n;return bb(e,i).map(e=>()=>e)}},$T,$T,BT,{kernelName:Tc,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,i]=t,r=Dm(n,0);return{x:()=>nm(r,e,jp(e,i)),alpha:()=>{let t=nm(r,im(e),jp(e,n));const s=vp(i.shape,e.shape);return s.length>0&&(t=_m(t,s)),Tf(t,i.shape)}}}},UT,{kernelName:kc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,mp(xm(n)))}}},{kernelName:Dc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,i=jp(zm(n,6),lb(n));return{x:()=>jp(e,Qh(i,"float32"))}}},{kernelName:Cc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,Qh(lb(n),"float32"))}}},{kernelName:Ec,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Tf(e,n.shape)}}},{kernelName:Nc,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[i]=t,r={dy:e,images:i};return{images:()=>ih.runKernel(Pc,r,n)}}},{kernelName:Ac,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[i]=t,r={dy:e,images:i};return{images:()=>ih.runKernel(Rc,r,n)}}},{kernelName:Oc,gradFunc:(e,t,n)=>{const{dims:i}=n,r=Va(i,e.shape);return{x:()=>Ug(e,r)}}},{kernelName:Lc,gradFunc:e=>({x:()=>im(e)})},{kernelName:Mc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mp(Wp(e,jp(ym(n,1.5),2)))}}},{kernelName:Bc,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>Qh(im(n),"float32"),t:()=>jp(e,Qh(n,e.dtype)),e:()=>jp(e,Qh(Zm(n),e.dtype))}}},{kernelName:zc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Dm(n,vm(0)),i=vm($y),r=vm(By),s=jp(e,r),a=jp(jp(e,i),km(Qh(n,"float32")));return nm(t,s,a)}}}},{kernelName:Wc,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,jp(n,qm(vm(1),n)))}}},{kernelName:Hc,gradFunc:e=>({x:()=>im(e)})},{kernelName:Gc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(Xf(Qh(n,"float32")),e)}}},{kernelName:Vc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(Kf(Qh(n,"float32")),e)}}},VT,{kernelName:Zc,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i]=t,{dim:r}=n,s=jp(e,i);return{logits:()=>qm(s,jp(_m(s,[r],true),i))}}},{kernelName:jc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,wf(n))}}},HT,HT,WT,WT,{kernelName:qc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,jp(Tm(Qh(n,"float32")),2))}}},jT,{kernelName:ru,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(e,jp(Qh(n,"float32"),2))}}},{kernelName:Tu,gradFunc:e=>({x:()=>im(e)})},qT,{kernelName:Xc,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,r=i.shape.slice(),{axis:s}=n;Va(s,i.shape).forEach(e=>{r[e]=1});const a=Tf(e,r),o=jp(a,sg(i.shape,"float32"));return{x:()=>o}}},{kernelName:uu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Wp(e,xm(Xf(n)))}}},{kernelName:du,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>jp(qm(vm(1),xm(n)),e)}}},XT,{kernelName:mu,gradFunc:(e,t,n)=>{const i=n,{perm:r}=i,s=fm(r);return{x:()=>bp(e,s)}}},{kernelName:bu,gradFunc:(e,t,n)=>{const i=n,{axis:r}=i;return{value:()=>ob(e,r)}}},KT,{kernelName:vu,gradFunc:e=>({x:()=>im(e)})}];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const a6 of YT)Pu(a6);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Ld().prototype.abs=function(){return this.throwIfDisposed(),qp(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.acos=function(){return this.throwIfDisposed(),Xp(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.acosh=function(){return this.throwIfDisposed(),Kp(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.add=function(e){return this.throwIfDisposed(),Vp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.all=function(e,t){return this.throwIfDisposed(),Yp(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.any=function(e,t){return this.throwIfDisposed(),Zp(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.argMax=function(e){return this.throwIfDisposed(),Qp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.argMin=function(e){return this.throwIfDisposed(),Jp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.asScalar=function(){return this.throwIfDisposed(),Pa(1===this.size,()=>"The array must have only 1 element."),Tf(this,[])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.asType=function(e){return this.throwIfDisposed(),Qh(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.as1D=function(){return this.throwIfDisposed(),Tf(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.as2D=function(e,t){return this.throwIfDisposed(),Tf(this,[e,t])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Tf(this,[e,t,n])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),Tf(this,[e,t,n,i])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.as5D=function(e,t,n,i,r){return this.throwIfDisposed(),Tf(this,[e,t,n,i,r])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.asin=function(){return this.throwIfDisposed(),ef(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.asinh=function(){return this.throwIfDisposed(),tf(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.atan=function(){return this.throwIfDisposed(),nf(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.atan2=function(e){return this.throwIfDisposed(),rf(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.atanh=function(){return this.throwIfDisposed(),sf(this)},Ld().prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),xf(this,e,t,n,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Cf(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.batchNorm=function(e,t,n,i,r){return this.throwIfDisposed(),Ef(this,e,t,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Df(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.cast=function(e){return this.throwIfDisposed(),Qh(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.ceil=function(){return this.throwIfDisposed(),Of(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Mf(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Od&&(e=[e]),Sf([this,...e],t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.conv1d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Gf(this,e,t,n,i,r,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.conv2dTranspose=function(e,t,n,i,r){return this.throwIfDisposed(),Hf(this,e,t,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.conv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Uf(this,e,t,n,i,r,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.cos=function(){return this.throwIfDisposed(),Xf(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.cosh=function(){return this.throwIfDisposed(),Kf(this)},
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Yf(this,e,t,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Zf(this,e,t,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Qf(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.depthwiseConv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Jf(this,e,t,n,i,r,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.dilation2d=function(e,t,n,i,r){return this.throwIfDisposed(),em(this,e,t,n,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.divNoNan=function(e){return this.throwIfDisposed(),rm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.div=function(e){return this.throwIfDisposed(),Wp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.dot=function(e){return this.throwIfDisposed(),sm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.elu=function(){return this.throwIfDisposed(),am(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.equal=function(e){return this.throwIfDisposed(),tm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.erf=function(){return this.throwIfDisposed(),om(this)},
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Im(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.exp=function(){return this.throwIfDisposed(),km(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.expandDims=function(e){return this.throwIfDisposed(),Cm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.expm1=function(){return this.throwIfDisposed(),Em(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.fft=function(){return this.throwIfDisposed(),eb(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.flatten=function(){return this.throwIfDisposed(),Tf(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.floor=function(){return this.throwIfDisposed(),Nm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.floorDiv=function(e){return this.throwIfDisposed(),Hp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.gather=function(e,t){return this.throwIfDisposed(),Pm(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Om(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.greater=function(e){return this.throwIfDisposed(),Dm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.ifft=function(){return this.throwIfDisposed(),tb(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.irfft=function(){return this.throwIfDisposed(),nb(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.isFinite=function(){return this.throwIfDisposed(),Lm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.isInf=function(){return this.throwIfDisposed(),Mm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.isNaN=function(){return this.throwIfDisposed(),Fm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.leakyRelu=function(e){return this.throwIfDisposed(),$m(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.lessEqual=function(e){return this.throwIfDisposed(),zm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.less=function(e){return this.throwIfDisposed(),Bm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.localResponseNormalization=function(e,t,n,i){return this.throwIfDisposed(),Um(this,e,t,n,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logSigmoid=function(){return this.throwIfDisposed(),jm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Xm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Km(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.log=function(){return this.throwIfDisposed(),Gm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.log1p=function(){return this.throwIfDisposed(),Vm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ym(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logicalNot=function(){return this.throwIfDisposed(),Zm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logicalOr=function(e){return this.throwIfDisposed(),Qm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.logicalXor=function(e){return this.throwIfDisposed(),Jm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),ap(this,e,t,n)},Ld().prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),eg(this,e,t,n,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.max=function(e,t){return this.throwIfDisposed(),gm(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.maximum=function(e){return this.throwIfDisposed(),ng(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.mean=function(e,t){return this.throwIfDisposed(),ig(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.min=function(e,t){return this.throwIfDisposed(),bm(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.minimum=function(e){return this.throwIfDisposed(),ag(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),og(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.mod=function(e){return this.throwIfDisposed(),lg(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.mul=function(e){return this.throwIfDisposed(),jp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.neg=function(){return this.throwIfDisposed(),mp(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.norm=function(e,t,n){return this.throwIfDisposed(),wm(this,e,t,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.notEqual=function(e){return this.throwIfDisposed(),ug(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),op(this,e,t,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.onesLike=function(){return this.throwIfDisposed(),dg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.pad=function(e,t){return this.throwIfDisposed(),hg(this,e,t)},Ld().prototype.pool=function(e,t,n,i,r,s){return this.throwIfDisposed(),fg(this,e,t,n,i,r,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.pow=function(e){return this.throwIfDisposed(),ym(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.prelu=function(e){return this.throwIfDisposed(),mg(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.prod=function(e,t){return this.throwIfDisposed(),gg(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.reciprocal=function(){return this.throwIfDisposed(),$g(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.relu=function(){return this.throwIfDisposed(),Bg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.relu6=function(){return this.throwIfDisposed(),zg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Tf(this,e.shape)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.reshape=function(e){return this.throwIfDisposed(),Tf(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Qb(this,e,t,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Jb(this,e,t,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.reverse=function(e){return this.throwIfDisposed(),Ug(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.rfft=function(){return this.throwIfDisposed(),rb(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.round=function(){return this.throwIfDisposed(),Gg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.rsqrt=function(){return this.throwIfDisposed(),Vg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.selu=function(){return this.throwIfDisposed(),Hg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.separableConv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),Wg(this,e,t,n,i,r,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sigmoid=function(){return this.throwIfDisposed(),wf(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sign=function(){return this.throwIfDisposed(),jg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sin=function(){return this.throwIfDisposed(),qg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sinh=function(){return this.throwIfDisposed(),Xg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.slice=function(e,t){return this.throwIfDisposed(),If(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.softmax=function(e){return this.throwIfDisposed(),Jg(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.softplus=function(){return this.throwIfDisposed(),Wm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),pg(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.split=function(e,t){return this.throwIfDisposed(),ib(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sqrt=function(){return this.throwIfDisposed(),Tm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.square=function(){return this.throwIfDisposed(),xm(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.squaredDifference=function(e){return this.throwIfDisposed(),sb(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.squeeze=function(e){return this.throwIfDisposed(),ab(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Od?[this,e]:[this,...e];return ob(n,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.step=function(e){return this.throwIfDisposed(),lb(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.stridedSlice=function(e,t,n,i,r,s,a,o){return this.throwIfDisposed(),cb(this,e,t,n,i,r,s,a,o)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sub=function(e){return this.throwIfDisposed(),qm(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.sum=function(e,t){return this.throwIfDisposed(),_m(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.tan=function(){return this.throwIfDisposed(),ub(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.tanh=function(){return this.throwIfDisposed(),kf(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.tile=function(e){return this.throwIfDisposed(),Am(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.toBool=function(){return this.throwIfDisposed(),Qh(this,"bool")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.toFloat=function(){return this.throwIfDisposed(),Qh(this,"float32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.toInt=function(){return this.throwIfDisposed(),Qh(this,"int32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.topk=function(e,t){return this.throwIfDisposed(),pb(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.transpose=function(e){return this.throwIfDisposed(),bp(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.unique=function(e){return this.throwIfDisposed(),mb(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),gb(this,e,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.unstack=function(e){return this.throwIfDisposed(),bb(this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.where=function(e,t){return this.throwIfDisposed(),nm(e,this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Ld().prototype.zerosLike=function(){return this.throwIfDisposed(),im(this)};
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class ZT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ZT.prototype)}}class QT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,QT.prototype)}}class JT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,JT.prototype)}}class ex extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ex.prototype)}}class tx extends Error{constructor(e){super(e),Object.setPrototypeOf(this,tx.prototype)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nx{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ix(e,t){if(Array.isArray(e)){let n=[];for(let i=0;i<t;i++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function rx(e,t){if(!e)throw new tx(t)}function sx(e,t){let n=0;for(const i of e)i===t&&n++;return n}function ax(e){return 1===e.length?e[0]:e}function ox(e){return Array.isArray(e)?e:[e]}function lx(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function cx(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ux={};function dx(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function hx(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach(e=>hx(e));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"==typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!=typeof t.value?hx(t):e[n]=t.value)}}}function px(e,t={},n={},i="object",r=!1){if("string"==typeof e){const r=e;let s;if(r in n)s=n[r];else if(r in ux)s=ux[r];else if(s=t[r],null==s)throw new JT(`Unknown ${i}: ${e}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=e;if(null==s.className||null==s.config)throw new JT(`${i}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const a=s.className;let o,l;if(a in n?[o,l]=n[a]:a in ux?[o,l]=ux.className:a in t&&([o,l]=t[a]),null==o)throw new JT(`Unknown ${i}: ${a}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const e={};for(const n of Object.keys(ux))e[n]=ux[n];for(const r of Object.keys(n))e[r]=n[r];s.config.customObjects=e;const t=Object.assign({},ux);for(const r of Object.keys(n))ux[r]=n[r];hx(s.config);const i=l(o,s.config,n,r);return ux=Object.assign({},t),i}{const e=Object.assign({},ux);for(const i of Object.keys(n))ux[i]=n[i];const t=new o(s.config);return ux=Object.assign({},e),t}}}function fx(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function mx(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function gx(e){if(null==e)throw new JT(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function bx(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new JT(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function yx(e,t,n=0,i=1/0){return rx(n>=0),rx(i>=n),Array.isArray(e)&&e.length>=n&&e.length<=i&&e.every(e=>typeof e===t)}function vx(e,t){Array.isArray(e)?(Pa(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((e,n)=>vx(e,`element ${n+1} of ${t}`))):Pa(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${Tx(e)}.`)}function Tx(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>Tx(e)).join(",")+"]":"string"==typeof e?`"${e}"`:`${e}`}function xx(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let _x=0;function Sx(){return _x++}const wx={};function Ix(e=""){return e in wx||(wx[e]=0),wx[e]+=1,e+wx[e].toString()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kx=["channelsFirst","channelsLast"],Cx=["nearest","bilinear"],Ex=["valid","same","causal"],Ax=["max","avg"],Rx=["sum","mul","concat","ave"],Nx=new Map;function Px(e){bx(kx,"DataFormat",e)}function Dx(e){bx(Ex,"PaddingMode",e)}function Ox(e){bx(Ax,"PoolMode",e)}const Lx=[];function Mx(e,t){Lx.push(e);try{const e=t();return Lx.pop(),e}catch(r6){throw Lx.pop(),r6}}function Fx(e){if(!zx(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Lx.length?"":Lx.join("/")+"/")+e}function $x(e){if(!zx(e))throw new Error("Not a valid tensor name: '"+e+"'");Nx.has(e)||Nx.set(e,0);const t=Nx.get(e);if(Nx.set(e,Nx.get(e)+1),t>0){const n=`${e}_${t}`;return Nx.set(n,1),n}return e}const Bx=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function zx(e){return!!e.match(Bx)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ux(e){return e===parseInt(e.toString(),10)}function Gx(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let i=1;for(let r=t;r<n;++r)i*=e[r];return i}function Vx(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const i=e[n];i<t&&(t=i)}return t}function Hx(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const i=e[n];i>t&&(t=i)}return t}function Wx(e,t){if(t<e)throw new JT(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let i=e;i<t;++i)n.push(i);return n}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let jx;function qx(){return null==jx&&(jx=ih.backend.epsilon()),jx}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Xx(e,t){return Qh(e,t)}function Kx(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),Tf(e,n)}function Yx(e,t,n){return up(()=>{switch(e.rank){case 1:return Kg(e,t,n);case 2:return Yg(e,[t,0],[n,e.shape[1]]);case 3:return Zg(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Qg(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return If(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return If(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new JT(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Zx(e,t,n){return up(()=>{switch(e.rank){case 1:return Kg(e,t,n);case 2:return Yg(e,[0,t],[e.shape[0],n]);case 3:return Zg(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Qg(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new JT(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Qx(e,t,n,i){return up(()=>{switch(e.rank){case 1:return Kg(e,t,n);case 2:switch(i){case 1:return Yx(e,t,n);case 2:return Zx(e,t,n);default:throw new JT(`The axis is not within the rank of the tensor ${i}`)}case 3:switch(i){case 1:return Yx(e,t,n);case 2:return Zg(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Zx(e,t,n);default:throw new JT(`The axis is not within the rank of the tensor ${i}`)}case 4:switch(i){case 1:return Yx(e,t,n);case 2:return Qg(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Qg(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Zx(e,t,n);default:throw new JT(`The axis is not within the rank of the tensor ${i}`)}default:throw new JT(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Jx(e,t=-1){let n;return t<0&&(n=e[0].rank,t=0!==n?n:0),t===e[0].rank&&(t=-1),Sf(e,t)}function e_(e,t){switch(e.rank){case 1:return Ff([e,t]);case 2:return $f([e,t],0);case 3:return Bf([e,t],0);case 4:return zf([e,t],0);default:throw new JT(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function t_(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new JT(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return Am(e,t)}function n_(e,t=0,n=1,i,r){return Lg(e,t,n,i,r)}function i_(e,t,n,i){if(e.rank<2||t.rank<2)throw new ex(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new ex(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(2===e.rank&&2===t.rank){return Ab({a:e,b:t,transposeA:!1,transposeB:!1,bias:i?a_(e.rank,i,"channelsLast"):null,activation:n})}{const r=e.shape.slice(),s=r.pop();e=Tf(e,[-1,s]);const a=t.shape.slice(),o=a.pop(),l=a.pop(),c=[...a,o],u=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=Tf(bp(t,u),[l,-1]);const d=[...r,...c];return Tf(Ab({a:e,b:t,transposeA:!1,transposeB:!1,bias:i?a_(e.rank,i,"channelsLast"):null,activation:n}),d)}}function r_(e,t,n){return up(()=>(t=Array.isArray(t)?db(t,"int32"):Qh(t,"int32"),Pm(e,t,n)))}function s_(e){return jp(e,e)}function a_(e,t,n){const i=t.shape;if(1!==t.rank&&t.rank!==e)throw new JT(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(5===e){if("channelsFirst"===n)return 1===i.length?Tf(t,[1,i[0],1,1,1]):Tf(t,[1,i[3],i[0],i[1],i[2]]);if("channelsLast"===n)return 1===i.length?Tf(t,[1,1,1,1,i[0]]):Tf(t,[1].concat(i))}else if(4===e){if("channelsFirst"===n)return 1===i.length?Tf(t,[1,i[0],1,1]):Tf(t,[1,i[2],i[0],i[1]]);if("channelsLast"===n)return 1===i.length?Tf(t,[1,1,1,i[0]]):Tf(t,[1].concat(i))}else if(3===e){if("channelsFirst"===n)return 1===i.length?Tf(t,[1,i[0],1]):Tf(t,[1,i[1],i[0]]);if("channelsLast"===n)return 1===i.length?Tf(t,[1,1,i[0]]):Tf(t,[1].concat(i))}else if(e<3)return t;throw new JT(`Unsupported input rank by biasAdd: ${t.rank}`)}function o_(e,t,n){return up(()=>(null==n&&(n="channelsLast"),Px(n),Vp(e,a_(e.rank,t,n))))}function l_(e,t,n,i){return up(()=>vb(e,t,n,i))}function c_(e,t,n=!1){return n?e():t()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const u_=["fanIn","fanOut","fanAvg"],d_=["normal","uniform","truncatedNormal"];class h_ extends zp{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class p_ extends h_{apply(e,t){return rg(e,t)}}p_.className="Zeros",Gp(p_);class f_ extends h_{apply(e,t){return sg(e,t)}}f_.className="Ones",Gp(f_);class m_ extends h_{constructor(e){if(super(),"object"!=typeof e)throw new JT(`Expected argument of type ConstantConfig but got ${e}`);if(void 0===e.value)throw new JT(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return up(()=>jp(vm(this.value),sg(e,t)))}getConfig(){return{value:this.value}}}m_.className="Constant",Gp(m_);class g_ extends h_{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Mg(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}g_.className="RandomUniform",Gp(g_);class b_ extends h_{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new ex(`randomNormal does not support dType ${t}.`);return n_(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}b_.className="RandomNormal",Gp(b_);class y_ extends h_{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new ex(`truncatedNormal does not support dType ${t}.`);return fb(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}y_.className="TruncatedNormal",Gp(y_);class v_ extends h_{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return up(()=>{if(2!==e.length||e[0]!==e[1])throw new JT("Identity matrix initializer can only be used for 2D square matrices.");return jp(this.gain,Rm(e[0]))})}getConfig(){return{gain:this.gain}}}v_.className="Identity",Gp(v_);class T_ extends h_{constructor(e){if(super(),e.scale<0)throw new JT(`scale must be a positive float. Got: ${e.scale}`);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var t;this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,t=this.mode,bx(u_,"FanMode",t),this.distribution=null==e.distribution?"normal":e.distribution,function(e){bx(d_,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e,t="channelsLast"){let n,i;if(Px(t),2===e.length)n=e[0],i=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){const t=Gx(e,2);n=e[1]*t,i=e[0]*t}else if("channelsLast"===t){const t=Gx(e,0,e.length-2);n=e[e.length-2]*t,i=e[e.length-1]*t}}else{const t=Gx(e);n=Math.sqrt(t),i=Math.sqrt(t)}return[n,i]}(e),i=n[0],r=n[1];let s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,i):"fanOut"===this.mode?s/=Math.max(1,r):s/=Math.max(1,(i+r)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new ex(`${this.getClassName()} does not support dType ${t}.`);return fb(e,0,n,t,this.seed)}{const n=Math.sqrt(3*s);return Mg(e,-n,n,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}T_.className="VarianceScaling",Gp(T_);class x_ extends T_{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return T_.className}}x_.className="GlorotUniform",Gp(x_);class __ extends T_{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return T_.className}}__.className="GlorotNormal",Gp(__);class S_ extends T_{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return T_.className}}S_.className="HeNormal",Gp(S_);class w_ extends T_{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return T_.className}}w_.className="HeUniform",Gp(w_);class I_ extends T_{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return T_.className}}I_.className="LeCunNormal",Gp(I_);class k_ extends T_{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return T_.className}}k_.className="LeCunNormal",Gp(k_);class C_ extends h_{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,null!=this.seed)throw new ex("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return up(()=>{if(e.length<2)throw new ex("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const t=n_(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32");let n=uy.gramSchmidt(t);return e[0]>e[1]&&(n=bp(n)),jp(this.gain,n)})}getConfig(){return{gain:this.gain,seed:this.seed}}}C_.className="Orthogonal",Gp(C_);const E_={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function A_(e,t={}){return px(e,Up.getMap().classNameMap,t,"initializer")}function R_(e){return dx(e)}function N_(e){if("string"==typeof e){const t=e in E_?E_[e]:e;if("GlorotNormal"===t)return new __;if("GlorotUniform"===t)return new x_;if("HeNormal"===t)return new S_;if("HeUniform"===t)return new w_;if("LeCunNormal"===t)return new I_;if("LeCunUniform"===t)return new k_;{const e={};return e.className=t,e.config={},A_(e)}}return e instanceof h_?e:A_(e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P_(e){return Array.isArray(e)&&Array.isArray(e[0])}function D_(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function O_(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new JT(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function L_(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new JT(`Expected exactly 1 Shape; got ${e.length}`)}return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function M_(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce((e,t)=>e*t);return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const F_="Variable";class $_{constructor(e,t="float32",n=F_,i=!0,r=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=Sx(),n=null==n?F_:n,this.originalName=Fx(n),this.name=$x(this.originalName),this.trainable_=i,this.constraint=r,this.val=function(e,t=!0,n,i){return ih.makeVariable(e,t,n,i)}(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function B_(e){return e.map(e=>e.read())}function z_(e){e.forEach(e=>{e[0].write(e[1])})}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class U_{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class G_{constructor(e,t,n,i,r,s,a){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=Sx(),null!=s&&(this.originalName=Fx(s),this.name=$x(this.originalName)),this.rank=t.length}}let V_=0;class H_{constructor(e,t){this.callArgs=t,this.id=V_++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let W_=0;class j_ extends zp{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=W_++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=lx(e)+"_"+Ix(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new QT(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new JT(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return ax(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ax(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ZT(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new ZT(`Layer ${this.name} is not connected, no input to return.`);return ax(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new ZT(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ZT(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return ax(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=ox(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=ox(this.inputSpec);if(e.length!==t.length)throw new JT(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(null==r)continue;const s=i.rank;if(null!=r.ndim&&s!==r.ndim)throw new JT(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${r.ndim}, found ndim=${s}`);if(null!=r.maxNDim&&s>r.maxNDim)throw new JT(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${r.maxNDim}, found ndim=${s}`);if(null!=r.minNDim&&s<r.minNDim)throw new JT(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${r.minNDim}, found ndim=${s}.`);if(null!=r.dtype&&i.dtype!==r.dtype)throw new JT(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${r.dtype}, found dtype=${i.dtype}.`);if(r.axes){const e=i.shape;for(const t in r.axes){const i=Number(t),s=r.axes[t],a=i>=0?e[i]:e[e.length+i];if(null!=s&&-1===[s,null].indexOf(a))throw new JT(`Input ${n} is incompatible with layer ${this.name}: expected axis ${i} of input shape to have value ${s} but got shape ${e}.`)}}if(null!=r.shape)for(let e=0;e<r.shape.length;++e){const t=r.shape[e],s=i.shape[e];if(null!=t&&null!=s&&t!==s)throw new JT(`Input ${n} is incompatible with layer ${this.name}: expected shape=${r.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=ox(e);let i=!0;for(const s of n)if(!(s instanceof G_)){i=!1;break}let r=!0;for(const s of n)if(s instanceof G_){r=!1;break}if(i===r)throw new JT("Arguments to apply() must be all SymbolicTensors or all Tensors");return Mx(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of ox(e))t.push(n.shape);this.build(ax(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let i=this.call(e,t);const r=ox(i),s=[];for(let e of r)-1!==n.indexOf(e)&&(e=e.clone()),s.push(e);if(i=ax(s),null!=this.activityRegularizer)throw new ex("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}{const n=function(e){e=ox(e);const t=[];for(const n of e)t.push(n.shape);return ax(t)}(e),i=this.computeOutputShape(n);let r;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),r=null!=i&&i.length>0&&Array.isArray(i[0])?i.map((n,i)=>new G_(s,n,this,ox(e),t,this.name,i)):new G_(s,i,this,ox(e),t,this.name),this.addInboundNode(e,r,null,null,n,i,t),this._refCount++,null!=this.activityRegularizer)throw new ex("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((n,i)=>{null!=n&&null!=e[i]&&e[i]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new ZT(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new ZT(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new QT(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return M_(this.weights)}build(e){this.built=!0}getWeights(e=!1){return B_(e?this.trainableWeights:this.weights)}setWeights(e){up(()=>{const t=this.weights;if(t.length!==e.length)throw new JT(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;const n=[],i=B_(t);for(let r=0;r<i.length;++r){const s=i[r],a=t[r],o=e[r];if(!Fa(s.shape,o.shape))throw new JT(`Layer weight shape ${s.shape} not compatible with provided weight shape ${o.shape}`);n.push([a,o])}z_(n)})}addWeight(e,t,n,i,r,s,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new JT(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(i=null!=o?o():N_("zeros"));const l=i.apply(t,n),c=new $_(l,n,e,s,a);return l.dispose(),null!=r&&this.addLoss(()=>r.apply(c.read())),null==s&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=ox(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);t.forEach(e=>{if(null!=e)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)})}return null}return t}addInboundNode(e,t,n,i,r,s,a=null){const o=ox(e);t=ox(t),n=ox(n),i=ox(i),r=D_(r),s=D_(s);const l=[],c=[],u=[];for(const d of o)l.push(d.sourceLayer),c.push(d.nodeIndex),u.push(d.tensorIndex);new H_({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:u,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:s},a);for(let d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function q_(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const i=q_(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of i)-1===t.indexOf(e)&&t.push(e)}return t}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class X_ extends j_{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:Ix("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new JT("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new JT("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new JT("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const i=new G_(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new H_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new JT(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}X_.className="InputLayer",Gp(X_);class K_{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof K_)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new JT(`Duplicate key: name=${e.name}, id=${e.id}`);return this.id2Value[e.id]=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Qh(t,e.dtype)}catch(s6){throw new JT(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof G_){if(null==this.id2Value[e.id])throw new JT(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new JT(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof G_){if(null==this.id2Value[e.id])throw new JT(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new JT(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&dp(this.id2Mask)}}const Y_=new nx,Z_=new nx;function Q_(e,t,n,i){const r=null!=n&&n.training,s=Array.isArray(e),a=s?e:[e],o=a.map(e=>e.name),l=[],c=t.names();for(const f of o)-1!==c.indexOf(f)?l.push(t.getValue(f)):l.push(null);null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const u=o.join(",")+"|"+t.names().sort().join(",");let d,h=Y_.get(u);if(null==h){const e=function(e,t){Pa(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],i={};if(1===e.length){const r=eS(e[0],t);n=r.sorted,i=r.recipientMap}else{const r=new Set;for(const s of e){const{sorted:e,recipientMap:a}=eS(s,t);for(const t of e)r.has(t.name)||(n.push(t),r.add(t.name));for(const t in a)null==i[t]&&(i[t]=new Set),a[t].forEach(e=>i[t].add(e))}}return{sorted:n,recipientCounts:J_(i)}}(a,t);h=e.sorted,d=e.recipientCounts,Y_.put(u,h),Z_.put(u,d)}d={},r||Object.assign(d,Z_.get(u));const p=new K_(t);for(let f=0;f<h.length;++f){if(null!=i){const e=cp().numTensors;e>i.maxNumTensors&&(i.maxNumTensors=e),e<i.minNumTensors&&(i.minNumTensors=e)}const e=h[f],s=e.sourceLayer;if(s instanceof X_)continue;const a=[],c=[],u=[];let m=!1;for(const n of e.inputs){const e=p.getValue(n),i=p.getMask(n);a.push(e),c.push(i),null!=i&&(m=!0),r||(d[n.name]--,0!==d[n.name]||t.hasKey(n)||-1!==o.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||u.push(e))}m&&((n=n||{}).mask=c[0]);const g=ox(s.apply(a,n));let b=null;s.supportsMasking&&(b=s.computeMask(a,c));const y=tS(e),v=Array.isArray(y)?y:[y];for(let t=0;t<v.length;++t){p.hasKey(v[t])||p.add(v[t],g[t],Array.isArray(b)?b[0]:b);const e=o.indexOf(v[t].name);-1!==e&&(l[e]=g[t])}r||dp(u)}return p.disposeMasks(),s?l:l[0]}function J_(e){const t={};for(const n in e)t[n]=e[n].size;return t}function eS(e,t){const n=new Set,i=[],r={};for(const o of t.names())n.add(o);const s=[],a=[];for(s.push(e);s.length>0;){const e=s[s.length-1];if(n.has(e.name)){s.pop();continue}const t=a[a.length-1]===s.length-1;if(0===e.inputs.length||t)s.pop(),i.push(e),n.add(e.name),t&&a.pop();else{a.push(s.length-1);for(const t of e.inputs)null==r[t.name]&&(r[t.name]=new Set),r[t.name].add(e.name),n.has(t.name)||s.push(t)}}return{sorted:i,recipientMap:r}}function tS(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const i of e.sourceLayer.inboundNodes[t].outputTensors)if(i.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function nS(e,t){return up(()=>Tm(_m(jp(e,e),t,!0)))}mo().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,function(e){null!=Y_&&Y_.setMaxEntries(e),null!=Z_&&Z_.setMaxEntries(e)});class iS extends zp{getConfig(){return{}}}class rS extends iS{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return up(()=>{const t=nS(e,this.axis),n=Mf(t,0,this.maxValue);return jp(e,Wp(n,Vp(qx(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}rS.className="MaxNorm",Gp(rS);class sS extends iS{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return up(()=>Wp(e,Vp(qx(),nS(e,this.axis))))}getConfig(){return{axis:this.axis}}}sS.className="UnitNorm",Gp(sS);class aS extends iS{apply(e){return Bg(e)}}aS.className="NonNeg",Gp(aS);class oS extends iS{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return up(()=>{const t=nS(e,this.axis),n=Vp(jp(this.rate,Mf(t,this.minValue,this.maxValue)),jp(1-this.rate,t));return jp(e,Wp(n,Vp(qx(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}oS.className="MinMaxNorm",Gp(oS);const lS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function cS(e){return dx(e)}function uS(e,t={}){return px(e,Up.getMap().classNameMap,t,"constraint")}function dS(e){if(null==e)return null;if("string"==typeof e){return uS({className:e in lS?lS[e]:e,config:{}})}return e instanceof iS?e:uS(e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function hS(e){if(null==e)return;const t=[],n=[],i=[];for(const r in e){const s=e[r];if("number"!=typeof s){const e=s;t.push(e.data()),n.push(r),i.push(e)}}if(t.length>0){const r=await Promise.all(t);for(let t=0;t<r.length;++t)e[n[t]]=r[t][0];dp(i)}}function pS(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var fS,mS;(mS=fS||(fS={}))[mS.SILENT=0]="SILENT",mS[mS.VERBOSE=1]="VERBOSE";class gS{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class bS{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class yS extends gS{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const i in t){const e=t[i];if("number"==typeof e)this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+e*n;else{let t;i in this.totals?t=this.totals[i]:this.totals[i]=0;const r=up(()=>Vp(this.totals[i],jp(e,n)));this.totals[i]=r,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?t[n]=this.totals[n]/this.seen:up(()=>{const e=jp(Wp(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),hp(t[n])}))}}class vS extends gS{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const r in this.history){const i=this.history[r];for(let s=0;s<i.length;++s)if("number"!=typeof i[s]){const a=i[s];e.push(a.data()),t.push(r),n.push(s)}}const i=await Promise.all(e);for(let r=0;r<i.length;++r){this.history[t[r]][n[r]].dispose(),this.history[t[r]][n[r]]=i[r][0]}}}class TS extends gS{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||_y,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Za(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let i,r=null!=n?n():Td();return(...s)=>{const a=null!=n?n():Td();return a-r<t||(r=a,i=e(...s)),i}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const i=[];null!=this.yield&&(await hS(n),i.push(this.yield(e,t,n))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await hS(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await hS(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await hS(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await hS(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):Za(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await hS(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await hS(e),await this.trainEnd(e))}}function xS(e,t){if(null==e&&(e={}),e instanceof gS)return[e];if(Array.isArray(e)&&e[0]instanceof gS)return e;return ox(e).map(e=>new TS(e,t))}class _S{constructor(){}static registerCallbackConstructor(e,t){Pa(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),_S.checkForDuplicate(t),null==_S.constructors[e]&&(_S.constructors[e]=[]),_S.constructors[e].push(t)}static checkForDuplicate(e){for(const t in _S.constructors){_S.constructors[+t].forEach(t=>{if(t===e)throw new JT("Duplicate callback constructor.")})}}static clear(){_S.constructors={}}static createCallbacks(e){const t=[];for(const n in _S.constructors){const i=+n;e>=i&&t.push(..._S.constructors[i])}return t.map(e=>new e)}}function SS(e,t,n,i,r,s,a,o,l){const c=new vS,u=[new yS,..._S.createCallbacks(t)];null!=e&&u.push(...e),u.push(c);const d=new bS(u);return d.setParams({epochs:n,initialEpoch:i,samples:r,steps:s,batchSize:a,verbose:t,doValidation:o,metrics:l}),{callbackList:d,history:c}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wS(e,t={},n=!1){return px(e,Up.getMap().classNameMap,t,"layer",n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function IS(e,t){return up(()=>{"float32"!==e.dtype&&(e=Qh(e,"float32"));const n=_m(s_(e),t,!0),i=Lf(n.shape,qx()),r=Tm(ng(n,i));return Wp(e,r)})}function kS(e,t){return up(()=>ig(s_(qm(t,e)),-1))}function CS(e,t){return up(()=>ig(qp(qm(t,e)),-1))}function ES(e,t){return up(()=>{const n=qm(e,t),i=Mf(qp(e),qx(),Number.MAX_VALUE),r=qp(Wp(n,i));return jp(100,ig(r,-1))})}function AS(e,t,n=!1){return up(()=>{if(n)t=Jg(t);else{const e=_m(t,t.shape.length-1,!0);t=Wp(t,e)}return t=Mf(t,qx(),1-qx()),mp(_m(jp(Qh(e,"float32"),Gm(t)),t.shape.length-1))})}function RS(e,t,n=!1){return up(()=>{const i=Qh(Nm(function(e){const t=[Gx(e.shape)];return Tf(e,t)}(e)),"int32"),r=(t=Mf(t,qx(),1-qx())).shape;return AS(Tf(op(i,r[r.length-1]),r),t,n)})}function NS(e,t){return up(()=>{let n;return n=Mf(t,qx(),1-qx()),n=Gm(Wp(n,qm(1,n))),ig(function(e,t){if(!Fa(e.shape,t.shape))throw new JT(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return up(()=>{const n=Bg(t),i=mp(qp(t));return Vp(qm(n,jp(t,e)),Vm(km(i)))})}(e,n),-1)})}function PS(e,t){return up(()=>{const n=IS(e,-1),i=IS(t,-1),r=jp(n,i);return mp(_m(r,-1))})}_S.constructors={};const DS={meanSquaredError:kS,meanAbsoluteError:CS,meanAbsolutePercentageError:ES,meanSquaredLogarithmicError:function(e,t){return up(()=>{const n=Mf(t,qx(),Number.MAX_VALUE),i=Gm(Vp(1,n)),r=Mf(e,qx(),Number.MAX_VALUE),s=Gm(Vp(1,r));return ig(s_(qm(i,s)),-1)})},squaredHinge:function(e,t){return up(()=>{const n=ng(0,qm(1,jp(e,t)));return ig(s_(n),-1)})},hinge:function(e,t){return up(()=>{const n=ng(0,qm(1,jp(e,t)));return ig(n,-1)})},categoricalHinge:function(e,t){return up(()=>{const n=_m(jp(e,t),-1),i=gm(jp(qm(1,e),t),-1);return ng(0,Vp(1,qm(i,n)))})},logcosh:function(e,t){return up(()=>{const n=Math.log(2),i=qm(t,e),r=qm(Vp(i,Wm(jp(-2,i))),n);return ig(r,-1)})},categoricalCrossentropy:AS,sparseCategoricalCrossentropy:RS,binaryCrossentropy:NS,kullbackLeiblerDivergence:function(e,t){return up(()=>{const n=Mf(e,qx(),1),i=Mf(t,qx(),1);return _m(jp(e,Gm(Wp(n,i))),-1)})},poisson:function(e,t){return up(()=>{const n=Gm(Vp(qx(),t));return ig(qm(t,jp(e,n)),-1)})},cosineProximity:PS};function OS(e){if("string"==typeof e){if(e in DS)return DS[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new JT(t)}return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LS(e,t){return up(()=>{const n=jp(.5,dg(t)),i=Xx(Dm(t,n),e.dtype);return ig(tm(e,i),-1)})}function MS(e,t){return up(()=>Xx(tm(Qp(e,-1),Qp(t,-1)),"float32"))}function FS(e,t){return NS(e,t)}function $S(e,t){return e.rank===t.rank&&(e=ab(e,[e.rank-1])),(t=Qp(t,-1)).dtype!==e.dtype&&(t=Qh(t,e.dtype)),Qh(tm(e,t),"float32")}const BS=AS,zS=RS,US={binaryAccuracy:LS,categoricalAccuracy:MS,precision:function(e,t){return up(()=>{const n=function(e,t){return up(()=>Qh(_m(Ym(tm(e,1),tm(t,1))),"float32"))}(e,t),i=function(e,t){return up(()=>Qh(_m(Ym(tm(e,0),tm(t,1))),"float32"))}(e,t),r=Vp(n,i);return Qh(nm(Dm(r,0),Wp(n,r),0),"float32")})},categoricalCrossentropy:BS,sparseCategoricalCrossentropy:zS,mse:kS,MSE:kS,mae:CS,MAE:CS,mape:ES,MAPE:ES,cosine:PS};function GS(e){if("string"==typeof e&&e in US)return US[e];if("string"!=typeof e&&null!=e)return e;throw new JT(`Unknown metric ${e}`)}function VS(e){if(rx(null!==e,`Unknown LossOrMetricFn ${e}`),"string"==typeof e)return e;{let t;for(const n of Object.keys(DS))if(DS[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(US))if(US[n]===e){t=n;break}return void 0!==t?t:e.name}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const HS=1048576;function WS(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!jS(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>HS&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function jS(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!=typeof n)return!1;if(!jS(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!jS(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qS(e,t,n,i=console.log){const r=function(e){let t=!0;const n=[],i=[];for(const r in e.nodesByDepth)n.push(e.nodesByDepth[r]);for(const r of n){if(r.length>1||1===r.length&&r[0].inboundLayers.length>1){t=!1;break}i.push(...r)}if(t)for(const r of e.layers){let e=!1;for(const n of r.inboundNodes)if(-1!==i.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),s=["Layer (type)","Input Shape","Output shape","Param #"];let a;if(r?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!r){s.push("Receives inputs"),a=[];for(const t in e.nodesByDepth)a.push(...e.nodesByDepth[t])}i("_".repeat(t)),XS(s,n,i),i("=".repeat(t));const o=e.layers;for(let u=0;u<o.length;++u)r?KS(o[u],n,i):YS(o[u],n,a,i),i((u===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;t=null!=e.collectedTrainableWeights?M_(e.collectedTrainableWeights):M_(e.trainableWeights);return t}(e),c=M_(e.nonTrainableWeights);i(`Total params: ${l+c}`),i(`Trainable params: ${l}`),i(`Non-trainable params: ${c}`),i("_".repeat(t))}function XS(e,t,n=console.log){let i="";for(let r=0;r<e.length;++r)r>0&&(i=i.slice(0,i.length-1)+" "),i+=e[r],i=i.slice(0,t[r]),i+=" ".repeat(t[r]-i.length);n(i)}function KS(e,t,n){let i,r;try{r=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(s6){r="multiple"}try{i=JSON.stringify(e.outputShape)}catch(s6){i="multiple"}XS([`${e.name} (${e.getClassName()})`,r,i,e.countParams().toString()],t,n)}function YS(e,t,n,i){let r,s;try{s=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(s6){s="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s6){r="multiple"}const a=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e){const t=u.inboundLayers[e].name,n=u.nodeIndices[e],i=u.tensorIndices[e];a.push(`${t}[${n}][${i}]`)}const o=e.name,l=e.getClassName(),c=0===a.length?"":a[0];XS([`${o} (${l})`,s,r,e.countParams().toString(),c],t,i);for(let u=1;u<a.length;++u)XS(["","","","",a[u]],t,i)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ZS(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function QS(e,t){if(null===e)return null;if("string"==typeof e)return cx(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];ZS(t,r,i)?n.push(i):n.push(QS(i,t))}return n}{const t={};for(const n of Object.keys(e)){const i=e[n];if("name"===n&&"string"==typeof i)t[n]=i;else{const e=cx(n);t[e]=QS(i,e)}}return t}}function JS(e,t){if(null==e)return null;if("string"==typeof e)return lx(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];ZS(t,r,i)?n.push(i):n.push(JS(i,t))}return n}{const t={};for(const n of Object.keys(e)){const i=e[n],r=lx(n);t[r]="name"!==n&&"className"!==n||"string"!=typeof i?JS(i,n):i}return t}}
/** @license See the LICENSE file. */const ew="3.21.0";
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tw extends j_{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=Ix(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],mx(this.inputs).length!==this.inputs.length)throw new JT(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(e=>e.name)}`);mx(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(e=>e.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const e=b.sourceLayer,t=b.nodeIndex,n=b.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const b of this.inputs){const e=b.sourceLayer,t=b.nodeIndex,n=b.tensorIndex;rx(0===t,"input layer has >1 nodes"),rx(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const t=this.inputLayers[b];if(!(t instanceof X_))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${t.getClassName()}.`);this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},i={},r={},s={},a=[],o=(e,t,n,i,r,l)=>{null!=i&&null!=r&&null!=l||(i=e.sourceLayer,r=e.nodeIndex,l=e.tensorIndex);const c=i.inboundNodes[r];if(-1!==n.indexOf(c))throw new QT(`The tensor ${e.name} at layer "${i.name}" is part of a cycle.`);if(-1!==t.indexOf(c))return;this.containerNodes.add(tw.nodeKey(i,r)),i.id in s||(s[i.id]=Object.keys(s).length),-1===n.indexOf(c)&&n.push(c);const u=c.inboundLayers.length;for(let s=0;s<u;s++){const e=c.inputTensors[s],i=c.inboundLayers[s],r=c.nodeIndices[s],a=c.tensorIndices[s];o(e,t,n,i,r,a)}for(t.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);a.push(c)},l=[],c=[];for(const b of this.outputs)o(b,l,c);const u=a.slice().reverse();for(const b of u){n[b.id]=b,b.id in t||(t[b.id]=0);let e=t[b.id];const s=null==i[b.outboundLayer.id]?0:i[b.outboundLayer.id];e=Math.max(e,s),i[b.outboundLayer.id]=e,r[b.outboundLayer.id]=b.outboundLayer,t[b.id]=e;for(let i=0;i<b.inboundLayers.length;i++){const r=b.inboundLayers[i],s=b.nodeIndices[i],a=r.inboundNodes[s],o=null==t[a.id]?0:t[a.id];t[a.id]=Math.max(e+1,o),n[a.id]=a}}const d={};for(const b in t){const e=t[b];e in d||(d[e]=[]),d[e].push(n[b])}const h={};for(const b in i){const e=i[b];e in h||(h[e]=[]),h[e].push(r[b])}let p=Object.keys(h).map(e=>parseInt(e,10)).sort(fx);this.layers=[];for(const b of p){const e=h[b];e.sort((e,t)=>{const n=s[e.id],i=s[t.id];return n<i?-1:n>i?1:0});for(const t of e)t instanceof tw&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=h,p=Object.keys(d).map(e=>parseInt(e,10)).sort(fx);const f=this.inputs.slice(),m=[];for(const b of p)for(const e of d[b]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new QT(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${m}`);for(const t of e.outputTensors)f.push(t);m.push(t.name)}}this.nodesByDepth=d;const g=this.layers.map(e=>e.name);for(const b of g){const e=g.filter(e=>e===b).length;if(1!==e)throw new QT(`The name "${b}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new H_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new JT("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const n={};let i=0;for(const s of this.layers)for(const e of s.weights){if(null!=n[e.originalName])throw new JT(`Duplicate weight name: ${e.originalName}`);n[e.originalName]=e,i++}const r=[];for(const s in e){let i=s;if(null==n[s]){const e=s.split("/");i=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[i])r.push([n[i],e[s]]);else if(t)throw new JT(`Provided weight data has no target variable: ${s}`);delete n[i]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new JT(`${e.length} of ${i} weights are not set: ${e}`)}z_(r)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${ew}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const n=JS(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return up(()=>{e=ox(e);const n=new K_;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return Q_(this.outputs,n,t)})}computeMask(e,t){return up(()=>{let n;return e=ox(e),n=null==t?ix(null,e.length):ox(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=D_(e);if(t.length!==this.inputLayers.length)throw new JT(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let a=0;a<t.length;a++){const e=this.inputLayers[a],i=t[a];n[e.name+"_0_0"]=i}const i=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(fx);if(i.length>1)for(const a of i){const e=this.nodesByDepth[a];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const i=[];for(let a=0;a<t.inboundLayers.length;a++){const e=t.inboundLayers[a],r=t.nodeIndices[a],s=t.tensorIndices[a],o=n[`${e.name}_${r}_${s}`];i.push(o)}const r=D_(e.computeOutputShape(ax(i))),s=e.inboundNodes.indexOf(t);for(let t=0;t<r.length;t++){n[`${e.name}_${s}_${t}`]=r[t]}}}const r=[],s=[];for(let a=0;a<this.outputLayers.length;a++){const e=this.outputLayers[a],t=this.outputLayersNodeIndices[a],n=this.outputLayersTensorIndices[a],i=`${e.name}_${t}_${n}`;s.push(i)}for(let a=0;a<s.length;a++){const e=s[a];rx(e in n),r.push(n[e])}return ax(r)}runInternalGraph(e,t){null==t&&(t=ix(null,e.length));const n={};for(let o=0;o<this.inputs.length;++o){const i=this.inputs[o],r=e[o],s=t[o];n[i.id]=[r,s]}const i=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(fx);for(const o of i){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer,i=t.inputTensors,r=t.outputTensors,s=new Array;for(const t of i)t.id in n&&s.push(n[t.id]);if(s.length===i.length){let i,a,o,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===s.length){const[t,n]=s[0];null==c.mask&&(c.mask=n),o=ox(e.call(t,c)),l=ox(e.computeMask(t,n)),i=[t],a=[n]}else i=s.map(e=>e[0]),a=s.map(e=>e[1]),null==c.mask&&(c.mask=a),o=ox(e.call(i,c)),l=ox(e.computeMask(i,a));if(e.activityRegularizer)throw new ex("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<r.length;++e){const t=r[e],i=o[e],s=l[e];n[t.id]=[i,s]}}}}const r=[],s=[],a=[];for(const o of this.outputs){rx(o.id in n,`Could not compute output ${o.name} : ${o.id}`);const[e,t]=n[o.id];a.push(e.shape),r.push(e),s.push(t)}return[r,s,a]}buildNodeConversionMap(e){const t={};let n;for(const i of this.layers){n=i instanceof tw?1:0;for(let e=0;e<i.inboundNodes.length;e++){const r=tw.nodeKey(i,e);this.containerNodes.has(r)&&(t[r]=n,n+=1)}}return t}getLayer(e,t){if(null!=t){if(this.layers.length<=t)throw new JT(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}if(null==e)throw new JT("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===e)return n;throw new JT(`No such layer: ${e}`)}calculateLosses(){return up(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const i=tw.nodeKey(t,n);this.containerNodes.has(i)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const s of this.layers){const e=s.getClassName(),i=s.getConfig(),r=[];for(let n=0;n<s.inboundNodes.length;n++){const e=s.inboundNodes[n],i=tw.nodeKey(s,n);let a={};if(this.containerNodes.has(i)){if(e.callArgs)try{JSON.stringify(e.callArgs),a=e.callArgs}catch(s6){console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${e.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),a={}}if(e.inboundLayers.length>0){const n=[];for(let i=0;i<e.inboundLayers.length;i++){const r=e.inboundLayers[i],s=e.nodeIndices[i],o=e.tensorIndices[i];let l=t[tw.nodeKey(r,s)];null==l&&(l=0),n.push([r.name,l,o,a])}r.push(n)}}}const a={};a.name=s.name,a.className=e,a.config=i,a.inboundNodes=r,n.push(a)}e.layers=n;const i=[];for(let s=0;s<this.inputLayers.length;s++){const e=this.inputLayers[s],n=this.inputLayersNodeIndices[s],r=tw.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let a=t[r];null==a&&(a=0);const o=this.inputLayersTensorIndices[s];i.push([e.name,a,o])}e.inputLayers=i;const r=[];for(let s=0;s<this.outputLayers.length;s++){const e=this.outputLayers[s],n=this.outputLayersNodeIndices[s],i=tw.nodeKey(e,n);if(!this.containerNodes.has(i))continue;let a=t[i];null==a&&(a=0);const o=this.outputLayersTensorIndices[s];r.push([e.name,a,o])}return e.outputLayers=r,e}static fromConfig(e,t,n={},i=!1){const r={},s={};function a(e,t){e.name in s?s[e.name].push(t):s[e.name]=[t]}function o(e,t){const n=[];let i;for(const s of t){const o=s[0],l=s[1],c=s[2];if(i=null==s[3]?{}:s[3],!(o in r))return void a(e,t);const u=r[o];if(u.inboundNodes.length<=l)return void a(e,t);const d=u.inboundNodes[l];n.push(d.outputTensors[c])}n.length>0&&e.apply(ax(n),i)}function l(e){const n=e.name,s=wS(e,null!=t.customObjects?t.customObjects:{});s.setFastWeightInitDuringBuild(i),r[n]=s;e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new JT(`Corrupted configuration, expected array for nodeData: ${e}`);a(s,e)})}const c=t.name,u=t.layers;for(const m of u)l(m);for(;!gx(s);)for(const e of u){const t=r[e.name];if(t.name in s){const e=s[t.name];delete s[t.name];for(const n of e)o(t,n)}}const d=[],h=[],p=t.inputLayers;for(const m of p){const e=m[0],t=m[1],n=m[2];rx(e in r);const i=r[e].inboundNodes[t].outputTensors;d.push(i[n])}const f=t.outputLayers;for(const m of f){const e=m[0],t=m[1],n=m[2];rx(e in r);const i=r[e].inboundNodes[t].outputTensors;h.push(i[n])}return new e({inputs:d,outputs:h,name:c})}get stateful(){if(this._stateful)throw new JT("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){up(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nw(e,t){return function(e,t,n){const i=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===i)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==i)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{t in e?n.push(e[t]):n.push(null)}),n}throw new Error(`The model has multiple (${i}) outputs, so ${n} must be either an array with ${i} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}(e,t,"classWeight")}async function iw(e,t,n,i){if(null!=t||null!=i)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=up(()=>{if(1===e.shape.length)return Jh(e);if(2===e.shape.length){if(e.shape[1]>1){return Qp(e,1)}if(1===e.shape[1])return Tf(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await t.data());dp(t);const r=[];return i.forEach(e=>{if(null==n[e])throw new Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);r.push(n[e])}),db(r,"float32")}return null}function rw(e,t){return jp(e,t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sw(e,t){let n,i;const r=t;n=r.xs,i=r.ys,Pa(null!=n&&null!=i,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const s=aw("input",e.inputNames,n),a=aw("output",e.outputNames,i),o=s[0].shape[0];Pa(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),Pa(a.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let l=0;l<s.length;l++)Pa(s[l].shape[0]===o,()=>`Batch size mismatch: input ${e.inputNames[l]} has ${s[l].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);for(let l=0;l<a.length;l++)Pa(a[l].shape[0]===o,()=>`Batch size mismatch: output ${e.outputNames[l]} has ${a[l].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);return{xs:s,ys:a}}function aw(e,t,n){if(n instanceof Od)return[n];if(Array.isArray(n))return Pa(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const i=[];for(const r of t){if(null==n[r])throw new JT(`The feature data generated by the dataset lacks the required ${e} key '${r}'.`);i.push(n[r])}return i}}async function ow(e,t,n){const i=null!=n.batchesPerEpoch;if(Pa(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),Pa(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),Pa(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),Pa(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),Pa(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const r=null!=n.validationData;let s,a;if(r)if(lw(n.validationData))Pa(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const e=function(e){if(3===e.length)throw new ex("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);s=e.xs,a=e.ys}const o=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let c;c=r?l.slice().concat(l.map(e=>"val_"+e)):l.slice();const u=xS(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:h,history:p}=SS(u,d,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,r,c);h.setModel(e),e.history=p,await h.onTrainBegin(),e.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,m=await t.iterator();for(;f<n.epochs;){const c={};await h.onEpochBegin(f);let u=0,d=0;for(i||(m=await t.iterator());!i||u<n.batchesPerEpoch;){const t=await m.next();if(i&&t.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${u} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(null!=t.value){const{xs:i,ys:r}=sw(e,t.value),s={};s.batch=d,s.size=i[0].shape[0],await h.onBatchBegin(d,s);const a=[];if(null!=n.classWeight){const t=nw(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)a.push(await iw(r[e],null,t[e]))}const c=i.concat(r).concat(a),p=o(c);dp(c);for(let e=0;e<l.length;++e){const t=l[e],n=p[e];s[t]=n,hp(n)}await h.onBatchEnd(d,s),pS(s),d++,u++}if(i?u>=n.batchesPerEpoch:t.done){if(r){let t;t=lw(n.validationData)?ox(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):ox(e.evaluate(s,a,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)c[`val_${e.metricsNames[n]}`]=t[n]}break}if(e.stopTraining_)break}if(await h.onEpochEnd(f,c),f++,e.stopTraining_)break}return await h.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function lw(e){return"function"==typeof e.iterator}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function cw(e){Pa(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function uw(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>Yx(e,t,n-t)):Yx(e,t,n-t)}function dw(e,t){return up(()=>null==e?null:Array.isArray(e)?e.map(e=>dw(e,t)):r_(e,"int32"===t.dtype?t:Qh(t,"int32")))}function hw(e,t){const n=[];let i=0,r=null;for(;i<e;)r=i+t,r>=e&&(r=e),n.push([i,r]),i=r;return n}async function pw(e,t,n,i={}){if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let r,s,a,o,l,c,u,d,h;e.isTraining=!0;try{const p=null==i.batchSize?32:i.batchSize;cw(p);const f=!1,m=await e.standardizeUserData(t,n,i.sampleWeight,i.classWeight,f,p);r=m[0],s=m[1],h=m[2];let g,b=!1;if(null!=i.validationData&&i.validationData.length>0){if(b=!0,2!==i.validationData.length)throw 3===i.validationData.length?new ex("validationData including sample weights is not supported yet."):new JT(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${i.validationData} is invalid.`);l=i.validationData[0],c=i.validationData[1];const t=!0,n=await e.standardizeUserData(l,c,null,null,t,p);u=n[0],d=n[1],g=u.concat(d)}else if(null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1){b=!0;const e=Math.floor(r[0].shape[0]*(1-i.validationSplit)),t=r[0].shape[0];u=uw(r,e,t),a=r,r=uw(r,0,e),d=uw(s,e,t),o=s,s=uw(s,0,e),g=u.concat(d)}else null!=i.validationSteps&&(b=!0);const y=r.concat(s).concat(h);e.checkTrainableWeightsConsistency();const v=e.makeTrainFunction(),T=e.getDedupedMetricsNames();let x,_;b?(e.makeTestFunction(),x=e.testFunction,_=T.slice().concat(T.map(e=>"val_"+e))):(x=null,g=[],_=T.slice());const S=xS(i.callbacks,i.yieldEvery),w=await async function(e,t,n,i,r,s,a,o,l,c,u,d,h,p,f){null==r&&(r=32),null==s&&(s=1),null==u&&(u=!0),null==h&&(h=0);let m=!1;if(null!=l&&null!=c&&(m=!0),null!=f&&(m=!0,null==p))throw new JT("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=e.checkNumSamples(n,r,p,"steps_per_epoch");let b;null!=g&&(b=Wx(0,g)),null==a&&(a=1);const{callbackList:y,history:v}=SS(o,a,s,h,g,p,r,m,d);y.setModel(e),e.history=v,await y.onTrainBegin(),e.stopTraining_=!1;for(let T=h;T<s;++T){await y.onEpochBegin(T);const s={};if(null!=p)throw new ex("stepsPerEpoch mode is not implemented yet.");{if("batch"===u)throw new ex("batch shuffling is not implemneted yet");u&&Ea(b);const a=db(b),o=hw(g,r);for(let u=0;u<o.length;++u){const d={};if(await y.onBatchBegin(u,d),up(()=>{const h=o[u][0],p=o[u][1],f=Yx(a,h,p-h);d.batch=u,d.size=p-h;const g=dw(n,f),b=t(g);for(let e=0;e<i.length;++e){const t=i[e],n=b[e];d[t]=n,hp(n)}if(u===o.length-1&&m){const t=e.testLoop(l,c,r);for(let e=0;e<i.length;++e){const n=i[e],r=t[e];hp(r),s["val_"+n]=r}}}),await y.onBatchEnd(u,d),pS(d),e.stopTraining_)break}a.dispose()}if(await y.onEpochEnd(T,s),e.stopTraining_)break}return await y.onTrainEnd(),await e.history.syncData(),e.history}(e,v,y,T,p,i.epochs,i.verbose,S,x,g,i.shuffle,_,i.initialEpoch,null,null);return w}finally{e.isTraining=!1,mw(r,t),mw(s,n),mw(a,t),mw(o,n),mw(u,l),mw(d,c),null!=h&&dp(h)}}function fw(e){const t=[];e instanceof Od&&(e=[e]);for(let n=0;n<e.length;++n){const i=e[n];if(1===i.rank)t.push(Kx(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(i)}}return t}function mw(e,t){if(null==e)return;const n=[];if(t instanceof Od)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const r in t){const e=t[r];n.push(e.id)}const i=[];if(e instanceof Od)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&i.push(e)});else if(null!=e)for(const r in e){const t=e[r];-1===n.indexOf(t.id)&&i.push(t)}i.forEach(e=>{e.isDisposed||e.dispose()})}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gw(e){return Array.isArray(e)}function bw(e){return!function(e){return e instanceof Od}(e)&&!gw(e)}function yw(e,t,n,i=!0,r=""){if(null==t||0===t.length){if(null!=e){let t=!1;if(gw(e)&&e.length>0)t=!0;else if(bw(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new JT(`Error when checking model ${r} expected no data, but got ${e}`)}return[]}if(null==e)return t.map(e=>null);let s;if(bw(e)){s=[];for(const n of t){if(null==e[n])throw new JT(`No data provided for "${n}". Need data for each key in: ${t}`);s.push(e[n])}}else if(gw(e)){if(e.length!==t.length)throw new JT(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(t.length>1)throw new JT(`The model ${r} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=fw(s),null!=n)for(let a=0;a<t.length;++a){if(null==n[a])continue;const e=s[a];if(e.shape.length!==n[a].length)throw new JT(`Error when checking ${r}: expected ${t[a]} to have ${n[a].length} dimension(s). but got array with shape ${e.shape}`);for(let t=0;t<n[a].length;++t){if(0===t&&!i)continue;const s=e.shape[t],o=n[a][t];if(null!=o&&o>=0&&s!==o)throw new JT(`${r} expected a batch of elements where each example has shape [${n[a].slice(1,n[a].length)}] (i.e.,tensor shape [*,${n[a].slice(1,n[a].length)}]) but the ${r} received an input with ${e.shape[0]} examples, each with shape [${e.shape.slice(1,e.shape.length)}] (tensor shape [${e.shape}])`)}}return s}function vw(e,t,n,i=!0,r=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new JT(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new JT(`The model expects ${t.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(null!=n)for(let a=0;a<t.length;++a){if(null==n[a])continue;const e=s[a];if(e.shape.length!==n[a].length)throw new JT(`Error when checking ${r}: expected ${t[a]} to have ${n[a].length} dimension(s), but got array with shape ${JSON.stringify(e.shape)}`);for(let s=0;s<n[a].length;++s){if(0===s&&!i)continue;const o=e.shape[s],l=n[a][s];if(null!=l&&l!==o)throw new JT(`Error when checking ${r}: expected ${t[a]} to have shape ${JSON.stringify(n[a])} but got array with shape ${JSON.stringify(e.shape)}.`)}}}class Tw extends tw{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new JT("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");qS(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>Ty.adagrad(.01),Adadelta:()=>Ty.adadelta(1,.95,qx()),Adam:()=>Ty.adam(.001,.9,.999,qx()),Adamax:()=>Ty.adamax(.002,.9,.999,qx(),0),RMSProp:()=>Ty.rmsprop(.001,.9,0,qx()),SGD:()=>Ty.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new JT(`Unknown Optimizer ${e}`)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof dy))throw new JT("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new JT(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);const n=e.loss;t=n.map(e=>OS(e))}else{const n=OS(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new JT(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(OS(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){const e=this.internalOutputShapes[s],t=this.outputNames[s];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[s])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Mx("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const i=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const i of t){let t=n.hasOwnProperty(i)?n[i]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),r=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};Mx("metric",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,i,s;for(const a of t){if("string"==typeof a&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(a)){const t=this.internalOutputShapes[e];let r;1===t[t.length-1]||this.lossFunctions[e]===NS?-1!==["accuracy","acc"].indexOf(a)?i=LS:-1!==["crossentropy","ce"].indexOf(a)&&(i=FS):this.lossFunctions[e]===RS?-1!==["accuracy","acc"].indexOf(a)?i=$S:-1!==["crossentropy","ce"].indexOf(a)&&(i=zS):-1!==["accuracy","acc"].indexOf(a)?i=MS:-1!==["crossentropy","ce"].indexOf(a)&&(i=BS),-1!==["accuracy","acc"].indexOf(a)?r="acc":-1!==["crossentropy","ce"].indexOf(a)&&(r="ce"),s=i,n=""+r}else{const e=GS(a);s=e,n=""+VS(a)}let t;Mx(n,()=>{t=s}),r(e,n,t)}})(i[e])}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){const i=null==n.batchSize?32:n.batchSize;cw(i);const r=this.standardizeUserDataXY(e,t,!0,i);try{const e=r[0].concat(r[1]);this.makeTestFunction();const t=this.testFunction;return ax(this.testLoop(t,e,i,n.verbose,n.steps))}finally{mw(r[0],e),mw(r[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const i=null!=(n=n||{}).batches,r=e.testFunction;let s=[];if(n.verbose>0)throw new ex("Verbose mode is not implemented yet.");Pa(!i||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const a="function"==typeof t.next?t:await t.iterator();let o=0,l=0;for(;!i||l<n.batches;){const t=await a.next();if(s=up(()=>{if(t.value){const{xs:n,ys:i}=sw(e,t.value),a=n.concat(i),c=up(()=>r(a));if(dp(a),0===l)for(let e=0;e<c.length;++e)s.push(vm(0));const u=a[0].shape[0];for(let e=0;e<c.length;++e){const t=c[e],n=s[e];s[e]=up(()=>Vp(s[e],jp(u,t))),l>0&&dp(n)}dp(c),o+=u,++l}return s}),t.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<s.length;++c){const e=s[c];s[c]=Wp(s[c],o),dp(e)}return ax(s)}(this,e,t)}checkNumSamples(e,t,n,i="steps"){let r;if(null!=n){if(r=null,null!=t)throw new JT(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else{if(null==e)throw new JT(`Either the input data should have a defined shape, or ${i} shoud be specified.`);r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new JT("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),i=n?t:[t],r=this.retrieveSymbolicTensors(i),s=new K_;if(e instanceof Od&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new JT(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)s.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new JT(`No value is provided for the model's input ${o.name}`);s.add(o,t)}const a=Q_(r,s);return n?a:a[0]}retrieveSymbolicTensors(e){const t=ix(null,e.length);let n=e.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],s=r.map(e=>e.name);for(let i=0;i<e.length;++i){const a=s.indexOf(e[i]);if(-1!==a&&(t[i]=r[a],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,i)=>{null==t&&n.push(e[i])}),new JT(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return t}predictLoop(e,t=32,n=!1){return up(()=>{const i=this.checkNumSamples(e);if(n)throw new ex("Verbose predictLoop() is not implemented yet.");const r=hw(i,t),s=this.outputs.map(e=>[]);for(let t=0;t<r.length;++t){const n=up(()=>{const n=r[t][0],i=r[t][1],s=uw(e,n,i),a=[];if(Array.isArray(s))for(let e=0;e<s.length;++e)a.push({key:this.inputs[e],value:s[e]});else a.push({key:this.inputs[0],value:s});const o=new K_(a);return Q_(this.outputs,o)});n.forEach((e,t)=>s[t].push(e))}return ax(s.map(e=>Sf(e,0)))})}predict(e,t={}){const n=fw(e);vw(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return cw(e),this.predictLoop(n,e)}finally{mw(n,e)}}predictOnBatch(e){vw(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,i){if(null==this.optimizer_)throw new QT("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let s=0;s<this.feedOutputShapes.length;++s){const e=this.feedOutputShapes[s];this.feedLossFns[s]===RS?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(e,t){const n=mx(e.map(e=>e.shape[0]));n.sort();const i=mx(t.map(e=>e.shape[0]));if(i.sort(),n.length>1)throw new JT(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(e=>e.shape))}`);if(i.length>1)throw new JT(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(e=>e.shape))}`);if(n.length>0&&i.length>0&&!Fa(n,i))throw new JT(`Input Tensors should have the same number of samples as target Tensors. Found ${n[0]} input sample(s) and ${i[0]} target sample(s).`)}(e=yw(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=yw(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){const i=[kS,NS,AS];for(let r=0;r<e.length;++r){const s=e[r],a=t[r],o=n[r];if(null!=a){if(a===AS&&1===s.shape[s.shape.length-1])throw new JT(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==i.indexOf(a)){const e=s.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const i=e[n],r=t[n];if(null!=r&&i!==r)throw new JT(`A target Tensor with shape ${s.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&e[0].shape[0]%i!==0)throw new JT(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,i,r=!0,s){const[a,o]=this.standardizeUserDataXY(e,t,r,s);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=i){const e=nw(i,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await iw(o[t],null,e[t]))}return[a,o,l]}testLoop(e,t,n,i=0,r){return up(()=>{const s=this.checkNumSamples(t,n,r,"steps"),a=[];if(i>0)throw new ex("Verbose mode is not implemented yet.");if(null!=r)throw new ex("steps mode in testLoop() is not implemented yet");{const i=hw(s,n),r=db(Wx(0,s));for(let n=0;n<i.length;++n){const s=i[n][0],o=i[n][1],l=Yx(r,s,o-s),c=dw(t,l),u=e(c);if(0===n)for(let e=0;e<u.length;++e)a.push(vm(0));for(let e=0;e<u.length;++e){const t=u[e];a[e]=Vp(a[e],jp(o-s,t))}}for(let e=0;e<a.length;++e)a[e]=Wp(a[e],s)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const i=e[n];let r=i;if(sx(e,i)>1){r+=`_${sx(e.slice(0,n),i)}`}t.push(r)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],a=this.collectedTrainableWeights.map(e=>e.read()),o=this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const a=new K_(e),o=Q_(this.outputs,a,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(i[n],o[n]);null!=r[n]&&(e=rw(e,r[n]));const s=ig(e);t.push(s),l=0===n?e:Vp(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],r=this.metricsTensors[n][1];e=ig(t(i[r],o[r]))}hp(e),s.push(e)}return l=ig(l),this.calculateLosses().forEach(e=>{l=Vp(l,e)}),l},!0,a);return[o].concat(s)}}makeTestFunction(){this.testFunction=e=>up(()=>{const t=[];let n;const i=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let e=0;e<this.inputs.length;++e)s.push({key:this.inputs[e],value:i[e]});const a=new K_(s),o=Q_(this.outputs,a);for(let e=0;e<this.lossFunctions.length;++e){const i=this.lossFunctions[e],s=ig(i(r[e],o[e]));n=0===e?s:Vp(n,s),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],i=this.metricsTensors[e][1],s=ig(n(r[i],o[i]));t.push(s)}return t})}async fit(e,t,n={}){return pw(this,e,t,n)}async fitDataset(e,t){return ow(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),i=n[0],r=n[1],s=this.makeTrainFunction()(i.concat(r)),a=[];for(const o of s){const e=await o.data();a.push(e[0])}return dp(s),mw(n[0],e),mw(n[1],t),ax(a)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n);for(let s=0;s<i.length;++s)n&&!i[s].trainable||t.push({name:i[s].originalName,tensor:r[s]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=cp().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-cp().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=lx(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>lx(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const i of t){if("string"!=typeof n[i])throw new Error("Serialization of non-string loss is not supported.");e[i]=lx(n[i])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[lx(VS(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>lx(VS(e)));{const e={};for(const t in this.metrics)e[t]=lx(VS(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=wS(QS(e.optimizer_config));let n,i;if("string"==typeof e.loss)n=cx(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>cx(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=cx(e.loss[t])}if(Array.isArray(e.metrics))i=e.metrics.map(e=>cx(e));else if(null!=e.metrics){i={};for(const t in e.metrics)i[t]=cx(e.metrics[t])}this.compile({loss:n,metrics:i,optimizer:t})}async save(e,t){if("string"==typeof e){const t=(n=e,wh.getSaveHandlers(n));if(0===t.length)throw new JT(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new JT(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}var n;if(null==e.save)throw new JT("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const i=await gh(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:`TensorFlow.js tfjs-layers v${ew}`,convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:n}=await gh(await this.optimizer.getWeights(),e);i.specs.push(...n),i.data=Th([i.data,t])}if(null!=this.userDefinedMetadata){const e=!0;WS(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=i.data,r.weightSpecs=i.specs,e.save(r)}setUserDefinedMetadata(e){WS(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Tw.className="Model",Gp(Tw);class xw extends Tw{}xw.className="Functional",Gp(xw);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class _w extends Tw{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:Ix("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new JT(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof _w||e instanceof Tw;let n;if(t){if(n=e,1!==n.outputs.length)throw new JT("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new JT("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new JT("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new JT("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new X_({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new JT(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new JT("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=q_(this.outputs[0])}this.inboundNodes=[],new H_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ix(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(L_(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Tw({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new QT("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new QT("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new QT("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new QT("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},i=!1){let r,s={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new JT("Legacy serialization format not supported yet.");r=t}else Pa(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=t.layers,delete t.layers,s=t;const a=new e(s);if(!(a instanceof _w))throw new ex(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const o of r){const e=wS(o,void 0,i);i&&e.setFastWeightInitDuringBuild(!0),a.add(e)}return a}set stopTraining(e){if(null==this.model)throw new JT("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new JT("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}_w.className="Sequential",Gp(_w);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Sw extends zp{getConfig(){return{}}}class ww extends Sw{apply(e,t=1){return function(e,t=1){if(1!==t)throw new ex(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return am(e)}(e,t)}}ww.className="elu",Gp(ww);class Iw extends Sw{apply(e){return Hg(e)}}Iw.className="selu",Gp(Iw);class kw extends Sw{apply(e){return Bg(e)}}kw.className="relu",Gp(kw);class Cw extends Sw{apply(e){return up(()=>ag(6,Bg(e)))}}Cw.className="relu6",Gp(Cw);class Ew extends Sw{apply(e){return e}}Ew.className="linear",Gp(Ew);class Aw extends Sw{apply(e){return wf(e)}}Aw.className="sigmoid",Gp(Aw);class Rw extends Sw{apply(e){return function(e){return up(()=>{const t=Vp(.5,jp(.2,e));return Mf(t,0,1)})}(e)}}Rw.className="hardSigmoid",Gp(Rw);class Nw extends Sw{apply(e){return Wm(e)}}Nw.className="softplus",Gp(Nw);class Pw extends Sw{apply(e){return function(e){return up(()=>Wp(e,Vp(qp(e),1)))}(e)}}Pw.className="softsign",Gp(Pw);class Dw extends Sw{apply(e){return kf(e)}}Dw.className="tanh",Gp(Dw);class Ow extends Sw{apply(e,t=-1){return Jg(e,t)}}Ow.className="softmax",Gp(Ow);class Lw extends Sw{apply(e,t=-1){return Xm(e,t)}}Lw.className="logSoftmax",Gp(Lw);class Mw extends Sw{apply(e,t=1){return up(()=>jp(wf(jp(e,t)),e))}}Mw.className="swish",Gp(Mw);class Fw extends Sw{apply(e){return up(()=>jp(e,kf(Wm(e))))}}function $w(e){return e.getClassName()}function Bw(e,t={}){return px(e,Up.getMap().classNameMap,t,"activation")}function zw(e){if(null==e){const e={className:"linear",config:{}};return Bw(e)}if("string"==typeof e){const t={};return t.className=e,t.config={},Bw(t)}return e instanceof Sw?e:Bw(e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */Fw.className="mish",Gp(Fw);class Uw extends zp{}class Gw extends Uw{constructor(e){super(),function(e){if(null!=e&&"object"!=typeof e)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return up(()=>{let t=rg([1]);return this.hasL1&&(t=Vp(t,_m(jp(this.l1,qp(e))))),this.hasL2&&(t=Vp(t,_m(jp(this.l2,s_(e))))),Tf(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Gw.className="L1L2",Gp(Gw);const Vw={l1l2:"L1L2"};function Hw(e){return dx(e)}function Ww(e,t={}){return px(e,Up.getMap().classNameMap,t,"regularizer")}function jw(e){if(null==e)return null;if("string"==typeof e){return Ww({className:e in Vw?Vw[e]:e,config:{}})}return e instanceof Uw?e:Ww(e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qw extends j_{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=O_(e);let n=Bg(e);return null!=this.maxValue&&(n=Mf(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}qw.className="ReLU",Gp(qw);class Xw extends j_{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=O_(e);return $m(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Xw.className="LeakyReLU",Gp(Xw);class Kw extends j_{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=N_(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=jw(e.alphaRegularizer),this.alphaConstraint=dS(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new JT(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`);this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=L_(e)).slice(1);if(null!=this.sharedAxes)for(const i of this.sharedAxes)t[i-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let i=1;i<e.length;++i)n[i]=e[i];this.inputSpec=[new U_({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=O_(e),mg(e,this.alpha.read())}getConfig(){const e={alphaInitializer:R_(this.alphaInitializer),alphaRegularizer:Hw(this.alphaRegularizer),alphaConstraint:cS(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}Kw.className="PReLU",Gp(Kw);class Yw extends j_{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new ex(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=O_(e);return am(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Yw.className="ELU",Gp(Yw);class Zw extends j_{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=O_(e);return jp(n,Qh(Dm(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}Zw.className="ThresholdedReLU",Gp(Zw);class Qw extends j_{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new Ow).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=O_(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Jw(e,t,n){if("number"==typeof e)return ix(e,t);if(e.length!==t)throw new JT(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let i=0;i<t;++i){const r=e[i];if(!Ux(r))throw new JT(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${r}`)}return e}function eI(e,t,n,i,r=1){if(null==e)return e;let s;return s="same"===n?e:e-(t+(t-1)*(r-1))+1,Math.floor((s+i-1)/i)}function tI(e,t,n,i){if(null==e)return null;if("valid"===i)e=e*t+Hx([n-t,0]);else{if("same"!==i)throw new JT(`Unsupport padding mode: ${i}.`);e*=t}return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nI(e,t){return up(()=>(Px(t),"channelsFirst"===t?bp(e,[0,2,3,1]):e))}function iI(e,t){return up(()=>(Px(t),"channelsFirst"===t?bp(e,[0,2,3,4,1]):e))}function rI(e,t,n,i=[1,1],r="valid",s,a,o=null){return up(()=>{if(null==s&&(s="channelsLast"),Px(s),3!==e.rank&&4!==e.rank)throw new JT(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new JT(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=nI(e,s);if("causal"===r)throw new ex("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=kb({x:l,filter:t,strides:i,pad:"same"===r?"same":"valid",dilations:a,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===s&&(l=bp(l,[0,3,1,2])),l})}Qw.className="Softmax",Gp(Qw);class sI extends j_{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",sI.verifyArgs(t),this.rank=e,vx(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new ex(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Jw(t.kernelSize,e,"kernelSize"),this.strides=Jw(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,Dx(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Px(this.dataFormat),this.activation=zw(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=N_(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=dS(t.biasConstraint),this.biasRegularizer=jw(t.biasRegularizer),this.activityRegularizer=jw(t.activityRegularizer),this.dilationRate=Jw(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new JT(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new JT(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new JT(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(e){if(rx("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!yx(e.kernelSize,"number",1,3))throw new JT(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:$w(this.activation),useBias:this.useBias,biasInitializer:R_(this.biasInitializer),biasRegularizer:Hw(this.biasRegularizer),activityRegularizer:Hw(this.activityRegularizer),biasConstraint:cS(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class aI extends sI{constructor(e,t){super(e,t),this.kernel=null,aI.verifyArgs(t),this.filters=t.filters,vx(this.filters,"filters"),this.kernelInitializer=N_(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=dS(t.kernelConstraint),this.kernelRegularizer=jw(t.kernelRegularizer)}build(e){e=L_(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new JT(`The channel dimension of the input should be defined. Found ${e[t]}`);const n=e[t],i=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return up(()=>{let t;e=O_(e);const n=null==this.bias?null:this.bias.read(),i=xx(this.activation.getClassName());if(null!=i&&2===this.rank)t=rI(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(1===this.rank)t=function(e,t,n,i=1,r="valid",s,a=1){return up(()=>{if(null==s&&(s="channelsLast"),Px(s),3!==e.shape.length)throw new JT(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(3!==t.shape.length)throw new JT(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new JT(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if("channelsFirst"===s&&(e=bp(e,[0,2,1])),"causal"===r)throw new ex("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=Gf(e,t,i,"same"===r?"same":"valid","NWC",a);return null!=n&&(o=o_(o,n)),o})}(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=rI(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new ex("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,i=[1,1,1],r="valid",s,a){return up(()=>{if(null==s&&(s="channelsLast"),Px(s),4!==e.rank&&5!==e.rank)throw new JT(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(4!==t.rank&&5!==t.rank)throw new JT(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let o=iI(e,s);if("causal"===r)throw new ex("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=Wf(o,t,i,"same"===r?"same":"valid","NDHWC",a),null!=n&&(o=o_(o,n)),"channelsFirst"===s&&(o=bp(o,[0,4,1,2,3])),o})}(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=L_(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let r=0;r<n.length;++r){const e=eI(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(e)}let i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t),i.push(this.filters)):(i.push(this.filters),i=i.concat(t)),i}getConfig(){const e={filters:this.filters,kernelInitializer:R_(this.kernelInitializer),kernelRegularizer:Hw(this.kernelRegularizer),kernelConstraint:cS(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new JT(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class oI extends aI{constructor(e){super(2,e),oI.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!yx(e.kernelSize,"number",1,2))throw new JT(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}oI.className="Conv2D",Gp(oI);class lI extends aI{constructor(e){super(3,e),lI.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new JT(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}lI.className="Conv3D",Gp(lI);class cI extends oI{constructor(e){if(super(e),this.inputSpec=[new U_({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new JT(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(4!==(e=L_(e)).length)throw new JT("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new JT("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new U_({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return up(()=>{let t=O_(e);if(4!==t.shape.length)throw new JT(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,i=n[0];let r,s;"channelsFirst"===this.dataFormat?(r=2,s=3):(r=1,s=2);const a=n[r],o=n[s],l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],d=this.strides[1],h=[i,tI(a,u,l,this.padding),tI(o,d,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=bp(t,[0,2,3,1]));let p=Hf(t,this.kernel.read(),h,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=bp(p,[0,3,1,2])),null!=this.bias&&(p=o_(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p})}computeOutputShape(e){const t=(e=L_(e)).slice();let n,i,r;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3):(n=3,i=1,r=2);const s=this.kernelSize[0],a=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[i]=tI(t[i],o,s,this.padding),t[r]=tI(t[r],l,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}cI.className="Conv2DTranspose",Gp(cI);class uI extends lI{constructor(e){if(super(e),this.inputSpec=[new U_({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new JT(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(5!==(e=L_(e)).length)throw new JT("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new JT("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new U_({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return up(()=>{let t=O_(e);if(5!==t.shape.length)throw new JT(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,i=n[0];let r,s,a;"channelsFirst"===this.dataFormat?(a=2,r=3,s=4):(a=1,r=2,s=3);const o=n[a],l=n[r],c=n[s],u=this.kernelSize[0],d=this.kernelSize[1],h=this.kernelSize[2],p=this.strides[0],f=this.strides[1],m=this.strides[2],g=[i,tI(o,p,u,this.padding),tI(l,f,d,this.padding),tI(c,m,h,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=bp(t,[0,2,3,4,1]));let b=qf(t,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(b=bp(b,[0,4,1,2,3])),null!==this.bias&&(b=o_(b,this.bias.read(),this.dataFormat)),null!==this.activation&&(b=this.activation.apply(b)),b})}computeOutputShape(e){const t=(e=L_(e)).slice();let n,i,r,s;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3,s=4):(n=4,i=1,r=2,s=3);const a=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],u=this.strides[1],d=this.strides[2];return t[n]=this.filters,t[i]=tI(t[i],c,a,this.padding),t[r]=tI(t[r],u,o,this.padding),t[s]=tI(t[s],d,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}uI.className="Conv3DTranspose",Gp(uI);class dI extends aI{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new JT("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new JT("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new JT(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=N_(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=jw(t.depthwiseRegularizer),this.depthwiseConstraint=dS(t.depthwiseConstraint),this.pointwiseInitializer=N_(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=jw(t.pointwiseRegularizer),this.pointwiseConstraint=dS(t.pointwiseConstraint)}build(e){if((e=L_(e)).length<this.rank+2)throw new JT(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new JT(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const n=e[t],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new U_({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return up(()=>{let t;if(e=O_(e),1===this.rank)throw new ex("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=bp(e,[0,2,3,1])),t=Wg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=o_(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=bp(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=R_(this.depthwiseInitializer),e.pointwiseInitializer=R_(this.pointwiseInitializer),e.depthwiseRegularizer=Hw(this.depthwiseRegularizer),e.pointwiseRegularizer=Hw(this.pointwiseRegularizer),e.depthwiseConstraint=cS(this.depthwiseConstraint),e.pointwiseConstraint=cS(this.pointwiseConstraint),e}}dI.className="SeparableConv";class hI extends dI{constructor(e){super(2,e)}}hI.className="SeparableConv2D",Gp(hI);class pI extends aI{constructor(e){super(1,e),pI.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!yx(e.kernelSize,"number",1,1))throw new JT(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}pI.className="Conv1D",Gp(pI);class fI extends j_{constructor(e){super(e),"number"==typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return up(()=>{if(e=O_(e),"channelsLast"===this.dataFormat){const t=Qx(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Qx(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=Qx(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Qx(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}fI.className="Cropping2D",Gp(fI);class mI extends j_{constructor(e){var t;super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Px(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,t=this.interpolation,bx(Cx,"InterpolationFormat",t)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return up(()=>{let t=O_(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=bp(t,[0,2,3,1]);const e=this.size[0]*n[2],i=this.size[1]*n[3],r="nearest"===this.interpolation?cy.resizeNearestNeighbor(t,[e,i]):cy.resizeBilinear(t,[e,i]);return bp(r,[0,3,1,2])}{const e=this.size[0]*n[1],i=this.size[1]*n[2];return"nearest"===this.interpolation?cy.resizeNearestNeighbor(t,[e,i]):cy.resizeBilinear(t,[e,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}mI.className="UpSampling2D",Gp(mI);class gI extends sI{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=N_(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=dS(e.depthwiseConstraint),this.depthwiseRegularizer=jw(e.depthwiseRegularizer)}build(e){if((e=L_(e)).length<4)throw new JT(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new JT(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const n=e[t],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return up(()=>{let t=
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function(e,t,n=[1,1],i="valid",r,s){return up(()=>{null==r&&(r="channelsLast"),Px(r);let a=nI(e,r);if(4!==e.rank)throw new JT(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(4!==t.rank)throw new JT(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return a=Jf(a,t,n,"same"===i?"same":"valid","NHWC",s),"channelsFirst"===r&&(a=bp(a,[0,3,1,2])),a})}(e=O_(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=o_(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=L_(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=eI(t,this.kernelSize[0],this.padding,this.strides[0]),s=eI(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],i,r,s]:[e[0],r,s,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=R_(this.depthwiseInitializer),e.depthwiseRegularizer=Hw(this.depthwiseRegularizer),e.depthwiseConstraint=cS(this.depthwiseRegularizer),e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function bI(e,t,n,i){if(Array.isArray(e)){if(null!=t||null!=n)throw new JT("When inputs is an array, neither initialState or constants should be provided");null!=i&&(n=e.slice(e.length-i,e.length),e=e.slice(0,e.length-i)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function r(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=r(t),constants:n=r(n)}}function yI(e,t,n,i=!1,r,s,a=!1,o=!1){return up(()=>{const l=t.shape.length;if(l<3)throw new JT(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Wx(2,l));if(t=bp(t,c),null!=s)throw new ex("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=r&&((r=Qh(Qh(r,"bool"),"float32")).rank===l-1&&(r=Cm(r,-1)),r=bp(r,c)),i&&(t=Ug(t,0),null!=r&&(r=Ug(r,0)));const u=[];let d,h=n;const p=t.shape[0],f=bb(t);let m,g;null!=r&&(m=bb(r));for(let t=0;t<p;++t){const n=f[t],i=up(()=>e(n,h));if(null==r)d=i[0],h=i[1];else{const e=up(()=>{const e=m[t],n=qm(dg(e),e),r=Vp(jp(i[0],e),jp(h[0],n)),s=h.map((t,r)=>Vp(jp(i[1][r],e),jp(t,n)));return{output:r,newStates:s}});d=e.output,h=e.newStates}o&&u.push(d)}if(o){g=ob(u,1)}return[d,g,h]})}gI.className="DepthwiseConv2D",Gp(gI);class vI extends j_{constructor(e){let t;if(super(e),null==e.cell)throw new JT("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new CI({cells:e.cell}):e.cell,null==t.stateSize)throw new JT("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new U_({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return Wx(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null)}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){P_(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let i;if(i=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const i of t)n.push([e[0],i]);return[i].concat(n)}return i}computeMask(e,t){return up(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new ex("Constants support is not implemented in RNN yet.");P_(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new U_({shape:[t,null,...n]});const i=[e[0]].concat(e.slice(2));let r;if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Fa(this.stateSpec.map(e=>e.shape[e.shape.length-1]),r))throw new JT(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map(e=>new U_({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){up(()=>{if(!this.stateful)throw new ZT("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new JT("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>rg([n,e])):this.states_=[rg([n,this.cell.stateSize])];else if(null==e)dp(this.states_),null!=this.keptStates&&(dp(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>rg([n,e])):this.states_[0]=rg([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new JT(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);!0===t?this.keptStates.push(this.states_.slice()):dp(this.states_);for(let t=0;t<this.states_.length;++t){const i=e[t],r=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,s=[n,r];if(!Fa(i.shape,s))throw new JT(`State ${t} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${i.shape}`);this.states_[t]=i}}this.states_=this.states_.map(e=>hp(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});const r=bI(e,n,i,this.numConstants);e=r.inputs,n=r.initialState,i=r.constants;let s=[],a=[];if(null!=n){t.initialState=n,s=s.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new U_({shape:e.shape}));a=a.concat(this.stateSpec)}null!=i&&(t.constants=i,s=s.concat(i),this.numConstants=i.length);if(s[0]instanceof G_){const n=[e].concat(s),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const o=super.apply(n,t);return this.inputSpec=r,o}return super.apply(e,t)}call(e,t){return up(()=>{const n=null==t?null:t.mask,i=null==t?null:t.training;let r=null==t?null:t.initialState;e=O_(e),null==r&&(r=this.stateful?this.states_:this.getInitialState(e));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==s)throw new JT(`RNN Layer has ${s} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},o=yI((e,t)=>{const n=this.cell.call([e].concat(t),a);return[n[0],n.slice(1)]},e,r,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],c=o[1],u=o[2];this.stateful&&this.resetStates(u,i);const d=this.returnSequences?c:l;return this.returnState?[d].concat(u):d})}getInitialState(e){return up(()=>{let t=rg(e.shape);return t=_m(t,[1,2]),t=Kx(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?t_(t,[1,e]):t):this.cell.stateSize>1?[t_(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===vI.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,e,t)}static fromConfig(e,t,n={}){const i=wS(t.cell,n);return new e(Object.assign(t,{cell:i}))}}vI.className="RNN",Gp(vI);class TI extends j_{}class xI extends TI{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,vx(this.units,"units"),this.activation=zw(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=N_(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=N_(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=N_(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jw(e.kernelRegularizer),this.recurrentRegularizer=jw(e.recurrentRegularizer),this.biasRegularizer=jw(e.biasRegularizer),this.kernelConstraint=dS(e.kernelConstraint),this.recurrentConstraint=dS(e.recurrentConstraint),this.biasConstraint=dS(e.biasConstraint),this.dropout=Vx([1,Hx([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=Vx([1,Hx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=L_(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return up(()=>{if(2!==e.length)throw new JT(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const i=null!=t.training&&t.training;let r;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=EI({ones:()=>dg(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=EI({ones:()=>dg(n),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;r=i_(null!=s?jp(e,s):e,this.kernel.read()),null!=this.bias&&(r=o_(r,this.bias.read())),null!=a&&(n=jp(n,a));let o=Vp(r,i_(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$w(this.activation),useBias:this.useBias,kernelInitializer:R_(this.kernelInitializer),recurrentInitializer:R_(this.recurrentInitializer),biasInitializer:R_(this.biasInitializer),kernelRegularizer:Hw(this.kernelRegularizer),recurrentRegularizer:Hw(this.recurrentRegularizer),biasRegularizer:Hw(this.biasRegularizer),activityRegularizer:Hw(this.activityRegularizer),kernelConstraint:cS(this.kernelConstraint),recurrentConstraint:cS(this.recurrentConstraint),biasConstraint:cS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}xI.className="SimpleRNNCell",Gp(xI);class _I extends vI{constructor(e){e.cell=new xI(e),super(e)}call(e,t){return up(()=>{null!=this.cell.dropoutMask&&(dp(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dp(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}static fromConfig(e,t){return new e(t)}}_I.className="SimpleRNN",Gp(_I);class SI extends TI{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new JT("GRUCell does not support reset_after parameter set to true.");this.units=e.units,vx(this.units,"units"),this.activation=zw(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=zw(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=N_(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=N_(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=N_(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jw(e.kernelRegularizer),this.recurrentRegularizer=jw(e.recurrentRegularizer),this.biasRegularizer=jw(e.biasRegularizer),this.kernelConstraint=dS(e.kernelConstraint),this.recurrentConstraint=dS(e.recurrentConstraint),this.biasConstraint=dS(e.biasConstraint),this.dropout=Vx([1,Hx([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=Vx([1,Hx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=L_(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return up(()=>{if(2!==e.length)throw new JT(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const n=null!=t.training&&t.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=EI({ones:()=>dg(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=EI({ones:()=>dg(i),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,s=this.recurrentDropoutMask;let a,o,l;0<this.dropout&&this.dropout<1&&(e=jp(e,r[0]));let c=i_(e,this.kernel.read());this.useBias&&(c=o_(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=jp(i,s[0]));const u=this.recurrentKernel.read(),[d,h]=ib(u,[2*this.units,this.units],u.rank-1),p=i_(i,d),[f,m,g]=ib(c,3,c.rank-1),[b,y]=ib(p,2,p.rank-1);a=this.recurrentActivation.apply(Vp(f,b)),o=this.recurrentActivation.apply(Vp(m,y));const v=i_(jp(o,i),h);l=this.activation.apply(Vp(g,v));const T=Vp(jp(a,i),jp(Vp(1,mp(a)),l));return[T,T]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$w(this.activation),recurrentActivation:$w(this.recurrentActivation),useBias:this.useBias,kernelInitializer:R_(this.kernelInitializer),recurrentInitializer:R_(this.recurrentInitializer),biasInitializer:R_(this.biasInitializer),kernelRegularizer:Hw(this.kernelRegularizer),recurrentRegularizer:Hw(this.recurrentRegularizer),biasRegularizer:Hw(this.biasRegularizer),activityRegularizer:Hw(this.activityRegularizer),kernelConstraint:cS(this.kernelConstraint),recurrentConstraint:cS(this.recurrentConstraint),biasConstraint:cS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}SI.className="GRUCell",Gp(SI);class wI extends vI{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new SI(e),super(e)}call(e,t){return up(()=>{null!=this.cell.dropoutMask&&(dp(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dp(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}wI.className="GRU",Gp(wI);class II extends TI{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,vx(this.units,"units"),this.activation=zw(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=zw(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=N_(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=N_(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=N_(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=jw(e.kernelRegularizer),this.recurrentRegularizer=jw(e.recurrentRegularizer),this.biasRegularizer=jw(e.biasRegularizer),this.kernelConstraint=dS(e.kernelConstraint),this.recurrentConstraint=dS(e.recurrentConstraint),this.biasConstraint=dS(e.biasConstraint),this.dropout=Vx([1,Hx([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=Vx([1,Hx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=L_(e))[e.length-1];let i;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;i=new((t=class extends h_{apply(t,i){const r=e.apply([n]),s=(new f_).apply([n]),a=e.apply([2*n]);return e_(e_(r,s),a)}}).className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return up(()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new JT(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1];const r=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=EI({ones:()=>dg(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=EI({ones:()=>dg(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;let o,l,c,u;0<this.dropout&&this.dropout<1&&(e=jp(e,s[0]));let d=i_(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=jp(i,a[0])),d=Vp(d,i_(i,this.recurrentKernel.read())),this.useBias&&(d=o_(d,this.bias.read()));const[h,p,f,m]=ib(d,4,d.rank-1);o=this.recurrentActivation.apply(h),l=this.recurrentActivation.apply(p),c=Vp(jp(l,r),jp(o,this.activation.apply(f))),u=this.recurrentActivation.apply(m);const g=jp(u,this.activation.apply(c));return[g,g,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$w(this.activation),recurrentActivation:$w(this.recurrentActivation),useBias:this.useBias,kernelInitializer:R_(this.kernelInitializer),recurrentInitializer:R_(this.recurrentInitializer),biasInitializer:R_(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Hw(this.kernelRegularizer),recurrentRegularizer:Hw(this.recurrentRegularizer),biasRegularizer:Hw(this.biasRegularizer),activityRegularizer:Hw(this.activityRegularizer),kernelConstraint:cS(this.kernelConstraint),recurrentConstraint:cS(this.recurrentConstraint),biasConstraint:cS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}II.className="LSTMCell",Gp(II);class kI extends vI{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new II(e),super(e)}call(e,t){return up(()=>{null!=this.cell.dropoutMask&&(dp(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dp(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}kI.className="LSTM",Gp(kI);class CI extends TI{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return up(()=>{let n=e.slice(1);const i=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?i.push(n.splice(0,e.stateSize.length)):i.push(n.splice(0,1));i.reverse();const r=[];let s;for(let a=0;a<this.cells.length;++a){const o=this.cells[a];n=i[a],s=0===a?[e[0]].concat(n):[s[0]].concat(n),s=o.call(s,t),r.push(s.slice(1))}n=[];for(const e of r.slice().reverse())n.push(...e);return[s[0]].concat(n)})}build(e){let t;P_(e)&&(e=e[0]),this.cells.forEach((n,i)=>{Mx(`RNNCell_${i}`,()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}))};return Object.assign({},e,t)}static fromConfig(e,t,n={}){const i=[];for(const r of t.cells)i.push(wS(r,n));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return B_(e)}setWeights(e){const t=[];for(const n of this.cells){const i=n.weights.length,r=e.splice(i);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],r[e]])}z_(t)}}function EI(e){const{ones:t,rate:n,training:i=!1,count:r=1,dropoutFunc:s}=e,a=()=>null!=s?s(t(),n):l_(t(),n),o=()=>c_(a,t,i);if(!r||r<=1)return hp(o().clone());return Array(r).fill(void 0).map(o).map(e=>hp(e.clone()))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */CI.className="StackedRNNCells",Gp(CI);var AI=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};class RI extends vI{constructor(e){if(e.unroll)throw new ex("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ex("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new U_({ndim:5})]}call(e,t){return up(()=>{if(null!=this.cell.dropoutMask&&(dp(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dp(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new JT("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,i=null==t?null:t.training,r=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:r})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return up(()=>{const{stateSize:t}=this.cell,n=e.shape,i=this.computeSingleOutputShape(n),r=rg([i[0],...i.slice(2)]);return Array.isArray(t)?Array(t.length).fill(r):[r]})}resetStates(e,t=!1){up(()=>{if(!this.stateful)throw new ZT("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,i=this.computeSingleOutputShape(n),r=[i[0],...i.slice(2)];if(null==n[0])throw new JT("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>rg(r)):this.states_=[rg(r)];else if(null==e)dp(this.states_),null!=this.keptStates&&(dp(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>rg(r)):this.states_[0]=rg(r);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new JT(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):dp(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],i=r;if(!Fa(n.shape,i))throw new JT(`State ${t} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map(e=>hp(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:i,padding:r,strides:s,dilationRate:a}=this.cell,o="channelsFirst"===t,l=e[o?3:2],c=e[o?4:3],u=eI(l,i[0],r,s[0],a[0]),d=eI(c,i[1],r,s[1],a[1]);return[...e.slice(0,2),...o?[n,u,d]:[u,d,n]]}}RI.className="ConvRNN2D";class NI extends II{constructor(e){const{filters:t,kernelSize:n,strides:i,padding:r,dataFormat:s,dilationRate:a}=e;super(Object.assign({},e,{units:t})),this.filters=t,vx(this.filters,"filters"),this.kernelSize=Jw(n,2,"kernelSize"),this.kernelSize.forEach(e=>vx(e,"kernelSize")),this.strides=Jw(i||1,2,"strides"),this.strides.forEach(e=>vx(e,"strides")),this.padding=r||"valid",Dx(this.padding),this.dataFormat=s||"channelsLast",Px(this.dataFormat),this.dilationRate=Jw(a||1,2,"dilationRate"),this.dilationRate.forEach(e=>vx(e,"dilationRate"))}build(e){var t;e=L_(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new JT(`The channel dimension of the input should be defined. Found ${e[n]}`);const i=e[n],r=this.kernelSize.concat([i,4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,i=this.filters;e=new((t=class extends h_{apply(e,t){return Jx([n.apply([i]),sg([i]),n.apply([2*i])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return up(()=>{if(3!==e.length)throw new JT(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const n=t.training||!1,i=e[0],r=e[1],s=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=EI({ones:()=>dg(i),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=(e,t,n)=>t&&t[n]?jp(t[n],e):e;let l=o(i,a,0),c=o(i,a,1),u=o(i,a,2),d=o(i,a,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=EI({ones:()=>dg(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const h=this.recurrentDropoutMask;let p=o(r,h,0),f=o(r,h,1),m=o(r,h,2),g=o(r,h,3);const[b,y,v,T]=ib(this.kernel.read(),4,3),[x,_,S,w]=this.useBias?ib(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,b,x,this.padding),c=this.inputConv(c,y,_,this.padding),u=this.inputConv(u,v,S,this.padding),d=this.inputConv(d,T,w,this.padding);const[I,k,C,E]=ib(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,I),f=this.recurrentConv(f,k),m=this.recurrentConv(m,C),g=this.recurrentConv(g,E);const A=this.recurrentActivation.apply(Vp(l,p)),R=this.recurrentActivation.apply(Vp(c,f)),N=Vp(jp(R,s),jp(A,this.activation.apply(Vp(u,m)))),P=jp(this.recurrentActivation.apply(Vp(d,g)),this.activation.apply(N));return[P,P,N]})}getConfig(){const e=super.getConfig(),t=AI(e,["units"]),n={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,n)}inputConv(e,t,n,i){const r=Uf(e,t,this.strides,i||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?o_(r,n,this.dataFormat):r}recurrentConv(e,t){return Uf(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}NI.className="ConvLSTM2DCell",Gp(NI);class PI extends RI{constructor(e){const t=new NI(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}PI.className="ConvLSTM2D",Gp(PI);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class DI extends j_{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let i=0;i<this.noiseShape.length;++i)n.push(null==this.noiseShape[i]?t[i]:this.noiseShape[i]);return n}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,i=this.getNoiseShape(n);return c_(()=>l_(n,this.rate,i,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}DI.className="Dropout",Gp(DI);class OI extends DI{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}OI.className="SpatialDropout1D",Gp(OI);class LI extends j_{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,vx(this.units,"units"),this.activation=zw(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=N_(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=N_(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=dS(e.kernelConstraint),this.biasConstraint=dS(e.biasConstraint),this.kernelRegularizer=jw(e.kernelRegularizer),this.biasRegularizer=jw(e.biasRegularizer),this.activityRegularizer=jw(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=L_(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=L_(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e),i=xx(this.activation.getClassName());let r;return null!=i?r=i_(n,this.kernel.read(),i,this.bias?this.bias.read():null):(r=i_(n,this.kernel.read()),null!=this.bias&&(r=o_(r,this.bias.read())),null!=this.activation&&(r=this.activation.apply(r))),r})}getConfig(){const e={units:this.units,activation:$w(this.activation),useBias:this.useBias,kernelInitializer:R_(this.kernelInitializer),biasInitializer:R_(this.biasInitializer),kernelRegularizer:Hw(this.kernelRegularizer),biasRegularizer:Hw(this.biasRegularizer),activityRegularizer:Hw(this.activityRegularizer),kernelConstraint:cS(this.kernelConstraint),biasConstraint:cS(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}LI.className="Dense",Gp(LI);class MI extends j_{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=L_(e);for(const t of e.slice(1))if(null==t)throw new JT(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Gx(e,1)]}call(e,t){return up(()=>{this.invokeCallHook(e,t);let n=O_(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=bp(n,e)}return function(e){if(e.rank<=1)throw new JT(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],Gx(e.shape,1)];return Tf(e,t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}MI.className="Flatten",Gp(MI);class FI extends j_{constructor(e){super(e),this.supportsMasking=!0,this.activation=zw(e.activation)}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e);return this.activation.apply(n)})}getConfig(){const e={activation:$w(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}FI.className="Activation",Gp(FI);class $I extends j_{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return up(()=>{return e=O_(e),t=e,n=this.n,up(()=>{if(2!==t.shape.length)throw new JT(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return t_(Kx(t,1),[1,n,1])});var t,n})}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}$I.className="RepeatVector",Gp($I);class BI extends j_{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",i=t.slice();let r=1,s=null;for(let o=0;o<i.length;++o){const e=i[o];if(this.isUnknown(e)){if(null!==s)throw new JT("Can only specifiy one unknown dimension.");s=o}else r*=e}const a=Gx(e);if(null!==s){if(0===r||a%r!==0)throw new JT(n);i[s]=a/r}else if(a!==r)throw new JT(n);return i}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e),i=n.shape,r=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return Tf(n,r)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}BI.className="Reshape",Gp(BI);class zI extends j_{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Wx(1,e.dims.length+1);if(!Fa(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new U_({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=L_(e)).slice();return this.dims.forEach((n,i)=>{t[i+1]=e[n]}),t}call(e,t){return bp(O_(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}zI.className="Permute",Gp(zI);class UI extends j_{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=O_(e);return Zp(ug(n,this.maskValue),-1)}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e),i=Zp(ug(n,this.maskValue),-1,!0);return jp(n,Qh(i,n.dtype))})}}UI.className="Masking",Gp(UI);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class GI extends j_{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(ox(e.inputLength))}this.inputDim=e.inputDim,vx(this.inputDim,"inputDim"),this.outputDim=e.outputDim,vx(this.outputDim,"outputDim"),this.embeddingsInitializer=N_(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=jw(e.embeddingsRegularizer),this.activityRegularizer=jw(e.activityRegularizer),this.embeddingsConstraint=dS(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return up(()=>this.maskZero?(e=O_(e),ug(e,im(e))):null)}computeOutputShape(e){if(e=L_(e),null==this.inputLength)return[...e,this.outputDim];const t=ox(this.inputLength);if(t.length!==e.length-1)throw new JT(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let i=0;i<t.length;++i){const r=t[i],s=e[i+1];if(null!=r&&null!=s&&r!==s)throw new JT(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);null==r&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return up(()=>{this.invokeCallHook(e,t);let n=O_(e);"int32"!==n.dtype&&(n=Xx(n,"int32"));const i=r_(this.embeddings.read(),Tf(n,[n.size]));return Tf(i,L_(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:R_(this.embeddingsInitializer),embeddingsRegularizer:Hw(this.embeddingsRegularizer),activityRegularizer:Hw(this.activityRegularizer),embeddingsConstraint:cS(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}GI.className="Embedding",Gp(GI);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class VI extends j_{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new ex}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let i=0;i<t.length;++i){const r=e[e.length-t.length+i],s=t[i];if(null==r||null==s||r<0||s<0)n.push(null);else if(1===r)n.push(s);else if(1===s)n.push(r);else{if(r!==s)throw new JT("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(r)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[L_(e)]),e.length<2)throw new JT(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const r of e)null!=r&&null!==r[0]&&t.push(r[0]);if(t=mx(t),t.length>1)throw new JT(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const t=null==e[r]?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const i=e.map(e=>e.length);-1===e.indexOf(null)&&1===mx(i).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return up(()=>{if(this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const i=Hx(n);for(let n of e){const e=n.rank;for(let t=0;t<i-e;++t)n=Kx(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const s of e){const e=s.rank;if(null==e){const e=s.shape,i=e[0],r=e.slice(1).concat([i]);let a=Tf(s,[i].concat(Gx(e.slice(1))));a=bp(a,[1,0]),a=Tf(a,r),t.push(a),n=!0}else if(e>1){const i=Wx(1,e).concat([0]);t.push(bp(s,i)),n=!0}else t.push(s)}let i=this.mergeFunction(t);const r=i.rank;if(n)if(null==r){const e=i.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));i=Tf(bp(Tf(i,[-1,t]),[1,0]),n)}else if(r>1){const e=[r-1].concat(Wx(0,r-1));i=bp(i,e)}return i}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let i=1;i<e.length;++i){const n=null==e[i]?null:e[i].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const i of e)null!=i&&null!==i[0]&&n.push(i[0]);return n=mx(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return up(()=>{if(null==t)return null;if(!Array.isArray(t))throw new JT("`mask` should be an Array");if(!Array.isArray(e))throw new JT("`inputs` should be an Array");if(t.length!==e.length)throw new JT(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(e=>null==e))return null;let n=(t=t.map(e=>null==e?e:Cm(e,0)))[0];for(let e=1;e<t.length-1;++e)n=Ym(n,t[e]);return n})}}class HI extends VI{constructor(e){super(e)}mergeFunction(e){return up(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Vp(t,e[n]);return t})}}HI.className="Add",Gp(HI);class WI extends VI{constructor(e){super(e)}mergeFunction(e){return up(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=jp(t,e[n]);return t})}}WI.className="Multiply",Gp(WI);class jI extends VI{constructor(e){super(e)}mergeFunction(e){return up(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Vp(t,e[n]);return jp(1/e.length,t)})}}jI.className="Average",Gp(jI);class qI extends VI{constructor(e){super(e)}mergeFunction(e){return up(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=ng(t,e[n]);return t})}}qI.className="Maximum",Gp(qI);class XI extends VI{constructor(e){super(e)}mergeFunction(e){return up(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=ag(t,e[n]);return t})}}XI.className="Minimum",Gp(XI);class KI extends VI{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new JT("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const i of e)if(null!=i){t=!1;break}if(t)return;const n=[];for(let i=0;i<e.length;++i){const t=e[i].slice();t.splice(this.axis,1);let r=!1;for(const e of n)if(Fa(e,t)){r=!0;break}r||n.push(t)}if(n.length>1)throw new JT("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return up(()=>Jx(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new JT("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),i=this.axis<0?n.length+this.axis:this.axis;for(const r of t.slice(1)){if(null==n[i]||null==r[i]){n[i]=null;break}n[i]+=r[i]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new JT("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new JT("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new JT(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return up(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const i=[];for(let s=0;s<e.length;++s)null==t[s]?i.push(Qh(dg(e[s]),"bool")):t[s].rank<e[s].rank?i.push(Cm(t[s],-1)):i.push(t[s]);const r=Sf(i,this.axis);return Yp(r,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function YI(e,t){for(;e<0;)e+=t;return e}KI.className="Concatenate",Gp(KI);class ZI extends VI{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){Pa(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new ex("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);if(t[i[0]]!==n[i[1]])throw new JT(`Dimension incompatibility: ${t[i[0]]} !== ${n[i[1]]}`)}mergeFunction(e){if(2!==e.length)throw new JT(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t,n=e[0],i=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>YI(t,e[n].shape.length)):[YI(this.axes,n.shape.length),YI(this.axes,i.shape.length)],this.normalize&&(n=IS(n,t[0]),i=IS(i,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new ex("batchDot is not implemented for tensors of 4D or higher rank yet");if(Pa(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),Pa(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new ex("batchDot is not implemented for complex64-type Tensors yet.");const i=e.shape.length,r=t.shape.length;null==n&&(n=[i-1,r-2]);const s=n;return up(()=>{let n,a;if(i>r){n=i-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=Tf(t,t.shape.concat(e))}else if(r>i){n=r-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=Tf(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)a=s[0]===s[1]?_m(jp(e,t),s[0]):_m(jp(bp(e,[1,0]),t),s[1]);else{const n=s[0]!==e.shape.length-1,i=s[1]===t.shape.length-1;a=ap(e,t,n,i)}if(n>0){let e;e=i>r?i+r-3:i-1;const t=[];for(let i=e;i<e+n;++i)t.push(i);a=ab(a,t)}return 1===a.shape.length&&(a=Cm(a,1)),a})}(n,i,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[YI(this.axes,e.length),YI(this.axes,t.length)],n}computeOutputShape(e){Pa(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new ex("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);t.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);const r=t.concat(n);return 1===r.length&&r.push(1),r}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}ZI.className="Dot",Gp(ZI);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class QI extends j_{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e);return c_(()=>Vp(n_(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}}QI.className="GaussianNoise",Gp(QI);class JI extends j_{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return up(()=>{this.invokeCallHook(e,t);const n=O_(e);if(this.rate>0&&this.rate<1){return c_(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return jp(n,n_(n.shape,1,e))},()=>n,t.training||!1)}return n})}}JI.className="GaussianDropout",Gp(JI);class ek extends j_{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||O_(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return up(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return c_(()=>{const t=O_(e),i=-1.7580993408473766;let r=Om(Mg(n),this.rate);r=Xx(r,"float32");const s=((1-this.rate)*(1+this.rate*i**2))**-.5,a=-s*i*this.rate,o=Vp(jp(t,r),jp(Vp(r,-1),i));return Vp(jp(o,s),a)},()=>O_(e),t.training||!1)}return e})}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function tk(e,t,n,i,r,s=.001){let a;if(2===e.rank)a=Af(e,t,n,i,r,s);else if(3===e.rank)a=Rf(e,t,n,i,r,s);else{if(4!==e.rank)throw new ex(`batchNormalization is not implemented for array of rank ${e.rank} yet`);a=Nf(e,t,n,i,r,s)}return a}function nk(e,t,n,i,r=.001){return Fa(i.slice().sort(),Wx(0,e.rank-1))?function(e,t,n,i,r=.001){return up(()=>{const s=cg(e,i),a=s.mean,o=s.variance;return[tk(e,a,o,n,t,r),a,o]})}(e,t,n,i,r):function(e,t,n,i,r=.001){return up(()=>{const s=cg(e,i),a=s.mean,o=s.variance,l=[];for(const t of Wx(0,e.rank))-1!==i.indexOf(t)?l.push(1):l.push(e.shape[t]);const c=Tf(a,l),u=Tf(o,l),d=null==t?null:Tf(t,l),h=null==n?null:Tf(n,l);return[tk(e,c,u,h,d,r),a,o]})}(e,t,n,i,r)}ek.className="AlphaDropout",Gp(ek);class ik extends j_{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=N_(e.betaInitializer||"zeros"),this.gammaInitializer=N_(e.gammaInitializer||"ones"),this.movingMeanInitializer=N_(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=N_(e.movingVarianceInitializer||"ones"),this.betaConstraint=dS(e.betaConstraint),this.gammaConstraint=dS(e.gammaConstraint),this.betaRegularizer=jw(e.betaRegularizer),this.gammaRegularizer=jw(e.gammaRegularizer)}build(e){e=L_(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new JT(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new U_({ndim:e.length,axes:{[t]:n}})];const i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return up(()=>{const n=null!=t.training&&t.training,i=O_(e),r=i.shape,s=r.length,a=Wx(0,s),o=this.axis>=0?this.axis:this.axis+s;a.splice(o,1);const l=ix(1,s);l[o]=r[o];const c=a.slice();c.sort();const u=!Fa(c,Wx(0,s).slice(0,s-1));if(!n)return(()=>{if(u){const e=Tf(this.movingMean.read(),l),t=Tf(this.movingVariance.read(),l),n=this.center?Tf(this.beta.read(),l):null,r=this.scale?Tf(this.gamma.read(),l):null;return tk(i,e,t,n,r,this.epsilon)}return tk(i,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[d,h,p]=nk(i,this.gamma.read(),this.beta.read(),a,this.epsilon),f=(e,t,n)=>{up(()=>{const i=1-n,r=e.read(),s=jp(qm(r,t),i);e.write(qm(r,s))})};return(()=>{f(this.movingMean,h,this.momentum),f(this.movingVariance,p,this.momentum)})(),d})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:R_(this.betaInitializer),gammaInitializer:R_(this.gammaInitializer),movingMeanInitializer:R_(this.movingMeanInitializer),movingVarianceInitializer:R_(this.movingVarianceInitializer),betaRegularizer:Hw(this.betaRegularizer),gammaRegularizer:Hw(this.gammaRegularizer),betaConstraint:cS(this.betaConstraint),gammaConstraint:cS(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}ik.className="BatchNormalization",Gp(ik);class rk extends j_{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=N_(e.betaInitializer||"zeros"),this.gammaInitializer=N_(e.gammaInitializer||"ones"),this.betaRegularizer=jw(e.betaRegularizer),this.gammaRegularizer=jw(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=L_(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=t);for(const r of this.axis)if(r<0||r>=t)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==mx(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map(t=>e[t]),i=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,t){const n=O_(e),i=n.shape,r=i.length;return up(()=>{let{mean:e,variance:t}=cg(n,this.axis,!0);const s=ix(1,r);for(const n of this.axis)s[n]=i[n];const a=e=>null!=e&&e.shape.length!==r?Tf(e,s):e;let o=this.scale?a(this.gamma.read()):null,l=this.center?a(this.beta.read()):null;const c=[],u=[];for(let n=0;n<r;++n)-1!==this.axis.indexOf(n)?(c.push(i[n]),u.push(1)):(c.push(1),u.push(i[n]));return e=Am(e,c),t=Am(t,c),null!=o&&(o=Am(o,u)),null!=l&&(l=Am(l,u)),tk(n,e,t,l,o,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:R_(this.betaInitializer),gammaInitializer:R_(this.gammaInitializer),betaRegularizer:Hw(this.betaRegularizer),gammaRegularizer:Hw(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}rk.className="LayerNormalization",Gp(rk);class sk extends j_{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new JT(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new JT(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new JT(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new U_({ndim:4})]}computeOutputShape(e){let t,n;return e=L_(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return up(()=>{return t=O_(e),n=this.padding,i=this.dataFormat,up(()=>{if(4!==t.rank)throw new JT(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new JT("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==i&&(i="channelsLast"),"channelsLast"!==i&&"channelsFirst"!==i)throw new JT(`Unknown data format: ${i}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let e;return e="channelsFirst"===i?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],hg(t,e)});
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var t,n,i})}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function ak(e,t,n,i,r,s){return up(()=>{let a;Px(r),Ox(s),Dx(i),null==n&&(n=[1,1]),null==i&&(i="valid"),null==r&&(r="channelsLast"),null==s&&(s="max"),e=nI(e,r);const o="same"===i?"same":"valid";return a="max"===s?eg(e,t,n,o):xf(e,t,n,o),"channelsFirst"===r&&(a=bp(a,[0,3,1,2])),a})}function ok(e,t,n,i,r,s){return up(()=>{let a;Px(r),Ox(s),Dx(i),null==n&&(n=[1,1,1]),null==i&&(i="valid"),null==r&&(r="channelsLast"),null==s&&(s="max"),e=iI(e,r);const o="same"===i?"same":"valid";return a="max"===s?tg(e,t,n,o):_f(e,t,n,o),"channelsFirst"===r&&(a=bp(a,[0,4,1,2,3])),a})}sk.className="ZeroPadding2D",Gp(sk);class lk extends j_{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new JT(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);this.poolSize=e.poolSize}if(vx(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new JT(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);this.strides=e.strides}vx(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,Dx(this.padding),this.inputSpec=[new U_({ndim:3})]}computeOutputShape(e){const t=eI((e=L_(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return up(()=>{this.invokeCallHook(e,t),e=Kx(O_(e),2);const n=this.poolingFunction(O_(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ab(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class ck extends lk{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Px(r),Dx(i),ak(e,t,n,i,r,"max")}}ck.className="MaxPooling1D",Gp(ck);class uk extends lk{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Px(r),Dx(i),ak(e,t,n,i,r,"avg")}}uk.className="AveragePooling1D",Gp(uk);class dk extends j_{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new JT(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];vx(this.poolSize,"poolSize"),vx(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Px(this.dataFormat),Dx(this.padding),this.inputSpec=[new U_({ndim:4})]}computeOutputShape(e){e=L_(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=eI(t,this.poolSize[0],this.padding,this.strides[0]),n=eI(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return up(()=>(this.invokeCallHook(e,t),this.poolingFunction(O_(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class hk extends dk{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Px(r),Dx(i),ak(e,t,n,i,r,"max")}}hk.className="MaxPooling2D",Gp(hk);class pk extends dk{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Px(r),Dx(i),ak(e,t,n,i,r,"avg")}}pk.className="AveragePooling2D",Gp(pk);class fk extends j_{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new JT(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];vx(this.poolSize,"poolSize"),vx(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Px(this.dataFormat),Dx(this.padding),this.inputSpec=[new U_({ndim:5})]}computeOutputShape(e){e=L_(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[4]:e[3];return t=eI(t,this.poolSize[0],this.padding,this.strides[0]),n=eI(n,this.poolSize[1],this.padding,this.strides[1]),i=eI(i,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,i]:[e[0],t,n,i,e[4]]}call(e,t){return up(()=>(this.invokeCallHook(e,t),this.poolingFunction(O_(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class mk extends fk{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Px(r),Dx(i),ok(e,t,n,i,r,"max")}}mk.className="MaxPooling3D",Gp(mk);class gk extends fk{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return Px(r),Dx(i),ok(e,t,n,i,r,"avg")}}gk.className="AveragePooling3D",Gp(gk);class bk extends j_{constructor(e){super(e),this.inputSpec=[new U_({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new ex}}class yk extends bk{constructor(e){super(e||{})}call(e,t){return up(()=>{const t=O_(e);return ig(t,1)})}}yk.className="GlobalAveragePooling1D",Gp(yk);class vk extends bk{constructor(e){super(e||{})}call(e,t){return up(()=>{const t=O_(e);return gm(t,1)})}}vk.className="GlobalMaxPooling1D",Gp(vk);class Tk extends j_{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Px(this.dataFormat),this.inputSpec=[new U_({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new ex}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class xk extends Tk{call(e,t){return up(()=>{const t=O_(e);return"channelsLast"===this.dataFormat?ig(t,[1,2]):ig(t,[2,3])})}}xk.className="GlobalAveragePooling2D",Gp(xk);class _k extends Tk{call(e,t){return up(()=>{const t=O_(e);return"channelsLast"===this.dataFormat?gm(t,[1,2]):gm(t,[2,3])})}}_k.className="GlobalMaxPooling2D",Gp(_k);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Sk extends j_{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){const i=wS(t.layer,n);delete t.layer;const r={layer:i};return Object.assign(r,t),new e(r)}}class wk extends Sk{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=L_(e)).length<3)throw new JT(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=L_(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),i=e[1];return[n[0],i].concat(n.slice(1))}call(e,t){return up(()=>yI((e,n)=>[O_(this.layer.call(e,t)),[]],e=O_(e),[],!1,null,null,!1,!0)[1])}}wk.className="TimeDistributed",Gp(wk);class Ik extends Sk{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=wS(n),t.goBackwards=!0!==t.goBackwards;const i={};var r;if(i.className=e.layer.getClassName(),i.config=t,this.backwardLayer=wS(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,r=this.mergeMode,bx(Rx,"BidirectionalMergeMode",r),e.weights)throw new ex("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,i,r=this.forwardLayer.computeOutputShape(e);return Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),this.returnState?(i=r.slice(1),t=r[0]):t=r[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(i).concat(i.slice()):[t].concat(i).concat(i.slice()):ax(n)}apply(e,t){let n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});const r=bI(e,n,i,this.numConstants);if(e=r.inputs,n=r.initialState,i=r.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==i)return super.apply(e,t);const s=[],a=[];if(null!=n){const e=n.length;if(e%2>0)throw new JT("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);const i=n.map(e=>new U_({shape:e.shape}));this.forwardLayer.stateSpec=i.slice(0,e/2),this.backwardLayer.stateSpec=i.slice(e/2),a.push(...i)}if(null!=i)throw new ex("Support for constants in Bidirectional layers is not implemented yet.");const o=s[0]instanceof G_;for(const l of s)if(l instanceof G_!==o)throw new JT("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(s),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const o=super.apply(n,t);return this.inputSpec=r,o}return super.apply(e,t)}call(e,t){return up(()=>{const n=t.initialState;let i,r,s,a;if(null==n)i=this.forwardLayer.call(e,t),r=this.backwardLayer.call(e,t);else{const s=n.slice(0,n.length/2),a=n.slice(n.length/2);i=this.forwardLayer.call(e,Object.assign(t,{initialState:s})),r=this.backwardLayer.call(e,Object.assign(t,{initialState:a}))}return this.returnState&&(Array.isArray(i)&&(s=i.slice(1).concat(r.slice(1))),i=i[0],r=r[0]),this.returnSequences&&(r=Ug(r,1)),"concat"===this.mergeMode?a=Jx([i,r]):"sum"===this.mergeMode?a=Vp(i,r):"ave"===this.mergeMode?a=jp(.5,Vp(i,r)):"mul"===this.mergeMode?a=jp(i,r):null==this.mergeMode&&(a=[i,r]),this.returnState?null==this.mergeMode?a.concat(s):[a].concat(s):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Mx(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Mx(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=wS(t.layer);if(delete t.layer,null!=t.numConstants)throw new ex("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=t;return i.layer=n,new e(i)}}Ik.className="Bidirectional",Gp(Ik);
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class kk extends j_{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return up(()=>("float32"!==(e=O_(e)).dtype&&(e=Xx(e,"float32")),Vp(jp(e,this.scale),this.offset)))}}kk.className="Rescaling",Gp(kk);
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Ck,Ek,Ak,Rk,Nk;mo().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),(Ek=Ck||(Ck={}))[Ek.DT_INVALID=0]="DT_INVALID",Ek[Ek.DT_FLOAT=1]="DT_FLOAT",Ek[Ek.DT_DOUBLE=2]="DT_DOUBLE",Ek[Ek.DT_INT32=3]="DT_INT32",Ek[Ek.DT_UINT8=4]="DT_UINT8",Ek[Ek.DT_INT16=5]="DT_INT16",Ek[Ek.DT_INT8=6]="DT_INT8",Ek[Ek.DT_STRING=7]="DT_STRING",Ek[Ek.DT_COMPLEX64=8]="DT_COMPLEX64",Ek[Ek.DT_INT64=9]="DT_INT64",Ek[Ek.DT_BOOL=10]="DT_BOOL",Ek[Ek.DT_QINT8=11]="DT_QINT8",Ek[Ek.DT_QUINT8=12]="DT_QUINT8",Ek[Ek.DT_QINT32=13]="DT_QINT32",Ek[Ek.DT_BFLOAT16=14]="DT_BFLOAT16",Ek[Ek.DT_QINT16=15]="DT_QINT16",Ek[Ek.DT_QUINT16=16]="DT_QUINT16",Ek[Ek.DT_UINT16=17]="DT_UINT16",Ek[Ek.DT_COMPLEX128=18]="DT_COMPLEX128",Ek[Ek.DT_HALF=19]="DT_HALF",Ek[Ek.DT_RESOURCE=20]="DT_RESOURCE",Ek[Ek.DT_VARIANT=21]="DT_VARIANT",Ek[Ek.DT_UINT32=22]="DT_UINT32",Ek[Ek.DT_UINT64=23]="DT_UINT64",Ek[Ek.DT_FLOAT_REF=101]="DT_FLOAT_REF",Ek[Ek.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",Ek[Ek.DT_INT32_REF=103]="DT_INT32_REF",Ek[Ek.DT_UINT8_REF=104]="DT_UINT8_REF",Ek[Ek.DT_INT16_REF=105]="DT_INT16_REF",Ek[Ek.DT_INT8_REF=106]="DT_INT8_REF",Ek[Ek.DT_STRING_REF=107]="DT_STRING_REF",Ek[Ek.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",Ek[Ek.DT_INT64_REF=109]="DT_INT64_REF",Ek[Ek.DT_BOOL_REF=110]="DT_BOOL_REF",Ek[Ek.DT_QINT8_REF=111]="DT_QINT8_REF",Ek[Ek.DT_QUINT8_REF=112]="DT_QUINT8_REF",Ek[Ek.DT_QINT32_REF=113]="DT_QINT32_REF",Ek[Ek.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",Ek[Ek.DT_QINT16_REF=115]="DT_QINT16_REF",Ek[Ek.DT_QUINT16_REF=116]="DT_QUINT16_REF",Ek[Ek.DT_UINT16_REF=117]="DT_UINT16_REF",Ek[Ek.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",Ek[Ek.DT_HALF_REF=119]="DT_HALF_REF",Ek[Ek.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",Ek[Ek.DT_VARIANT_REF=121]="DT_VARIANT_REF",Ek[Ek.DT_UINT32_REF=122]="DT_UINT32_REF",Ek[Ek.DT_UINT64_REF=123]="DT_UINT64_REF",Rk=Ak||(Ak={}),(Nk=Rk.CheckpointFormatVersion||(Rk.CheckpointFormatVersion={}))[Nk.LEGACY=0]="LEGACY",Nk[Nk.V1=1]="V1",Nk[Nk.V2=2]="V2";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Pk,Dk;(Dk=Pk||(Pk={}))[Dk.FAIL=0]="FAIL",Dk[Dk.SHORTEST=1]="SHORTEST",Dk[Dk.LONGEST=2]="LONGEST";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ok(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&Pa("complex64"!==e.dtype,()=>`${t} does not support complex64 tensors in the CPU backend.`)})}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lk=yb;class Mk extends ka{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Ia(this,lp())}nextDataId(){return Mk.nextDataId++}write(e,t,n){this.firstUse&&(this.firstUse=!1,mo().get("IS_NODE")&&Iu("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:n,refCount:1}),i}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&Ya(n[0])){const r=n.map(e=>xd(e));i=this.write(r,e,t)}else i=this.write(n,e,t);return{dataId:i,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,i,r){this.data.set(e,{values:t,dtype:i,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return jy(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>_d(e));return Zh(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return Zh(e.shape,e.dtype,t)}makeOutput(e,t,n){return lp().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Td();e();return{kernelMs:Td()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ok([e],"where");const t=this.readSync(e.dataId);return Lk(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fk(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}Mk.nextDataId=0;const $k={kernelName:To,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;Ok(t,"abs");let i=new Float32Array(Ma(t.shape));return i=Fk(n.data.get(t.dataId).values),n.makeOutput(i,t.shape,t.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bk(e){return(t,n,i,r,s)=>{const a=Tp(t,n),o=a.length,l=to(a),c=Wa(s,Ma(a)),u=t.length,d=n.length,h=to(t),p=to(n),f=yp(t,a),m=yp(n,a);if(f.length+m.length===0)for(let g=0;g<c.length;++g)c[g]=e(i[g%i.length],r[g%r.length]);else for(let g=0;g<c.length;++g){const t=co(g,o,l),n=t.slice(-u);f.forEach(e=>n[e]=0);const s=lo(n,u,h),a=t.slice(-d);m.forEach(e=>a[e]=0);const b=lo(a,d,p);c[g]=e(i[s],r[b])}return[c,a]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zk(e){const{inputs:t,backend:n}=e,{real:i,imag:r}=t,s=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,o=n.makeTensorInfo(i.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(i.shape,"float32",s),imag:n.makeTensorInfo(r.shape,"float32",a)},o}const Uk={kernelName:Wo,backendName:"cpu",kernelFunc:zk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gk(e,t,n="float32"){if("complex64"===n){return zk({inputs:{real:Gk(e,t,"float32"),imag:Gk(e,t,"float32")},backend:e})}const i=so(Ma(t),n);return e.makeTensorInfo(t,n,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vk(e){const{inputs:t,backend:n}=e,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const Hk={kernelName:Dl,backendName:"cpu",kernelFunc:Vk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wk(e){const{inputs:t,backend:n}=e,{input:i}=t,r=n.data.get(i.dataId).complexTensorInfos.real,s=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,s)}const jk={kernelName:Ic,backendName:"cpu",kernelFunc:Wk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qk(e,t,n,i){if("int32"===i){return[t,"int32",Int32Array.from(e)]}if("bool"===i){const i=vd([0],n),[r,s]=Bk((e,t)=>e!==t?1:0)(t,[],e,i,"bool");return[s,"bool",r]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}function Xk(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{dtype:s}=i;if("complex64"===s){if("complex64"===r.dtype)return Vk({inputs:{x:r},backend:n});const e=Gk(n,r.shape,r.dtype),t=Xk({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),i=zk({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),i}if("complex64"===r.dtype){const e=Wk({inputs:{input:r},backend:n}),t=Xk({inputs:{x:e},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(e),t}if(!qa(r.dtype,s)){const e=Vk({inputs:{x:r},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:s}}const a=n.data.get(r.dataId).values,[o,l,c]=qk(a,r.shape,r.dtype,s);return n.makeTensorInfo(o,l,c)}const Kk={kernelName:Go,backendName:"cpu",kernelFunc:Xk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yk(e,t,n,i){return null==n?({inputs:n,backend:r})=>{const{a:s,b:a}=n,o=r;Ok([s,a],e);const l=o.data.get(s.dataId).values,c=o.data.get(a.dataId).values,u="string"===s.dtype?Iv(l):l,d="string"===s.dtype?Iv(c):c,h=i||s.dtype,[p,f]=t(s.shape,a.shape,u,d,h);return o.makeTensorInfo(f,h,p)}:({inputs:e,backend:r})=>{const{a:s,b:a}=e,o=r;if("complex64"===s.dtype||"complex64"===a.dtype){const e=Xk({inputs:{x:s},backend:o,attrs:{dtype:"complex64"}}),t=o.data.get(e.dataId),i=t.complexTensorInfos.real,r=t.complexTensorInfos.imag,l=o.data.get(i.dataId).values,c=o.data.get(r.dataId).values,u=Xk({inputs:{x:a},backend:o,attrs:{dtype:"complex64"}}),d=o.data.get(u.dataId),h=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,f=o.data.get(h.dataId).values,m=o.data.get(p.dataId).values,[g,b,y]=n(s.shape,a.shape,l,c,f,m),v=o.makeTensorInfo(y,"float32",g),T=o.makeTensorInfo(y,"float32",b),x=zk({inputs:{real:v,imag:T},backend:o});return o.disposeIntermediateTensorInfo(e),o.disposeIntermediateTensorInfo(u),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(T),x}{const e=o.data.get(s.dataId).values,n=o.data.get(a.dataId).values,r=i||s.dtype,[l,c]=t(s.shape,a.shape,e,n,r);return o.makeTensorInfo(c,r,l)}}}function Zk(e){return(t,n,i,r,s,a)=>{const o=Tp(t,n),l=Ma(o),c=o.length,u=to(o),d=Wa("float32",l),h=Wa("float32",l),p=yp(t,o),f=yp(n,o),m=jy(i,r),g=jy(s,a),b=t.length,y=to(t),v=n.length,T=to(n);if(p.length+f.length===0)for(let x=0;x<d.length;x++){const t=x%m.length,n=x%g.length,i=e(m[2*t],m[2*t+1],g[2*n],g[2*n+1]);d[x]=i.real,h[x]=i.imag}else for(let x=0;x<d.length;x++){const t=co(x,c,u),n=t.slice(-b);p.forEach(e=>n[e]=0);const i=lo(n,b,y),r=t.slice(-v);f.forEach(e=>r[e]=0);const s=lo(r,v,T),a=e(m[2*i],m[2*i+1],g[2*s],g[2*s+1]);d[x]=a.real,h[x]=a.imag}return[d,h,o]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qk=Bk((e,t)=>e+t),Jk=Zk((e,t,n,i)=>({real:e+n,imag:t+i})),eC=Yk(So,Qk,Jk),tC={kernelName:So,backendName:"cpu",kernelFunc:eC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nC(e,t,n,i,r){const s=Ma(i),a=so(r,n);for(let o=0;o<e.length;o++){const n=e[o];if(n<0)throw new Error("Input x must be non-negative!");n>=r||(a[n]+=s>0?t[o]:1)}return a}function iC(e,t,n,i=!1){const r=e.shape[0],s=e.shape[1],a=Zh([r,n],t.dtype);for(let o=0;o<r;o++)for(let r=0;r<s;r++){const s=e.get(o,r);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(i?a.set(1,o,s):t.size>0?a.set(a.get(o,s)+t.get(o,r),o,s):a.set(a.get(o,s)+1,o,s))}return a}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rC(e){return(t,n,i)=>{const r=Wa(n,t.length);for(let s=0;s<t.length;++s)r[s]=e(t[s],i);return r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sC(e,t,n){return({inputs:i,attrs:r,backend:s})=>{const{x:a}=i;if(Ok(a,e),"string"===a.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const o=s,l=o.data.get(a.dataId).values,c=Ma(a.shape),u=n||a.dtype,d=ja(u,c);for(let e=0;e<c;++e)d[e]=t(l[e],r);return o.makeTensorInfo(a.shape,u,d)}}function aC(e,t,n){return({inputs:i,attrs:r,backend:s})=>{const{x:a}=i;if(Ok(a,e),"string"===a.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const o=s,l=o.data.get(a.dataId).values,c=n||a.dtype,u=t(l,c,r);return o.makeTensorInfo(a.shape,c,u)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oC=rC(e=>Math.ceil(e)),lC=aC(Vo,oC),cC={kernelName:Vo,backendName:"cpu",kernelFunc:lC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uC(e,t,n,i){const r=ja(n,Ma(t));if(i&&"string"!==n){let t=0;e.forEach(e=>{const n=Ma(e.shape);r.set(e.vals,t),t+=n})}else{let i=0;e.forEach(e=>{const s="string"===n?Iv(e.vals):e.vals;let a=0;for(let n=0;n<e.shape[0];++n){const o=n*t[1]+i;for(let t=0;t<e.shape[1];++t)r[o+t]=s[a++]}i+=e.shape[1]})}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dC=Bk((e,t)=>e===t?1:0),hC=Yk(vl,dC,null,"bool"),pC={kernelName:vl,backendName:"cpu",kernelFunc:hC},fC=rC(e=>Math.exp(e)),mC=aC(Tl,fC,"float32"),gC={kernelName:Tl,backendName:"cpu",kernelFunc:mC},bC=rC(e=>Math.expm1(e)),yC=aC(_l,bC),vC={kernelName:_l,backendName:"cpu",kernelFunc:yC},TC=rC(e=>Math.floor(e)),xC=aC(kl,TC),_C={kernelName:kl,backendName:"cpu",kernelFunc:xC};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SC(e,t,n,i,r,s,a,o,l){const c=Zh([i,s],n);for(let u=0;u<i;u++){const n=[];let i=0;for(let t=0;t<r;t++){const s=e[u*r+t];i+=s*a[t],n.push(s)}if(i<0||i>=l/s)throw new Error(`Invalid indices: ${n} does not index into ${o}`);for(let e=0;e<s;e++)c.values[u*s+e]=t.get(...t.indexToLoc(i*s+e))}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wC(e,t,n){const i=Zh(n,e.dtype);for(let r=0;r<i.size;++r){const n=i.indexToLoc(r).slice(),s=n[0],a=n[2],o=t.locToIndex([s,a]);n[2]=t.values[o];const l=e.locToIndex(n);0<=l&&l<e.values.length&&(i.values[r]=e.values[l])}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC=Bk((e,t)=>e>t?1:0),kC=Yk(Nl,IC,null,"bool"),CC={kernelName:Nl,backendName:"cpu",kernelFunc:kC},EC=Bk((e,t)=>e>=t?1:0),AC=Yk(Pl,EC,null,"bool"),RC={kernelName:Pl,backendName:"cpu",kernelFunc:AC},NC=Bk((e,t)=>e<t?1:0),PC=Yk(zl,NC,null,"bool"),DC={kernelName:zl,backendName:"cpu",kernelFunc:PC},OC=Bk((e,t)=>e<=t?1:0),LC=Yk(Ul,OC,null,"bool"),MC={kernelName:Ul,backendName:"cpu",kernelFunc:LC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FC(e,t,n){const i=(t-e)/(n-1),r=so(n,"float32");r[0]=e;for(let s=1;s<r.length;s++)r[s]=r[s-1]+i;return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $C=rC(e=>Math.log(e)),BC=aC(Vl,$C),zC={kernelName:Vl,backendName:"cpu",kernelFunc:BC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function UC(e,t,n,i){const r=Wa(i,Ma(n));for(let s=0;s<r.length;++s){const n=s*t;let i=e[n];for(let r=0;r<t;++r){const t=e[n+r];(Number.isNaN(t)||t>i)&&(i=t)}r[s]=i}return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GC=Bk((e,t)=>Math.max(e,t)),VC=Yk(Zl,GC),HC={kernelName:Zl,backendName:"cpu",kernelFunc:VC},WC=Bk((e,t)=>Math.min(e,t)),jC=Yk(sc,WC),qC={kernelName:sc,backendName:"cpu",kernelFunc:jC},XC=Bk((e,t)=>e*t),KC=Zk((e,t,n,i)=>({real:e*n-t*i,imag:e*i+t*n})),YC=Yk(cc,XC,KC),ZC={kernelName:cc,backendName:"cpu",kernelFunc:YC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function QC(e,t,n){const i=yd(-1,n);return XC([],t,i,e,n)}const JC={kernelName:uc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;Ok(i,"neg");const r=n.data.get(i.dataId).values,[s,a]=QC(r,i.shape,i.dtype);return n.makeTensorInfo(a,i.dtype,s)}},eE=Bk((e,t)=>e!==t?1:0),tE=Yk(dc,eE,null,"bool"),nE={kernelName:dc,backendName:"cpu",kernelFunc:tE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iE(e,t,n,i,r){const s=t.length,a=Ma(t),o=to(t),l=to(r),c=Wa(n,Ma(r));for(let u=0;u<a;++u){const t=co(u,s,o),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[i[e]];c[lo(n,s,l)]=e[u]}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(e){const{inputs:t,attrs:n,backend:i}=e,{x:r}=t,{perm:s}=n;Ok(r,"transpose");const a=r.shape.length,o=new Array(a);for(let c=0;c<o.length;c++)o[c]=r.shape[s[c]];const l=iE(i.data.get(r.dataId).values,r.shape,r.dtype,s,o);return{dataId:i.write(l,o,r.dtype),shape:o,dtype:r.dtype}}const sE={kernelName:mu,backendName:"cpu",kernelFunc:rE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(e,t,n,i){const[r,s]=um(e,i),a=Xd(t,"int32"),o=so(Ma(r),a),l=Ma(s);for(let c=0;c<o.length;++c){const e=c*l;let t=1;for(let i=0;i<l;++i)t*=n[e+i];o[c]=t}return{outVals:o,outShape:r,outDtype:a}}const oE={kernelName:xc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;Ok(r,"prod");const o=r.shape.length,l=Va(s,r.shape),c=pm(l,o);let u=l,d=r;const h=[];null!=c&&(d=rE({inputs:{x:r},backend:n,attrs:{perm:c}}),h.push(d),u=mm(u.length,o));const p=n.data.get(d.dataId).values,{outVals:f,outShape:m,outDtype:g}=aE(d.shape,d.dtype,p,u);let b=m;return a&&(b=dm(m,l)),h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(b,g,f)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(e,t,n,i){const r=[];let s=0;const a=t.length-1+n.length,o=new Array(a).fill(null).map(()=>[0]);!function(e,t){for(let n=0;n<e.length;++n){const i=e[n],r=n===e.length-1?t:e[n+1].length;if(0===i.length)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>r)throw new Error("Ragged splits must not point past values");for(let e=1;e<i.length;++e)if(i[e-1]>i[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,i);let l=1;for(let c=0;c<t.length-1;++c){l*=t[c];const e=t[c+1];for(let t=1;t<l+1;++t)o[c].push(t*e)}for(let c=0;c<e.length;++c){let i=e[c],a=e[c]+1;for(let e=0;e<n.length;++e){const r=n[e],s=e+t.length-1;if(s>=0){const e=o[s],t=e[e.length-1]-r[i];for(let n=i;n<a;++n)o[s].push(r[n+1]+t)}i=r[i],a=r[a]}a!==i&&(r.push([i,a]),s+=a-i)}return{outSplits:o,valueSlices:r,numValues:s}}function cE(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let i=t;i<e.length;i++)n[t-1]*=e[i];return n}function uE(e,t,n,i,r){const s=t.slice();s[0]=r;const a=ja(n,Ma(s)),o=e.length;return function(e,t,n,i,r,s){const a=cE(t,2)[1],o=cE(s,2)[1];let l=0;for(const c of n)for(let t=c[0];t<c[1];++t){for(let n=0;n<i;++n)r[l*o+n]=e[t*a+n];++l}}(e,t,i,0===o?0:o/t[0],a,s),[a,s]}function dE(e,t,n,i,r,s,a,o){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((e,i)=>{if(e<0||e>=n){const r=co(i,t.length,to(t)).join(",");throw new Error(`indices[${r}] = ${e} is not in [0, ${n})`)}})}(s,a,t[0][0]-1),0===i.length)throw new Error("params.rank must be nonzero");const l=i[0],{outSplits:c,valueSlices:u,numValues:d}=lE(s,a,e,l),h=function(e){const t=[];for(let n=0;n<e.length;++n){const i=ja("int32",e[n].length);t.push(i),e[n].forEach((e,t)=>i[t]=e)}return t}(c),p=uE(n,i,r,u,d);return[h,p[0],p[1]]}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hE=Iy;class pE{constructor(e,t,n,i,r,s,a,o,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=i,this.valuesDType=r,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=Ey(c),this.raggedRank=Ay(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===hE.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===hE.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case hE.VALUE_ROWIDS:return pE.getMaxWidthValueRowID(t);case hE.ROW_SPLITS:return pE.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${hE[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let i=0;i<t-1;++i){const t=e[i+1]-e[i];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,i=e[0],r=0;for(let s=1;s<t;++s){const t=e[s];t!==i&&(i=t,r=Math.max(s-n,r),n=s)}return Math.max(t-n,r)}tensorShapeFromTensor(e,t,n=!0){if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return mE(e,n)}calculateOutputSize(e){const t=this.valuesShape;Ry(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=Cy(this.raggedRank,n,t);i[0]<0&&(i[0]=e);for(let r=1;r<=this.raggedRank;++r)i[r]<0&&(i[r]=this.getMaxWidth(r));return i}calculateFirstParentOutputIndex(e,t,n){const i=Math.min(e,n),r=[];let s=0;for(let a=0;a<i;++a,s+=t)r.push(s);for(let a=i;a<e;++a)r.push(-1);return Pa(r.length===e,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(e,t,n,i){const r=e.length,s=[];for(let a=0;a<r-1;++a){const r=e[a+1]-e[a];let o=Math.min(i,r),l=t[a];-1===l&&(o=0);for(let e=0;e<o;++e)s.push(l),l+=n;for(let e=0;e<r-o;++e)s.push(-1)}if(r>0&&s.length!==e[r-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(e,t,n,i){const r=e.length,s=[];if(0===r)return[];let a=0,o=e[0];if(o>=t.length)throw new Error(`Got currentValueRowId=${o}, which is not less than ${t.length}`);let l=t[o];s.push(l);for(let c=1;c<r;++c){const r=e[c];if(r===o)l>=0&&(++a,a<i?l+=n:l=-1);else{if(a=0,o=r,r>=t.length)throw new Error(`Got nextValueRowId=${r} which is not less than ${t.length}`);l=t[r]}s.push(l)}if(s.length!==e.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(e,t,n,i){const r=this.getRowPartitionTensor(e),s=this.getRowPartitionTypeByDimension(e);switch(s){case hE.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,t,n,i);case hE.ROW_SPLITS:if(r.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${r.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(r,t,n,i);default:throw new Error(`Unsupported partition type: ${hE[s]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case hE.FIRST_DIM_SIZE:return e[0];case hE.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case hE.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${hE[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let s=n.length-2;s>=0;--s)n[s]=n[s+1]*t[s+1];const i=mE(t,!1),r=ja(this.valuesDType,Ma(i));if(n[0]*t[0]>0){let s=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){s=this.calculateOutputIndex(e-1,s,n[e],t[e])}this.setOutput(this.raggedRank,s,r,i)}return[i,r]}setOutput(e,t,n,i){if(0===n.length)return;const r=this.values,s=n;let a=i.slice();a=a.slice(e+1);const o=Ma(a),l=t.length;let c=this.defaultValue;if(c.length!==o&&1!==c.length){const e=this.defaultValueShape;up(()=>{const t=Tf(c,e),n=Df(t,a);c=n.dataSync()})}let u=0,d=0,h=0;for(let p=0;p<=l;++p){let e=p<l?t[p]:-1;if(e!==h){if(d<h){const e=r.subarray(u*o);fE(s.subarray(d*o),e,(h-d)*o)}if(p>=l){const t=n.length;e=Math.floor(t/o)}if(e>h)if(1===this.defaultValue.length)s.subarray(h*o,e*o).fill(this.defaultValue[0]),h=e;else for(;e>h;){fE(s.slice(h*o),c,o),++h}e<0?(u=p+1,d=h):(u=p,d=h,h=d+1)}else++h}}}function fE(e,t,n){for(let i=0;i<n;i++)e[i]=t[i]}function mE(e,t){const n=[];for(let i of e){if(i<0){if(!t)throw new Error(`Dimension ${i} must be >= 0`);if(i<-1)throw new Error(`Dimension ${i} must be >= -1`);i=-1}n.push(i)}return n}function gE(e,t,n,i,r,s,a,o,l,c){return new pE(e,t,n,i,r,s,a,o,l,c).compute()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bE(e,t,n,i){if(e===t||e<t&&n<0||t<e&&n>1)return so(0,i);const r=so(Math.abs(Math.ceil((t-e)/n)),i);t<e&&1===n&&(n=-1),r[0]=e;for(let s=1;s<r.length;s++)r[s]=r[s-1]+n;return r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yE=rC(e=>1/Math.sqrt(e)),vE=aC(Mc,yE),TE={kernelName:Mc,backendName:"cpu",kernelFunc:vE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xE(e,t,n,i,r,s,a,o,l,c){const u=[i/r,r],d=e.values,h=t.values;if(0===i)return Zh(n,t.dtype);const p=Zh(u,t.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let f=0;f<s;f++){const e=[];let s=0;for(let t=0;t<a;t++){const n=d[f*a+t];e.push(n),s+=n*o[t]}if(s<0||s>=i/r)throw new Error(`Invalid indices: ${e} does not index into ${n}`);for(let n=0;n<r;n++)c?p.values[s*r+n]+=h[f*r+n]:p.values[s*r+n]=0===t.rank?h[0]:h[f*r+n]}return p}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _E=rC(e=>1/(1+Math.exp(-e))),SE=sC(Wc,e=>1/(1+Math.exp(-e))),wE={kernelName:Wc,backendName:"cpu",kernelFunc:SE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IE(e,t,n,i,r){const s=Op(i,t,n),a=Ma(n),o=to(i);if(s){const n=Lp(t,o);return"string"===r?e.slice(n,n+a):e.subarray(n,n+a)}const l=Zh(i,r,"string"===r?Iv(e):e),c=Zh(n,r);for(let u=0;u<c.size;++u){const e=c.indexToLoc(u),n=e.map((e,n)=>e+t[n]);c.set(l.get(...n),...e)}return"string"===r?kv(c.values):c.values}function kE(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,size:a}=i;Ok(r,"slice");const[o,l]=Mp(r,s,a);wp(r,o,l);const c=IE(n.data.get(r.dataId).values,o,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const CE={kernelName:Uc,backendName:"cpu",kernelFunc:kE};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(e,t,n,i,r,s,a){const o=t[0],l=s[0],c=new Array(l),u=new Array(o),d=t[1];if(0===l){if(0!==o)throw new Error(cv(o));return[ja(n,0),[0,d],ja(r,0),c,u]}let h=!0,p=0;const f=new Array(l).fill(0);for(let g=0;g<o;++g){const t=e[g*d];if(t<0)throw new Error(uv(g,t));if(t>=l)throw new Error(dv(g,t,l));++f[t],h=h&&t>=p,p=t}let m=!0;for(let g=0;g<l;++g){const e=0===f[g];c[g]=e,m=m&&!e,f[g]=Math.max(f[g],1),g>0&&(f[g]+=f[g-1])}if(m&&h){const t=e,n=i;for(let e=0;e<o;++e)u[e]=e;return[t,[o,d],n,c,u]}{const t=f[l-1],s=ja(n,t*d),h=ja(r,t),p=new Array(l).fill(0);for(let n=0;n<o;++n){const t=e[n*d],r=p[t],a=(0===t?0:f[t-1])+r;p[t]++;for(let i=0;i<d;++i)s[a*d+i]=e[n*d+i];h[a]=i[n],u[n]=a}for(let e=0;e<l;++e){if(0===p[e]){const t=0===e?0:f[e-1];s[t*d+0]=e;for(let e=1;e<d;++e)s[t*d+e]=0;h[t]=a}}return[s,[t,d],h,c,u]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(e,t,n,i,r){const s=Ma(i),a=t[0],o=r.length,l=[];let c=1,u=-1;for(let m=0;m<o;++m){const e=r[m];if(-1===e){if(-1!==u)throw new Error(hv(u,m));u=m,l.push(1)}else{if(e<0)throw new Error(pv(m,e));c*=e,l.push(e)}}if(-1!==u){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(s/c);if(c*e!==s)throw new Error(mv(i,l));l[u]=e}if(Ma(l)!==s)throw new Error(gv(i,l));const d=i.length,h=[];if(d>0){h[d-1]=1;for(let e=d-2;e>=0;--e)h[e]=h[e+1]*i[e+1]}const p=[];if(o>0){p[o-1]=1;for(let e=o-2;e>=0;--e)p[e]=p[e+1]*l[e+1]}const f=ja(n,a*o);for(let m=0;m<a;++m){let t=0;for(let n=0;n<d;++n)t+=e[m*d+n]*h[n];for(let e=0;e<o;++e)f[m*o+e]=Math.trunc(t/p[e]),t%=p[e]}return[f,[a,o],l]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RE(e,t,n,i,r,s=!1,a=0){const o=i.length,l=[t[0],e.length/t[0]],c=l[1],u=o>0?r[o-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const d=t.slice();d[0]=u;const h=ja(n,d.reduce((e,t)=>e*t,1));if(0===o)return u>0&&h.fill(a),[h,d];if(u<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,m=0,g=r[p];for(;;){let t=0;if(f<o){if(t=r[f],g===t){++f;continue}if(g>=t)throw new Error(yv())}if(g<0||g>=u)throw new Error(vv(g,u));g>m&&h.fill(a,m*c,g*c);for(let n=p;n<f;++n){const t=i[n];if(t<0||t>=l[0])throw new Error(Tv(n,i[n],l[0]));for(let n=0;n<c;n++)h[g*c+n]+=e[t*c+n]}if(s)for(let e=0;e<c;e++)h[g*c+e]/=f-p;if(p=f,++f,m=g+1,g=t,f>o)break}return m<u&&h.fill(a,m*c,u*c),[h,d]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NE=rC(e=>Math.sqrt(e)),PE=sC(qc,e=>Math.sqrt(e)),DE={kernelName:qc,backendName:"cpu",kernelFunc:PE},OE=Bk((e,t)=>{const n=e-t;return n*n}),LE=Yk(iu,OE),ME={kernelName:iu,backendName:"cpu",kernelFunc:LE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FE(e,t,n,i){const r=Zh(e,t.dtype);for(let s=0;s<r.size;s++){const e=r.indexToLoc(s),a=new Array(e.length);for(let t=0;t<a.length;t++)a[t]=e[t]*n[t]+i[t];r.set(t.get(...a),...e)}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $E{constructor(e,t,n,i,r,s){this.separator=xd(e),this.nGramWidths=t,this.leftPad=xd(n),this.rightPad=xd(i),this.padWidth=r,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,i,r,s){for(let a=0;a<r;++a){const o=this.getPadWidth(s),l=Math.max(0,o-a),c=Math.max(0,o-(r-(a+1))),u=s-(l+c),d=t+(l>0?0:a-o);let h=0;h+=l*this.leftPad.length;for(let t=0;t<u;++t)h+=e[d+t].length;h+=c*this.rightPad.length;h+=(l+c+u-1)*this.separator.length,n[i+a]=new Uint8Array(h);const p=n[i+a];let f=0;const m=e=>e.forEach(e=>p[f++]=e);for(let e=0;e<l;++e)m(this.leftPad),m(this.separator);for(let t=0;t<u-1;++t)m(e[d+t]),m(this.separator);if(u>0){m(e[d+u-1]);for(let e=0;e<c;++e)m(this.separator),m(this.rightPad)}else{for(let e=0;e<c-1;++e)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,t){const n=e.length,i=t.length;if(i>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let r=1;r<i;++r){let i=t[r]>=e;if(i=i&&t[r]<=n,!i)throw new Error(`Invalid split value ${t[r]}, must be in [${e}, ${n}]`);e=t[r]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}const r=i-1,s=ja("int32",i);if(0===n||0===i){const e=new Array(n);for(let t=0;t<=r;++t)s[t]=0;return[e,s]}s[0]=0;for(let o=1;o<=r;++o){const e=t[o]-t[o-1];let n=0;this.nGramWidths.forEach(t=>{n+=this.getNumNGrams(e,t)}),this.preserveShort&&e>0&&0===n&&(n=1),s[o]=s[o-1]+n}const a=new Array(s[r]);for(let o=0;o<r;++o){const n=t[o];let i=s[o];if(this.nGramWidths.forEach(r=>{const s=t[o+1]-t[o],l=this.getNumNGrams(s,r);this.createNGrams(e,n,a,i,l,r),i+=l}),this.preserveShort&&i===s[o]){const r=t[o+1]-t[o];if(0===r)continue;const s=r+2*this.padWidth,l=1;this.createNGrams(e,n,a,i,l,s)}}return[a,s]}}function BE(e,t,n,i,r,s,a,o){return new $E(n,i,r,s,a,o).compute(e,t)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(e,t,n,i){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)i.push(e.subarray(t,t+1));return}if(1===t.length){const r=t[0];let s=e.indexOf(r);for(;-1!==s;){const t=e.subarray(0,s);n&&0===t.length||i.push(t),s=(e=e.subarray(s+1)).indexOf(r)}return void(n&&0===e.length||i.push(e))}let r=0;for(let s=0;s<e.length+1;s++)if(s===e.length||-1!==t.indexOf(e[s])){const t=e.subarray(r,s);n&&0===t.length||i.push(t),r=s+1}}function UE(e,t,n){const i=e.length,r=[];let s=0,a=0;const o=new Array(i);for(let h=0;h<i;++h){const i=r.length;zE(e[h],t,n,r);const l=r.length-i;o[h]=l,s+=l,a=Math.max(a,l)}const l=ja("int32",2*s),c=new Array(s),u=[i,a];let d=0;for(let h=0;h<i;++h)for(let e=0;e<o[h];++e)l[2*d]=h,l[2*d+1]=e,c[d]=r[d],++d;return[l,c,u]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GE(e,t){const n=ja("int32",e.length);for(let i=0;i<e.length;++i)n[i]=bd(e[i]).modulo(t).getLowBitsUnsigned();return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VE=Bk((e,t)=>e-t),HE=Zk((e,t,n,i)=>({real:e-n,imag:t-i})),WE=Yk(cu,VE,HE),jE={kernelName:cu,backendName:"cpu",kernelFunc:WE};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qE(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const i=Zh(n,e.dtype);for(let r=0;r<i.values.length;++r){const t=i.indexToLoc(r),n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=t[i]%e.shape[i];const s=e.locToIndex(n);i.values[r]=e.values[s]}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XE=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function KE(e,t,n=0,i=e.length-1){for(;i>n;){if(i-n>600){const r=i-n+1,s=t-n+1,a=Math.log(r),o=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*o*(r-o)/r)*Math.sign(s-r/2);KE(e,t,Math.max(n,Math.floor(t-s*o/r+l)),Math.min(i,Math.floor(t+(r-s)*o/r+l)))}const r=e[t];let s=n,a=i;for(Na(e,n,t),XE(e[i],r)>0&&Na(e,n,i);s<a;){for(Na(e,s,a),s++,a--;XE(e[s],r)<0;)s+=1;for(;XE(e[a],r)>0;)a-=1}0===XE(e[n],r)?Na(e,n,a):(a+=1,Na(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}}function YE(e,t,n,i,r){const s=t[t.length-1],[a,o]=[e.length/s,s],l=Wa(n,a*i),c=Wa("int32",a*i);for(let d=0;d<a;d++){const t=d*o,n=e.subarray(t,t+o);let s=new Array(n.length);n.forEach((e,t)=>s[t]={value:e,index:t}),i<s.length&&(KE(s,i),s=s.slice(0,i)),r&&s.sort(XE);const a=d*i,u=l.subarray(a,a+i),h=c.subarray(a,a+i);for(let e=0;e<i;e++)u[e]=s[e].value,h[e]=s[e].index}const u=t.slice();return u[u.length-1]=i,[Zh(u,n,l),Zh(u,"int32",c)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(e,t,n,i){const r=Va(t,n)[0],s=[1,n[0],1];for(let f=0;f<r;f++)s[0]*=n[f];s[1]=n[r];for(let f=r+1;f<n.length;f++)s[2]*=n[f];const a={},o=new Int32Array(n[r]),l=new Nd(s,i,e),c=[],u=1===s[0]&&1===s[2];for(let f=0;f<n[r];f++){let t;if(u)t=e[f].toString();else{const e=[];for(let t=0;t<s[0];t++)for(let n=0;n<s[2];n++)e.push(l.get(t,f,n));t=e.join(",")}if(void 0!==a[t])o[f]=a[t];else{const e=Object.keys(a).length;a[t]=e,o[f]=e,c.push(f)}}const d=s.slice();d[1]=Object.keys(a).length;const h=new Nd(d,i);c.forEach((e,t)=>{for(let n=0;n<s[0];n++)for(let i=0;i<s[2];i++)h.set(l.get(n,e,i),n,t,i)});const p=n.slice();return p[r]=d[1],{outputValues:h.values,outputShape:p,indices:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QE=Object.freeze(Object.defineProperty({__proto__:null,simpleAbsImpl:Fk,addImpl:Qk,bincountImpl:nC,bincountReduceImpl:iC,castImpl:qk,ceilImpl:oC,concatImpl:uC,equalImpl:dC,expImpl:fC,expm1Impl:bC,floorImpl:TC,gatherNdImpl:SC,gatherV2Impl:wC,greaterImpl:IC,greaterEqualImpl:EC,lessImpl:NC,lessEqualImpl:OC,linSpaceImpl:FC,logImpl:$C,maxImpl:UC,maximumImpl:GC,minimumImpl:WC,multiplyImpl:XC,negImpl:QC,notEqualImpl:eE,prodImpl:aE,raggedGatherImpl:dE,raggedTensorToTensorImpl:gE,rangeImpl:bE,rsqrtImpl:yE,scatterImpl:xE,sigmoidImpl:_E,sliceImpl:IE,sparseFillEmptyRowsImpl:EE,sparseReshapeImpl:AE,sparseSegmentReductionImpl:RE,sqrtImpl:NE,squaredDifferenceImpl:OE,stridedSliceImpl:FE,stringNGramsImpl:BE,stringSplitImpl:UE,stringToHashBucketFastImpl:GE,subImpl:VE,tileImpl:qE,topKImpl:YE,transposeImpl:iE,uniqueImpl:ZE},Symbol.toStringTag,{value:"Module"}));
/** @license See the LICENSE file. */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
pp("cpu",()=>new Mk,1);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const JE=sC(gl,e=>e>=0?e:Math.exp(e)-1),eA={kernelName:gl,backendName:"cpu",kernelFunc:JE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tA(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{alpha:s}=i;Ok([r],"leakyRelu");const a=Ma(r.shape),o=n.data.get(r.dataId).values,l=Wa("float32",a);for(let c=0;c<o.length;c++)l[c]=o[c]<0?s*o[c]:o[c];return n.makeTensorInfo(r.shape,"float32",l)}const nA={kernelName:Bl,backendName:"cpu",kernelFunc:tA},iA=Bk((e,t)=>e<0?t*e:e);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(e){const{inputs:t,backend:n}=e,{x:i,alpha:r}=t;Ok([i,r],"prelu");const s=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,[o,l]=iA(i.shape,r.shape,s,a,"float32");return n.makeTensorInfo(l,"float32",o)}const sA={kernelName:Tc,backendName:"cpu",kernelFunc:rA},aA=sC(Cc,e=>Math.max(0,e)),oA={kernelName:Cc,backendName:"cpu",kernelFunc:aA},lA=sC(Dc,e=>Math.min(Math.max(0,e),6)),cA={kernelName:Dc,backendName:"cpu",kernelFunc:lA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uA(e,t,n,i,r){if("linear"===n)return Vk({inputs:{x:t},backend:e});if("relu"===n)return aA({inputs:{x:t},backend:e});if("elu"===n)return JE({inputs:{x:t},backend:e});if("relu6"===n)return lA({inputs:{x:t},backend:e});if("prelu"===n)return rA({inputs:{x:t,alpha:i},backend:e});if("leakyrelu"===n)return tA({inputs:{x:t},backend:e,attrs:{alpha:r}});if("sigmoid"===n)return SE({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{shape:s}=i,a=Ma(r.shape),o=Ga(s,a),l=Ma(o);Pa(a===l,()=>`The new shape (${o}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const c=n.data.get(r.dataId);if(null!=c.complexTensorInfos){const e=c.complexTensorInfos.real,t=c.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:r.dataId,shape:o,dtype:r.dtype}}const hA={kernelName:Ec,backendName:"cpu",kernelFunc:dA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s}=t,{transposeA:a,transposeB:o}=i;Ok([r,s],"matMul");const l=r.shape.length,c=s.shape.length,u=a?r.shape[l-2]:r.shape[l-1],d=o?s.shape[c-1]:s.shape[c-2],h=a?r.shape[l-1]:r.shape[l-2],p=o?s.shape[c-2]:s.shape[c-1],f=r.shape.slice(0,-2),m=s.shape.slice(0,-2),g=Ma(f),b=Ma(m),y=Tp(r.shape.slice(0,-2),s.shape.slice(0,-2)).concat([h,p]);Pa(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${r.shape} and ${s.shape} and transposeA=${a} and transposeB=${o} must match.`);const v=o?[b,p,d]:[b,d,p],T=dA({inputs:{x:r},backend:n,attrs:{shape:a?[g,u,h]:[g,h,u]}}),x=dA({inputs:{x:s},backend:n,attrs:{shape:v}}),_=a?T.shape[1]:T.shape[2],S=a?T.shape[2]:T.shape[1],w=o?x.shape[1]:x.shape[2],I=Math.max(g,b),k=n.data.get(T.dataId).values,C=n.data.get(x.dataId).values,E=to(T.shape),A=to(x.shape),[R,N,P]=a?[E[0],1,E[1]]:[E[0],E[1],1],[D,O,L]=o?[1,A[1],A[0]]:[A[1],1,A[0]],M=S*w,F=Zh([I,S,w],T.dtype),$=F.values,B=n.blockSize;for(let z=0;z<I;z++)for(let e=0;e<S;e+=B)for(let t=0;t<w;t+=B)for(let n=0;n<_;n+=B){const i=Math.min(e+B,S),r=Math.min(t+B,w),s=Math.min(n+B,_);for(let a=e;a<i;a++)for(let e=t;e<r;e++){let t=0;for(let i=n;i<s;i++){const n=Math.min(z,g-1)*R,r=Math.min(z,b-1)*L;t+=k[n+a*N+i*P]*C[i*D+e*O+r]}$[z*M+(a*w+e)]+=t}}return n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(y,F.dtype,F.values)}const fA={kernelName:$o,backendName:"cpu",kernelFunc:pA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mA={kernelName:_u,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s,bias:a,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=i;let h,p,f;const m=[];h=pA({inputs:{a:r,b:s},attrs:{transposeA:l,transposeB:c},backend:n}),a&&(p=eC({inputs:{a:h,b:a},backend:n}),m.push(h),h=p),u&&(f=uA(n,h,u,o,d),m.push(h),h=f);for(const g of m)n.disposeIntermediateTensorInfo(g);return h}},gA=sC(xo,e=>Math.acos(e)),bA={kernelName:xo,backendName:"cpu",kernelFunc:gA},yA=sC(_o,e=>Math.acosh(e)),vA={kernelName:_o,backendName:"cpu",kernelFunc:yA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TA={kernelName:wo,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n}=e,i=t;Ok(t,"addN");const r=i.map(e=>n.data.get(e.dataId).values),s=Zh(i[0].shape,i[0].dtype),a=s.values;for(let o=0;o<i.length;o++){const e=r[o];for(let t=0;t<a.length;t++)a[t]+=e[t]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xA={kernelName:Io,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;Ok(r,"all");const o=Va(s,r.shape);let l=o;const c=pm(l,r.shape.length);let u=r;null!=c&&(u=rE({inputs:{x:r},backend:n,attrs:{perm:c}}),l=mm(l.length,r.shape.length)),hm("all",l,u.shape.length);const[d,h]=um(u.shape,l),p=Ma(h),f=so(Ma(d),u.dtype),m=n.data.get(u.dataId).values;for(let b=0;b<f.length;++b){const e=b*p;let t=m[e];for(let n=0;n<p;++n){const i=m[e+n];t=t&&i}f[b]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,f);if(a){const e=dA({inputs:{x:g},backend:n,attrs:{shape:dm(d,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _A={kernelName:ko,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;Ok(r,"any");const o=Va(s,r.shape);let l=o;const c=pm(l,r.shape.length);let u=r;null!=c&&(u=rE({inputs:{x:r},backend:n,attrs:{perm:c}}),l=mm(l.length,r.shape.length)),hm("any",l,u.shape.length);const[d,h]=um(u.shape,l),p=Ma(h),f=so(Ma(d),u.dtype),m=n.data.get(u.dataId).values;for(let b=0;b<f.length;++b){const e=b*p;let t=m[e];for(let n=0;n<p;++n){const i=m[e+n];t=t||i}f[b]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,f);if(a){const e=dA({inputs:{x:g},backend:n,attrs:{shape:dm(d,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SA={kernelName:Co,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;Ok(r,"argMax");let a=Va(s,r.shape);const o=pm(a,r.shape.length);let l=r;const c=[];null!=o&&(l=rE({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=mm(a.length,l.shape.length)),a=[a[0]],hm("argMax",a,l.shape.length);const[u,d]=um(l.shape,a),h=so(Ma(u),"int32"),p=Ma(d),f=n.data.get(l.dataId).values;for(let m=0;m<h.length;++m){const e=m*p;let t=f[e],n=0;for(let i=0;i<p;++i){const r=f[e+i];r>t&&(t=r,n=i)}h[m]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",h)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wA={kernelName:Eo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;Ok(r,"argMin");let a=Va(s,r.shape);const o=pm(a,r.shape.length);let l=r;const c=[];null!=o&&(l=rE({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=mm(a.length,l.shape.length)),a=[a[0]],hm("argMin",a,l.shape.length);const[u,d]=um(l.shape,a),h=so(Ma(u),"int32"),p=Ma(d),f=n.data.get(l.dataId).values;for(let m=0;m<h.length;++m){const e=m*p;let t=f[e],n=0;for(let i=0;i<p;++i){const r=f[e+i];r<t&&(t=r,n=i)}h[m]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",h)}},IA=sC(Ao,e=>Math.asin(e)),kA={kernelName:Ao,backendName:"cpu",kernelFunc:IA},CA=sC(Ro,e=>Math.asinh(e)),EA={kernelName:Ro,backendName:"cpu",kernelFunc:CA},AA=sC(No,e=>Math.atan(e)),RA={kernelName:No,backendName:"cpu",kernelFunc:AA},NA=Bk((e,t)=>Math.atan2(e,t)),PA=Yk(Do,NA),DA={kernelName:Do,backendName:"cpu",kernelFunc:PA},OA=sC(Po,e=>Math.atanh(e)),LA={kernelName:Po,backendName:"cpu",kernelFunc:OA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MA(e,t,n,i,r,s){const a=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Zh(r.outShape,n),g=m.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let T=0;T<r.batchSize;++T){const t=T*b,n=T*i[0];for(let m=0;m<r.inChannels;++m)for(let b=0;b<r.outHeight;++b){const T=b*a-h,x=Math.max(0,T),_=Math.min(r.inHeight,u+T),S=t+b*y;for(let t=0;t<r.outWidth;++t){const a=t*o-p,u=Math.max(0,a),h=Math.min(r.inWidth,d+a);let b=f,y=0,T=0;for(let t=x;t<_;t+=l){const r=n+t*i[1];for(let t=u;t<h;t+=c){const n=e[r+t*i[2]+m];"max"===s&&n>b?b=n:"avg"===s&&(y+=n,T++)}if(isNaN(b))break}g[S+t*v+m]="avg"===s?y/T:b}}}return m}function FA(e,t,n,i,r=!1,s=!1){const a=Zh(i.outShape,"int32"),o=i.strideHeight,l=i.strideWidth,c=i.dilationHeight,u=i.dilationWidth,d=i.effectiveFilterHeight,h=i.effectiveFilterWidth,p=i.padInfo.top,f=i.padInfo.left,m=Zh(t,n,e);for(let g=0;g<i.batchSize;++g)for(let e=0;e<i.inChannels;++e)for(let t=0;t<i.outHeight;++t){const n=t*o-p;let b=n;for(;b<0;)b+=c;const y=Math.min(i.inHeight,d+n);for(let o=0;o<i.outWidth;++o){const d=o*l-f;let p=d;for(;p<0;)p+=u;const v=Math.min(i.inWidth,h+d);let T=Number.NEGATIVE_INFINITY,x=-1;for(let t=b;t<y;t+=c){const a=t-n;for(let n=p;n<v;n+=u){const o=n-d,l=m.get(g,t,n,e);l>T&&(T=l,x=r?s?((g*i.inHeight+t)*i.inWidth+n)*i.inChannels+e:(t*i.inWidth+n)*i.inChannels+e:a*h+o)}}a.set(x,g,t,o,e)}}return a}function $A(e,t,n,i,r,s){const a=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,b=r.padInfo.left,y="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Zh(r.outShape,n),T=v.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[3]*r.outShape[4],w=r.outShape[4];for(let I=0;I<r.batchSize;++I){const t=I*x,n=I*i[0];for(let v=0;v<r.inChannels;++v)for(let x=0;x<r.outDepth;++x){const I=x*a-m;let k=I;for(;k<0;)k+=c;const C=Math.min(r.inDepth,h+I),E=t+x*_;for(let t=0;t<r.outHeight;++t){const a=t*o-g;let h=a;for(;h<0;)h+=u;const m=Math.min(r.inHeight,p+a),x=E+t*S;for(let t=0;t<r.outWidth;++t){const a=t*l-b;let o=a;for(;o<0;)o+=d;const p=Math.min(r.inWidth,f+a),g=x+t*w;let _=y,S=0,I=0;for(let t=k;t<C;t+=c){const r=n+t*i[1];for(let t=h;t<m;t+=u){const n=r+t*i[2];for(let t=o;t<p;t+=d){const r=e[n+t*i[3]+v];if("max"===s&&r>_?_=r:"avg"===s&&(S+=r,I++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}T[g+v]="avg"===s?S/I:_}}}}return v}const BA={kernelName:Oo,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;Ok(r,"avgPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;Pa(bf(a,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`);const c=of(r.shape,s,a,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&Fa(c.inShape,c.outShape))u=Vk({inputs:{x:r},backend:n});else{const e=n.data.get(r.dataId).values,t=to(r.shape),i=MA(e,r.shape,r.dtype,t,c,"avg");u=n.makeTensorInfo(c.outShape,r.dtype,i.values)}return u}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zA={kernelName:Mo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=i;Ok(r,"avgPool3d");const u=lf(r.shape,s,a,1,o,l,c),d=$A(n.data.get(r.dataId).values,r.shape,r.dtype,to(r.shape),u,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UA={kernelName:Fo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=i;Ok([r,s],"avgPool3DGrad");const u=lf(s.shape,a,o,1,l,c),d=u.strideDepth,h=u.strideHeight,p=u.strideWidth,f=u.filterDepth,m=u.filterHeight,g=u.filterWidth,b=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,T=u.effectiveFilterDepth,x=u.effectiveFilterHeight,_=u.effectiveFilterWidth,S=T-1-u.padInfo.front,w=_-1-u.padInfo.left,I=x-1-u.padInfo.top,k=Zh(s.shape,"float32"),C=1/(f*m*g),E=n.bufferSync(r);for(let A=0;A<u.batchSize;++A)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let i=0;i<u.inWidth;++i){const r=t-S,s=n-I,a=i-w;let o=0;for(let t=0;t<T;t+=b){const n=(r+t)/d;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let t=0;t<x;t+=y){const i=(s+t)/h;if(!(i<0||i>=u.outHeight||Math.floor(i)!==i))for(let t=0;t<_;t+=v){const r=(a+t)/p;if(r<0||r>=u.outWidth||Math.floor(r)!==r)continue;o+=E.get(A,n,i,r,e)}}}k.set(o*C,A,t,n,i,e)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GA={kernelName:Lo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s;Ok([r,s],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=i,u=of(a.shape,o,l,1,c),d=u.strideHeight,h=u.strideWidth,p=u.filterHeight,f=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,b=u.effectiveFilterHeight,y=u.effectiveFilterWidth,v=y-1-u.padInfo.left,T=b-1-u.padInfo.top,x=Zh(a.shape,"float32"),_=1/(p*f),S=n.data.get(r.dataId).values,w=Zh(r.shape,"float32",S);for(let I=0;I<u.batchSize;++I)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inHeight;++t)for(let n=0;n<u.inWidth;++n){const i=t-T,r=n-v;let s=0;for(let t=0;t<b;t+=m){const n=(i+t)/d;if(!(n<0||n>=u.outHeight||Math.floor(n)!==n))for(let t=0;t<y;t+=g){const i=(r+t)/h;if(i<0||i>=u.outWidth||Math.floor(i)!==i)continue;s+=w.get(I,n,i,e)}}x.set(s*_,I,t,n,e)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VA={kernelName:El,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,scale:s,offset:a,mean:o,variance:l}=t;Pa(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Pa(null==a||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Pa(null==s||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ok([r,o,l,s,a],"batchNorm");let{varianceEpsilon:c}=i;null==c&&(c=.001);const u=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,h=n.data.get(l.dataId).values,p=s?n.data.get(s.dataId).values:new Float32Array([1]),f=a?n.data.get(a.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=f.length,b=p.length,y=h.length,v=d.length;let T=0,x=0,_=0,S=0;for(let w=0;w<u.length;++w)m[w]=f[T++]+(u[w]-d[x++])*p[_++]/Math.sqrt(h[S++]+c),T>=g&&(T=0),x>=v&&(x=0),_>=b&&(_=0),S>=y&&(S=0);return n.makeTensorInfo(r.shape,r.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA={kernelName:Bo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,crops:a}=i;Ok([r],"batchToSpaceND");const o=s.reduce((e,t)=>e*t),l=Dy(r.shape,s,o),c=Oy(l.length,s.length),u=Ly(r.shape,s,o),d=My(a,s.length),h=Fy(u,a,s.length),p=dA({inputs:{x:r},backend:n,attrs:{shape:l}}),f=rE({inputs:{x:p},backend:n,attrs:{perm:c}}),m=dA({inputs:{x:f},backend:n,attrs:{shape:u}}),g=kE({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WA={kernelName:zo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a}=i,o=nC(n.data.get(r.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,o)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jA={kernelName:Uo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:i,s1:r}=t,s=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values,o=Tp(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},qA=sC(Ho,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),XA={kernelName:Ho,backendName:"cpu",kernelFunc:qA},KA={kernelName:jo,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,i=new Float32Array(Ma(t.shape)),r=n.data.get(t.dataId),s=r.complexTensorInfos.real,a=r.complexTensorInfos.imag,o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values;for(let c=0;c<o.length;c++){const e=o[c],t=l[c];i[c]=Math.hypot(e,t)}return n.makeOutput(i,t.shape,"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function YA(e){const{inputs:t,backend:n}=e,{input:i}=t,r=n.data.get(i.dataId).complexTensorInfos.imag,s=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,s)}const ZA={kernelName:Ll,backendName:"cpu",kernelFunc:YA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QA(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i,s=Va(r,t[0].shape)[0];Sy(t.map(e=>e.shape),s);let a=wy(t.map(e=>e.shape),s);if(0===Ma(a))return n.makeTensorInfo(a,t[0].dtype,[]);const o=t.filter(e=>Ma(e.shape)>0);if(1===o.length)return Vk({inputs:{x:o[0]},backend:n});if("complex64"===o[0].dtype){const e=o.map(e=>Wk({inputs:{input:e},backend:n})),t=o.map(e=>YA({inputs:{input:e},backend:n})),i=QA({inputs:e,backend:n,attrs:{axis:s}}),r=QA({inputs:t,backend:n,attrs:{axis:s}}),a=zk({inputs:{real:i,imag:r},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),a}const l=o.map(e=>{const t=Ma(e.shape.slice(s));return dA({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),c=l.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));a=wy(l.map(e=>e.shape),1);const u=1===l[0].shape[0],d=uC(c,a,t[0].dtype,u),h=wy(o.map(e=>e.shape),s),p=n.makeTensorInfo(h,t[0].dtype,d);return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}const JA={kernelName:qo,backendName:"cpu",kernelFunc:QA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=i;Ok([r,s],"conv2d");const d=yf(l),h=cf(r.shape,s.shape,a,c,o,u,!1,d),p=h.filterHeight,f=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,b=h.padInfo.left,y=h.padInfo.top,v="channelsLast"===h.dataFormat,T=new Nd(h.outShape,r.dtype),x=to(r.shape),_=to(s.shape),S=x[0],w=v?x[1]:x[2],I=v?x[2]:1,k=v?1:x[1],C=T.strides[0],E=v?T.strides[1]:T.strides[2],A=v?T.strides[2]:1,R=v?1:T.strides[1],N=n.data.get(r.dataId).values,P=n.data.get(s.dataId).values,D=T.values;for(let O=0;O<h.batchSize;++O){const e=O*S,t=O*C;for(let n=0;n<h.outHeight;++n){const i=t+n*E,r=n*h.strideHeight-y;for(let t=0;t<p;++t){const n=r+t*m;if(n<0||n>=h.inHeight)continue;const s=t*_[0],a=e+n*w;for(let e=0;e<h.outWidth;++e){const t=i+e*A,n=e*h.strideWidth-b;for(let e=0;e<f;++e){const i=n+e*g;if(i<0||i>=h.inWidth)continue;const r=a+i*I;let o=s+e*_[1];for(let e=0;e<h.inChannels;++e){const n=N[r+e*k];for(let e=0;e<h.outChannels;++e)D[t+e*R]+=n*P[o+e];o+=h.outChannels}}}}}}return n.makeTensorInfo(T.shape,T.dtype,D)}const tR={kernelName:Xo,backendName:"cpu",kernelFunc:eR};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nR={kernelName:Ko,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=i;Ok([r,s],"conv2dBackpropFilter");const d=yf(l),h=cf(r.shape,u,a,1,o,c,!1,d),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=h,b="channelsLast"===h.dataFormat,y=new Nd(h.filterShape,"float32"),v=h.padInfo.left,T=h.padInfo.top,x=n.data.get(r.dataId).values,_=n.data.get(s.dataId).values,S=new Nd(r.shape,r.dtype,x),w=new Nd(s.shape,s.dtype,_);for(let I=0;I<m;++I){const e=Math.max(0,Math.ceil((T-I)/p)),t=Math.min(h.outHeight,(h.inHeight+T-I)/p);for(let n=0;n<g;++n){const i=Math.max(0,Math.ceil((v-n)/f)),r=Math.min(h.outWidth,(h.inWidth+v-n)/f);for(let s=0;s<h.inChannels;++s)for(let a=0;a<h.outChannels;++a){let o=0;for(let l=0;l<h.batchSize;++l)for(let c=e;c<t;++c){const e=I+c*p-T;for(let t=i;t<r;++t){const i=n+t*f-v;o+=b?S.get(l,e,i,s)*w.get(l,c,t,a):S.get(l,s,e,i)*w.get(l,a,c,t)}}y.set(o,I,n,s,a)}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iR={kernelName:Yo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{inputShape:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=i;Ok([r,s],"conv2dBackpropInput");const d=to(s.shape),h=to(r.shape);let p=yf(c);const f=cf(a,s.shape,o,1,l,u,!1,p),m=new Nd(f.inShape,"float32"),g=m.values,b=n.data.get(r.dataId).values,y=n.data.get(s.dataId).values,[v,T,x]=d,{batchSize:_,filterHeight:S,filterWidth:w,inChannels:I,inHeight:k,inWidth:C,outChannels:E,outHeight:A,outWidth:R,strideHeight:N,strideWidth:P}=f;p=f.dataFormat;const D=S-1-f.padInfo.top,O=w-1-f.padInfo.left,L="channelsLast"===p,M=m.strides[0],F=L?m.strides[1]:m.strides[2],$=L?m.strides[2]:1,B=L?1:m.strides[1],z=h[0],U=L?h[1]:h[2],G=L?h[2]:1,V=L?1:h[1];for(let H=0;H<_;++H)for(let e=0;e<I;++e)for(let t=0;t<k;++t){const n=t-D,i=Math.max(0,Math.ceil(n/N)),r=Math.min(A,(S+n)/N);for(let s=0;s<C;++s){const a=s-O,o=Math.max(0,Math.ceil(a/P)),l=Math.min(R,(w+a)/P);let c=0;for(let t=i;t<r;++t){const i=t*N-n;for(let n=o;n<l;++n){const r=z*H+U*t+G*n,s=v*(S-1-i)+T*(w-1-(n*P-a))+x*e;for(let e=0;e<E;++e){c+=b[r+V*e]*y[s+e]}}}g[M*H+F*t+$*s+B*e]=c}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rR={kernelName:Zo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i;Ok([r,s],"conv3d");const c=uf(r.shape,s.shape,a,l,o),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=c,b=g.front,y=g.left,v=g.top,T=new Nd(c.outShape,r.dtype),x=n.data.get(r.dataId).values,_=n.data.get(s.dataId).values,S=T.values,w=to(r.shape),I=to(s.shape);for(let k=0;k<c.batchSize;++k){const e=k*w[0],t=k*T.strides[0];for(let n=0;n<c.outDepth;++n){const i=t+n*T.strides[1],r=n*c.strideDepth-b;for(let t=0;t<u;++t){const n=r+t*p;if(n<0||n>=c.inDepth)continue;const s=t*I[0],a=e+n*w[1];for(let e=0;e<c.outHeight;++e){const t=i+e*T.strides[2],n=e*c.strideHeight-v;for(let e=0;e<d;++e){const i=n+e*f;if(i<0||i>=c.inHeight)continue;const r=s+e*I[1],o=a+i*w[2];for(let e=0;e<c.outWidth;++e){const n=t+e*c.outChannels,i=e*c.strideWidth-y;for(let e=0;e<h;++e){const t=i+e*m;if(t<0||t>=c.inWidth)continue;const s=r+e*I[2],a=o+t*c.inChannels;let l=s;for(let e=0;e<c.inChannels;++e){const t=x[a+e];for(let e=0;e<c.outChannels;++e)S[n+e]+=t*_[l+e];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sR={kernelName:Qo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,filterShape:l}=i;Ok([r,s],"conv3dBackpropFilterV2");const c=to(r.shape),u=to(s.shape),d=uf(r.shape,l,a,1,o),h=d.strideDepth,p=d.strideHeight,f=d.strideWidth,m=d.filterDepth,g=d.filterHeight,b=d.filterWidth,y=new Nd(d.filterShape,"float32"),v=y.values,[T,x,_,S]=y.strides,w=n.data.get(s.dataId).values,[I,k,C,E]=u,A=n.data.get(r.dataId).values,[R,N,P,D]=c,O=d.padInfo.front,L=d.padInfo.left,M=d.padInfo.top;for(let F=0;F<m;++F){const e=Math.max(0,Math.ceil((O-F)/h)),t=Math.min(d.outDepth,(d.inDepth+O-F)/h),n=F*T;for(let i=0;i<g;++i){const r=Math.max(0,Math.ceil((M-i)/p)),s=Math.min(d.outHeight,(d.inHeight+M-i)/p),a=i*x+n;for(let n=0;n<b;++n){const o=Math.max(0,Math.ceil((L-n)/f)),l=Math.min(d.outWidth,(d.inWidth+L-n)/f),c=n*_+a;for(let a=0;a<d.inChannels;++a){const u=a*S+c;for(let c=0;c<d.outChannels;++c){let m=0;for(let u=0;u<d.batchSize;++u){const d=u*R,g=u*I;for(let u=e;u<t;++u){const e=(F+u*h-O)*N+d,t=u*k+g;for(let u=r;u<s;++u){const r=(i+u*p-M)*P+e,s=u*C+t;for(let e=o;e<l;++e){const t=e*E+s;m+=A[(n+e*f-L)*D+r+a]*w[t+c]}}}}v[u+c]=m}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aR={kernelName:Jo,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{pad:a,strides:o,inputShape:l}=i;Ok([r],"conv3dBackpropInputV2");const c=to(r.shape),u=to(s.shape),d=uf(l,s.shape,o,1,a),h=new Nd(d.inShape,"float32"),p=h.values,[f,m,g,b]=h.strides,y=n.data.get(r.dataId).values,[v,T,x,_]=c,S=n.data.get(s.dataId).values,[w,I,k,C]=u,{batchSize:E,filterDepth:A,filterHeight:R,filterWidth:N,inChannels:P,inDepth:D,inHeight:O,inWidth:L,outChannels:M,outDepth:F,outHeight:$,outWidth:B,strideDepth:z,strideHeight:U,strideWidth:G}=d,V=A-1-d.padInfo.front,H=R-1-d.padInfo.top,W=N-1-d.padInfo.left;for(let j=0;j<E;++j)for(let e=0;e<P;++e)for(let t=0;t<D;++t){const n=t-V,i=Math.max(0,Math.ceil(n/z)),r=Math.min(F,(A+n)/z);for(let s=0;s<O;++s){const a=s-H,o=Math.max(0,Math.ceil(a/U)),l=Math.min($,(R+a)/U);for(let c=0;c<L;++c){const u=c-W,d=Math.max(0,Math.ceil(u/G)),h=Math.min(B,(N+u)/G);let E=0;for(let t=i;t<r;++t){const i=t*z-n;for(let n=o;n<l;++n){const r=n*U-a;for(let s=d;s<h;++s){const a=v*j+T*t+x*n+_*s,o=w*(A-1-i)+I*(R-1-r)+k*(N-1-(s*G-u))+C*e;for(let e=0;e<M;++e){E+=y[a+e]*S[o+e]}}}}p[f*j+m*t+g*s+b*c+e]=E}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},oR=sC(el,e=>Math.cos(e)),lR={kernelName:el,backendName:"cpu",kernelFunc:oR},cR=sC(tl,e=>Math.cosh(e)),uR={kernelName:tl,backendName:"cpu",kernelFunc:cR};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dR={kernelName:rl,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{image:r,boxes:s,boxInd:a}=t,{cropSize:o,method:l,extrapolationValue:c}=i,[u,d,h,p]=r.shape,f=s.shape[0],[m,g]=o,b=Zh([f,m,g,p],"float32"),y=n.data.get(s.dataId).values,v=n.data.get(a.dataId).values,T=n.data.get(r.dataId).values,x=to(r.shape),_=to(b.shape);for(let S=0;S<f;S++){const e=4*S,t=y[e],n=y[e+1],i=y[e+2],r=y[e+3],s=v[S];if(s>=u)continue;const a=m>1?(i-t)*(d-1)/(m-1):0,o=g>1?(r-n)*(h-1)/(g-1):0;for(let u=0;u<m;u++){const e=m>1?t*(d-1)+u*a:.5*(t+i)*(d-1);if(e<0||e>d-1)for(let t=0;t<g;t++)for(let e=0;e<p;e++){const n=e+t*_[2]+u*_[1]+S*_[0];b.values[n]=c}else if("bilinear"===l){const t=Math.floor(e),i=Math.ceil(e),a=e-t;for(let e=0;e<g;e++){const l=g>1?n*(h-1)+e*o:.5*(n+r)*(h-1);if(l<0||l>h-1){for(let t=0;t<p;t++){const n=t+e*_[2]+u*_[1]+S*_[0];b.values[n]=c}continue}const d=Math.floor(l),f=Math.ceil(l),m=l-d;for(let n=0;n<p;n++){let r=n+d*x[2]+t*x[1]+s*x[0];const o=T[r];r=n+f*x[2]+t*x[1]+s*x[0];const l=T[r];r=n+d*x[2]+i*x[1]+s*x[0];const c=T[r];r=n+f*x[2]+i*x[1]+s*x[0];const h=o+(l-o)*m,p=c+(T[r]-c)*m;r=n+e*_[2]+u*_[1]+S*_[0],b.values[r]=h+(p-h)*a}}}else for(let t=0;t<g;++t){const i=g>1?n*(h-1)+t*o:.5*(n+r)*(h-1);if(i<0||i>h-1){for(let e=0;e<p;e++){const n=e+t*_[2]+u*_[1]+S*_[0];b.values[n]=c}continue}const a=Math.round(i),l=Math.round(e);for(let e=0;e<p;e++){const n=e+a*x[2]+l*x[1]+s*x[0],i=e+t*_[2]+u*_[1]+S*_[0];b.values[i]=T[n]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hR={kernelName:nl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;Ok(r,"cumprod");const l=pm([s],r.shape.length);let c=r;null!=l&&(c=rE({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=mm(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Xd(c.dtype,"int32"),h=ro(Ma(c.shape),d),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let b=0;b<p.length;b+=f)for(let e=0;e<f;e++){const t=m(b,e);if(0===e)h[t]=a?1:p[t];else{const n=m(b,e-1);h[t]=a?p[n]*h[n]:p[t]*h[n]}}const g=n.makeTensorInfo(c.shape,d,h);if(null!=l){const e=rE({inputs:{x:g},backend:n,attrs:{perm:fm(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),e}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pR={kernelName:il,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;Ok(r,"cumsum");const l=pm([s],r.shape.length);let c=r;null!=l&&(c=rE({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=mm(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Xd(c.dtype,"int32"),h=so(Ma(c.shape),d),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let b=0;b<p.length;b+=f)for(let e=0;e<f;e++){const t=m(b,e);if(0===e)h[t]=a?0:p[t];else{const n=m(b,e-1);h[t]=a?p[n]+h[n]:p[t]+h[n]}}const g=n.makeTensorInfo(c.shape,d,h);if(null!=l){const e=rE({inputs:{x:g},backend:n,attrs:{perm:fm(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),e}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fR={kernelName:sl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a,binaryOutput:o}=i;if(1===r.shape.length){const e=nC(n.data.get(r.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,e)}if(2===r.shape.length){const e=iC(n.bufferSync(r),n.bufferSync(s),a,o);return n.makeTensorInfo(e.shape,s.dtype,e.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mR={kernelName:al,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockSize:s,dataFormat:a}=i;Pa("NHWC"===a,()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`);const o=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],d=l*s,h=c*s,p=u/(s*s),f=n.data.get(r.dataId).values,m=new Float32Array(o*d*h*p);let g=0;for(let b=0;b<o;++b)for(let e=0;e<d;++e){const t=Math.floor(e/s),n=e%s;for(let e=0;e<h;++e){const i=Math.floor(e/s),r=(n*s+e%s)*p;for(let e=0;e<p;++e){const n=e+r+u*(i+c*(t+l*b));m[g++]=f[n]}}}return n.makeTensorInfo([o,d,h,p],r.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gR(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l,dimRoundingMode:c}=i;Ok([r,s],"depthwiseConv2DNative");const u=to(r.shape),d=to(s.shape);let h=l;null==h&&(h=[1,1]),Pa(bf(a,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${h}'`);const p=cf(r.shape,s.shape,a,h,o,c,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:b,padInfo:y}=p,v=y.left,T=y.top,x=p.outChannels/p.inChannels,_=new Nd(p.outShape,r.dtype),S=n.data.get(r.dataId).values,w=n.data.get(s.dataId).values,I=_.values;for(let k=0;k<p.batchSize;++k){const e=k*u[0],t=k*_.strides[0];for(let n=0;n<p.outHeight;++n){const i=t+n*_.strides[1],r=n*p.strideHeight-T;for(let t=0;t<f;++t){const n=r+t*g;if(n<0||n>=p.inHeight)continue;const s=t*d[0],a=e+n*u[1];for(let e=0;e<p.outWidth;++e){const t=i+e*_.strides[2],n=e*p.strideWidth-v;for(let e=0;e<m;++e){const i=n+e*b;if(i<0||i>=p.inWidth)continue;const r=s+e*d[1],o=a+i*p.inChannels;let l=t,c=r;for(let e=0;e<p.inChannels;++e){const t=S[o+e];for(let e=0;e<x;++e)I[l+e]+=t*w[c+e];l+=x,c+=x}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const bR={kernelName:ol,backendName:"cpu",kernelFunc:gR};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yR={kernelName:ll,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=i;Ok([r,s],"depthwiseConv2dNativeBackpropFilter");const d=cf(r.shape,u,a,o,l,c,!0),{strideHeight:h,strideWidth:p,filterHeight:f,filterWidth:m}=d,g=new Nd(d.filterShape,"float32"),b=d.padInfo.left,y=d.padInfo.top,v=d.outChannels/d.inChannels,T=n.data.get(r.dataId).values,x=new Nd(r.shape,r.dtype,T),_=n.data.get(s.dataId).values,S=new Nd(s.shape,s.dtype,_);for(let w=0;w<f;++w){const e=Math.max(0,Math.ceil((y-w)/h)),t=Math.min(d.outHeight,(d.inHeight+y-w)/h);for(let n=0;n<m;++n){const i=Math.max(0,Math.ceil((b-n)/p)),r=Math.min(d.outWidth,(d.inWidth+b-n)/p);for(let s=0;s<d.outChannels;++s){const a=Math.trunc(s/v),o=s%v;let l=0;for(let c=0;c<d.batchSize;++c)for(let o=e;o<t;++o){const e=w+o*h-y;for(let t=i;t<r;++t){const i=n+t*p-b;l+=x.get(c,e,i,a)*S.get(c,o,t,s)}}g.set(l,w,n,a,o)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vR={kernelName:cl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=i;Ok([r,s],"depthwiseConv2DNativeBackpropInput");const d=to(r.shape),h=to(s.shape),p=cf(u,s.shape,a,o,l,c,!0),f=new Nd(p.inShape,"float32"),m=f.values,[g,b,y]=f.strides,v=n.data.get(r.dataId).values,[T,x,_]=d,S=n.data.get(s.dataId).values,[w,I,k]=h,{batchSize:C,filterHeight:E,filterWidth:A,inChannels:R,inHeight:N,inWidth:P,outChannels:D,outHeight:O,outWidth:L,strideHeight:M,strideWidth:F}=p,$=E-1-p.padInfo.top,B=A-1-p.padInfo.left,z=D/R;for(let U=0;U<C;++U)for(let e=0;e<R;++e)for(let t=0;t<N;++t){const n=t-$,i=Math.max(0,Math.ceil(n/M)),r=Math.min(O,(E+n)/M);for(let s=0;s<P;++s){const a=s-B,o=Math.max(0,Math.ceil(a/F)),l=Math.min(L,(A+a)/F);let c=0;for(let t=i;t<r;++t){const i=t*M-n;for(let n=o;n<l;++n){const r=T*U+x*t+_*n,s=w*(E-1-i)+I*(A-1-(n*F-a))+k*e;for(let t=0;t<z;++t){c+=v[r+(e*z+t)]*S[s+t]}}}m[g*U+b*t+y*s+e]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TR={kernelName:ul,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=Ma(i.shape),s=n.data.get(i.dataId).values,a=Zh([r,r],i.dtype),o=a.values;for(let c=0;c<s.length;c++)o[c*r+c]=s[c];const l=[...i.shape,...i.shape];return n.makeTensorInfo(l,a.dtype,a.values)}},xR={kernelName:dl,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,filter:r}=e,{strides:s,pad:a,dilations:o}=n,l=t,c=l.data.get(i.dataId).values,u=i.shape.length,d=l.data.get(r.dataId).values,h=r.shape.length,{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:b,outWidth:y,padInfo:v,strideHeight:T,strideWidth:x,filterHeight:_,filterWidth:S,dilationHeight:w,dilationWidth:I,outShape:k}=af(i.shape,r.shape,s,a,"NHWC",o),C=Ma(k),E=k.length,A=ja(i.dtype,C);for(let R=0;R<p;++R)for(let e=0;e<b;++e){const t=e*T-v.top;for(let n=0;n<y;++n){const s=n*x-v.left;for(let a=0;a<g;++a){let o=Number.MIN_SAFE_INTEGER;for(let e=0;e<_;++e){const n=t+e*w;if(n>=0&&n<f)for(let t=0;t<S;++t){const l=s+t*I;if(l>=0&&l<m){const s=lo([R,n,l,a],u,to(i.shape)),p=lo([e,t,a],h,to(r.shape)),f=c[s]+d[p];f>o&&(o=f)}}}A[lo([R,e,n,a],E,to(k))]=o}}}return{dataId:l.write(vd(A,i.dtype),k,i.dtype),shape:k,dtype:i.dtype}}},_R={kernelName:pl,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,filter:r,dy:s}=e,{strides:a,pad:o,dilations:l}=n,c=t,u=io(i.shape,c.data.get(i.dataId).values),d=io(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:b,padInfo:y,strideHeight:v,strideWidth:T,filterHeight:x,filterWidth:_,dilationHeight:S,dilationWidth:w,outShape:I}=af(i.shape,r.shape,a,o,"NHWC",l);Pa(s.rank===I.length,()=>`Error in ${pl}, dy must have the same rank as output ${I.length}, but got ${s.rank}`);const k=io(I,c.data.get(s.dataId).values),C=ao(r.shape,r.dtype);for(let E=0;E<h;++E)for(let e=0;e<g;++e){const t=e*v-y.top;for(let n=0;n<b;++n){const i=n*T-y.left;for(let r=0;r<m;++r){let s=Number.MIN_SAFE_INTEGER,a=0,o=0;for(let e=0;e<x;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=i+t*w;if(l>=0&&l<f){const i=u[E][n][l][r]+d[e][t][r];i>s&&(s=i,a=e,o=t)}}}C[a][o][r]+=k[E][e][n][r]}}}return{dataId:c.write(vd(C,i.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},SR={kernelName:hl,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,filter:r,dy:s}=e,{strides:a,pad:o,dilations:l}=n,c=t,u=io(i.shape,c.data.get(i.dataId).values),d=io(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:b,padInfo:y,strideHeight:v,strideWidth:T,filterHeight:x,filterWidth:_,dilationHeight:S,dilationWidth:w,outShape:I}=af(i.shape,r.shape,a,o,"NHWC",l);Pa(s.rank===I.length,()=>`Error in ${hl}, dy must have the same rank as output ${I.length}, but got ${s.rank}`);const k=io(I,c.data.get(s.dataId).values),C=ao(i.shape,i.dtype);for(let E=0;E<h;++E)for(let e=0;e<g;++e){const t=e*v-y.top;for(let n=0;n<b;++n){const i=n*T-y.left;for(let r=0;r<m;++r){let s=Number.MIN_SAFE_INTEGER,a=t<0?0:t,o=i<0?0:i;for(let e=0;e<x;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=i+t*w;if(l>=0&&l<f){const i=u[E][n][l][r]+d[e][t][r];i>s&&(s=i,a=n,o=l)}}}C[E][a][o][r]+=k[E][e][n][r]}}}return{dataId:c.write(vd(C,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wR(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;let o;Ok(r,"sum"),o="bool"===r.dtype?Xk({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):Vk({inputs:{x:r},backend:n});const l=o.shape.length,c=Va(s,o.shape),u=pm(c,l);let d=c,h=o;null!=u&&(h=rE({inputs:{x:o},backend:n,attrs:{perm:u}}),d=mm(d.length,l)),hm("sum",d,h.shape.length);const[p,f]=um(h.shape,d);let m=Gk(n,p,Xd(h.dtype,"int32"));const g=Ma(f),b=n.data.get(m.dataId).values,y=n.data.get(h.dataId).values;for(let v=0;v<b.length;++v){const e=v*g;let t=0;for(let n=0;n<g;++n)t+=y[e+n];b[v]=t}if(a){const e=m;m=dA({inputs:{x:m},backend:n,attrs:{shape:dm(m.shape,c)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(o),null!=u&&n.disposeIntermediateTensorInfo(h),m}const IR={kernelName:Xc,backendName:"cpu",kernelFunc:wR};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kR={kernelName:ml,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{equation:r}=i,s=t,{allDims:a,summedDims:o,idDims:l}=nv(r,s.length);rv(a.length,l,s);const{path:c,steps:u}=sv(o,l),d=u.length;let h=null,p=a.length;const f=[];for(let m=0;m<d;++m){for(const e of u[m]){const{permutationIndices:t,expandDims:i}=iv(p,l[e]);let r;av(t)?r=s[e]:(r=rE({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(r));const a=r.shape.slice();for(let e=0;e<i.length;++e)a.splice(i[e],0,1);Fa(r.shape,a)||(r=dA({inputs:{x:r},backend:n,attrs:{shape:a}}),f.push(r)),null===h?h=r:(h=YC({inputs:{a:r,b:h},backend:n}),f.push(h))}m<d-1&&(c[m]>=0&&(h=wR({inputs:{x:h},backend:n,attrs:{axis:c[m]-(a.length-p),keepDims:!1}}),f.push(h)),p--)}for(const m of f)m!==h&&n.disposeIntermediateTensorInfo(m);return h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CR={kernelName:bl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:i,y:r}=t;Ok([i,r],"eluGrad");const s=new Float32Array(Ma(r.shape)),a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values;for(let l=0;l<a.length;++l){const e=a[l];s[l]=e>=1?o[l]:o[l]*(e+1)}return n.makeTensorInfo(r.shape,"float32",s)}},ER=zy,AR=Uy,RR=Gy,NR=Vy,PR=Hy,DR=Wy,OR=sC(yl,e=>{const t=Math.sign(e),n=Math.abs(e),i=1/(1+ER*n);return t*(1-((((DR*i+PR)*i+NR)*i+RR)*i+AR)*i*Math.exp(-n*n))}),LR={kernelName:yl,backendName:"cpu",kernelFunc:OR};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MR(e){const{inputs:t,backend:n,attrs:i}=e,{input:r}=t,{dim:s}=i,a=r.shape.length,o=r.shape.slice();let l=s;return s<0&&(Pa(-(a+1)<=s,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+s+1),o.splice(l,0,1),dA({inputs:{x:r},backend:n,attrs:{shape:o}})}const FR={kernelName:xl,backendName:"cpu",kernelFunc:MR},$R=Bk((e,t)=>e/t),BR=Yk(fl,$R),zR={kernelName:fl,backendName:"cpu",kernelFunc:BR};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function UR(e,t,n){const i=e.shape,r=i[0],s=i[1],a=n.data.get(e.dataId),o=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,c=[r,s],u=Ma(c),d=Wa("float32",u),h=Wa("float32",u);for(let g=0;g<r;g++){const e=kE({inputs:{x:o},backend:n,attrs:{begin:[g,0],size:[1,s]}}),i=kE({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,s]}}),r=zk({inputs:{real:e,imag:i},backend:n}),{real:a,imag:c}=GR(r,t,n),u=jy(a,c);for(let t=0;t<s;t++){const e=Yy(u,t);d[g*s+t]=e.real,h[g*s+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r)}const p=n.makeTensorInfo(c,"float32",d),f=n.makeTensorInfo(c,"float32",h),m=zk({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}function GR(e,t,n){const i=Ma(e.shape),r=n.data.get(e.dataId),s=n.data.get(r.complexTensorInfos.real.dataId).values,a=n.data.get(r.complexTensorInfos.imag.dataId).values;if((o=i)&o-1){const e=function(e,t,n){const i=new Float32Array(2*t);for(let r=0;r<t;r++){let s=0,a=0;for(let i=0;i<t;i++){const o=Jy(r*i,t,n),l=Yy(e,i);s+=l.real*o.real-l.imag*o.imag,a+=l.real*o.imag+l.imag*o.real}n&&(s/=t,a/=t),Zy(i,s,a,r)}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(jy(s,a),i,t);return qy(e)}{const r=VR(s,a,i,t,n),o=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(o,"float32",r.real),t=n.makeTensorInfo(o,"float32",r.imag),s=n.makeTensorInfo([],"float32",yd(i,"float32")),a=Vk({inputs:{x:s},backend:n}),l=zR.kernelFunc({inputs:{a:e,b:s},backend:n}),c=zR.kernelFunc({inputs:{a:t,b:a},backend:n}),u=n.data.get(l.dataId).values,d=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:u,imag:d}}return r}var o}function VR(e,t,n,i,r){if(1===n)return{real:e,imag:t};const s=jy(e,t),a=n/2,o=Xy(s),l=o.real,c=o.imag,u=[l.length],d=r.makeTensorInfo(u,"float32",l),h=r.makeTensorInfo(u,"float32",c),p=zk({inputs:{real:d,imag:h},backend:r}),f=Ky(s),m=f.real,g=f.imag,b=[m.length],y=r.makeTensorInfo(b,"float32",m),v=r.makeTensorInfo(b,"float32",g),T=zk({inputs:{real:y,imag:v},backend:r}),x=VR(l,c,a,i,r),_=x.real,S=x.imag,w=[_.length],I=r.makeTensorInfo(w,"float32",_),k=r.makeTensorInfo(w,"float32",S),C=zk({inputs:{real:I,imag:k},backend:r}),E=VR(m,g,a,i,r),A=E.real,R=E.imag,N=[A.length],P=r.makeTensorInfo(N,"float32",A),D=r.makeTensorInfo(N,"float32",R),O=zk({inputs:{real:P,imag:D},backend:r}),L=Qy(n,i),M=[L.real.length],F=r.makeTensorInfo(M,"float32",L.real),$=r.makeTensorInfo(M,"float32",L.imag),B=zk({inputs:{real:F,imag:$},backend:r}),z=YC({inputs:{a:B,b:O},backend:r}),U=eC({inputs:{a:C,b:z},backend:r}),G=WE({inputs:{a:C,b:z},backend:r}),V=Wk({inputs:{input:U},backend:r}),H=Wk({inputs:{input:G},backend:r}),W=YA({inputs:{input:U},backend:r}),j=YA({inputs:{input:G},backend:r}),q=QA({inputs:[V,H],backend:r,attrs:{axis:0}}),X=QA({inputs:[W,j],backend:r,attrs:{axis:0}}),K=r.data.get(q.dataId).values,Y=r.data.get(X.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(X),{real:K,imag:Y}}const HR={kernelName:Sl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t,r=Ma(i.shape),s=i.shape[i.shape.length-1],a=dA({inputs:{x:i},backend:n,attrs:{shape:[r/s,s]}}),o=UR(a,!1,n),l=dA({inputs:{x:o},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WR(e){const{backend:t,attrs:n}=e,{shape:i,value:r,dtype:s}=n,a=s||Qa(r),o=ja(a,Ma(i));return function(e,t){e.fill(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(o,r),t.makeTensorInfo(i,a,o)}const jR={kernelName:wl,backendName:"cpu",kernelFunc:WR};const qR={kernelName:Il,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:i}=e,r=n,s=Wa(i.dtype,Ma(i.shape)),[a,o,l,c]=i.shape,u=r.data.get(i.dataId).values;for(let d=0;d<a;d++){const e=d*l*o*c;for(let t=0;t<o;t++){const n=t*(l*c);for(let t=0;t<l;t++){const i=t*c;for(let r=0;r<c;r++){const a=Math.round(l-t-1),o=e+n+i+r;let d=u[o];if(a>=0&&a<l){d=u[e+n+a*c+r]}s[o]=d}}}}return{dataId:r.write(s,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},XR=Bk((e,t)=>Math.floor(e/t)),KR=Yk(Cl,XR,null,"int32"),YR={kernelName:Cl,backendName:"cpu",kernelFunc:KR};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZR={kernelName:Su,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=i;let m=eR({inputs:{x:r,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(a){const e=m;if("NCHW"===u&&1===a.shape.length&&1!==a.shape[0]){const e=dA({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=eC({inputs:{a:m,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else m=eC({inputs:{a:m,b:a},backend:n});n.disposeIntermediateTensorInfo(e)}if(p){const e=m;if("NCHW"===u&&"prelu"===p&&1===o.shape.length&&1!==o.shape[0]){const e=dA({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=uA(n,m,p,e,f),n.disposeIntermediateTensorInfo(e)}else m=uA(n,m,p,o,f);n.disposeIntermediateTensorInfo(e)}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR={kernelName:wu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=i;let m=gR({inputs:{x:r,filter:s},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(a){const e=m;m=eC({inputs:{a:m,b:a},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){const e=m;m=uA(n,m,p,o,f),n.disposeIntermediateTensorInfo(e)}return m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JR={kernelName:Rl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:i,indices:r}=t,s=Ma(i.shape),a=r.shape,o=a[a.length-1],[l,c,u,d]=xp(i,r);if(0===c)return n.makeTensorInfo(l,i.dtype,[]);const h=SC(n.data.get(r.dataId).values,n.bufferSync(i),i.dtype,c,o,u,d,i.shape,s);return n.makeTensorInfo(l,i.dtype,h.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eN={kernelName:Al,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,indices:s}=t,{axis:a,batchDims:o}=i;Ok([r,s],"gatherV2");const l=Va(a,r.shape)[0],c=n.data.get(s.dataId).values,u=r.shape[l];for(let v=0;v<c.length;++v){const e=c[v];Pa(e<=u-1&&e>=0,()=>`GatherV2: the index value ${e} is not in [0, ${u-1}]`)}let d=o;null==o&&(d=0);const h=Ma(s.shape),p=Sv(r,s,l,d),f=dA({inputs:{x:r},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),m=dA({inputs:{x:s},backend:n,attrs:{shape:[p.batchSize,h/p.batchSize]}}),g=[p.batchSize,p.outerSize,h/p.batchSize,p.sliceSize],b=n.bufferSync(m),y=wC(n.bufferSync(f),b,g);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(p.outputShape,y.dtype,y.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tN={kernelName:Ol,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t,r=Ma(i.shape),s=i.shape[i.shape.length-1],a=dA({inputs:{x:i},backend:n,attrs:{shape:[r/s,s]}}),o=UR(a,!0,n),l=dA({inputs:{x:o},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}},nN=sC(Ml,e=>Number.isFinite(e)?1:0,"bool"),iN={kernelName:Ml,backendName:"cpu",kernelFunc:nN},rN=sC(Fl,e=>Math.abs(e)===1/0?1:0,"bool"),sN={kernelName:Fl,backendName:"cpu",kernelFunc:rN},aN=sC($l,e=>Number.isNaN(e)?1:0,"bool"),oN={kernelName:$l,backendName:"cpu",kernelFunc:aN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lN={kernelName:Gl,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,num:s}=n,a=FC(i,r,s);return t.makeTensorInfo([a.length],"float32",a)}},cN=sC(Hl,e=>Math.log1p(e)),uN={kernelName:Hl,backendName:"cpu",kernelFunc:cN},dN=Bk((e,t)=>e&&t),hN=Yk(Wl,dN,null,"bool"),pN={kernelName:Wl,backendName:"cpu",kernelFunc:hN},fN=sC(jl,e=>e?0:1,"bool"),mN={kernelName:jl,backendName:"cpu",kernelFunc:fN},gN=Bk((e,t)=>e||t),bN=Yk(ql,gN,null,"bool"),yN={kernelName:ql,backendName:"cpu",kernelFunc:bN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vN={kernelName:Xl,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{depthRadius:s,bias:a,alpha:o,beta:l}=i;Ok(r,"LRN");const c=r.shape[3],u=c-1,d=n.data.get(r.dataId).values,h=Ma(r.shape),p=new Float32Array(h);function f(e){const t=e%c;let n=e-t+Math.max(0,t-s);const i=e-t+Math.min(t+s,u);let r=0;for(;n<=i;n++){const e=d[n];r+=e*e}return r}for(let m=0;m<h;m++){const e=f(m),t=d[m]*Math.pow(a+o*e,-l);p[m]=t}return n.makeTensorInfo(r.shape,r.dtype,p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TN={kernelName:Kl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,y:s,dy:a}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=i;Ok(a,"LRNGrad");const d=Ma(a.shape),h=a.shape[3],p=n.data.get(a.dataId).values,f=n.data.get(r.dataId).values,m=n.data.get(s.dataId).values,g=new Float32Array(d),b=d;for(let y=0;y<b;y++){const e=y%h,t=y-e+Math.max(0,e-o),n=y-e+Math.min(h,e+o+1);let i=0;for(let r=t;r<n;r++)i+=Math.pow(f[r],2);i=c*i+l;for(let r=t;r<n;r++){let e=-2*c*u*f[r]*m[y]/i;y===r&&(e+=Math.pow(i,-u)),e*=p[y],g[r]+=e}}return n.makeTensorInfo(a.shape,r.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xN(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reductionIndices:s,keepDims:a}=i,o=n;let l=r.shape;const c=l.length,u=Va(s,l);let d=u;const h=pm(d,c);let p=o.data.get(r.dataId).values;if(null!=h){const e=new Array(c);for(let t=0;t<e.length;t++)e[t]=l[h[t]];p=iE(p,l,r.dtype,h,e),d=mm(d.length,c),l=e}Ok(r,"max"),hm("max",d,c);const[f,m]=um(l,d),g=UC(p,Ma(m),f,r.dtype),b=o.write(g,f,r.dtype);let y=f;if(a){y=dm(f,u)}return{dataId:b,shape:y,dtype:r.dtype}}const _N={kernelName:Yl,backendName:"cpu",kernelFunc:xN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SN={kernelName:Ql,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;Ok(r,"maxPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;Pa(bf(a,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`);const c=of(r.shape,s,a,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&Fa(c.inShape,c.outShape))u=Vk({inputs:{x:r},backend:n});else{const e=n.data.get(r.dataId).values,t=to(r.shape),i=MA(e,r.shape,r.dtype,t,c,"max");u=n.makeTensorInfo(c.outShape,r.dtype,i.values)}return u}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wN={kernelName:ec,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=i;Ok(r,"maxPool3d");const u=lf(r.shape,s,a,1,o,l,c),d=$A(n.data.get(r.dataId).values,r.shape,r.dtype,to(r.shape),u,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IN={kernelName:tc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,{filterSize:a,strides:o,pad:l,dimRoundingMode:c}=i;Ok([r,s],"maxPool3DGrad");const u=lf(s.shape,a,o,1,l,c),d=function(e,t){const n=Zh(t.outShape,"int32"),i=t.strideDepth,r=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,u=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let b=0;b<t.outDepth;++b){const y=b*i-h;let v=y;for(;v<0;)v+=a;const T=Math.min(t.inDepth,c+y);for(let i=0;i<t.outHeight;++i){const c=i*r-p;let h=c;for(;h<0;)h+=o;const x=Math.min(t.inHeight,u+c);for(let r=0;r<t.outWidth;++r){const p=r*s-f;let _=p;for(;_<0;)_+=l;const S=Math.min(t.inWidth,d+p);let w=Number.NEGATIVE_INFINITY,I=-1;for(let t=v;t<T;t+=a){const n=t-y;for(let i=h;i<x;i+=o){const r=i-c;for(let s=_;s<S;s+=l){const a=s-p,o=e.get(m,t,i,s,g);o>=w&&(w=o,I=n*u*d+r*u+a)}}}n.set(I,m,b,i,r,g)}}}return n}(n.bufferSync(s),u),h=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.dilationDepth,g=u.dilationHeight,b=u.dilationWidth,y=u.effectiveFilterDepth,v=u.effectiveFilterHeight,T=u.effectiveFilterWidth,x=y-1-u.padInfo.front,_=T-1-u.padInfo.left,S=v-1-u.padInfo.top,w=Zh(s.shape,"float32"),I=n.bufferSync(r);for(let k=0;k<u.batchSize;++k)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let i=0;i<u.inWidth;++i){const r=t-x,s=n-S,a=i-_;let o=0;for(let t=0;t<y;t+=m){const n=(r+t)/h;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let i=0;i<v;i+=g){const r=(s+i)/p;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let s=0;s<T;s+=b){const l=(a+s)/f;if(l<0||l>=u.outWidth||Math.floor(l)!==l)continue;const c=y*v*T-1-d.get(k,n,r,l,e)===t*v*T+i*T+s?1:0;if(0===c)continue;o+=I.get(k,n,r,l,e)*c}}}w.set(o,k,t,n,i,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kN={kernelName:Jl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s,output:a}=t,o=s;Ok([s,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=i,h=of(o.shape,l,c,1,u,d),p=n.data.get(o.dataId).values,f=Zh(h.outShape,o.dtype,FA(p,o.shape,o.dtype,h).values),m=h.strideHeight,g=h.strideWidth,b=h.dilationHeight,y=h.dilationWidth,v=h.effectiveFilterHeight,T=h.effectiveFilterWidth,x=T-1-h.padInfo.left,_=v-1-h.padInfo.top,S=Zh(o.shape,"float32"),w=n.data.get(r.dataId).values,I=Zh(r.shape,"float32",w);for(let k=0;k<h.batchSize;++k)for(let e=0;e<h.inChannels;++e)for(let t=0;t<h.inHeight;++t)for(let n=0;n<h.inWidth;++n){const i=t-_,r=n-x;let s=0;for(let t=0;t<v;t+=b){const n=(i+t)/m;if(!(n<0||n>=h.outHeight||Math.floor(n)!==n))for(let i=0;i<T;i+=y){const a=(r+i)/g;if(a<0||a>=h.outWidth||Math.floor(a)!==a)continue;const o=v*T-1-f.get(k,n,a,e)===t*T+i?1:0;if(0===o)continue;s+=I.get(k,n,a,e)*o}}S.set(s,k,t,n,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const CN={kernelName:nc,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{filterSize:r,strides:s,pad:a,includeBatchInIndex:o}=t,l=n;Ok(i,"MaxPoolWithArgmax");const c=l.data.get(i.dataId).values,u=of(i.shape,r,s,[1,1],a),[d,h]=function(e,t,n,i,r){const s=MA(e,0,n,to(t),r,"max"),a=FA(e,t,n,r,!0,i);return[s.values,a.values]}(c,i.shape,i.dtype,o,u),p=l.write(d,u.outShape,i.dtype),f=l.write(h,u.outShape,i.dtype);return[{dataId:p,shape:u.outShape,dtype:i.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EN={kernelName:ic,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=Va(s,r.shape),l=Ma(um(r.shape,o)[1]),c=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(u);const d=Xk({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});c.push(d);const h=BR({inputs:{a:d,b:u},backend:n});c.push(h);const p=wR({inputs:{x:h},backend:n,attrs:{axis:s,keepDims:a}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AN={kernelName:rc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;Ok(r,"min");const o=Va(s,r.shape);let l=o;const c=pm(l,r.shape.length);let u=r;null!=c&&(u=rE({inputs:{x:r},backend:n,attrs:{perm:c}}),l=mm(l.length,r.shape.length)),hm("min",l,u.shape.length);const[d,h]=um(u.shape,l),p=Ma(h),f=so(Ma(d),u.dtype),m=n.data.get(u.dataId).values;for(let b=0;b<f.length;++b){const e=b*p;let t=m[e];for(let n=0;n<p;++n){const i=m[e+n];(Number.isNaN(i)||i<t)&&(t=i)}f[b]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,f);if(a){const e=dA({inputs:{x:g},backend:n,attrs:{shape:dm(d,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RN={kernelName:ac,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{paddings:s,mode:a}=i;Ok(r,"mirrorPad");const o=s.map((e,t)=>e[0]+r.shape[t]+e[1]),l=s.map(e=>e[0]),c=s.map((e,t)=>e[0]+r.shape[t]),u="reflect"===a?0:1,d=n.data.get(r.dataId).values,h=r.shape.length,p=to(r.shape),f=Ma(o),m=o.length,g=to(o),b=Wa(r.dtype,f);for(let y=0;y<f;y++){let e=co(y,m,g);for(let n=0;n<m;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-u:e[n]>=c[n]&&(e[n]=2*(c[n]-1)-e[n]+u);e=e.map((e,t)=>e-l[t]);const t=lo(e,h,p);b[y]=d[t]}return{dataId:n.write(b,o,r.dtype),shape:o,dtype:r.dtype}}},NN=Bk((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),PN=Yk(oc,NN),DN={kernelName:oc,backendName:"cpu",kernelFunc:PN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ON(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{dim:s}=i,a=r.shape.length;let o=s;if(-1===o&&(o=a-1),o!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${o}`);const l=Va([o],r.shape),c=xN({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=dm(c.shape,l),d=dA({inputs:{x:c},backend:n,attrs:{shape:u}}),h=WE({inputs:{a:r,b:d},backend:n}),p=mC({inputs:{x:h},backend:n}),f=wR({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=dA({inputs:{x:f},backend:n,attrs:{shape:u}}),g=BR({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const LN={kernelName:Zc,backendName:"cpu",kernelFunc:ON};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN={kernelName:lc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{numSamples:s,seed:a,normalized:o}=i;Ok(r,"multinomial");const l=o?r:ON({inputs:{logits:r},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=n.data.get(l.dataId).values,h=[c,s],p=so(Ma(h),"int32");for(let f=0;f<c;++f){const e=f*u,t=new Float32Array(u-1);t[0]=d[e];for(let r=1;r<t.length;++r)t[r]=t[r-1]+d[e+r];const n=Pg.alea(a.toString()),i=f*s;for(let r=0;r<s;++r){const e=n();p[i+r]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){p[i+r]=n;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",p)}},FN=zb;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $N={kernelName:hc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=i;Ok(r,"NonMaxSuppression");const c=n.data.get(r.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:d}=FN(c,u,a,o,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},BN=Ub;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zN={kernelName:pc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=i;Ok(r,"NonMaxSuppressionPadded");const u=n.data.get(r.dataId).values,d=n.data.get(s.dataId).values,{selectedIndices:h,validOutputs:p}=BN(u,d,a,o,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},UN=Gb;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GN={kernelName:fc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=i;Ok(r,"NonMaxSuppressionWithScore");const u=n.data.get(r.dataId).values,d=n.data.get(s.dataId).values,h=a,p=o,f=l,m=c,{selectedIndices:g,selectedScores:b}=UN(u,d,h,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VN={kernelName:gc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:r}=t,{dtype:s,depth:a,onValue:o,offValue:l}=i;Ok(r,"oneHot");const c=Ma(r.shape),u=new Float32Array(c*a);u.fill(l);const d=n.data.get(r.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<a&&(u[h*a+d[h]]=o);return n.makeTensorInfo([...r.shape,a],s,u)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HN(e){const{inputs:t,backend:n}=e,{x:i}=t;if("string"===i.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===i.dtype){const e=Wk({inputs:{input:i},backend:n}),t=HN({inputs:{x:e},backend:n}),r=YA({inputs:{input:i},backend:n}),s=HN({inputs:{x:r},backend:n}),a=zk({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),a}return WR({backend:n,attrs:{shape:i.shape,value:0,dtype:i.dtype}})}const WN={kernelName:vu,backendName:"cpu",kernelFunc:HN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jN={kernelName:mc,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:i}=t,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===r.dtype){const t=Wk({inputs:{input:r},backend:i}),n=e({inputs:{x:t},backend:i}),s=YA({inputs:{input:r},backend:i}),a=HN({inputs:{x:s},backend:i}),o=zk({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(t),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}return WR({backend:i,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qN(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i;if(1===t.length)return MR({inputs:{input:t[0]},backend:n,attrs:{dim:r}});const s=t[0].shape,a=t[0].dtype;t.forEach(e=>{Da(s,e.shape,"All tensors passed to stack must have matching shapes"),Pa(a===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=QA({inputs:t.map(e=>{const t=MR({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t}),backend:n,attrs:{axis:r}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}const XN={kernelName:bc,backendName:"cpu",kernelFunc:qN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KN={kernelName:yc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{paddings:s,constantValue:a}=i;Ok(r,"pad");const o=s.map((e,t)=>e[0]+r.shape[t]+e[1]),l=s.map(e=>e[0]),c=n.data.get(r.dataId).values,u=Ma(r.shape),d=r.shape.length,h=to(r.shape),p=Ma(o),f=o.length,m=to(o),g=Wa(r.dtype,p);0!==a&&g.fill(a);for(let b=0;b<u;b++){g[lo(co(b,d,h).map((e,t)=>e+l[t]),f,m)]=c[b]}return{dataId:n.write(g,o,r.dtype),shape:o,dtype:r.dtype}}},YN=Bk((e,t)=>Math.pow(e,t)),ZN=Yk(vc,YN),QN={kernelName:vc,backendName:"cpu",kernelFunc:ZN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN={kernelName:_c,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{paramsNestedSplits:r,paramsDenseValues:s,indices:a}=t,o=r.map(e=>n.data.get(e.dataId).values),l=r.map(e=>e.shape),c=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values,[d,h,p]=dE(o,l,c,s.shape,s.dtype,u,a.shape),f=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(p,s.dtype,h);return f.concat([m])}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP={kernelName:Sc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{shape:r,values:s,defaultValue:a,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=i,c=n.data.get(r.dataId).values,u=n.data.get(s.dataId).values,d=n.data.get(a.dataId).values,h=o.map(e=>n.data.get(e.dataId).values),p=o.map(e=>e.shape),[f,m]=gE(c,r.shape,u,s.shape,s.dtype,d,a.shape,h,p,l);return n.makeTensorInfo(f,s.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP={kernelName:wc,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,dtype:s,step:a}=n,o=bE(i,r,a,s);return t.makeTensorInfo([o.length],s,o)}},nP=sC(kc,e=>1/e),iP={kernelName:kc,backendName:"cpu",kernelFunc:nP};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP={kernelName:Nc,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i;Ok(r,"resizeBilinear");const l=to(r.shape),[c,u]=o,[d,h,p,f]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(Ma([d,c,u,f])),b=[s&&c>1?h-1:h,s&&u>1?p-1:p],y=[s&&c>1?c-1:c,s&&u>1?u-1:u];let v=0;const T=b[0]/y[0],x=b[1]/y[1];for(let _=0;_<d;_++)for(let e=0;e<c;e++){let t;t=a?T*(e+.5)-.5:T*e;const n=Math.max(0,Math.floor(t)),i=t-n,r=Math.min(h-1,Math.ceil(t)),s=_*l[0]+n*l[1],o=_*l[0]+r*l[1];for(let e=0;e<u;e++){let t;t=a?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),r=t-n,c=Math.min(p-1,Math.ceil(t)),u=s+n*l[2],d=o+n*l[2],h=s+c*l[2],b=o+c*l[2];for(let e=0;e<f;e++){const t=m[u+e],n=m[d+e],s=t+(m[h+e]-t)*r,a=s+(n+(m[b+e]-n)*r-s)*i;g[v++]=a}}}return n.makeTensorInfo([d,c,u,f],"float32",g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={kernelName:Pc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i;Ok([s,r],"resizeBilinearGrad");const o=to(r.shape),[l,c,u,d]=r.shape,[,h,p]=s.shape,f=new Float32Array(l*c*u*d),m=[a&&h>1?c-1:c,a&&p>1?u-1:u],g=[a&&h>1?h-1:h,a&&p>1?p-1:p],b=m[0]/g[0],y=m[1]/g[1],v=n.data.get(s.dataId).values;let T=0;for(let x=0;x<l;x++){const e=x*o[0];for(let t=0;t<h;t++){const n=t*b,i=Math.floor(n),r=Math.min(Math.ceil(n),c-1),s=e+i*o[1],a=e+r*o[1],l=n-i,h=1-l;for(let e=0;e<p;e++){const t=e*y,n=Math.floor(t),i=Math.min(Math.ceil(t),u-1),r=t-n,c=1-r,p=s+n*o[2],m=s+i*o[2],g=a+n*o[2],b=a+i*o[2],x=h*c,_=h*r,S=l*c,w=l*r;for(let e=0;e<d;e++){const t=v[T++];f[p+e]+=t*x,f[m+e]+=t*_,f[g+e]+=t*S,f[b+e]+=t*w}}}}return n.makeTensorInfo([l,u,c,d],"float32",f)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP={kernelName:Ac,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i;Ok(r,"resizeNearestNeighbor");const l=to(r.shape),[c,u]=o,[d,h,p,f]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(d*c*u*f),b=[s&&c>1?h-1:h,s&&u>1?p-1:p],y=[s&&c>1?c-1:c,s&&u>1?u-1:u],v=b[0]/y[0],T=b[1]/y[1];let x=0;for(let _=0;_<d;_++){const e=_*l[0];for(let t=0;t<c;t++){const n=a?v*(t+.5):v*t;let i=Math.min(h-1,s?Math.round(n):Math.floor(n));a&&(i=Math.max(0,i));const r=e+i*l[1];for(let e=0;e<u;e++){const t=a?T*(e+.5):T*e;let n=Math.min(p-1,s?Math.round(t):Math.floor(t));a&&(n=Math.max(0,n));const i=r+n*l[2];for(let e=0;e<f;e++){const t=m[i+e];g[x++]=t}}}}return n.makeTensorInfo([d,c,u,f],r.dtype,g)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={kernelName:Rc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i;Ok([s,r],"resizeNearestNeighborGrad");const o=to(r.shape),l=to(s.shape),[c,u,d,h]=r.shape,[,p,f]=s.shape,m=new Float32Array(c*u*d*h),g=n.data.get(s.dataId).values,b=[a&&p>1?u-1:u,a&&f>1?d-1:d],y=[a&&p>1?p-1:p,a&&f>1?f-1:f],v=b[0]/y[0],T=b[1]/y[1],x=1/v,_=1/T,S=2*Math.ceil(x)+2,w=2*Math.ceil(_)+2;for(let I=0;I<c;I++){const e=I*o[0];for(let t=0;t<u;t++){const n=e+t*o[1],i=Math.floor(t*x),r=Math.floor(i-S/2);for(let s=0;s<d;s++){const i=n+s*o[2],c=Math.floor(s*_),b=Math.floor(c-w/2);for(let n=0;n<h;n++){let o=0;for(let i=0;i<S;i++){const c=i+r;if(c<0||c>=p)continue;const h=e+c*l[1],m=c*v;if(t===Math.min(u-1,a?Math.round(m):Math.floor(m)))for(let e=0;e<w;e++){const t=e+b;if(t<0||t>=f)continue;const i=h+t*l[2],r=t*T;s===Math.min(d-1,a?Math.round(r):Math.floor(r))&&(o+=g[i+n])}}m[i+n]=o}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP={kernelName:Oc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{dims:s}=i;Ok(r,"reverse");const a=r.shape.length,o=Va(s,r.shape);if(0===a)return Vk({inputs:{x:r},backend:n});const l=new Nd(r.shape,r.dtype),c=n.bufferSync(r);for(let u=0;u<l.size;u++){const e=l.indexToLoc(u),t=e.slice();o.forEach(e=>t[e]=r.shape[e]-1-t[e]),l.set(c.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},cP={kernelName:xu,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:i}=e,{radians:r,fillValue:s,center:a}=t,o=n,l=Wa(i.dtype,Ma(i.shape)),[c,u,d,h]=i.shape,[p,f]=Py(a,u,d),m=Math.sin(r),g=Math.cos(r),b=o.data.get(i.dataId).values;for(let y=0;y<c;y++){const e=y*d*u*h;for(let t=0;t<u;t++){const n=t*(d*h);for(let i=0;i<d;i++){const r=i*h;for(let a=0;a<h;a++){const o=[c,t,i,a],y=o[2],v=o[1];let T=(y-p)*g-(v-f)*m,x=(y-p)*m+(v-f)*g;T=Math.round(T+p),x=Math.round(x+f);let _=s;if("number"!=typeof s&&(_=3===a?255:s[a]),T>=0&&T<d&&x>=0&&x<u){_=b[e+x*(d*h)+T*h+a]}l[e+n+r+a]=_}}}}return{dataId:o.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},uP=sC(Lc,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}),dP={kernelName:Lc,backendName:"cpu",kernelFunc:uP};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:Fc,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:r,updates:s}=t,{shape:a}=i,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Sp(0,r,a),h=xE(n.bufferSync(r),n.bufferSync(s),a,d,c,l,o,u,0,!0);return n.makeTensorInfo(a,h.dtype,h.values)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pP(e,t){let n=0,i=e.length,r=0;for(;n<i;)r=Math.floor((n+i)/2),e[r]<t?n=r+1:i=r;return i}function fP(e,t){let n=0,i=e.length,r=0;for(;n<i;)r=Math.floor((n+i)/2),e[r]<=t?n=r+1:i=r;return i}const mP={kernelName:$c,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{sortedSequence:r,values:s}=t,{side:a}=i,o=function(e,t,n,i,r,s){const a=ja("int32",n*r);for(let o=0;o<n;++o){const n=e.slice(o*i,(o+1)*i),l=o*r;for(let e=0;e<r;++e)a[l+e]="left"===s?pP(n,t[e+l]):fP(n,t[e+l])}return a}(n.data.get(r.dataId).values,n.data.get(s.dataId).values,r.shape[0],r.shape[1],s.shape[1],a);return n.makeTensorInfo(s.shape,"int32",o)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP={kernelName:Bc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:i,t:r,e:s}=t;Ok([i,r,s],"select");const a=i.shape.length,o=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(s.dataId).values,u=Xd(r.dtype,s.dtype),d=so(Ma(r.shape),u);let h=0;const p=0===a||a>1||1===r.shape.length?1:Ma(r.shape.slice(1));for(let f=0;f<o.length;f++)for(let e=0;e<p;e++)1===o[f]?d[h++]=l[f]:d[h++]=c[f];return n.makeTensorInfo(r.shape,u,d)}},bP=$y,yP=By,vP=sC(zc,e=>e>=0?yP*e:bP*(Math.exp(e)-1)),TP={kernelName:zc,backendName:"cpu",kernelFunc:vP},xP=sC(Hc,e=>e<0?-1:e>0?1:0),_P={kernelName:Hc,backendName:"cpu",kernelFunc:xP},SP=sC(Gc,e=>Math.sin(e)),wP={kernelName:Gc,backendName:"cpu",kernelFunc:SP},IP=sC(Vc,e=>Math.sinh(e)),kP={kernelName:Vc,backendName:"cpu",kernelFunc:IP},CP=Math.log(1.1920928955078125e-7)+2,EP=sC(jc,e=>{const t=e>-CP,n=e<CP,i=Math.exp(e);let r;return r=n?i:t?e:Math.log(1+i),r}),AP={kernelName:jc,backendName:"cpu",kernelFunc:EP};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RP={kernelName:Kc,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,paddings:a}=i;Ok([r],"spaceToBatchND");const o=Ma(s),l=[[0,0]];l.push(...a);for(let g=1+s.length;g<r.shape.length;++g)l.push([0,0]);const c=KN.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),u=Dy(c.shape,s,o,!1),d=Oy(u.length,s.length,!1),h=Ly(c.shape,s,o,!1),p=dA({inputs:{x:c},backend:n,attrs:{shape:u}}),f=rE({inputs:{x:p},backend:n,attrs:{perm:d}}),m=dA({inputs:{x:f},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP={kernelName:Qc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:i,values:r,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${s.shape}`);if(2!==i.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${i.shape}`);if(1!==r.shape.length)throw new Error(`Values must be a vector, saw:\n        ${r.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const o=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values[0],[d,h,p,f,m]=EE(o,i.shape,i.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,i.dtype,d),n.makeTensorInfo([h[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(e=>Number(e)))),n.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PP={kernelName:Jc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:i,inputShape:r,newShape:s}=t;if(2!==i.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${i.shape}`);if(1!==r.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${r.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const a=Array.from(n.data.get(r.dataId).values),o=n.data.get(i.dataId).values,l=Array.from(n.data.get(s.dataId).values),[c,u,d]=AE(o,i.shape,i.dtype,a,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([d.length],s.dtype,new Int32Array(d))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DP={kernelName:eu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${r.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${s.shape}`);if(r.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,[c,u]=RE(a,i.shape,i.dtype,o,l,!0);return n.makeTensorInfo(u,i.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OP={kernelName:tu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${r.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${s.shape}`);if(r.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,[c,u]=RE(a,i.shape,i.dtype,o,l);return n.makeTensorInfo(u,i.dtype,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP={kernelName:nu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sparseIndices:r,sparseValues:s,defaultValue:a}=t,{outputShape:o}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=Sp(0,r,o),p=!1,f=n.bufferSync(r);let m;switch(s.dtype){case"bool":m=xE(f,n.bufferSync(s),o,h,u,c,l,d,Boolean(n.data.get(a.dataId).values[0]),p);break;case"float32":m=xE(f,n.bufferSync(s),o,h,u,c,l,d,n.data.get(a.dataId).values[0],p);break;case"int32":m=xE(f,n.bufferSync(s),o,h,u,c,l,d,n.data.get(a.dataId).values[0],p);break;case"string":m=xE(f,n.bufferSync(s),o,h,u,c,l,d,_d(n.data.get(a.dataId).values[0]),p);break;default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(o,m.dtype,m.values)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MP={kernelName:Yc,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{numOrSizeSplits:s,axis:a}=i,o=Va(a,r.shape)[0],l=lv(r,s,o),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(e=>{const t=[...u];t[o]=e;const i=kE({inputs:{x:r},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,i})}},FP={kernelName:ru,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,i=t;Ok(n,"square");const r=i.data.get(n.dataId).values,s=new Float32Array(r.length);for(let a=0;a<r.length;++a){const e=r[a];s[a]=e*e}return{dataId:i.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},$P=sC(Tu,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),BP={kernelName:Tu,backendName:"cpu",kernelFunc:$P};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zP={kernelName:su,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,end:a,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=i;Ok(r,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:b,begin:y,end:v,strides:T}=Fp(r.shape,s,a,o,l,c,u,d,h);let x;if(m)x=dA({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||b){Pa(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const e=Ip(y,v,T),t=kE({inputs:{x:r},backend:n,attrs:{begin:y,size:e}});x=dA({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{const e=FE(p,n.bufferSync(r),T,y);x=n.makeTensorInfo(f,e.dtype,e.values)}return x}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UP={kernelName:au,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{separator:r,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:d}=t,h=n.data.get(u.dataId).values,p=n.data.get(d.dataId).values,[f,m]=BE(h,p,r,s,a,o,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",m)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GP={kernelName:ou,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{skipEmpty:r}=i,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values[0],[c,u,d]=UE(o,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VP={kernelName:lu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{numBuckets:r}=i,{input:s}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=GE(n.data.get(s.dataId).values,r);return n.makeTensorInfo(s.shape,"int32",a)}},HP=sC(uu,e=>Math.tan(e)),WP={kernelName:uu,backendName:"cpu",kernelFunc:HP},jP=sC(du,e=>Math.tanh(e));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qP={kernelName:fu,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,attrs:n,backend:i}=e,{image:r,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:l,outputShape:c}=n,[u,d,h,p]=r.shape,[f,m]=null!=c?c:[d,h],g=[u,f,m,p],b=to(r.shape),y=b[0],v=b[1],T=b[2],x=to(g),_=x[0],S=x[1],w=x[2],I=Wa(r.dtype,Ma(g));I.fill(l);const k=i.data.get(r.dataId).values,C=i.data.get(s.dataId).values;for(let E=0;E<u;++E){const e=1===s.shape[0]?C:C.subarray(8*E,8*E+8);for(let t=0;t<f;++t)for(let n=0;n<m;++n)for(let i=0;i<p;++i){let r;const s=e[6]*n+e[7]*t+1;if(0===s)continue;const c=(e[0]*n+e[1]*t+e[2])/s,u=(e[3]*n+e[4]*t+e[5])/s,p=XP(c,h,o),f=XP(u,d,o);switch(a){case"nearest":r=YP(k,d,h,y,v,T,E,f,p,i,l);break;case"bilinear":r=ZP(k,d,h,y,v,T,E,f,p,i,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}I[E*_+t*S+n*w+i]=r}return i.makeTensorInfo(g,r.dtype,I)}return{dataId:i.write(I,g,r.dtype),shape:r.shape,dtype:r.dtype}}};function XP(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return Aa(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return Aa(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Aa(0,e,t-1)}(e,t);default:return function(e){return e}(e)}}function KP(e,t,n,i,r,s,a,o,l,c,u){return 0<=o&&o<t&&0<=l&&l<n?e[a*i+o*r+l*s+c]:u}function YP(e,t,n,i,r,s,a,o,l,c,u){return KP(e,t,n,i,r,s,a,Math.round(o),Math.round(l),c,u)}function ZP(e,t,n,i,r,s,a,o,l,c,u){const d=Math.floor(o),h=Math.floor(l),p=d+1,f=h+1;return(p-o)*((f-l)*KP(e,t,n,i,r,s,a,d,h,c,u)+(l-h)*KP(e,t,n,i,r,s,a,d,f,c,u))+(o-d)*((f-l)*KP(e,t,n,i,r,s,a,p,h,c,u)+(l-h)*KP(e,t,n,i,r,s,a,p,f,c,u))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QP={kernelName:bu,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{value:r}=t;let{axis:s}=i;s<0&&(s+=r.shape.length);const a=r.shape.length,o=r.shape[s],l=new Array(a-1);let c=0;for(let p=0;p<a;p++)p!==s&&(l[c++]=r.shape[p]);const u=new Array(a).fill(0),d=r.shape.slice();d[s]=1;const h=new Array(o);for(let p=0;p<h.length;p++){u[s]=p;const e=kE({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});h[p]=dA({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JP={kernelName:yu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,segmentIds:s}=t,{numSegments:a}=i;Ok(r,"unsortedSegmentSum");const o=[],l=[],c=r.shape.length-s.shape.length;let u=s;for(let h=0;h<c;++h){const e=MR({inputs:{input:u},backend:n,attrs:{dim:h+1}});u=e,l.push(e)}for(let h=0;h<a;++h){const e=yd(h,"int32"),t=n.makeTensorInfo([],"int32",e),i=hC({inputs:{a:t,b:u},backend:n}),s=Xk({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),a=YC({inputs:{a:s,b:r},backend:n}),c=wR({inputs:{x:a},backend:n,attrs:{axis:0,keepDims:!1}});o.push(c),l.push(t),l.push(i),l.push(s),l.push(a),l.push(c)}const d=qN({inputs:o,backend:n,attrs:{axis:0}});return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),d}},eD=[mA,$k,bA,vA,tC,TA,xA,_A,SA,wA,kA,EA,RA,DA,LA,BA,zA,UA,GA,fA,VA,HA,WA,jA,Kk,cC,XA,Uk,KA,JA,tR,nR,iR,rR,sR,aR,lR,uR,dR,hR,pR,fR,mR,bR,yR,vR,TR,xR,_R,SR,kR,eA,CR,pC,LR,gC,FR,vC,HR,jR,qR,_C,YR,ZR,QR,JR,eN,CC,RC,Hk,tN,ZA,iN,sN,oN,nA,DC,MC,lN,zC,uN,pN,mN,yN,vN,TN,_N,HC,SN,wN,IN,kN,CN,EN,AN,qC,RN,DN,MN,ZC,JC,$N,zN,GN,nE,VN,jN,XN,KN,QN,sA,oE,JN,eP,tP,jk,zR,iP,oA,cA,hA,rP,sP,aP,oP,lP,cP,dP,TE,hP,mP,gP,TP,wE,_P,wP,kP,CE,LN,AP,RP,NP,PP,DP,OP,LP,MP,DE,FP,ME,BP,zP,UP,GP,VP,jE,IR,WP,{kernelName:du,backendName:"cpu",kernelFunc:jP},{kernelName:hu,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reps:s}=i;Ok(r,"tile");const a=qE(n.bufferSync(r),s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}},{kernelName:pu,backendName:"cpu",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{k:s,sorted:a}=i;Ok(r,"topk");const o=n.data.get(r.dataId).values,[l,c]=YE(o,r.shape,r.dtype,s,a);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}},qP,sE,{kernelName:gu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{axis:r}=n,{x:s}=t;Ok(s,"unique");const a=i.data.get(s.dataId).values,{outputValues:o,outputShape:l,indices:c}=ZE(a,r,s.shape,s.dtype);return[i.makeTensorInfo(l,s.dtype,o),i.makeTensorInfo([c.length],"int32",c)]}},QP,JP,WN];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const a6 of eD)Nu(a6);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tD={},nD={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function iD(e,t){if(!(e in tD)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;n.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete tD[e]},!1),mo().getBool("SOFTWARE_WEBGL_ENABLED")&&(nD.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",nD)||n.getContext("experimental-webgl",nD);return n.getContext("webgl2",nD)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;tD[e]=n}const n=tD[e];return null==n||n.isContextLost()?(delete tD[e],iD(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),tD[e])}var rD,sD,aD,oD,lD,cD;function uD(e,t){return[t,e]}function dD(e){const t=Ma(e);return Ba(Math.ceil(t/4))}function hD(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function pD(e,t){const n=e;let i,r,s,a,o,l,c,u,d,h;return 2===mo().getNumber("WEBGL_VERSION")?(i=n.R32F,r=n.R16F,s=n.RGBA16F,a=n.RGBA32F,o=n.RED,c=4,u=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(i=e.RGBA,r=e.RGBA,s=e.RGBA,a=n.RGBA,o=e.RGBA,c=4,u=4,d=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT,l=e.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:h}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(e,t){const n=t();return mo().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}(e,t))}(e),n}(sD=rD||(rD={}))[sD.DENSE=0]="DENSE",sD[sD.SHARED_BATCH=1]="SHARED_BATCH",(oD=aD||(aD={}))[oD.RENDER=0]="RENDER",oD[oD.UPLOAD=1]="UPLOAD",oD[oD.PIXELS=2]="PIXELS",oD[oD.DOWNLOAD=3]="DOWNLOAD",(cD=lD||(lD={}))[cD.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",cD[cD.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",cD[cD.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",cD[cD.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",cD[cD.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16";function mD(e){return!!(mo().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function gD(e,t){return ID(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}const bD=/ERROR: [0-9]+:([0-9]+):/g;function yD(e,t){const n=bD.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);const i=+n[1],r=e.split("\n"),s=r.length.toString().length+2,a=r.map((e,t)=>za((t+1).toString(),s)+e);let o=0;for(let d=0;d<a.length;d++)o=Math.max(a[d].length,o);const l=a.slice(0,i-1),c=a.slice(i-1,i),u=a.slice(i);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${za(c[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function vD(e,t){if(fD(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function TD(e,t,n,i,r,s,a){const o=e.getAttribLocation(t,n);return-1!==o&&(fD(e,()=>e.bindBuffer(e.ARRAY_BUFFER,i)),fD(e,()=>e.vertexAttribPointer(o,r,e.FLOAT,!1,s,a)),fD(e,()=>e.enableVertexAttribArray(o)),!0)}function xD(e,t,n){!function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=t+e.TEXTURE0;if(i<e.TEXTURE0||i>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(e,n),fD(e,()=>e.activeTexture(e.TEXTURE0+n)),fD(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function _D(e,t,n){fD(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),fD(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function SD(e,t){fD(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),fD(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function wD(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}(e,t))}function ID(e,t,n){const i=fD(e,()=>t());if(null==i)throw new Error(n);return i}function kD(e,t=2){return Ma(e.slice(0,e.length-t))}function CD(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function ED(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[kD(e),...CD(e)]),t}function AD(e){return e%2==0}function RD(e,t){if(Fa(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],i=t.slice(-1)[0];if(n===i)return!0;if(AD(n)&&AD(i)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&AD(e[0])&&AD(t[0])}let ND,PD;function DD(e,t){return null!=e.getExtension(t)}function OD(e){try{if(null!=iD(e))return!0}catch(r6){return console.log("Error when getting WebGL context: ",r6),!1}return!1}function LD(e){if(0===e)return!1;const t=iD(e);if(1!==e){if(DD(t,"EXT_color_buffer_float"))return MD(t);const e="EXT_color_buffer_half_float";if(DD(t,e)){const n=t.getExtension(e);return function(e,t){const n=pD(e,t),i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const r=1,s=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,r,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(i),e.deleteFramebuffer(a),o}(t,n)}return!1}if(!DD(t,"OES_texture_float"))return!1;if(!DD(t,"WEBGL_color_buffer_float"))return!1;return MD(t)}function MD(e){const t=pD(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const r=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(i),r}function FD(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&Pa("complex64"!==e.dtype,()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $D=mo();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function BD(){let e,t,n,i,r,s,a,o,l,c;return 2===mo().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",i="in",r="texture",s="outputColor",a="out vec4 outputColor;",o=mo().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",i="varying",r="texture2D",s="gl_FragColor",a="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:i,texture2D:r,output:s,defineOutput:a,defineSpecialNaN:o,defineSpecialInf:l,defineRound:c}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(e,t,n="index"){const i=to(t);return i.map((t,r)=>`${`int ${e[r]} = ${n} / ${t}`}; ${r===i.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * ${t}`:`index -= ${e[r]} * ${t}`};`).join("")}function UD(e,t,n="index"){const i=to(t);return i.map((t,r)=>`${`int ${e[r]} = ${n} / outShapeStrides[${r}]`}; ${r===i.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * outShapeStrides[${r}]`:`index -= ${e[r]} * outShapeStrides[${r}]`};`).join("")}function GD(e,t,n="index"){const i=e.map((e,t)=>t),r=function(e,t){const n=e.length,i=e.map(e=>`${t}[${e}]`),r=new Array(n-1);r[n-2]=i[n-1];for(let s=n-3;s>=0;--s)r[s]=`(${r[s+1]} * ${i[s+1]})`;return r}(i,t);return r.map((t,i)=>`${`int ${e[i]} = ${n} / ${r[i]}`}; ${i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${r[i]}`:`index -= ${e[i]} * ${r[i]}`};`).join("")}function VD(e){const t=to(e).map(e=>e.toString());return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}$D.registerFlag("HAS_WEBGL",()=>$D.getNumber("WEBGL_VERSION")>0),$D.registerFlag("WEBGL_VERSION",()=>OD(2)?2:OD(1)?1:0),$D.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),$D.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===$D.get("WEBGL_VERSION")),$D.registerFlag("WEBGL_CPU_FORWARD",()=>!0),$D.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),$D.registerFlag("WEBGL_PACK",()=>$D.getBool("HAS_WEBGL")),$D.registerFlag("WEBGL_PACK_NORMALIZATION",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_CLIP",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_PACK_REDUCE",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_LAZILY_UNPACK",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_CONV_IM2COL",()=>$D.getBool("WEBGL_PACK")),$D.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==ND){const t=iD(e);ND=t.getParameter(t.MAX_TEXTURE_SIZE)}return ND}($D.getNumber("WEBGL_VERSION"))),$D.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==PD){const t=iD(e);PD=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,PD)}($D.getNumber("WEBGL_VERSION"))),$D.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=$D.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=iD(e);return t=DD(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:DD(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),$D.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>$D.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!sh()),$D.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=iD(e);if(1===e){if(!DD(t,"OES_texture_float"))return!1}else if(!DD(t,"EXT_color_buffer_float"))return!1;return MD(t)}($D.getNumber("WEBGL_VERSION"))),$D.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!$D.getBool("WEBGL_FORCE_F16_TEXTURES")&&$D.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),$D.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>LD($D.getNumber("WEBGL_VERSION"))),$D.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=$D.getNumber("WEBGL_VERSION"))&&null!=iD(e).fenceSync;var e}),$D.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>$D.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),$D.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)}),$D.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>sh()?1:-1,e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)}),$D.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),$D.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),$D.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),$D.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),$D.registerFlag("WEBGL_EXP_CONV",()=>!1),$D.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>$D.getBool("IS_TEST")),$D.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),$D.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),$D.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);const HD="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:WD}=Cv;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jD(e,t,n){const i=[];if(e.forEach(e=>{const t=Ma(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?i.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(i.push(`uniform sampler2D ${e.name};`),i.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){const{uniformShape:t}=iO(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:i.push(`uniform int ${e.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${e.name}Shape;`)}i.push(`uniform ivec2 ${e.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;")}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(e=>{i.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)});const r=i.join("\n"),s=e.map(e=>function(e,t,n=!1,i){let r="";r+=n?XD(e,i):qD(e,i);const s=e.shapeInfo.logicalShape,a=t.logicalShape;s.length<=a.length&&(r+=n?function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,a=t.logicalShape.length,o=WD(e.shapeInfo.logicalShape,t.logicalShape),l=nO(a),c=a-s;let u;const d=["x","y","z","w","u","v"];u=0===s?"":a<2&&o.length>=1?"coords = 0;":o.map(e=>`coords.${d[e+c]} = 0;`).join("\n");let h="";h=a<2&&s>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>`coords.${d[t+c]}`).join(", ");let p="return outputValue;";const f=1===Ma(e.shapeInfo.logicalShape),m=Ma(t.logicalShape),g=1===m;if(1!==s||f||g){if(f&&!g)p=1===a?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const e=s-2,t=s-1;o.indexOf(e)>-1&&o.indexOf(t)>-1?p="return vec4(outputValue.x);":o.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${r}() {\n      ${l} coords = getOutputCoords();\n      ${u}\n      vec4 outputValue = get${i}(${h});\n      ${p}\n    }\n  `}(e,t):function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),r="get"+i+"AtOutCoords",s=t.texShape,a=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&Fa(a,s))return`\n      float ${r}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=nO(l),u=WD(e.shapeInfo.logicalShape,t.logicalShape),d=l-o;let h;const p=["x","y","z","w","u","v"];h=0===o?"":l<2&&u.length>=1?"coords = 0;":u.map(e=>`coords.${p[e+d]} = 0;`).join("\n");let f="";f=l<2&&o>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>`coords.${p[t+d]}`).join(", ");return`\n    float ${r}() {\n      ${c} coords = getOutputCoords();\n      ${h}\n      return get${i}(${f});\n    }\n  `}(e,t));return r}(e,t,n.packedInputs,n.enableShapeUniforms)).join("\n"),a=t.texShape,o=BD(),l=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(o);let c,u,d=function(e){const t=`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${KD}\n    ${YD}\n    ${ZD}\n  `;return t}(o);t.isPacked?(c=function(e,t,n){switch(e.length){case 0:return JD();case 1:return function(e,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===i[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${i[1]}.0);\n      }\n    `;if(1===i[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${i[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);\n    }\n  `}(0,t,n);case 2:return function(e,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Fa(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));\n      }\n    `;const r=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n\n      int index = resTexRC.x * ${i[1]} + resTexRC.y;\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),s=r*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n      int index = resTexRC.x * ${i[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),s=r*Math.ceil(e[e.length-2]/2);let a=s,o="",l="b, r, c";for(let c=2;c<e.length-1;c++)a*=e[e.length-c-1],o=`\n      int b${c} = index / ${a};\n      index -= b${c} * ${a};\n    `+o,l=`b${c}, `+l;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n      int index = resTexRC.x * ${i[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec${e.length}(${l});\n    }\n  `}(e,t,n)}}(t.logicalShape,a,n.enableShapeUniforms),u=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(o)):(c=function(e,t,n){switch(e.length){case 0:return JD();case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `;if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}(0,t,n);case 2:return function(e,t,n){if(Fa(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `;if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${UD(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`}const i=zD(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${i}\n      return ivec3(r, c, d);\n    }\n  `}(e,t,n);case 4:return function(e,t,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${UD(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const i=zD(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${i}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t,n);case 5:return function(e,t){const n=zD(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=zD(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}(t.logicalShape,a,n.enableShapeUniforms),u=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(o)),n.packedInputs&&(d+=QD);return[d,l,u,r,c,s,n.userCode].join("\n")}function qD(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${i}() {return ${n};}`;const[r,s]=e.shapeInfo.texShape;if(1===r&&1===s)return`\n      float ${i}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=eO(n);if(t)return`\n    float ${i}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[o,l]=e.shapeInfo.texShape;return`\n    float ${i}() {\n      vec2 uv = uvFromFlat(${o}, ${l}, ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 1:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${i}(int index) {\n        ${tO(e)}\n      }\n    `;const r=e.shapeInfo.texShape,s=r[0],a=r[1];if(1===a&&1===s)return`\n      float ${i}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=eO(n);if(1===a)return t?`\n      float ${i}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${i}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===s)return t?`\n      float ${i}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${i}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(t)return`\n    float ${i}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${i}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${a}, index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape;if(null!=s&&Fa(n,s)){if(t)return`\n      float ${r}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `;const e=s[0];return`\n    float ${r}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${s[1]}.0, ${e}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `}const{newShape:a,keptDims:o}=Ha(n),l=a;if(l.length<n.length){const n=["row","col"];return`\n      ${qD(rO(e,l),t)}\n      float ${r}(int row, int col) {\n        return ${r}(${sO(n,o)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${tO(e)}\n      }\n    `;const c=s[0],u=s[1],d=eO(i);if(1===u)return t?`\n      float ${r}(int row, int col) {\n        float index = dot(vec3(row, col, ${d}), vec3(${i}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${r}(int row, int col) {\n      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `;if(1===c)return t?`\n      float ${r}(int row, int col) {\n        float index = dot(vec3(row, col, ${d}), vec3(${i}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${r}(int row, int col) {\n      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);\n      return sampleTexture(${i}, uv);\n    }\n  `;if(t)return`\n      float ${r}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${i}Shape[1] + col + ${d};\n        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);\n        return sampleTexture(${i}, uv);\n      }\n    `;return`\n  float ${r}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${d};\n    vec2 uv = uvFromFlat(${c}, ${u}, index);\n    return sampleTexture(${i}, uv);\n  }\n`}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[1]*n[2],a=n[2],{newShape:o,keptDims:l}=Ha(n),c=o;if(c.length<n.length){const n=["row","col","depth"];return`\n        ${qD(rO(e,c),t)}\n        float ${r}(int row, int col, int depth) {\n          return ${r}(${sO(n,l)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${s}, ${a}, 1)));\n        ${tO(e)}\n      }\n    `;const u=e.shapeInfo.texShape,d=u[0],h=u[1],p=e.shapeInfo.flatOffset;if(h===s&&null==p)return t?`\n      float ${r}(int row, int col, int depth) {\n        int stride1 = ${i}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n        float ${r}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${a}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${d}.0);\n          return sampleTexture(${i}, uv);\n        }\n      `;if(h===a&&null==p)return t?`\n      float ${r}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `;const f=eO(i);if(t)return`\n    float ${r}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${i}Shape[1] * ${i}Shape[2];\n      int stride1 = ${i}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${f};\n      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);\n      return sampleTexture(${i}, uv);\n    }\n    `;return`\n      float ${r}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${s} + col * ${a} + depth + ${f};\n        vec2 uv = uvFromFlat(${d}, ${h}, index);\n        return sampleTexture(${i}, uv);\n      }\n  `}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[3],a=n[2]*s,o=n[1]*a,{newShape:l,keptDims:c}=Ha(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${qD(rO(e,l),t)}\n      float ${r}(int row, int col, int depth, int depth2) {\n        return ${r}(${sO(n,c)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${o}, ${a}, ${s}, 1)));\n        ${tO(e)}\n      }\n    `;const u=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1],f=`int stride2 = ${i}Shape[3];`,m=`int stride1 = ${i}Shape[2] * stride2;`,g=`int stride0 = ${i}Shape[1] * stride1;`;if(p===o&&null==u)return t?`\n      float ${r}(int row, int col, int depth, int depth2) {\n        ${f}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n      float ${r}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${a}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `;if(p===s&&null==u)return t?`\n      float ${r}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n      float ${r}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `;const b=eO(i);if(t)return`\n    float ${r}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${f}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${b});\n      return sampleTexture(${i}, uv);\n    }\n  `;return`\n    float ${r}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${a} +\n          depth * ${s} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${p}, index + ${b});\n      return sampleTexture(${i}, uv);\n    }\n  `}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t[4],s=t[3]*r,a=t[2]*s,o=t[1]*a,{newShape:l,keptDims:c}=Ha(t);if(l.length<t.length){const t=["row","col","depth","depth2","depth3"];return`\n      ${qD(rO(e,l))}\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        return ${i}(${sO(t,c)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${o}, ${a}, ${s}, ${r})) +\n          depth3;\n        ${tO(e)}\n      }\n    `;const u=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];if(p===o&&null==u)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${a}, ${s}, ${r}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===r&&null==u)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=eO(n);return`\n    float ${i}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${a} + depth * ${s} +\n          depth2 * ${r} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${h}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:s}=Ha(t);if(r.length<t.length){const t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${qD(rO(e,r))}\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${i}(${sO(t,s)});\n      }\n    `}const a=t[5],o=t[4]*a,l=t[3]*o,c=t[2]*l,u=t[1]*c;if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${c}, ${l}, ${o})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${a}, 1)));\n        ${tO(e)}\n      }\n    `;const d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1];if(f===u&&null==d)return`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${l}, ${o}, ${a})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===a&&null==d)return`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=eO(n);return`\n    float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${c} + depth * ${l} +\n          depth2 * ${o} + depth3 * ${a} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function XD(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),i=BD();return`\n    vec4 ${n}() {\n      return ${i.texture2D}(${t}, halfCR);\n    }\n  `}(e);case 1:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e.shapeInfo.texShape,s=BD();if(t)return`\n    vec4 ${i}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`\n    vec4 ${i}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${a[0]}, ${a[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape,a=s[0],o=s[1],l=BD();if(null!=s&&Fa(n,s))return t?`\n      vec4 ${r}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);\n\n        return ${l.texture2D}(${i}, uv);\n      }\n    `:`\n      vec4 ${r}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${a}.0);\n\n        return ${l.texture2D}(${i}, uv);\n      }\n    `;if(t)return`\n    vec4 ${r}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${i}, uv);\n    }\n  `;const c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`\n    vec4 ${r}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);\n      return ${l.texture2D}(${i}, uv);\n    }\n  `}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape,a=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const i=[1,2],s=["b","row","col"];return`\n        ${XD(rO(e,n.slice(1)),t)}\n        vec4 ${r}(int b, int row, int col) {\n          return ${r}(${sO(s,i)});\n        }\n      `}const o=BD();if(t)return`\n    vec4 ${r}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${o.texture2D}(${i}, uv);\n    }\n  `;const l=a[0],c=a[1],u=Math.ceil(n[2]/2),d=u*Math.ceil(n[1]/2);return`\n    vec4 ${r}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${l}, ${c}, ${d}, ${u}, b, row, col);\n      return ${o.texture2D}(${i}, uv);\n    }\n  `}(e,t);default:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=BD();if(t)return`\n    vec4 ${i}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);\n    }\n  `;const s=e.shapeInfo.logicalShape,a=s.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=l[0],u=l[1],d=Math.ceil(s[a-1]/2);let h=d*Math.ceil(s[a-2]/2),p="int b, int row, int col",f=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<a-1;m++)p=`int b${m}, `+p,h*=s[a-m-1],f=`b${m} * ${h} + `+f;return`\n    vec4 ${i}(${p}) {\n      int index = ${f};\n      int texR = index / ${u};\n      int texC = index - texR * ${u};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});\n      return ${r.texture2D}(${n}, uv);\n    }\n  `}(e,t)}}const KD="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",YD="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ZD="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",QD="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function JD(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function eO(e){return`offset${e}`}function tO(e){const t=e.name,n=Ma(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function nO(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function iO(e,t,n){const{newShape:i,keptDims:r}=Ha(t),s=t.length,a=e&&3===s&&1===t[0],o=a?t.slice(1):i,l=!e&&s>1&&!Fa(t,n)&&i.length<s||a;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:r}}function rO(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function sO(e,t){return t.map(t=>e[t]).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aO(e,t,n,i){const r=n.map((e,n)=>{const i={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(i.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:i}}),s=r.map(e=>e.shapeInfo),a={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},o=jD(r,a,t),l=function(e,t){const n=ID(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(fD(e,()=>e.shaderSource(n,t)),fD(e,()=>e.compileShader(n)),mo().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw yD(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,o),c=e.createProgram(l);return mo().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:s,outShapeInfo:a,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:s,outShapeInfo:a},oO(e,t,c))}function oO(e,t,n){const i={},r={},s={},a=[];let o,l,c,u=null,d=null;d=e.getUniformLocation(n,"NAN",!1),1===mo().getNumber("WEBGL_VERSION")&&(u=e.getUniformLocation(n,"INFINITY",!1));const h=!1;for(let p=0;p<t.variableNames.length;p++){const a=t.variableNames[p];i[a]=e.getUniformLocation(n,a,h),i[`offset${a}`]=e.getUniformLocation(n,`offset${a}`,h),t.enableShapeUniforms&&(r[`${a}Shape`]=e.getUniformLocation(n,`${a}Shape`,h),s[`${a}TexShape`]=e.getUniformLocation(n,`${a}TexShape`,h))}return t.enableShapeUniforms&&(o=e.getUniformLocation(n,"outShape",h),c=e.getUniformLocation(n,"outShapeStrides",h),l=e.getUniformLocation(n,"outTexShape",h)),t.customUniforms&&t.customUniforms.forEach((t,i)=>{a[i]=e.getUniformLocation(n,t.name,h)}),{uniformLocations:i,customUniformLocations:a,infLoc:u,nanLoc:d,inShapesLocations:r,inTexShapesLocations:s,outShapeLocation:o,outShapeStridesLocation:c,outTexShapeLocation:l}}function lO(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((e,n)=>{const i=e.logicalShape,r=t[n],s=r.shape;if(!Fa(i,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${s} must match`);if(e.isUniform&&r.isUniform)return;const a=e.texShape,o=r.isUniform?null:r.texData.texShape;if(!Fa(a,o))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${o} must match`)})}function cO(e){return mo().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uO{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rD.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=BD();this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?UD(["r","c","d"],e):zD(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dO{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rD.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=BD();this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?UD(["r","c","d"],e):zD(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hO{constructor(e){this.variableNames=["A"],this.outTexUsage=aD.DOWNLOAD;const t=BD();this.outputShape=e,this.userCode=`\n      ${HD}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pO{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=aD.DOWNLOAD;const t=BD();this.outputShape=e,this.userCode=`\n      ${HD}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fO{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=BD();this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":VD(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${i}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mO{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=BD();this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length);let i="",r="result";t&&(r="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let t=0;t<=1;t++){const r=2*s+t;i+=`\n          localCoords = coords;\n          if(localCoords[2] + ${t} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${t};\n          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${s};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${r}] = values[0];\n            } else if (offset == 1) {\n              result[${r}] = values[1];\n            } else if (offset == 2) {\n              result[${r}] = values[2];\n            } else {\n              result[${r}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":VD(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${i}\n\n          ${n.output} = ${r};\n        }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gO(e){const t=BD();return function(e,t){const n=ID(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(fD(e,()=>e.shaderSource(n,t)),fD(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function bO(e){return function(e,t){const n=ID(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return fD(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),fD(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function yO(e){return function(e,t){const n=ID(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return fD(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),fD(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}function vO(e,t,n,i,r,s){!function(e,t){const n=mo().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const a=function(e){return ID(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),o=e.TEXTURE_2D;return fD(e,()=>e.bindTexture(o,a)),fD(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),fD(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),fD(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),fD(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),1===mo().getNumber("WEBGL_VERSION")?fD(e,()=>e.texImage2D(o,0,i,t,n,0,r,s,null)):fD(e,()=>e.texStorage2D(o,1,i,t,n)),fD(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:a,texShape:[n,t]}}function TO(e){return e.internalFormatFloat}function xO(e){return e.internalFormatHalfFloat}function _O(e){return e.downloadTextureFormat}function SO(e){return e.internalFormatPackedFloat}function wO(e){return e.internalFormatPackedHalfFloat}function IO(e,t,n,i,r,s,a,o){const l=e,c=new Float32Array(function(e,t){const[n,i]=hD(e,t);return n*i*4}(s,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class kO{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=mo().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){tD[e]=t}(t,e)):this.gl=iD(t);let n="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===mo().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=gD(this.gl,e),DD(this.gl,t))this.textureHalfFloatExtension=gD(this.gl,t);else if(mo().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),DD(this.gl,i))this.colorBufferHalfFloatExtension=gD(this.gl,i);else if(mo().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",DD(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!DD(this.gl,i))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(i)}this.vertexBuffer=bO(this.gl),this.indexBuffer=yO(this.gl),this.framebuffer=function(e){return ID(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=pD(this.gl,this.textureHalfFloatExtension)}get debug(){return mo().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;fD(e,()=>e.finish()),fD(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),fD(e,()=>e.deleteFramebuffer(this.framebuffer)),fD(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),fD(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),fD(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=uD(t,n);return vO(e,r,s,TO(i),i.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=uD(t,n);return vO(e,r,s,xO(i),i.textureFormatFloat,i.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=uD(t,n);return vO(e,r,s,_O(i),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){fD(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?2===mo().getNumber("WEBGL_VERSION")?fD(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):fD(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):2===mo().getNumber("WEBGL_VERSION")?fD(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):fD(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),fD(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,i){this.throwIfDisposed(),function(e,t,n,i,r,s){let a,o,l;fD(e,()=>e.bindTexture(e.TEXTURE_2D,t)),r instanceof Uint8Array?(a=new Uint8Array(n*i*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(a=new Float32Array(n*i*4),o=e.FLOAT,l=s.internalFormatPackedFloat),a.set(r),2===mo().getNumber("WEBGL_VERSION")?fD(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,i,e.RGBA,o,a)):fD(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,i,0,e.RGBA,o,a)),fD(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=hD(t,n);return vO(e,r,s,wO(i),e.RGBA,i.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=hD(t,n);return vO(e,r,s,SO(i),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(SD(this.gl,this.framebuffer),this.outputTexture=null),fD(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,i){const[r,s]=uD(t,n),a=new Uint8Array(t*n*4);return fD(e,()=>e.readPixels(0,0,r,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,i,r,s){return IO(this.gl,e,0,0,0,r,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const i=e,r=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,t),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const i=function(e,t,n){const i=e.createBuffer();fD(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const r=16*t*n;return fD(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,r,e.STREAM_READ)),fD(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),fD(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(mo().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=i.clientWaitSync(r,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=r}else mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const i=new Float32Array(t*n*4);return fD(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,i)),i}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=gO(t));const n=function(e){return ID(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);return fD(t,()=>t.attachShader(n,this.vertexShader)),fD(t,()=>t.attachShader(n,e)),function(e,t){if(fD(e,()=>e.linkProgram(t)),!mo().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n),this.debug&&vD(t,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(e,t,n){return fD(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),TD(e,t,"clipSpacePos",n,3,20,0)&&TD(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),n}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&fD(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&vD(this.gl,this.program),fD(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return ID(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),fD(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,i){fD(e,()=>xD(e,t,i)),fD(e,()=>e.uniform1i(n,i))}(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[i,r]=hD(t,n);this.setOutputMatrixTextureDriver(e,i,r)}setOutputMatrixWriteRegion(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)}setOutputPackedMatrixWriteRegion(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&vD(this.gl,this.program),wD(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),fD(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),fD(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=gD(this.gl,2===mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await Ua(()=>this.disposed||this.isQueryAvailable(e,mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),i=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),i&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in mo().platform&&(n=mo().platform.setTimeoutCustom.bind(mo().platform)),Ua(()=>(this.pollItems(),0===this.itemsToPoll.length),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),_D(this.gl,e,this.framebuffer),this.debug&&wD(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(_D(this.gl,this.outputTexture,this.framebuffer),this.debug&&wD(this.gl)):SD(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const i=this.gl;_D(i,e,this.framebuffer),this.debug&&wD(i),this.outputTexture=e,fD(i,()=>i.viewport(0,0,t,n)),fD(i,()=>i.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,i){this.throwIfDisposed(),fD(this.gl,()=>this.gl.scissor(e,t,n,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:CO,bincountImpl:EO,bincountReduceImpl:AO,castImpl:RO,ceilImpl:NO,concatImpl:PO,equalImpl:DO,expImpl:OO,expm1Impl:LO,floorImpl:MO,gatherNdImpl:FO,gatherV2Impl:$O,greaterImpl:BO,greaterEqualImpl:zO,lessImpl:UO,lessEqualImpl:GO,linSpaceImpl:VO,logImpl:HO,maxImpl:WO,maximumImpl:jO,minimumImpl:qO,multiplyImpl:XO,negImpl:KO,notEqualImpl:YO,prodImpl:ZO,raggedGatherImpl:QO,raggedTensorToTensorImpl:JO,rangeImpl:eL,rsqrtImpl:tL,scatterImpl:nL,sigmoidImpl:iL,simpleAbsImpl:rL,sliceImpl:sL,sparseFillEmptyRowsImpl:aL,sparseReshapeImpl:oL,sparseSegmentReductionImpl:lL,sqrtImpl:cL,stridedSliceImpl:uL,stringNGramsImpl:dL,stringSplitImpl:hL,stringToHashBucketFastImpl:pL,subImpl:fL,tileImpl:mL,topKImpl:gL,transposeImpl:bL,uniqueImpl:yL}=QE;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vL(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>`${e}.${t}`)}function TL(e,t){return 1===t?[e]:vL(e,t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class xL{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=cO(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=TL("rc",this.rank),t=nO(this.rank),n=this.getOutOfBoundsCondition(e),i=this.getSetup(e),r=this.getOutput(e);this.userCode=`\n        void main() {\n          ${t} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${i}\n\n            setOutput(vec4(${r}));\n          }\n        }\n      `}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let i=0;i<=1;i++){let r=`${0===n?"r":"rp1"}, ${0===i?"c":"cp1"}`;for(let t=2;t<this.rank;t++)r=`${e[e.length-1-t]},`+r;t.push(r)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${t[0]};\n      int c = ${t[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${i};\n    `}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${t[0]}),\n            cEdge ? 0. : getA(${t[1]}),\n            rEdge ? 0. : getA(${t[2]}),\n            rEdge || cEdge ? 0. : getA(${t[3]})`}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _L{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length);let n="";for(let s=0;s<4;s++){let e="thisRC = rc;";s%2==1&&(e+="thisRC.z += 1;"),s>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${s}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${s>0?"}":""}\n      `}var i,r;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */this.userCode=`\n      ${i=t,r=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${r?GD(["r","c","d"],"inputShape"):zD(["r","c","d"],i)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":VD(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class SL{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const i=IL(t,n),r=kL(e,i,n);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const s=wL(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const e=this.freeTextures[r].shift();return this.usedTextures[r].push(e),e}let a;return i===lD.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===lD.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===lD.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===lD.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===lD.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(e,t,n,i){if(null==this.freeTextures)return;const r=IL(n,i),s=kL(t,r,i);s in this.freeTextures||(this.freeTextures[s]=[]);const a=wL(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,i),o=mo().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[s],c=l.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function wL(e,t,n,i,r){const s=function(e,t){switch(e){case lD.PACKED_2X2_FLOAT32:return SO(t);case lD.PACKED_2X2_FLOAT16:return wO(t);case lD.UNPACKED_FLOAT32:return TO(t);case lD.UNPACKED_FLOAT16:return xO(t);case lD.PACKED_4X1_UNSIGNED_BYTE:return _O(t);default:throw new Error(`Unknown physical texture type ${e}`)}}(t,i);let a;if(r){const[t,n]=hD(e[0],e[1]);a=t*n}else{const[t,n]=uD(e[0],e[1]);a=t*n}const o=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}(n,s);return a*o}function IL(e,t){if(e===aD.UPLOAD)return lD.PACKED_2X2_FLOAT32;if(e===aD.RENDER||null==e)return function(e){return mo().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?lD.PACKED_2X2_FLOAT32:lD.UNPACKED_FLOAT32:e?lD.PACKED_2X2_FLOAT16:lD.UNPACKED_FLOAT16}(t);if(e===aD.DOWNLOAD||e===aD.PIXELS)return lD.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function kL(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CL{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const EL="if (isnan(x)) return x;",AL="return abs(x);",RL=EL+"\n  return (x < 0.0) ? 0.0 : x;\n",NL=EL+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",PL="return x;";class DL{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OL{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length);const t=e.length,n=TL("rc",t),i=nO(t),r=function(e,t){if(1===e)return"rc";let n="";for(let i=0;i<e;i++)n+=t[i],i<e-1&&(n+=",");return n}(t,n),s=n.slice(-2),a=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${i} rc = getOutputCoords();\n        vec4 packedInput = getA(${r});\n\n        setOutput(getChannel(packedInput, ${a}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LL=yb,ML={};const FL=mo().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class $L extends ka{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!mo().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof kO)t=e;else{const n=iD(mo().getNumber("WEBGL_VERSION"),e);t=new kO(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=iD(mo().getNumber("WEBGL_VERSION"));t=new kO(e),this.binaryCache=((n=mo().getNumber("WEBGL_VERSION"))in ML||(ML[n]={}),ML[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new SL(this.gpgpu),this.numMBBeforeWarning=null==mo().global.screen?1024:mo().global.screen.height*mo().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Ia(this,lp())}nextDataId(){return $L.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,n){if((mo().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||mo().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:t,dtype:n,values:e,usage:aD.UPLOAD,refCount:1}),i}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,i,r){if(mo().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:i,values:t,usage:aD.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:i,complexTensorInfos:r,slice:s,shape:a,isPacked:o}=t;if(null!=s){let t;t=o?new DL(a,PL):new CL(a,PL);const n=this.runWebGLProgram(t,[{dataId:e,shape:a,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===i)return n;const l=null!=this.activeTimers;let c,u;if(l&&(c=Td()),"complex64"===i){u=jy(this.readSync(r.real.dataId),this.readSync(r.imag.dataId))}else u=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=Td()-c),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:i,slice:r,dtype:s,complexTensorInfos:a,isPacked:o}=t;if(null!=r){let t;t=o?new DL(i,PL):new CL(i,PL);const n=this.runWebGLProgram(t,[{dataId:e,shape:i,dtype:s}],s),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if(mo().getBool("DEBUG")&&!mo().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===mo().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,u=null;if("complex64"!==s&&mo().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(t.texture.texture,...dD(i))}if(this.pendingRead.set(e,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const e=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]);c=jy(e[0],e[1])}else if(null==u)c=this.getValuesFromTexture(e);else{const e=Ma(i);c=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const e=this.gpgpu.gl;fD(e,()=>e.deleteBuffer(u))}const d=this.convertAndCacheOnCPU(e,c),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(e=>e(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&lp().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,t={}){const n=this.texData.get(e),{values:i,shape:r,slice:s,dtype:a,isPacked:o,texture:l}=n;if("complex64"===a)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=o?new DL(r,PL):new CL(r,PL);const i=this.runWebGLProgram(n,[{dataId:e,shape:r,dtype:a}],a),s=this.readToGPU(i,t);return this.disposeIntermediateTensorInfo(i),s}if(null==l)throw null!=i?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),u=lp().makeTensorFromTensorInfo(c),d=this.texData.get(c.dataId);return Object.assign({tensorRef:u},d.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>_d(e));return Zh(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return Zh(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!mD(n)){if(mo().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:i}=this.texData.get(e),r=Ma(t);if(mo().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),i=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(i.texture.texture,...dD(t)).subarray(0,r);return this.disposeIntermediateTensorInfo(n),s}const s=mo().getBool("WEBGL_PACK")&&!0===i,a=s?ED(t):t,o=s?new pO(a):new hO(a),l=this.runWebGLProgram(o,[{shape:a,dtype:n,dataId:e}],"float32"),c=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,e();const r=La(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),s=La(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(r);a.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),a.getExtraProfileInfo=()=>e.map((e,t)=>({name:s[t],ms:e})).map(e=>`${e.name}: ${e.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Td(),endMs:null}}endTimer(e){return mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Td(),e)}async getQueryTime(e){if(mo().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:i,usage:r,isPacked:s,slice:a}=this.texData.get(e),o=a&&a.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(i,n),this.textureManager.releaseTexture(t,i,r,s)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=FL){return mo().getBool("WEBGL_CPU_FORWARD")&&e.every(e=>null==this.texData.get(e.dataId).texture&&Ma(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Iu("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return LL(e.shape,t)}packedUnaryOp(e,t,n){const i=new DL(e.shape,t),r=this.compileAndRun(i,[e],n);return lp().makeTensorFromTensorInfo(r)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=rL(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(mo().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,AL,e.dtype);const t=new CL(e.shape,AL),n=this.compileAndRun(t,[e]);return lp().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&Ya(n[0])){const r=n.map(e=>xd(e));i=this.write(r,e,t)}else i=this.write(n,e,t);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:t}}makeOutput(e,t,n){return lp().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new OL(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new xL(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[kD(e.shape),...CD(e.shape)],i={dtype:e.dtype,shape:n,dataId:e.dataId},r=[kD(t),...CD(t)],s=new _L(r,n),a=[n],o=this.runWebGLProgram(s,[i],e.dtype,a,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:i,shape:r,dtype:s}=n;if(null!=t){Pa(Ma(r)<=t[0]*t[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=ED(r);let o;o=i?new dO(a):new uO(a);const l=[null!=t?t:dD(a)];return{dtype:s,shape:r,dataId:this.runWebGLProgram(o,[{shape:a,dtype:s,dataId:e}],s,l,!0,t).dataId}}runWebGLProgram(e,t,n,i,r=!1,s){const a=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(a.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===rD.DENSE){const t=null!=s?s:dD(e.outputShape);o.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===Ma(a.shape))return o.values=Wa(a.dtype,0),a;const l=[],c=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Ma(t.shape)<=mo().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!RD(n.shape,t.shape)){const e=t,i=t.shape;t.shape=n.shape,t=this.packedReshape(t,i),l.push(t),n=this.texData.get(t.dataId),e.shape=i}return{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);const u={shape:a.shape,texData:o,isUniform:!1},d=function(e,t,n){let i="";t.concat(n).forEach(t=>{const r=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const s=t.texData.texShape,{useSqueezeShape:a,uniformShape:o,keptDims:l}=iO(e.packedInputs,t.shape,s);let c="",u="",d="";if(1===o.length&&e.packedInputs){const e=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];c=`${e[0]>1}_${e[1]>1}`}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){const e=to(o);d=`${e[0]===s[1]}_${e[e.length-1]===s[1]}`}}else u=`${o[0]>1}_${o[1]>1}`;const h=t.shape.length,p=2===o.length&&Fa(t.shape,s),f=1===Ma(t.shape),m=yp(t.shape,n.shape),g=!e.packedInputs&&h===n.shape.length&&Fa(s,n.texData.texShape),b=e.packedInputs||o.length>2?"":`${s[0]>1}_${s[1]>1}`;i+=`${h}_${g}_${a?l:""}_${o.length}_${f}_${m}_${p}_${c}_${u}_${d}_${b}_${r}`}else{const e=t.isUniform?"uniform":t.texData.texShape;i+=`${t.shape}_${e}_${r}`}});const r=e.userCode;let s=e.constructor.name;return s+="_"+i+"_"+r+`${mo().getNumber("WEBGL_VERSION")}`,s}(e,c,u),h=this.getAndSaveBinary(d,()=>aO(this.gpgpu,e,c,u)),p=null!=this.activeTimers;let f;p&&(f=this.startTimer()),mo().get("ENGINE_COMPILE_ONLY")||function(e,t,n,i,r){t.program.enableShapeUniforms||(lO(t.inShapeInfos,n),lO([t.outShapeInfo],[i]));const s=i.texData.texture,a=i.texData.texShape;i.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,a[0],a[1]):e.setOutputMatrixTexture(s.texture,a[0],a[1]),e.setProgram(t.webGLProgram),1===mo().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((n,i)=>{const r=t.program.variableNames[i],s=t.uniformLocations[r],a=t.uniformLocations[`offset${r}`],o=t.inShapesLocations[`${r}Shape`],l=t.inTexShapesLocations[`${r}TexShape`];if(o){const{uniformShape:i}=iO(t.program.packedInputs,n.shape,n.texData.texShape);switch(i.length){case 1:e.gl.uniform1iv(o,new Int32Array(i));break;case 2:e.gl.uniform2iv(o,new Int32Array(i));break;case 3:e.gl.uniform3iv(o,new Int32Array(i));break;case 4:e.gl.uniform4iv(o,new Int32Array(i))}}if(l&&e.gl.uniform2i(l,n.texData.texShape[0],n.texData.texShape[1]),null!=s)if(n.isUniform)if(Ma(n.shape)<2)e.gl.uniform1f(s,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(s,t)}else null!=n.texData.slice&&null!=a&&e.gl.uniform1i(a,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,s,i)});const o=t.outShapeLocation;if(o)switch(i.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(i.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(i.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(i.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(i.shape))}if(t.outShapeStridesLocation){const n=to(i.shape);switch(i.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),t.program.customUniforms&&r&&t.program.customUniforms.forEach((n,i)=>{const s=t.customUniformLocations[i],a=r[i];if("float"===n.type)e.gl.uniform1fv(s,a);else if("vec2"===n.type)e.gl.uniform2fv(s,a);else if("vec3"===n.type)e.gl.uniform3fv(s,a);else if("vec4"===n.type)e.gl.uniform4fv(s,a);else if("int"===n.type)e.gl.uniform1iv(s,a);else if("ivec2"===n.type)e.gl.uniform2iv(s,a);else if("ivec3"===n.type)e.gl.uniform3iv(s,a);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(s,a)}}),e.executeProgram()}(this.gpgpu,h,c,u,i),l.forEach(e=>this.disposeIntermediateTensorInfo(e)),p&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));const m=mo().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=Td();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!mo().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===r){const e=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),e}return a}compileAndRun(e,t,n,i,r=!1){n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,i,r)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!mo().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=up(()=>{if(!mo().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=mo().getBool("DEBUG");mo().set("DEBUG",!1);const t=this.abs(vm(1e-8)).dataSync()[0];if(mo().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:i,values:r,texture:s,usage:a,isPacked:o}=t;if(null!=s)return;const l=null!=this.activeTimers;let c;l&&(c=Td());let u=t.texShape;if(null==u&&(u=function(e,t=!1){let n=mo().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=mo().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(i===1/0&&mo().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=n/2),t&&(n*=2,i*=2,e=e.map((t,n)=>n>=e.length-2?Ra(e[n]):e[n]),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=Ha(e);e=t.newShape}let r=Ma(e),s=null;e.length<=1&&r<=n?s=[1,r]:2===e.length&&e[0]<=n&&e[1]<=n?s=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);const a=null!=s&&Math.max(...s)>i&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(null==s||a)if(t){const t=kD(e);let n=2,i=2;e.length&&([n,i]=CD(e)),r=t*(n/2)*(i/2),s=Ba(r).map(e=>2*e)}else s=Ba(r);return s}(n,o),t.texShape=u),null!=r){const e=ED(n);let s,a=u[1],d=u[0];const h=r instanceof Uint8Array||r instanceof Uint8ClampedArray;!o&&h||([a,d]=hD(u[0],u[1])),s=o?new mO(e,h):new fO(e,h);const p=h?[d,a]:u,f=this.makeTensorInfo(p,i),m=this.texData.get(f.dataId);m.usage=h?aD.PIXELS:aD.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),a,d,r);const g=[[d,a]],b=!0,y=this.runWebGLProgram(s,[f],i,g,b),v=this.texData.get(y.dataId);t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,mo().get("ENGINE_COMPILE_ONLY")?this.disposeData(y.dataId):(t.texture=v.texture,t.values=null,this.texData.delete(y.dataId)),this.disposeIntermediateTensorInfo(f),l&&(this.uploadWaitMs+=Td()-c)}else{const e=this.acquireTexture(u,a,i,o);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:i}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}
/** @license See the LICENSE file. */(t,i)),n.values}acquireTexture(e,t,n,i){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,i)}computeBytes(e,t){return e[0]*e[1]*Ka(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise(e=>{try{this.checkCompletion_(t),e(!0)}catch(n){throw n}});e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await _y(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw yD(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:n,infLoc:i,nanLoc:r,inShapesLocations:s,inTexShapesLocations:a,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:c}=oO(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=n,e.infLoc=i,e.nanLoc=r,e.inShapesLocations=s,e.inTexShapesLocations=a,e.outShapeLocation=o,e.outShapeStridesLocation=l,e.outTexShapeLocation=c}}}$L.nextDataId=0;
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ah()&&pp("webgl",()=>new $L,2)
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;const BL="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class zL{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=Tp(t,n),this.enableShapeUniforms=cO(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class GL{constructor(e,t,n,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Tp(t,n);const r=this.outputShape.length;this.enableShapeUniforms=cO(r);let s="";if(i)if(0===r||1===Ma(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(s=`\n          ${nO(r)} coords = getOutputCoords();\n        `,1===r)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=TL("coords",r);this.enableShapeUniforms?s+=`\n            bool nextRowOutOfBounds =\n              (${e[r-2]} + 1) >= outShape[${r} - 2];\n            bool nextColOutOfBounds =\n              (${e[r-1]} + 1) >= outShape[${r} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:s+=`\n            bool nextRowOutOfBounds =\n              (${e[r-2]} + 1) >= ${this.outputShape[r-2]};\n            bool nextColOutOfBounds =\n              (${e[r-1]} + 1) >= ${this.outputShape[r-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${s}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(e){const{inputs:t,backend:n}=e,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const HL={kernelName:Dl,backendName:"webgl",kernelFunc:VL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(e){const{inputs:t,backend:n}=e,{real:i,imag:r}=t,s=n.makeTensorInfo(i.shape,"complex64"),a=n.texData.get(s.dataId),o=VL({inputs:{x:i},backend:n}),l=VL({inputs:{x:r},backend:n});return a.complexTensorInfos={real:o,imag:l},s}const jL={kernelName:Wo,backendName:"webgl",kernelFunc:WL},qL="return (a < 0.) ? b * a : a;",XL="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KL={kernelName:Bl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{alpha:s}=i,a=n.makeTensorInfo([],"float32",yd(s,"float32")),o=mo().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new GL(XL,r.shape,a.shape):new zL(qL,r.shape,a.shape),l=n.runWebGLProgram(o,[r,a],"float32");return n.disposeIntermediateTensorInfo(a),l}},YL="return (a < 0.) ? b * a : a;",ZL="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QL={kernelName:Tc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i,alpha:r}=t,s=mo().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new GL(ZL,i.shape,r.shape):new zL(YL,i.shape,r.shape);return n.runWebGLProgram(s,[i,r],"float32")}},JL="if (isnan(x)) return x;";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eM({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:i}){return({inputs:r,backend:s})=>{const{x:a}=r,o=s,l=i||a.dtype;if(o.shouldExecuteOnCPU([a])&&null!=n){const e=o.texData.get(a.dataId),t=n(e.values,l);return o.makeTensorInfo(a.shape,l,t)}let c;return c=mo().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new DL(a.shape,t):new CL(a.shape,e),o.runWebGLProgram(c,[a],l)}}function tM({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:r,dtype:s}){return({inputs:a,backend:o})=>{const{a:l,b:c}=a,u=o;if(i&&"complex64"===l.dtype){const t=u.texData.get(l.dataId),n=u.texData.get(c.dataId),[i,r]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(t=>{const[n,i]=t,r={dataId:n.dataId,dtype:n.dtype,shape:l.shape},s={dataId:i.dataId,dtype:i.dtype,shape:c.shape},a=new zL(e,l.shape,c.shape);return u.runWebGLProgram(a,[r,s],Xd(n.dtype,i.dtype))}),s=WL({inputs:{real:i,imag:r},backend:u});return u.disposeIntermediateTensorInfo(i),u.disposeIntermediateTensorInfo(r),s}const d=s||Xd(l.dtype,c.dtype);if(("string"===l.dtype||"string"===c.dtype||u.shouldExecuteOnCPU([l,c]))&&null!=r){const e=u.texData.get(l.dataId).values,t=u.texData.get(c.dataId).values,n="string"===l.dtype?Iv(e):e,i="string"===l.dtype?Iv(t):t,[s,a]=r(l.shape,c.shape,n,i,d),o=u.makeTensorInfo(a,d);return u.texData.get(o.dataId).values=s,o}let h;return h=mo().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new GL(t,l.shape,c.shape,n):new zL(e,l.shape,c.shape),u.runWebGLProgram(h,[l,c],d)}}function nM(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":RL;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":NL;if("prelu"===e)return t?ZL:YL;if("leakyrelu"===e)return t?XL:qL;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iM{constructor(e,t,n,i=!1,r=!1,s=!1,a=null,o=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=cO(this.outputShape.length);const c=i?e[1]:e[2],u=Math.ceil(c/2),d=i?"i * 2, rc.y":"rc.y, i * 2",h=r?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";a&&(m=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${a}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${a}\n        }`:`vec4 activation(vec4 x) {\n          ${a}\n        }`,g="result = activation(result);");const b=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let y="rc.x",v="rc.x";e[0]<t[0]?y=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(v=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${u}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${u}; i++) {\n          int batchA = ${y};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${d});\n          vec4 b = getMatrixB(batchB, ${h});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${b}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rM="return areal * breal - aimag * bimag;",sM="return areal * bimag + aimag * breal;";class aM{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Tp(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oM="return a * b;";function lM(e){const{inputs:t,backend:n}=e,{a:i,b:r}=t,s=Xd(i.dtype,r.dtype);if("complex64"===i.dtype){const e=n.texData.get(i.dataId),t=n.texData.get(r.dataId),s=new aM(rM,i.shape,r.shape),a=new aM(sM,i.shape,r.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape}],l=n.runWebGLProgram(s,o,"float32"),c=n.runWebGLProgram(a,o,"float32"),u=WL({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}if(n.shouldExecuteOnCPU([i,r])){const e=n.texData.get(i.dataId),t=n.texData.get(r.dataId),[a,o]=XO(i.shape,r.shape,e.values,t.values,s),l=n.makeTensorInfo(o,s);return n.texData.get(l.dataId).values=a,l}let a;return a=mo().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new GL(oM,i.shape,r.shape):new zL(oM,i.shape,r.shape),n.runWebGLProgram(a,[i,r],s)}const cM={kernelName:cc,backendName:"webgl",kernelFunc:lM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uM(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{shape:s}=i,a=n,o=Ma(r.shape),l=Ga(s,o),c=Ma(l);Pa(o===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`);const u=a.texData.get(r.dataId);return!u.isPacked||RD(r.shape,l)||null!==u.texture&&RD(u.shape,l)?(a.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype}):function(e,t,n){const i=[kD(e.shape),...CD(e.shape)],r={dtype:e.dtype,shape:i,dataId:e.dataId},s=[kD(t),...CD(t)],a=new _L(s,i),o=[i],l=n.runWebGLProgram(a,[r],e.dtype,o,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}(r,l,a)}const dM={kernelName:Ec,backendName:"webgl",kernelFunc:uM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hM{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:s}=e;this.outputShape=[i,s];const a=4*Math.floor(n/4),o=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l=`sumValue += dot(values * ${$a(e)?e.toPrecision(2):e}, ones);`}let c="";r%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===o}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pM{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:s}=e;this.outputShape=[i,s];let a="0.0",o="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",o="min"):"max"===t&&(a="-1.0 / 1e-20",o="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const c=4*Math.floor(n/4),u=n%4;let d=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${o}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${o}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,h="vec4";"all"===t?(a="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(a="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let p="";r%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${a};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${a});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${d}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===u}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${2===u}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${3===u}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${d}\n        }\n        setOutput(${l});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fM(e,t,n,i){const r=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],i=Ny(n);t.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return t}(e.shape);let s=e;for(let a=0;a<r.length;a++){const{inSize:o,windowSize:l,outSize:c}=r[a];let u,d;u="mean"===n?0===a?new hM({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},o):new hM({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c}):new pM({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},n),d=s,s=i.runWebGLProgram(u,[s],t),d.dataId!==e.dataId&&i.disposeIntermediateTensorInfo(d)}return s}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mM{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[t[s]];this.outputShape=n,this.rank=n.length;const i=nO(this.rank),r=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(t);for(let r=0;r<e.length;r++)i[e[r]]=n[r];return i.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n    void main() {\n      ${i} resRC = getOutputCoords();\n      setOutput(getA(${r}));\n    }\n    `}}class gM{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[t[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=nO(this.rank),r=vL("rc",this.rank),s=new Array(this.rank);for(let c=0;c<t.length;c++)s[t[c]]=r[c];const a=`vec2(${s.slice(-2).join()})`,o=`++${r[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`\n    void main() {\n      ${i} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${o}) {\n        result[1] = ${l};\n      }\n      --${r[this.rank-1]};\n      if(++${r[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${o}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bM(e,t,n){const i=mo().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gM(e.shape,t):new mM(e.shape,t);return n.runWebGLProgram(i,[e],e.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yM(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i;return function(e,t,n,i){const r=t,s=e.shape.length,a=Va(r,e.shape);let o=a;const l=pm(o,s),c=null!=l;let u=e;c&&(u=bM(e,l,i),o=mm(o.length,s)),hm("sum",o,s);const[d,h]=um(u.shape,o);let p=d;n&&(p=dm(d,a));const f=Ma(h),m=uM({inputs:{x:u},attrs:{shape:[Ma(e.shape)/f,f]},backend:i}),g=fM(m,Kd(e.dtype),"sum",i),b=uM({inputs:{x:g},attrs:{shape:p},backend:i});return i.disposeIntermediateTensorInfo(m),i.disposeIntermediateTensorInfo(g),c&&i.disposeIntermediateTensorInfo(u),b}(r,s,a,n)}const vM={kernelName:Xc,backendName:"webgl",kernelFunc:yM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TM(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{perm:s}=i,a=n,o=r.shape.length,l=new Array(o);for(let u=0;u<l.length;u++)l[u]=r.shape[s[u]];let c;if(a.shouldExecuteOnCPU([r])){const e=a.texData.get(r.dataId).values,t=bL(e,r.shape,r.dtype,s,l);c=a.makeTensorInfo(l,r.dtype);a.texData.get(c.dataId).values=t}else c=bM(r,s,a);return c}const xM={kernelName:mu,backendName:"webgl",kernelFunc:TM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _M({a:e,b:t,transposeA:n,transposeB:i,backend:r,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}){const c=e.shape.length,u=t.shape.length,d=n?e.shape[c-2]:e.shape[c-1],h=i?t.shape[u-1]:t.shape[u-2],p=n?e.shape[c-1]:e.shape[c-2],f=i?t.shape[u-2]:t.shape[u-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),b=Ma(m),y=Ma(g),v=Tp(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([p,f]);Pa(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${i} must match.`);const T=n?[b,d,p]:[b,p,d],x=i?[y,f,h]:[y,h,f],_=uM({inputs:{x:e},backend:r,attrs:{shape:T}}),S=uM({inputs:{x:t},backend:r,attrs:{shape:x}}),w=[_,S],I=Math.max(b,y),k=n?_.shape[1]:_.shape[2],C=null!=s,E=null!=a,A="leakyrelu"===l,R=null!=l?nM(l,!0):null;let N;if((1===p||1===f)&&k>1e3&&!1===(C||E||A||null!=R)){let e=_,t=S;n&&(e=TM({inputs:{x:_},backend:r,attrs:{perm:[0,2,1]}}),w.push(e)),i&&(t=TM({inputs:{x:S},backend:r,attrs:{perm:[0,2,1]}}),w.push(t));const s=1===f;let a=e;1!==f&&(a=uM({inputs:{x:e},backend:r,attrs:{shape:[I,k,1]}}),w.push(a));const o=1===f?2:1;let l=t;s&&(l=uM({inputs:{x:t},backend:r,attrs:{shape:[I,1,k]}}),w.push(l));const c=lM({inputs:{a:a,b:l},backend:r});N=yM({inputs:{x:c},backend:r,attrs:{axis:o,keepDims:!0}}),w.push(c)}else{const l=Xd(e.dtype,t.dtype),c=new iM(T,x,[I,p,f],n,i,C,R,E,A),u=[_,S];if(null!=s&&u.push(s),E&&u.push(a),A){const e=r.makeTensorInfo([],"float32",yd(o,"float32"));u.push(e),w.push(e)}N=r.runWebGLProgram(c,u,l)}const P=uM({inputs:{x:N},backend:r,attrs:{shape:v}});w.push(N);for(const D of w)r.disposeIntermediateTensorInfo(D);return P}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM={kernelName:_u,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s,bias:a,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=i;return _M({a:r,b:s,transposeA:l,transposeB:c,backend:n,bias:a,preluActivationWeights:o,leakyreluAlpha:d,activation:u})}},wM="return abs(x);";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM={kernelName:To,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;if(n.shouldExecuteOnCPU([i])&&"complex64"!==i.dtype){const e=n.texData.get(i.dataId),t=rL(e.values);return n.makeTensorInfo(i.shape,i.dtype,t)}let r;return r=mo().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new DL(i.shape,wM):new CL(i.shape,wM),n.runWebGLProgram(r,[i],i.dtype)}},kM=eM({opSnippet:EL+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),CM={kernelName:xo,backendName:"webgl",kernelFunc:kM},EM=eM({opSnippet:EL+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),AM={kernelName:_o,backendName:"webgl",kernelFunc:EM},RM="return a + b;",NM=tM({opSnippet:RM,packedOpSnippet:RM,supportsComplex:!0,cpuKernelImpl:CO}),PM={kernelName:So,backendName:"webgl",kernelFunc:NM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class DM{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>`T${t}`);const n=[];this.variableNames.forEach(e=>{n.push(`float v${e} = get${e}AtOutCoords();`)});const i=this.variableNames.map(e=>`v${e}`).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${i};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OM{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>`T${t}`);const n=[];this.variableNames.forEach(e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)});const i=this.variableNames.map(e=>`v${e}`).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${i};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LM={kernelName:wo,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i}=t,r=n;if(1===r.length)return VL({inputs:{x:r[0]},backend:i});if(r.length>mo().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(r.length/2),n=e({inputs:r.slice(0,t),backend:i}),s=e({inputs:r.slice(t),backend:i});return e({inputs:[n,s],backend:i})}const s=r.map(e=>e.dtype).reduce((e,t)=>Xd(e,t)),a=r.map(e=>e.shape),o=mo().getBool("WEBGL_PACK")?new OM(r[0].shape,a):new DM(r[0].shape,a);return i.runWebGLProgram(o,r,s)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MM={kernelName:Io,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=Va(s,r.shape);let c=l;const u=pm(c,o);let d=r;null!=u&&(d=TM({inputs:{x:r},backend:n,attrs:{perm:u}}),c=mm(c.length,o)),hm("all",c,o);const[h,p]=um(d.shape,c),f=uM({inputs:{x:d},backend:n,attrs:{shape:[-1,Ma(p)]}}),m=fM(f,f.dtype,"all",n);let g;if(a){g=uM({inputs:{x:m},backend:n,attrs:{shape:dm(h,l)}})}else g=uM({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(d),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FM={kernelName:ko,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=Va(s,r.shape);let c=l;const u=pm(c,o);let d=r;null!=u&&(d=TM({inputs:{x:r},backend:n,attrs:{perm:u}}),c=mm(c.length,o)),hm("any",c,o);const[h,p]=um(d.shape,c),f=uM({inputs:{x:d},backend:n,attrs:{shape:[-1,Ma(p)]}}),m=fM(f,f.dtype,"any",n);let g;if(a){g=uM({inputs:{x:m},backend:n,attrs:{shape:dm(h,l)}})}else g=uM({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(d),g}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $M{constructor(e,t,n){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[r,s];const a="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${i};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${i}; i++) {\n          int inIdx = ${o};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${a} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BM{constructor(e,t,n,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Pa(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);const r=e[e.length-1],s=Math.ceil(r/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,o=a.length,l=nO(o),c=TL("coords",o);let u,d;if(1===s){d=o+1;const e=nO(d);u=`\n        ${e} sourceLocR = ${e}(${c.join()}, 0);\n        ++${c[o-1]};\n        ${e} sourceLocG = ${e}(${c.join()}, 0);\n        ++${c[o-2]};\n        ${e} sourceLocA = ${e}(${c.join()}, 0);\n        --${c[o-1]};\n        ${e} sourceLocB = ${e}(${c.join()}, 0);\n        --${c[o-2]};`}else d=o,u=`\n        ${l} sourceLocR = coords;\n        ++${c[o-1]};\n        ${l} sourceLocG = coords;\n        ++${c[o-2]};\n        ${l} sourceLocA = coords;\n        --${c[o-1]};\n        ${l} sourceLocB = coords;\n        --${c[o-2]};`;const h=["x","y","z","w","u","v"].slice(0,d),p="."+h[d-1],f=h.map(e=>"int "+e),m=TL("sourceLocR",d-1).concat("inIdx.r"),g=TL("sourceLocG",d-1).concat("inIdx.g"),b=TL("sourceLocB",d-1).concat("inIdx.b"),y=TL("sourceLocA",d-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",T=i?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${b.join()}),\n                             getBestIndicesAChannel(${y.join()})));`,x=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${b.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${y.join()}) : 0.)`,_=i?"":`\n      float getBestIndicesAChannel(${f.join()}) {\n        return getChannel(getBestIndicesA(${h.join()}),\n                                          vec2(${h.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${f.join()}) {\n        return getChannel(getA(${h.join()}),\n                               vec2(${h.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${c[o-1]} < ${a[o-1]-1};\n        bool hasNextRow = ${c[o-2]} < ${a[o-2]-1};\n        ${u}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${x};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${T}\n          vec4 candidate = ${x};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zM(e,t,n,i=null){let r=t.shape[0],s=t.shape[1];null!=i&&(r=i.shape[0],s=i.shape[1]);const a=Ny(s),o={windowSize:a,inSize:s,batchSize:r,outSize:Math.ceil(s/a)},l=new $M(o,n,null==i),c=[t];null!=i&&c.push(i);const u=e.runWebGLProgram(l,c,"int32");if(1===u.shape[1])return u;const d=zM(e,t,n,u);return e.disposeIntermediateTensorInfo(u),d}function UM(e,t,n,i=null){const r=null!=i?i.shape:t.shape,s=Ny(r[r.length-1]),a=new BM(r,s,n,null==i),o=null==i?[t]:[t,i],l=e.runWebGLProgram(a,o,"int32");if(l.shape.length===t.shape.length){const i=UM(e,t,n,l);return e.disposeIntermediateTensorInfo(l),i}return l}function GM(e,t,n,i){const r=[n];if(hm("arg"+i.charAt(0).toUpperCase()+i.slice(1),r,t.shape.length),!mo().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],s=e.texData.get(t.dataId);let a=t;null!==s&&s.isPacked&&(a=e.unpackTensor(t),n.push(a));const[o,l]=um(a.shape,r),c=Ma(l),u=uM({inputs:{x:a},backend:e,attrs:{shape:[-1,c]}});n.push(u);const d=zM(e,u,i);n.push(d);const h=uM({inputs:{x:d},backend:e,attrs:{shape:o}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),h}return UM(e,t,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VM={kernelName:Co,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;let a=Va(s,r.shape);const o=pm(a,r.shape.length);let l=r;const c=[];null!=o&&(l=TM({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=mm(a.length,l.shape.length)),hm("argMax",[a[0]],l.shape.length);const u=GM(n,l,a[0],"max");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HM={kernelName:Eo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s}=i;let a=Va(s,r.shape);const o=pm(a,r.shape.length);let l=r;const c=[];null!=o&&(l=TM({inputs:{x:r},backend:n,attrs:{perm:o}}),c.push(l),a=mm(a.length,l.shape.length)),hm("argMin",[a[0]],l.shape.length);const u=GM(n,l,a[0],"min");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}},WM=eM({opSnippet:EL+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),jM={kernelName:Ao,backendName:"webgl",kernelFunc:WM},qM=eM({opSnippet:EL+"return log(x + sqrt(x * x + 1.0));"}),XM={kernelName:Ro,backendName:"webgl",kernelFunc:qM},KM=eM({opSnippet:EL+"\n  return atan(x);\n"}),YM={kernelName:No,backendName:"webgl",kernelFunc:KM},ZM=tM({opSnippet:BL+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+UL+"\n  return result;\n"}),QM={kernelName:Do,backendName:"webgl",kernelFunc:ZM},JM=eM({opSnippet:EL+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),eF={kernelName:Po,backendName:"webgl",kernelFunc:JM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class tF{constructor(e,t,n,i=!1,r=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const f="avg"===t,m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(f||(b="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${a}, ${o});\n        const ivec2 pads = ivec2(${h}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${u};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d};\n                wC += ${c}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${i?r?m:g:`wR * ${d} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let y=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(y="avgValue / count");const v=4*Math.floor(s/4),T=s%4,x=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${a}, ${o});\n      const ivec2 pads = ivec2(${h}, ${p});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${u};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${c};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              getValue(batch, xR, xC + 3 * ${c}, d)\n            );\n\n            ${x}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===T}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${x}\n          } else if (${2===T}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${x}\n          } else if (${3===T}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              initializationValue\n            );\n\n            ${x}\n          }\n        }\n        setOutput(${y});\n      }\n    `}}class nF{constructor(e,t,n,i=!1,r=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const y="avg"===t;let v="0.0";if(y||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${a}, ${o}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${b});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${c}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${u}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${d}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${t} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${i?r?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let T=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(T="avgValue / count");const x=4*Math.floor(s/4),_=s%4,S=`\n      if (${y}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${a}, ${o}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${b});\n      const float initializationValue = ${v};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${v});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${c}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${x}; wC += 4) {\n              int xC = xCCorner + wC * ${d};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${d}, ch)\n              );\n\n              ${S}\n            }\n\n            int xC = xCCorner + ${x};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                initializationValue\n              );\n\n              ${S}\n            }\n          }\n          setOutput(${T});\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iF={kernelName:Oo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;FD(r,"avgPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;Pa(bf(a,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`);const c=of(r.shape,s,a,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&Fa(c.inShape,c.outShape))return VL({inputs:{x:r},backend:n});const u=new tF(c,"avg",!1);return n.runWebGLProgram(u,[r],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rF={kernelName:Mo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:c}=i,u=lf(r.shape,s,a,[1,1,1],o,l,c),d=new nF(u,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sF{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.top,u=l-1-e.padInfo.left,d=1/(t*n);this.userCode=`\n      const ivec2 pads = ivec2(${c}, ${u});\n      const float avgMultiplier = float(${d});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${o};\n            wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${a}) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class aF{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=u-1-e.padInfo.front,f=d-1-e.padInfo.top,m=h-1-e.padInfo.left,g=1/(t*n*i);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${u};\n            wD += ${o}) {\n          float dyD = float(dyDCorner + wD) / ${r}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${d};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${c}) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oF={kernelName:Fo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=i,d=lf(a.shape,o,l,[1,1,1],c,u),h=new aF(d);return n.runWebGLProgram(h,[r],a.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lF={kernelName:Lo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s;FD([r,s],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=i,u=of(a.shape,o,l,1,c),d=new sF(u);return n.runWebGLProgram(d,[r],a.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cF={kernelName:$o,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s}=t,{transposeA:a,transposeB:o}=i;return _M({a:r,b:s,transposeA:a,transposeB:o,backend:n})}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uF{constructor(e,t,n,i,r,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Tp(e,t),Tp(e,n);let a="0.0";null!=i&&(Tp(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="1.0";null!=r&&(Tp(e,r),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${a};\n        float scale = ${o};\n        float inv = scale * inversesqrt(variance + float(${s}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dF{constructor(e,t,n,i,r,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Tp(e,t),Tp(e,n);let a="vec4(0.0)";null!=i&&(Tp(e,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=r&&(Tp(e,r),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${a};\n        vec4 scale = ${o};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${s}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hF={kernelName:El,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,mean:r,variance:s,offset:a,scale:o}=e;Pa(r.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Pa(null==a||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Pa(null==o||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;null==l&&(l=.001);const c=[i,r,s];let u=null;null!=a&&(u=a.shape,c.push(a));let d=null;null!=o&&(d=o.shape,c.push(o));const h=mo().getBool("WEBGL_PACK_NORMALIZATION")?new dF(i.shape,r.shape,s.shape,u,d,l):new uF(i.shape,r.shape,s.shape,u,d,l);return t.runWebGLProgram(h,c,c[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class pF{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=nO(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return fF.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.rank);let i;const r=e.map((e,t)=>`sourceLoc.${fF[t]} = start[${t}] + coords.${fF[t]};`);i=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${r.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${i}\n        setOutput(getSource(${n}));\n      }\n    `}}const fF=["x","y","z","w","u","v"];class mF{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=nO(this.rank),n=TL("coords",this.rank),i=TL("sourceLoc",this.rank),r=1===this.rank?"sourceLoc":`vec2(${i.slice(-2).join()})`,s=`getChannel(getSource(${i.join()}), ${r})`,a=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${i[this.rank-1]};\n        result.y = ${s};\n        --${i[this.rank-1]};\n      }\n    `,o=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${i[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${i[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map((e,t)=>`start[${t}]`).join()});`:e.map((e,t)=>`${i[t]} = ${n[t]} + start[${t}];`).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${a}\n        ${o}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gF(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,size:a}=i,[o,l]=Mp(r,s,a);if(wp(r,o,l),0===Ma(l))return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||"string"===r.dtype){const e=n.texData.get(r.dataId),t=sL(e.values,o,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,t)}const{isPacked:c}=n.texData.get(r.dataId),u=Op(r.shape,o,l);if(c||!u){const e=mo().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mF(l):new pF(l),t=[o];return n.runWebGLProgram(e,[r],r.dtype,t)}return n.uploadToGPU(r.dataId),function(e,t,n,i){const r=i.texData.get(e.dataId),s=i.makeTensorInfo(n,e.dtype),a=i.texData.get(s.dataId);Object.assign(a,r),a.refCount=1,a.shape=n,a.dtype=e.dtype;let o=Lp(t,to(e.shape));r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};const l=i.dataRefCount.get(a.slice.origDataId)||1;return i.dataRefCount.set(a.slice.origDataId,l+1),s}(r,o,l,n)}const bF={kernelName:Uc,backendName:"webgl",kernelFunc:gF},yF={kernelName:Bo,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,crops:a}=i;Pa(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const o=s.reduce((e,t)=>e*t),l=Dy(r.shape,s,o),c=Oy(l.length,s.length),u=Ly(r.shape,s,o),d=My(a,s.length),h=Fy(u,a,s.length),p=[],f=uM({inputs:{x:r},backend:n,attrs:{shape:l}}),m=TM({inputs:{x:f},backend:n,attrs:{perm:c}}),g=uM({inputs:{x:m},backend:n,attrs:{shape:u}}),b=gF({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return p.push(f),p.push(m),p.push(g),p.forEach(e=>n.disposeIntermediateTensorInfo(e)),b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF={kernelName:zo,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a}=i,o=n.readSync(r.dataId),l=n.readSync(s.dataId),c=EO(o,l,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF={kernelName:Uo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:i,s1:r}=t,s=n.readSync(i.dataId),a=n.readSync(r.dataId),o=Tp(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},xF=tM({opSnippet:"return float(a != b);",cpuKernelImpl:YO,dtype:"bool"}),_F={kernelName:dc,backendName:"webgl",kernelFunc:xF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SF(e){const{inputs:t,backend:n}=e,{input:i}=t;return VL({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.real},backend:n})}const wF={kernelName:Ic,backendName:"webgl",kernelFunc:SF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF={kernelName:Go,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function e(t){const{inputs:n,backend:i,attrs:r}=t,{x:s}=n,{dtype:a}=r;if("complex64"===a){if("complex64"===s.dtype)return VL({inputs:{x:s},backend:i});const t=rg(s.shape),n=e({inputs:{x:s},backend:i,attrs:{dtype:"float32"}}),r=WL({inputs:{real:n,imag:t},backend:i});return t.dispose(),i.disposeIntermediateTensorInfo(n),r}if("complex64"===s.dtype){const t=SF({inputs:{input:s},backend:i}),n=e({inputs:{x:t},backend:i,attrs:{dtype:a}});return i.disposeIntermediateTensorInfo(t),n}if(!qa(s.dtype,a)){const e=VL({inputs:{x:s},backend:i});return{dataId:e.dataId,shape:e.shape,dtype:a}}if(i.shouldExecuteOnCPU([s])){const e=i.texData.get(s.dataId).values,[t,n,r]=RO(e,s.shape,s.dtype,a);return i.makeTensorInfo(t,n,r)}if("int32"===a)return function(e,t){const n=new CL(e.shape,"return float(int(x));"),i=t.runWebGLProgram(n,[e],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}(s,i);if("bool"===a){const e=i.makeTensorInfo([],"bool",Wa("bool",1)),t=xF({inputs:{a:s,b:e},backend:i});return i.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${a}`)}},kF="return ceil(x);",CF=eM({opSnippet:kF,packedOpSnippet:kF,cpuKernelImpl:NO}),EF={kernelName:Vo,backendName:"webgl",kernelFunc:CF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class AF{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RF{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF={kernelName:Ho,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{clipValueMin:s,clipValueMax:a}=i;let o;o=mo().getBool("WEBGL_PACK_CLIP")?new RF(r.shape):new AF(r.shape);const l=[[s],[a]];return n.runWebGLProgram(o,[r],r.dtype,l)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PF{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DF(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const OF={kernelName:jo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=n.texData.get(i.dataId),s=new PF(i.shape),a=[DF(i,r.complexTensorInfos.real),DF(i,r.complexTensorInfos.imag)];return n.runWebGLProgram(s,a,a[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LF{constructor(e){this.outputShape=[],this.outputShape=wy(e,1),this.variableNames=e.map((e,t)=>`T${t}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let s=1;s<t.length;s++)t[s]=t[s-1]+e[s][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<t.length;s++){const e=t[s-1];n.push(`else if (yC < ${t[s]}) setOutput(getT${s}(yR, yC-${e}));`)}const i=t.length,r=t[t.length-1];n.push(`else setOutput(getT${i}(yR, yC-${r}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MF{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=wy(e,t);const n=this.outputShape,i=n.length,r=nO(i),s=TL("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((e,t)=>`T${t}`);const o=new Array(e.length-1);o[0]=e[0][t];for(let f=1;f<o.length;f++)o[f]=o[f-1]+e[f][t];const l=a[t],c=a.slice(-2),u=a.join();let d=`if (${l} < ${o[0]}) {\n        return getChannel(\n            getT0(${u}), vec2(${c.join()}));\n        }`;for(let f=1;f<o.length;f++){const e=o[f-1];d+=`\n        if (${l} < ${o[f]}  && ${l} >= ${o[f-1]}) {\n          return getChannel(\n            getT${f}(${FF(a,l,e)}),\n            vec2(${FF(c,l,e)}));\n        }`}const h=o.length,p=o[o.length-1];d+=`\n        return getChannel(\n          getT${h}(${FF(a,l,p)}),\n          vec2(${FF(c,l,p)}));`,this.userCode=`\n      float getValue(${a.map(e=>"int "+e)}) {\n        ${d}\n      }\n\n      void main() {\n        ${r} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[i-1]} = ${s[i-1]} + 1;\n        if (${s[i-1]} < ${n[i-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[i-2]} = ${s[i-2]} + 1;\n        if (${s[i-2]} < ${n[i-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[i-1]} = ${s[i-1]} - 1;\n        if (${s[i-2]} < ${n[i-2]} &&\n            ${s[i-1]} < ${n[i-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function FF(e,t,n){const i=e.indexOf(t);return e.map((e,t)=>t===i?`${e} - ${n}`:e).join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $F(e){const{inputs:t,backend:n}=e,{input:i}=t;return VL({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.imag},backend:n})}const BF={kernelName:Ll,backendName:"webgl",kernelFunc:$F};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(e,t,n){const i=e[0].dtype;if("complex64"===i){const i=e.map(e=>SF({inputs:{input:e},backend:n})),r=e.map(e=>$F({inputs:{input:e},backend:n})),s=zF(i,t,n),a=zF(r,t,n),o=WL({inputs:{real:s,imag:a},backend:n});return i.forEach(e=>n.disposeIntermediateTensorInfo(e)),r.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),o}let r=n.shouldExecuteOnCPU(e);if("string"===i&&(r=!0),r){const r=e.map(e=>{const i=Ma(e.shape.slice(t));return uM({inputs:{x:e},backend:n,attrs:{shape:[-1,i]}})}),s=r.map(e=>({vals:n.readSync(e.dataId),shape:e.shape})),a=wy(r.map(e=>e.shape),1),o=1===r[0].shape[0],l=PO(s,a,i,o),c=wy(e.map(e=>e.shape),t),u=n.makeTensorInfo(c,i,l);return r.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}const s=mo().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(e.length>s){const i=[];for(let a=0;a<e.length;a+=s){const r=e.slice(a,a+s);i.push(zF(r,t,n))}const r=zF(i,t,n);for(const e of i)n.disposeIntermediateTensorInfo(e);return r}if(mo().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const r=new MF(e.map(e=>e.shape),t);return n.runWebGLProgram(r,e,i)}const{tensors2D:a,outShape:o}=function(e,t,n){const i=wy(e.map(e=>e.shape),t),r=e.map(e=>uM({inputs:{x:e},attrs:{shape:[-1,Ma(e.shape.slice(t))]},backend:n}));return{tensors2D:r,outShape:i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,t,n),l=new LF(a.map(e=>e.shape)),c=n.runWebGLProgram(l,a,i);a.forEach(e=>n.disposeIntermediateTensorInfo(e));const u=uM({inputs:{x:c},attrs:{shape:o},backend:n});return n.disposeIntermediateTensorInfo(c),u}function UF(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i,s=Va(r,t[0].shape)[0];Sy(t.map(e=>e.shape),s);const a=wy(t.map(e=>e.shape),s);if(0===Ma(a))return n.makeTensorInfo(a,t[0].dtype,[]);const o=t.filter(e=>Ma(e.shape)>0);return 1===o.length?VL({inputs:{x:o[0]},backend:n}):zF(o,s,n)}const GF={kernelName:qo,backendName:"webgl",kernelFunc:UF};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VF{constructor(e,t=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,b=m?2:3,y=m?3:1;let v="",T="";n&&(v=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,T="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${o}, ${l});\n      const ivec2 pads = ivec2(${s}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${y}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${b}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${u};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${x}\n        ${T}\n        setOutput(result);\n      }\n    `}}class HF{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,i=e.padInfo.left,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.filterDepth,d=e.filterHeight,h=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${r}, ${s}, ${a});\n      const ivec3 pads = ivec3(${t}, ${n}, ${i});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${u}; wF++) {\n          int xF = xFCorner + wF * ${o};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${c};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WF{constructor(e,t=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=cO(this.outputShape.length);const s=e.padInfo.left,a=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,u=c;let d="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<c;m++)d+=`\n           vec4 xTexelC${2*m};\n           int xTexelC${2*m}Ready;\n           vec4 xTexelC${2*m+1};\n           int xTexelC${2*m+1}Ready;\n           vec4 xC${m};`;d+=`\n     for (int r = 0; r < ${l}; r++) {\n      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {\n       `;for(let m=0;m<c;m++)d+=`\n           xTexelC${2*m} = vec4(0.0);\n           xTexelC${2*m}Ready = 0;\n           xTexelC${2*m+1} = vec4(0.0);\n           xTexelC${2*m+1}Ready = 0;\n           xC${m} = vec4(0.0);`;d+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let m=0;m<(u+1)/2;m++){const t=2*m;if(d+=`\n           xC = xCCorner + ${t*o};\n           `,1===a){if(t<c&&(s%2==1?(d+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n               `,d+=1===o&&t>0?`\n                 xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                   } else {\n                     xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                   }\n                   `):d+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n\n                 xC${t} = xTexelC${t};\n                 `,t+1<c)){const e=s%2==0?Ra(o):o;o%2==0&&s%2==1||o%2!=0&&s%2!=1?(d+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                     xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${t+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${t+1}Ready = 1;\n                   }\n                   `,d+=o>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${t+1} = vec4(previous.zw, xTexelC${t+1}.xy);\n                     } else {\n                      xC${t+1} = vec4(0.0, 0.0, xTexelC${t+1}.xy);\n                     }\n                     `:`\n                     xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                     `):d+=1===e?`\n                     xC${t+1} = xTexelC${t};\n                     `:`\n                     xCOffset = xC + ${e};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                       xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${t+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${t+1}Ready = 1;\n                     }\n\n                     xC${t+1} = xTexelC${t+1};\n                     `}}else t<c&&(s%2==1?(d+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                   xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${t+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${t+1}Ready = 1;\n                 }\n\n                 xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n               `,t+1<c&&(d+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                 `)):(d+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                   xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${t+1}.zw = vec2(0.);\n                   }\n                   xTexelC${t+1}Ready = 1;\n                 }\n\n                 xC${t} = vec4(\n                   xTexelC${t}.xy, xTexelC${t+1}.xy);\n               `,t+1<c&&(d+=`\n                   xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                 `)));t<c&&(d+=`\n             wTexel = getW(r, ${t}, d1, d2);\n             dotProd += xC${t}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${e.inChannels}) {\n               dotProd += xC${t}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,t+1<c&&(d+=`\n               wTexel = getW(r, ${t+1}, d1, d2);\n               dotProd += xC${t+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${e.inChannels}) {\n                 dotProd += xC${t+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}d+="\n     }\n   ",d+="\n     }\n   ",d+="\n     }\n   ";let h="",p="";n&&(h=i?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:r?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,p="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${h}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${d}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${f}\n         ${p}\n         setOutput(result);\n       }\n     `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jF{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=cO(this.outputShape.length);const{dataFormat:n}=t,i=BD(),r="channelsLast"===n,s=r?1:2,a=r?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let e=0;e<=1;e++)l+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${c};\n\n          ${o}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${a}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${r}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*c+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*c+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${l}\n\n        ${i.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qF(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function XF({x:e,filter:t,convInfo:n,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:o=null}){const l=e.shape,c=i.texData.get(e.dataId),u=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,p="channelsLast"===n.dataFormat,f=!1;let m;const g=[];if(null!=s){const e=qF(s.shape,p);null!=e&&(s=uM({inputs:{x:s},backend:i,attrs:{shape:e}}),g.push(s))}if(null!=r){const e=qF(r.shape,p);null!=e&&(r=uM({inputs:{x:r},backend:i,attrs:{shape:e}}),g.push(r))}if(!((1===d||1===h)&&u>1e3)&&c.isPacked&&p&&null!=c.texture&&l[2]%2!=0&&Fa(c.shape.slice(-3),l.slice(-3))){const u=l[0]*l[1]*(l[2]+1),d={dataId:e.dataId,shape:[1,u,n.inChannels],dtype:e.dtype},h=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,Pa(RD(c.shape,d.shape),()=>`packed reshape ${c.shape} to ${d.shape} isn't free`);const p=uM({inputs:{x:t},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(p);const b=_M({a:d,b:p,backend:i,transposeA:false,transposeB:f,bias:r,activation:o,preluActivationWeights:s,leakyreluAlpha:a}),y=i.texData.get(b.dataId);Pa(y.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=h,y.shape=n.outShape,m=VL({inputs:{x:b},backend:i}),m.shape=n.outShape,g.push(b)}else{const l=n.outHeight*n.outWidth,c=uM({inputs:{x:e},backend:i,attrs:{shape:p?[n.batchSize,l,n.inChannels]:[n.batchSize,n.inChannels,l]}}),u=uM({inputs:{x:t},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),d=_M({a:p?c:u,b:p?u:c,transposeA:!p,transposeB:f,backend:i,bias:r,activation:o,preluActivationWeights:s,leakyreluAlpha:a});m=uM({inputs:{x:d},backend:i,attrs:{shape:n.outShape}}),g.push(c),g.push(u),g.push(d)}for(const b of g)i.disposeIntermediateTensorInfo(b);return m}function KF({x:e,filter:t,convInfo:n,backend:i,bias:r=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:o=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:h,dataFormat:p}=n,f="channelsLast"===p,m=l*c*u,g=h*d,b=[n.batchSize,m,g],y=[];if(null!=s){const e=qF(s.shape,f);null!=e&&(s=uM({inputs:{x:s},backend:i,attrs:{shape:e}}),y.push(s))}if(null!=r){const e=qF(r.shape,f);null!=e&&(r=uM({inputs:{x:r},backend:i,attrs:{shape:e}}),y.push(r))}const v=uM({inputs:{x:t},backend:i,attrs:{shape:[1,m,Ma(t.shape)/m]}});y.push(v);const T=new jF(b,n),x=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=i.runWebGLProgram(T,[e],"float32",x),S=uM({inputs:{x:_},backend:i,attrs:{shape:b}});y.push(_),y.push(S);const w=null!=r,I=null!=s,k="leakyrelu"===o,C=o?nM(o,!0):null,E=new iM(f?S.shape:v.shape,f?v.shape:S.shape,f?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],!0,!1,w,C,I,k),A=f?[S,v]:[v,S];if(r&&A.push(r),I&&A.push(s),k){const e=i.makeTensorInfo([],"float32",yd(a,"float32"));A.push(e),y.push(e)}const R=i.runWebGLProgram(E,A,"float32"),N=uM({inputs:{x:R},backend:i,attrs:{shape:n.outShape}});y.push(R);for(const P of y)i.disposeIntermediateTensorInfo(P);return N}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YF={kernelName:Xo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=i,d=yf(l),h=cf(r.shape,s.shape,a,c,o,u,!1,d);let p;if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(h.strideWidth<=2&&"channelsLast"===d&&mo().getBool("WEBGL_EXP_CONV")){const e=new WF(h),t=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=n.runWebGLProgram(e,[r,s],"float32",t)}else if(mo().getBool("WEBGL_CONV_IM2COL"))p=KF({x:r,filter:s,convInfo:h,backend:n});else{const e=new VF(h);p=n.runWebGLProgram(e,[r,s],"float32")}else p=XF({x:r,filter:s,convInfo:h,backend:n});const f=uM({inputs:{x:p},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(p),f}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZF{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,s="channelsLast"===e.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${i};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${r};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              if (${s}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class QF{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s="channelsLast"===e.dataFormat,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=s?1:2,c=s?2:3,u=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${u}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class JF{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,i=e.strideWidth,r=e.padInfo.front,s=e.padInfo.top,a=e.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${t} - ${r};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${s};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${i} - ${a};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class e${constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=i-1-e.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${o}, ${l}, ${c});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${r}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${i}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${i} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t$={kernelName:Ko,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=i,d=yf(l),h=cf(r.shape,u,a,1,o,c,!1,d),p=new ZF(h);return n.runWebGLProgram(p,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n$={kernelName:Yo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{inputShape:a,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=i,d=yf(c),h=cf(a,s.shape,o,1,l,u,!1,d),p=new QF(h);return n.runWebGLProgram(p,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i$={kernelName:Zo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i,c=uf(r.shape,s.shape,a,l,o),u=new HF(c);return n.runWebGLProgram(u,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r$={kernelName:Qo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,pad:o,filterShape:l}=i,c=uf(r.shape,l,a,1,o),u=new JF(c);return n.runWebGLProgram(u,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s$={kernelName:Jo,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{pad:a,strides:o,inputShape:l}=i,c=uf(l,s.shape,o,1,a),u=new e$(c);return n.runWebGLProgram(u,[r,s],"float32")}},a$=eM({opSnippet:JL+"\n  return cos(x);\n"}),o$={kernelName:el,backendName:"webgl",kernelFunc:a$},l$=eM({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),c$={kernelName:tl,backendName:"webgl",kernelFunc:l$};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class u${constructor(e,t,n,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,a,o,l]=e,[c]=t,[u,d]=n;this.outputShape=[c,u,d,l];const h="bilinear"===i?1:0,[p,f]=[a-1+".0",o-1+".0"],[m,g,b]=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[y,v,T]=d>1?[""+(o-1)/(d-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${y});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${v};\n\n        float in_y = ${b};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${r}));\n          return;\n        }\n        float in_x = ${T};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${r}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d$={kernelName:rl,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{image:r,boxes:s,boxInd:a}=t,{cropSize:o,method:l,extrapolationValue:c}=i,u=new u$(r.shape,s.shape,o,l,c);return n.runWebGLProgram(u,[r,s,a],"float32")}};var h$,p$;(p$=h$||(h$={})).Prod="*",p$.Sum="+";class f${constructor(e,t,n,i){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,s=this.op===h$.Prod?"1.0":"0.0",a=n?s:`getX(${m$(r,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=i?"end != "+(o-1):"end != 0",c=i?"end + 1":"end - 1"):(l=i?`end + pow2 < ${o}`:"end >= pow2",c=i?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${nO(r)} coords = getOutputCoords();\n        int end = ${g$(r,"coords",this.op)};\n        float val = ${a};\n        int pow2 = int(pow(2.0, index));\n        if (${l}) {\n          int idx = ${c};\n          ${g$(r,"coords",this.op)} = idx;\n          val ${this.op}= getX(${m$(r,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function m$(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function g$(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$(e,t,n,i,r,s){const a=t.shape.length,o=pm([i],a);let l=t;null!=o&&(l=TM({inputs:{x:t},backend:n,attrs:{perm:o}}));const c=mm(1,a)[0];if(c!==a-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${i}`);const u=l.shape[c];let d=VL({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(u))-1;h++){const t=new f$(e,l.shape,!1,s),i=[[h]],r=d;d=n.runWebGLProgram(t,[d],d.dtype,i),n.disposeIntermediateTensorInfo(r)}if(r){const t=new f$(e,l.shape,r,s),i=d;d=n.runWebGLProgram(t,[d],d.dtype),n.disposeIntermediateTensorInfo(i)}if(null!=o){const e=TM({inputs:{x:d},backend:n,attrs:{perm:fm(o)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),e}return d}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y$={kernelName:nl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;return b$(h$.Prod,r,n,s,a,o)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v$={kernelName:il,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,exclusive:a,reverse:o}=i;return b$(h$.Sum,r,n,s,a,o)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T$={kernelName:sl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a,binaryOutput:o}=i;if(1===r.shape.length){const e=n.readSync(r.dataId),t=n.readSync(s.dataId),i=EO(e,t,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,i)}if(2===r.shape.length){const e=n.bufferSync(r),t=n.bufferSync(s),i=AO(e,t,a,o);return n.makeTensorInfo(i.shape,s.dtype,i.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x${constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _$={kernelName:al,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockSize:s,dataFormat:a}=i,o=r.shape[0],l=("NHWC"===a?r.shape[1]:r.shape[2])*s,c=("NHWC"===a?r.shape[2]:r.shape[3])*s,u=("NHWC"===a?r.shape[3]:r.shape[1])/(s*s),d=new x$("NHWC"===a?[o,l,c,u]:[o,u,l,c],s,a);return n.runWebGLProgram(d,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S${constructor(e,t=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=cO(this.outputShape.length);const s=e.filterHeight,a=e.filterWidth,o=e.outChannels/e.inChannels;let l="",c="";n&&(l=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,c="result = activation(result);");const u=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${a}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${u}\n        ${c}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w${constructor(e,t=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=cO(this.outputShape.length);const s=e.outChannels/e.inChannels,a=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<u;g++)h+=`\n          vec4 xTexelC${2*g};\n          int xTexelC${2*g}Ready;\n          vec4 xTexelC${2*g+1};\n          int xTexelC${2*g+1}Ready;\n          vec4 xC${g};`;h+=`\n    for (int r = 0; r < ${c}; r++) {\n      `;for(let g=0;g<u;g++)h+=`\n          xTexelC${2*g} = vec4(0.0);\n          xTexelC${2*g}Ready = 0;\n          xTexelC${2*g+1} = vec4(0.0);\n          xTexelC${2*g+1}Ready = 0;\n          xC${g} = vec4(0.0);`;h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let g=0;g<(d+1)/2;g++){const e=2*g;if(h+=`\n          xC = xCCorner + ${e*l};\n          `,1===o){if(e<u&&(a%2==1?(h+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,h+=1===l&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):h+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<u)){const t=a%2==0?Ra(l):l;l%2==0&&a%2==1||l%2!=0&&a%2!=1?(h+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,h+=l>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                    } else {\n                     xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                    }\n                    `:`\n                    xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                    `):h+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<u&&(a%2==1?(h+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<u&&(h+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(h+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<u&&(h+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<u&&(h+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<u&&(h+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}h+="\n    }\n  ",h+="\n      }\n    ";let p="",f="";n&&(p=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,f="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${h}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${f}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I$={kernelName:ol,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l,dimRoundingMode:c}=i;let u=l;null==u&&(u=[1,1]),Pa(bf(a,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${u}'`);const d=cf(r.shape,s.shape,a,u,o,c,!0);let h;h=mo().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?new w$(d):new S$(d);const p=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[r,s],"float32",p)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k${constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${s} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${i};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${r};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class C${constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s=t-1-e.padInfo.top,a=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${o}; dm++) {\n              int d2 = d1 * ${o} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E$={kernelName:ll,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,dy:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=i,d=cf(r.shape,u,a,o,l,c,!0),h=new k$(d);return n.runWebGLProgram(h,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A$={kernelName:cl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,filter:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=i,d=cf(u,s.shape,a,o,l,c,!0),h=new C$(d);return n.runWebGLProgram(h,[r,s],"float32")}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R${constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N$={kernelName:ul,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=[...i.shape,...i.shape],s=Ma(i.shape),a=uM({inputs:{x:i},backend:n,attrs:{shape:[s]}}),o=new R$(s),l=n.runWebGLProgram(o,[a],a.dtype),c=uM({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P${constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:i,strideHeight:r,strideWidth:s,filterHeight:a,filterWidth:o,dilationHeight:l,dilationWidth:c}=e,{top:u,left:d}=i;this.userCode=`\n      const ivec2 strides = ivec2(${r}, ${s});\n      const ivec2 pads = ivec2(${u}, ${d});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${a}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${o}; w++) {\n              int wIn = wBeg + w * ${c};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D$={kernelName:dl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s}=t,{strides:a,pad:o,dilations:l}=i,c=af(r.shape,s.shape,a,o,"NHWC",l);let u;const d=new P$(c);u=n.runWebGLProgram(d,[r,s],"float32");const h=uM({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),h}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O$={kernelName:ml,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{equation:r}=i,s=t,{allDims:a,summedDims:o,idDims:l}=nv(r,s.length);rv(a.length,l,s);const{path:c,steps:u}=sv(o,l),d=u.length;let h=null,p=a.length;const f=[];for(let m=0;m<d;++m){for(const e of u[m]){const{permutationIndices:t,expandDims:i}=iv(p,l[e]);let r;av(t)?r=s[e]:(r=TM({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(r));const a=r.shape.slice();for(let e=0;e<i.length;++e)a.splice(i[e],0,1);Fa(r.shape,a)||(r=uM({inputs:{x:r},backend:n,attrs:{shape:a}}),f.push(r)),null===h?h=r:(h=lM({inputs:{a:r,b:h},backend:n}),f.push(h))}m<d-1&&(c[m]>=0&&(h=yM({inputs:{x:h},backend:n,attrs:{axis:c[m]-(a.length-p),keepDims:!1}}),f.push(h)),p--)}for(const m of f)m!==h&&n.disposeIntermediateTensorInfo(m);return h}},L$=eM({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),M$={kernelName:gl,backendName:"webgl",kernelFunc:L$},F$={kernelName:bl,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:i,y:r}=t,s=mo().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new GL("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",i.shape,r.shape):new zL("return (b >= 1.0) ? a : a * (b + 1.0);",i.shape,r.shape);return n.runWebGLProgram(s,[i,r],i.dtype)}},$$=tM({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:DO}),B$={kernelName:vl,backendName:"webgl",kernelFunc:$$},z$=eM({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${zy};\n  float a1 = ${Uy};\n  float a2 = ${Gy};\n  float a3 = ${Vy};\n  float a4 = ${Hy};\n  float a5 = ${Wy};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),U$={kernelName:yl,backendName:"webgl",kernelFunc:z$},G$=eM({opSnippet:JL+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:OO,dtype:"float32"}),V$={kernelName:Tl,backendName:"webgl",kernelFunc:G$};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function H$(e){const{inputs:t,attrs:n,backend:i}=e,{dim:r}=n,{input:s}=t,a=s.shape.length,o=s.shape.slice();let l=r;return r<0&&(Pa(-(a+1)<=r,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+r+1),o.splice(l,0,1),uM({inputs:{x:s},backend:i,attrs:{shape:o}})}const W$={kernelName:xl,backendName:"webgl",kernelFunc:H$},j$="return exp(x) - 1.0;",q$=eM({opSnippet:j$,packedOpSnippet:j$,cpuKernelImpl:LO}),X$={kernelName:_l,backendName:"webgl",kernelFunc:q$};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class K${constructor(e,t,n){this.variableNames=["real","imag"];const i=t[1];this.outputShape=t;const r=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${i}.0`:"1.0";let a;if("real"===e)a="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${r};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${i});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${i}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(e,t,n){const i=n.texData.get(e.dataId),r=Ma(e.shape),s=e.shape[e.shape.length-1],a=uM({inputs:{x:e},backend:n,attrs:{shape:[r/s,s]}}),o=a.shape,l=new K$("real",o,t),c=new K$("imag",o,t),u=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:o},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:o}],d=n.runWebGLProgram(l,u,"float32"),h=n.runWebGLProgram(c,u,"float32"),p=WL({inputs:{real:d,imag:h},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h);const f=uM({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),f}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$={kernelName:Sl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t;return Y$(i,!1,n)}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q${constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$(e){const{backend:t,attrs:n}=e,{shape:i,value:r}=n;let{dtype:s}=n;if(s=s||Qa(r),"string"===s){const e=ja(s,Ma(i));return e.fill(r),t.makeTensorInfo(i,s,e)}{const e=new Q$(i,r),n=[[r]];return t.runWebGLProgram(e,[],s,n)}}const eB={kernelName:wl,backendName:"webgl",kernelFunc:J$};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tB{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nB={kernelName:Il,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,i=t,r=new tB(n.shape);return i.runWebGLProgram(r,[n],n.dtype)}},iB="return floor(x);",rB=eM({opSnippet:iB,packedOpSnippet:iB,cpuKernelImpl:MO}),sB={kernelName:kl,backendName:"webgl",kernelFunc:rB},aB=tM({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),oB={kernelName:Cl,backendName:"webgl",kernelFunc:aB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lB{constructor(e){this.variableNames=["A"];const t=BD(),[n,i]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cB{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=BD(),[n,i]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${i}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uB={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e;let{pixels:r}=t;const{numChannels:s}=i,a="undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement,[l,c]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],d=[c,l,s];if(o||a){const e=mo().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=dB&&e===hB||(hB=e,dB=document.createElement("canvas").getContext("2d",{willReadFrequently:hB})),dB.canvas.width=l,dB.canvas.height=c,dB.drawImage(r,0,0,l,c),r=dB.canvas}const h=n.makeTensorInfo(u,"int32");n.texData.get(h.dataId).usage=aD.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),r);const p=mo().getBool("WEBGL_PACK")?new cB(d):new lB(d),f=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),f}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */};let dB,hB=mo().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const pB={kernelName:Su,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=i,m=yf(u),g=cf(r.shape,s.shape,l,d,c,h,!1,m);let b;const y=[],v=null!=a,T=null!=o,x="leakyrelu"===p,_=()=>{const e=[r,s],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=uM({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return y.push(t),t}return e};if(v&&e.push(t(a,u)),T&&e.push(t(o,u)),x){const t=n.makeTensorInfo([],"float32",yd(f,"float32"));e.push(t),y.push(t)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&mo().getBool("WEBGL_EXP_CONV")){const e=p?nM(p,!0):null,t=new WF(g,v,e,T,x),i=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],r=_();b=n.runWebGLProgram(t,r,"float32",i)}else if(mo().getBool("WEBGL_CONV_IM2COL"))b=KF({x:r,filter:s,convInfo:g,backend:n,bias:a,activation:p,preluActivationWeights:o,leakyreluAlpha:f});else{const e=p?nM(p,!1):null,t=new VF(g,v,e,T,x),i=_();b=n.runWebGLProgram(t,i,"float32")}else b=XF({x:r,filter:s,convInfo:g,backend:n,bias:a,activation:p,preluActivationWeights:o,leakyreluAlpha:f});const S=uM({inputs:{x:b},backend:n,attrs:{shape:g.outShape}});return y.push(b),y.forEach(e=>n.disposeIntermediateTensorInfo(e)),S}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fB={kernelName:wu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=i,f=[];let m=u;null==m&&(m=[1,1]),Pa(bf(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=cf(r.shape,s.shape,l,m,c,d,!0),b=mo().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=h?nM(h,b):null,v=[r,s],T=null!=a,x=null!=o,_="leakyrelu"===h;if(T&&v.push(a),x&&v.push(o),_){const e=n.makeTensorInfo([],"float32",yd(p,"float32"));v.push(e),f.push(e)}let S;S=b?new w$(g,T,y,x,_):new S$(g,T,y,x,_);const w=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],I=n.runWebGLProgram(S,v,"float32",w);return f.forEach(e=>n.disposeIntermediateTensorInfo(e)),I}};class mB{constructor(e,t,n,i){this.sliceDim=e,this.strides=t,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=n;const r=nO(n.length);let s="\n    int index;";for(let a=0;a<this.sliceDim;a++)s+=`\n          index = round(getIndices(coords[0], ${a}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};\n          flattenIndex += index * ${this.strides[a]};`;this.userCode=`\n         void main() {\n          ${r} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${s}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gB={kernelName:Rl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:i,indices:r}=t,s=r.shape,a=s[s.length-1],o=Ma(i.shape),[l,c,u,d]=xp(i,r),h=uM({inputs:{x:r},backend:n,attrs:{shape:[c,a]}}),p=uM({inputs:{x:i},backend:n,attrs:{shape:[Ma(i.shape)/u,u]}});if(n.shouldExecuteOnCPU([i,r])||"string"===i.dtype){const e=n.readSync(r.dataId),t=n.bufferSync(i),s=FO(e,t,i.dtype,c,a,u,d,i.shape,o);return n.makeTensorInfo(l,i.dtype,s.values)}const f=new mB(a,d,[c,u],i.shape),m=n.runWebGLProgram(f,[p,h],p.dtype),g=uM({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bB{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=nO(this.rank),i=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let i=0;i<e.length;i++)2===i?n.push("index"):n.push(`${t[i]}`);return n.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${i}));\n      }\n    `}}function yB(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,indices:s}=t,{axis:a,batchDims:o}=i,l=Va(a,r.shape)[0];if(mo().get("DEBUG")){const e=n.readSync(s.dataId),t=r.shape[l];for(let n=0;n<e.length;++n){const i=e[n];Pa(i<=t-1&&i>=0,()=>`GatherV2: the index value ${i} is not in [0, ${t-1}]`)}}const c=Sv(r,s,l,o),u=Ma(s.shape),d=[],h=uM({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=uM({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(h),d.push(p);const f=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,s])||"string"===r.dtype){const e=n.bufferSync(p),t=n.bufferSync(h),i=$O(t,e,f);return d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c.outputShape,i.dtype,i.values)}const m=new bB(h.shape,f),g=n.runWebGLProgram(m,[h,p],h.dtype);d.push(g);const b=uM({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return d.forEach(e=>n.disposeIntermediateTensorInfo(e)),b}const vB={kernelName:Al,backendName:"webgl",kernelFunc:yB},TB=tM({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:BO,dtype:"bool"}),xB={kernelName:Nl,backendName:"webgl",kernelFunc:TB},_B=tM({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:zO}),SB={kernelName:Pl,backendName:"webgl",kernelFunc:_B};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wB={kernelName:Ol,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n}=e,{input:i}=t;return Y$(i,!0,n)}},IB=eM({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),kB={kernelName:Ml,backendName:"webgl",kernelFunc:IB},CB=eM({opSnippet:"return float(isinf(x));",dtype:"bool"}),EB={kernelName:Fl,backendName:"webgl",kernelFunc:CB},AB=eM({opSnippet:"return float(isnan(x));",dtype:"bool"}),RB={kernelName:$l,backendName:"webgl",kernelFunc:AB},NB=tM({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:UO,dtype:"bool"}),PB={kernelName:zl,backendName:"webgl",kernelFunc:NB},DB=tM({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:GO,dtype:"bool"}),OB={kernelName:Ul,backendName:"webgl",kernelFunc:DB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LB={kernelName:Gl,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,num:s}=n,a=VO(i,r,s);return t.makeTensorInfo([a.length],"float32",a)}},MB=eM({opSnippet:JL+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:HO}),FB={kernelName:Vl,backendName:"webgl",kernelFunc:MB},$B=eM({opSnippet:JL+"\n  return log(1.0 + x);\n"}),BB={kernelName:Hl,backendName:"webgl",kernelFunc:$B},zB=tM({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),UB={kernelName:Wl,backendName:"webgl",kernelFunc:zB},GB=eM({opSnippet:"return float(!(x >= 1.0));"}),VB={kernelName:jl,backendName:"webgl",kernelFunc:GB},HB=tM({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),WB={kernelName:ql,backendName:"webgl",kernelFunc:HB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class jB{constructor(e,t,n,i,r){this.variableNames=["x"],this.outputShape=[];const s=t,a=e[3]-1;let o;this.outputShape=e;const l=`float(${n}) + float(${i}) * sum`;o=.5===r?`inversesqrt(${l})`:1===r?`1.0/(${l})`:`exp(log(${l}) * float(-${r}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${a}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${o};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qB{constructor(e,t,n,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=t,a=e[3]-1;let o;this.outputShape=e;const l=`float(${n}) + float(${i}) * sum`;o=.5===r?`inversesqrt(${l})`:1===r?`1.0/(${l})`:`exp(log(${l}) * float(-${r}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${o};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XB={kernelName:Xl,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{depthRadius:s,bias:a,alpha:o,beta:l}=i,c=mo().getBool("WEBGL_PACK_NORMALIZATION")?new qB(r.shape,s,a,o,l):new jB(r.shape,s,a,o,l);return n.runWebGLProgram(c,[r],r.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class KB{constructor(e,t,n,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=i,this.beta=r,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${i}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${i})\n                * float(${r})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${r});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YB={kernelName:Kl,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r,y:s,dy:a}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=i,d=new KB(r.shape,o,l,c,u);return n.runWebGLProgram(d,[r,s,a],r.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ZB(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reductionIndices:s,keepDims:a}=i,o=r.shape.length,l=Va(s,r.shape);let c=l;const u=pm(c,o),d=null!=u,h=n.shouldExecuteOnCPU([r]);let p=r;if(d){if(h){const e=n.texData.get(p.dataId).values,t=new Array(o);for(let n=0;n<t.length;n++)t[n]=r.shape[u[n]];const i=bL(e,r.shape,r.dtype,u,t);p=n.makeTensorInfo(t,r.dtype);n.texData.get(p.dataId).values=i}else p=bM(r,u,n);c=mm(c.length,o)}hm("max",c,o);const[f,m]=um(p.shape,c);let g,b=f;if(a&&(b=dm(f,l)),h){const e=n.texData.get(p.dataId).values,t=WO(e,Ma(m),b,r.dtype);g=n.makeTensorInfo(b,r.dtype);n.texData.get(g.dataId).values=t}else g=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e,t,n,i){const r=Ma(t),s=uM({inputs:{x:e},attrs:{shape:[Ma(e.shape)/r,r]},backend:i}),a=fM(s,e.dtype,"max",i),o=uM({inputs:{x:a},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}(p,m,b,n);return d&&n.disposeIntermediateTensorInfo(p),g}const QB={kernelName:Yl,backendName:"webgl",kernelFunc:ZB},JB=tM({opSnippet:BL+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+UL+"\n  return result;\n",cpuKernelImpl:jO}),ez={kernelName:Zl,backendName:"webgl",kernelFunc:JB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tz={kernelName:Ql,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t;FD(r,"maxPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=i;Pa(bf(a,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`);const c=of(r.shape,s,a,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&Fa(c.inShape,c.outShape))return VL({inputs:{x:r},backend:n});const u=new tF(c,"max",!1);return n.runWebGLProgram(u,[r],r.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nz={kernelName:ec,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{filterSize:s,strides:a,pad:o,dataFormat:l,dimRoundingMode:c}=i,u=lf(r.shape,s,a,[1,1,1],o,c,l),d=new nF(u,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iz{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,i=e.dilationHeight,r=e.effectiveFilterHeight,s=e.effectiveFilterWidth,a=r-1-e.padInfo.top,o=s-1-e.padInfo.left,l=r*s-1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${r};\n          wR += ${i}) {\n          float dyR = float(dyRCorner + wR) / ${t}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${s} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class rz{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,i=e.strideWidth,r=e.dilationDepth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=o-1-e.padInfo.front,d=l-1-e.padInfo.top,h=c-1-e.padInfo.left,p=o*l*c-1;this.userCode=`\n      const ivec3 pads = ivec3(${u}, ${d}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${o};\n           wD += ${r}) {\n          float dyD = float(dyDCorner + wD) / ${t}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${s}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${c};\n                wC += ${a}) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${c} +\n                  wR * ${c} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sz={kernelName:tc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s}=t,a=s,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=i,d=lf(a.shape,o,l,[1,1,1],c,u),h=new nF(d,"max",!0),p=n.runWebGLProgram(h,[a],a.dtype),f=new rz(d),m=n.runWebGLProgram(f,[r,p],a.dtype);return n.disposeIntermediateTensorInfo(p),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const az={kernelName:Jl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:r,input:s,output:a}=t,o=s;FD([s,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=i,h=of(o.shape,l,c,1,u,d),p=new tF(h,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),m=new iz(h),g=n.runWebGLProgram(m,[r,f],o.dtype);return n.disposeIntermediateTensorInfo(f),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const oz={kernelName:nc,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{filterSize:r,strides:s,pad:a,includeBatchInIndex:o}=t,l=n;Pa(4===i.shape.length,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const c=[1,1];Pa(bf(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);const u=of(i.shape,r,s,c,a),[d,h]=function(e,t,n,i){let r=new tF(n,"max",!1);const s=i.runWebGLProgram(r,[e],"float32");return r=new tF(n,"max",!0,!0,t),[s,i.runWebGLProgram(r,[e],"float32")]}(i,o,u,l);return[d,h]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const lz={kernelName:ic,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{keepDims:r,axis:s}=t,a=n,o=i.shape.length,l=Va(s,i.shape);let c=l;const u=pm(c,o),d=null!=u,h=a.shouldExecuteOnCPU([i]),p=[];let f=i;if(d){if(h){const e=a.texData.get(f.dataId).values,t=new Array(o);for(let r=0;r<t.length;r++)t[r]=i.shape[u[r]];const n=bL(e,i.shape,i.dtype,u,t);f=a.makeTensorInfo(t,i.dtype);a.texData.get(f.dataId).values=n}else f=bM(i,u,a);p.push(f),c=mm(c.length,o)}hm("sum",c,o);const[m,g]=um(f.shape,c);let b=m;r&&(b=dm(m,l));const y=function(e,t,n,i){const r=Ma(t),s=uM({inputs:{x:e},attrs:{shape:[Ma(e.shape)/r,r]},backend:i}),a=fM(s,"float32","mean",i),o=uM({inputs:{x:a},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}(f,g,b,a);for(const v of p)a.disposeIntermediateTensorInfo(v);return y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cz={kernelName:rc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=Va(s,r.shape);let c=l;const u=pm(c,o);let d=r;null!=u&&(d=TM({inputs:{x:r},backend:n,attrs:{perm:u}}),c=mm(c.length,r.shape.length)),hm("min",c,o);const[h,p]=um(d.shape,c),f=uM({inputs:{x:d},backend:n,attrs:{shape:[-1,Ma(p)]}}),m=fM(f,f.dtype,"min",n);let g;if(a){g=uM({inputs:{x:m},backend:n,attrs:{shape:dm(h,l)}})}else g=uM({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(d),g}},uz=tM({opSnippet:BL+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+UL+"\n  return result;\n",cpuKernelImpl:qO}),dz={kernelName:sc,backendName:"webgl",kernelFunc:uz};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hz{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=nO(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l="reflect"===n?0:1;this.userCode=1!==i?`\n      ${r} start = ${r}(${s});\n      ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outC = getOutputCoords();\n        for (int i = 0; i < ${i}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${r} coords = outC - start;\n        setOutput(getX(${o}));\n      }\n    `:`\n        int start = ${s};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pz{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=nO(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=TL("rc",i),l=TL("source",i),c=`${o[i-1]} < ${this.outputShape[i-1]}`,u=1===i?"source":`vec2(${l.slice(-2).join()})`,d="reflect"===n?0:1;let h="";if(1===i){const e=`\n        ${r} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${d};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${d};\n        }\n        source -= start;\n      `;h=`\n        ${r} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${o[i-1]} += 1;\n        if(${c}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n      `}else{const e=`\n        ${r} source = rc;\n        ${r} lt = ${r}(lessThan(source, start));\n        ${r} gte = ${r}(greaterThanEqual(source, end));\n        ${r} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${d}) +\n                gte * ((end - 1) * 2 - source + ${d});\n        source -= start;\n      `;h=`\n        ${r} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${o[i-1]} += 1;\n        if(${c}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n        rc = outputLoc;\n        ${o[i-2]} += 1;\n        if(${o[i-2]} < ${this.outputShape[i-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${l.join()}), ${u});\n          ${o[i-1]} += 1;\n          if(${c}) {\n            ${e}\n            result[3] = getChannel(getX(${l.join()}), ${u});\n          }\n        }\n      `}this.userCode=`\n      const ${r} start = ${r}(${s});\n      const ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fz={kernelName:ac,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i}=e,{paddings:r,mode:s}=n,a=mo().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pz(i.shape,r,s):new hz(i.shape,r,s);return t.runWebGLProgram(a,[i],i.dtype)}},mz=tM({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+UL+"\n  return result;\n"}),gz={kernelName:oc,backendName:"webgl",kernelFunc:mz};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class bz{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yz=tM({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),vz={kernelName:fl,backendName:"webgl",kernelFunc:yz},Tz="return a - b;",xz=tM({opSnippet:Tz,packedOpSnippet:Tz,supportsComplex:!0,cpuKernelImpl:fL}),_z={kernelName:cu,backendName:"webgl",kernelFunc:xz};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Sz(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{dim:s}=i,a=Va([s],r.shape),o=ZB({inputs:{x:r},backend:n,attrs:{reductionIndices:a,keepDims:!1}}),l=dm(o.shape,a),c=uM({inputs:{x:o},backend:n,attrs:{shape:l}}),u=xz({inputs:{a:r,b:c},backend:n}),d=G$({inputs:{x:u},backend:n}),h=yM({inputs:{x:d},backend:n,attrs:{axis:a,keepDims:!1}}),p=uM({inputs:{x:h},backend:n,attrs:{shape:l}}),f=yz({inputs:{a:d,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),f}const wz={kernelName:Zc,backendName:"webgl",kernelFunc:Sz};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iz={kernelName:lc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{numSamples:s,seed:a,normalized:o}=i,l=o?r:Sz({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new bz(c,u,s),h=[[a]],p=n.runWebGLProgram(d,[l],"int32",h);return o||n.disposeIntermediateTensorInfo(l),p}},kz=EL+"\n  return -x;\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cz={kernelName:uc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;if(n.shouldExecuteOnCPU([i])){const e=n.texData.get(i.dataId),[t,r]=KO(e.values,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,t)}let r;return r=mo().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new DL(i.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new CL(i.shape,kz),n.runWebGLProgram(r,[i],i.dtype)}},Ez=zb;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Az={kernelName:hc,backendName:"webgl",kernelFunc:function(e){Iu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=i,c=n.readSync(r.dataId),u=n.readSync(s.dataId),{selectedIndices:d}=Ez(c,u,a,o,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},Rz=Ub;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nz={kernelName:pc,backendName:"webgl",kernelFunc:function(e){Iu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=i,u=n.readSync(r.dataId),d=n.readSync(s.dataId),{selectedIndices:h,validOutputs:p}=Rz(u,d,a,o,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Pz=Gb;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dz={kernelName:fc,backendName:"webgl",kernelFunc:function(e){Iu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:r,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=i,u=n.readSync(r.dataId),d=n.readSync(s.dataId),h=a,p=o,f=l,m=c,{selectedIndices:g,selectedScores:b}=Pz(u,d,h,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oz{constructor(e,t,n,i){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${i}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lz={kernelName:gc,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{indices:r}=t,{dtype:s,depth:a,onValue:o,offValue:l}=i,c=Ma(r.shape),u=new Oz(c,a,o,l),d=uM({inputs:{x:r},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(u,[d],s);n.disposeIntermediateTensorInfo(d);const p=uM({inputs:{x:h},backend:n,attrs:{shape:[...r.shape,a]}});return n.disposeIntermediateTensorInfo(h),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mz(e){const{inputs:t,backend:n}=e,{x:i}=t;if("complex64"===i.dtype){const e=SF({inputs:{input:i},backend:n}),t=Mz({inputs:{x:e},backend:n}),r=$F({inputs:{input:i},backend:n}),s=Mz({inputs:{x:r},backend:n}),a=WL({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),a}return J$({attrs:{shape:i.shape,dtype:i.dtype,value:"string"===i.dtype?"":0},backend:n})}const Fz={kernelName:vu,backendName:"webgl",kernelFunc:Mz};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $z={kernelName:mc,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i}=t,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===r.dtype){const t=SF({inputs:{input:r},backend:i}),n=e({inputs:{x:t},backend:i}),s=$F({inputs:{input:r},backend:i}),a=Mz({inputs:{x:s},backend:i}),o=WL({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(t),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}return J$({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:i})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bz={kernelName:bc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{axis:r}=i;if(1===t.length)return H$({inputs:{input:t[0]},backend:n,attrs:{dim:r}});const s=t[0].shape,a=t[0].dtype;t.forEach(e=>{Da(s,e.shape,"All tensors passed to stack must have matching shapes"),Pa(a===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=UF({inputs:t.map(e=>{const t=H$({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t}),backend:n,attrs:{axis:r}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zz{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=nO(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);this.userCode=1!==i?`\n      ${r} start = ${r}(${s});\n      ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${r} coords = outC - start;\n          setOutput(getX(${o}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uz{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const i=e.length,r=nO(i),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=TL("rc",i),l=TL("source",i),c=`${o[i-1]} < ${this.outputShape[i-1]}`,u=1===i?"source":`vec2(${l.slice(-2).join()})`,d=[`${r} rc = outputLoc;`,`${o[i-1]} += 1;\n       if(${c}) {\n      `,1===i?"":`}\n       rc = outputLoc;\n       ${o[i-2]} += 1;\n       if(${o[i-2]} < ${this.outputShape[i-2]}) {`,1===i?"":`  ${o[i-1]} += 1;\n         if(${c}) {`],h=1===i?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let f=0,m=1===i?2:4;f<m;f++)p+=`\n        ${d[f]}\n        if (${h}) {\n          result[${f}] = float(value);\n        } else {\n          ${r} source = rc - start;\n          result[${f}] = getChannel(getX(${l.join()}), ${u});\n        }\n      `;p+=1===i?"} ":"}}",this.userCode=`\n      const ${r} start = ${r}(${s});\n      const ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gz=e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{paddings:s,constantValue:a}=i;if(0===Ma(r.shape)){const e=s.map((e,t)=>e[0]+r.shape[t]+e[1]);return J$({backend:n,attrs:{shape:e,value:a,dtype:r.dtype}})}const o=mo().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Uz(r.shape,s,a):new zz(r.shape,s,a),l=[[a]];return n.runWebGLProgram(o,[r],r.dtype,l)},Vz={kernelName:yc,backendName:"webgl",kernelFunc:Gz},Hz=tM({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+UL+"\n  return result;\n"}),Wz={kernelName:vc,backendName:"webgl",kernelFunc:Hz};const jz={kernelName:xc,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{axis:s,keepDims:a}=i,o=r.shape.length,l=[],c=Va(s,r.shape);let u=c;const d=pm(u,o);let h,p=r;if(null!=d&&(p=TM({inputs:{x:r},backend:n,attrs:{perm:d}}),u=mm(u.length,o),l.push(p)),hm("prod",u,o),n.shouldExecuteOnCPU([p])){const e=n.texData.get(p.dataId).values,{outVals:t,outShape:i,outDtype:r}=ZO(p.shape,p.dtype,e,u);h=n.makeTensorInfo(i,r,t)}else{const[e,t]=um(p.shape,u),i=Ma(t),s=uM({inputs:{x:p},backend:n,attrs:{shape:[-1,i]}}),a=fM(s,Kd(r.dtype),"prod",n);h=uM({inputs:{x:a},backend:n,attrs:{shape:e}}),l.push(s),l.push(a)}if(a){l.push(h);const e=dm(h.shape,c);h=uM({inputs:{x:h},backend:n,attrs:{shape:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),h}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qz={kernelName:_c,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{paramsNestedSplits:r,paramsDenseValues:s,indices:a}=t,{outputRaggedRank:o}=i,l=r.map(e=>n.readSync(e.dataId)),c=r.map(e=>e.shape),u=n.readSync(s.dataId),d=n.readSync(a.dataId),[h,p,f]=QO(l,c,u,s.shape,s.dtype,d,a.shape,o),m=h.map(e=>n.makeTensorInfo([e.length],"int32",e)),g=n.makeTensorInfo(f,s.dtype,p);return m.concat([g])}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xz={kernelName:Sc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{shape:r,values:s,defaultValue:a,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=i,c=n.readSync(r.dataId),u=n.readSync(s.dataId),d=n.readSync(a.dataId),h=o.map(e=>n.readSync(e.dataId)),p=o.map(e=>e.shape),[f,m]=JO(c,r.shape,u,s.shape,s.dtype,d,a.shape,h,p,l);return n.makeTensorInfo(f,s.dtype,m)}},Kz=e=>{const{backend:t,attrs:n}=e,{start:i,stop:r,step:s,dtype:a}=n,o=eL(i,r,s,a);return t.makeTensorInfo([o.length],a,o)},Yz={kernelName:wc,backendName:"webgl",kernelFunc:Kz},Zz=eM({opSnippet:"return 1.0 / x;"}),Qz={kernelName:kc,backendName:"webgl",kernelFunc:Zz},Jz=eM({opSnippet:EL+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),eU={kernelName:Cc,backendName:"webgl",kernelFunc:Jz},tU=eM({opSnippet:EL+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),nU={kernelName:Dc,backendName:"webgl",kernelFunc:tU};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class iU{constructor(e,t,n,i,r){this.variableNames=["A"],this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n];let d;d=r?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rU{constructor(e,t,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n];let d;d=r?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]},\n          ${c[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sU={kernelName:Nc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i,[l,c]=o,u=mo().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new rU(r.shape,l,c,s,a):new iU(r.shape,l,c,s,a);return n.runWebGLProgram(u,[r],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aU{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,r]=t,[,s,a]=e,o=[n&&s>1?i-1:i,n&&a>1?r-1:r],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],c=o[0]/l[0],u=o[1]/l[1],d=1/c,h=1/u,p=2*Math.ceil(d)+2,f=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU={kernelName:Pc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i,o=new aU(s.shape,r.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lU{constructor(e,t,n,i,r){this.variableNames=["A"],this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n],d=i?"0.5":"0.0";let h;h=r?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cU{constructor(e,t,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,l]=e;this.outputShape=[s,t,n,l];const c=[i&&t>1?a-1:a,i&&n>1?o-1:o],u=[i&&t>1?t-1:t,i&&n>1?n-1:n],d=i?"0.5":"0.0";let h;h=r?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/u[0]},\n          ${c[1]/u[1]},\n          ${c[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU={kernelName:Ac,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r}=t,{alignCorners:s,halfPixelCenters:a,size:o}=i,[l,c]=o,u=mo().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cU(r.shape,l,c,s,a):new lU(r.shape,l,c,s,a);return n.runWebGLProgram(u,[r],r.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dU{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,r]=t,[,s,a]=e,o=[n&&s>1?i-1:i,n&&a>1?r-1:r],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],c=o[0]/l[0],u=o[1]/l[1],d=1/c,h=1/u,p=2*Math.ceil(d)+2,f=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${o[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${o[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hU={kernelName:Rc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i,o=new dU(s.shape,r.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pU{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const i=e.map((n,i)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(i)).join(","),r=nO(n);this.userCode=`\n      void main() {\n        ${r} coords = getOutputCoords();\n        setOutput(getX(${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fU{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const i=TL("rc",n),r=`${i[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${i[n-2]} + 1 < ${this.outputShape[n-2]}`,a=nO(n);var o;function l(n){const i=e.map((i,r)=>function(n,i){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${i[n]} - 1`:`${i[n]}`}(r,n));return`getChannel(getX(${i.join(",")}), vec2(${i.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${r}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${a} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${o=i.slice(),l(o)};\n          if(${r}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",l(e)}(i.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",l(e)}(i.slice())};\n            if(${r}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",l(e)}(i.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU={kernelName:Oc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{dims:s}=i,a=r.shape.length,o=Va(s,r.shape);if(0===a)return VL({inputs:{x:r},backend:n});const l=mo().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fU(r.shape,o):new pU(r.shape,o);return n.runWebGLProgram(l,[r],r.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gU{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],i=e[2];this.outputShape=e;let r="";r="number"==typeof t?`float outputValue = ${t.toFixed(2)};`:`\n        vec3 fill = vec3(${t.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${r}\n          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:xu,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:i}=e,{radians:r,fillValue:s,center:a}=t,o=n,l=new gU(i.shape,s),[c,u]=Py(a,i.shape[1],i.shape[2]),d=[[c,u,Math.sin(r),Math.cos(r)]];return o.runWebGLProgram(l,[i],i.dtype,d)}},yU=eM({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),vU={kernelName:Lc,backendName:"webgl",kernelFunc:yU},TU=eM({opSnippet:"return inversesqrt(x);",cpuKernelImpl:tL}),xU={kernelName:Mc,backendName:"webgl",kernelFunc:TU};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _U{constructor(e,t,n,i,r,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const o=nO(r.length),l=nO(s.length);let c="";1===n?c="i":2===n&&(c="i, j");const u=`getIndices(${c})`;let d="";1===i?d="i":2===i&&(d="i, coords[1]");const h=`getUpdates(${d})`,p=t>1?"strides[j]":"strides";this.userCode=`\n        ${o} strides = ${o}(${r});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(${u});\n              flattenedIndex += index * ${p};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${h};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:Fc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:r,updates:s}=t,{shape:a}=i,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Sp(0,r,a),h=[d/c,c];if(0===d)return n.makeTensorInfo(a,r.dtype);const p=uM({inputs:{x:r},backend:n,attrs:{shape:[l,o]}}),f=uM({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new _U(l,o,p.shape.length,f.shape.length,u,h),b=n.runWebGLProgram(g,[f,p,m],f.dtype),y=uM({inputs:{x:b},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(m),y}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wU{constructor(e,t,n,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const r=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,s=2===mo().getNumber("WEBGL_VERSION")?"while (left < right) {":r,a="left"===i?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${s}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${a} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:$c,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sortedSequence:r,values:s}=t,{side:a}=i,o=new wU(r.shape[0],r.shape[1],s.shape[1],a),l=[[r.shape[1]]];return n.runWebGLProgram(o,[r,s],"int32",l)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kU{constructor(e,t,n){let i,r;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)r="resRC",i="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[];for(let i=0;i<t.length;i++)a.push(`${n[i]}`),i<e&&s.push(`${n[i]}`);i=s.join(),r=a.join()}const s=nO(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${i});\n        if (cVal >= 1.0) {\n          setOutput(getA(${r}));\n        } else {\n          setOutput(getB(${r}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU={kernelName:Bc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:i,t:r,e:s}=t,a=new kU(i.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(a,[i,r,s],Xd(r.dtype,s.dtype))}},EU=eM({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = ${By};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),AU={kernelName:zc,backendName:"webgl",kernelFunc:EU},RU=eM({opSnippet:JL+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:iL}),NU={kernelName:Wc,backendName:"webgl",kernelFunc:RU},PU=eM({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),DU={kernelName:Hc,backendName:"webgl",kernelFunc:PU},OU=eM({opSnippet:JL+"\n  return sin(x);\n"}),LU={kernelName:Gc,backendName:"webgl",kernelFunc:OU},MU=eM({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),FU={kernelName:Vc,backendName:"webgl",kernelFunc:MU},$U=eM({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),BU={kernelName:jc,backendName:"webgl",kernelFunc:$U},zU={kernelName:Kc,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockShape:s,paddings:a}=i;Pa(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const o=s.reduce((e,t)=>e*t),l=[[0,0]];l.push(...a);for(let b=1+s.length;b<r.shape.length;++b)l.push([0,0]);const c=[],u=Gz({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),d=Dy(u.shape,s,o,!1),h=Oy(d.length,s.length,!1),p=Ly(u.shape,s,o,!1),f=uM({inputs:{x:u},backend:n,attrs:{shape:d}}),m=TM({inputs:{x:f},backend:n,attrs:{perm:h}}),g=uM({inputs:{x:m},backend:n,attrs:{shape:p}});return c.push(u),c.push(f),c.push(m),c.forEach(e=>n.disposeIntermediateTensorInfo(e)),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={kernelName:Qc,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){const{inputs:t,backend:n}=e,{indices:i,values:r,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${s.shape}`);if(2!==i.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${i.shape}`);if(1!==r.shape.length)throw new Error(`Values must be a vector, saw:\n         ${r.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const o=n.readSync(i.dataId),l=n.readSync(r.dataId),c=n.readSync(s.dataId),u=n.readSync(a.dataId)[0],[d,h,p,f,m]=aL(o,i.shape,i.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,i.dtype,d),n.makeTensorInfo([h[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(e=>Number(e)))),n.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU={kernelName:Jc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:i,inputShape:r,newShape:s}=t;if(2!==i.shape.length)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(1!==r.shape.length)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const a=Array.from(n.readSync(r.dataId)),o=n.readSync(i.dataId),l=Array.from(n.readSync(s.dataId)),[c,u,d]=oL(o,i.shape,i.dtype,a,l);return[n.makeTensorInfo(u,i.dtype,c),n.makeTensorInfo([d.length],s.dtype,new Int32Array(d))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:eu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${r.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${s.shape}`);const a=n.readSync(i.dataId),o=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=lL(a,i.shape,i.dtype,o,l,!0);return n.makeTensorInfo(u,i.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:tu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${r.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${s.shape}`);const a=n.readSync(i.dataId),o=n.readSync(r.dataId),l=n.readSync(s.dataId),[c,u]=lL(a,i.shape,i.dtype,o,l);return n.makeTensorInfo(u,i.dtype,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:nu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sparseIndices:r,sparseValues:s,defaultValue:a}=t,{outputShape:o}=i,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=Sp(0,r,o),p=!1;if("string"===s.dtype){const e=n.bufferSync(r),t=n.bufferSync(s),i=_d(n.readSync(a.dataId)[0]),f=nL(e,t,o,h,u,c,l,d,i,p);return n.makeTensorInfo(o,f.dtype,f.values)}const f=new _U(c,l,r.shape.length,s.shape.length,d,[h,1],p),m=n.runWebGLProgram(f,[s,r,a],s.dtype),g=uM({inputs:{x:m},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU={kernelName:Yc,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{numOrSizeSplits:s,axis:a}=i,o=Va(a,r.shape)[0],l=lv(r,s,o),c=r.shape.length,u=new Array(c).fill(0),d=r.shape.slice();return l.map(e=>{const t=[...d];t[o]=e;const i=gF({inputs:{x:r},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,i})}},qU="return sqrt(x);",XU=eM({opSnippet:qU,packedOpSnippet:qU,cpuKernelImpl:cL}),KU={kernelName:qc,backendName:"webgl",kernelFunc:XU},YU={kernelName:ru,backendName:"webgl",kernelFunc:eM({opSnippet:"return x * x;"})},ZU="return (a - b) * (a - b);",QU=tM({opSnippet:ZU,packedOpSnippet:ZU}),JU={kernelName:iu,backendName:"webgl",kernelFunc:QU};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:Tu,backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({inputs:e,attrs:t,backend:n}){const{x:i}=e,r=EL+`\n    return x > 0.0 ? 1.0 : float(${t.alpha});\n  `,s=new CL(i.shape,r);return n.runWebGLProgram(s,[i],i.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tG{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const i=n.length,r=nO(n.length),s=nO(n.length);let a="";if(1===i)a="coords * strides + begin";else{let e=0;a=n.map((t,i)=>(e++,1===n.length?`coords * strides[${i}] + begin[${i}]`:`coords[${e-1}] * strides[${i}] + begin[${i}]`)).join(",")}this.userCode=`\n      ${r} begin = ${r}(${e});\n      ${r} strides = ${r}(${t});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${a}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:su,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{begin:s,end:a,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=i,{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:b,begin:y,end:v,strides:T}=Fp(r.shape,s,a,o,l,c,u,d,h);let x;if(m)x=uM({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||b){Pa(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const e=Ip(y,v,T),t=gF({inputs:{x:r},backend:n,attrs:{begin:y,size:e}});x=uM({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([r])){const e=n.readSync(r.dataId),t=Zh(r.shape,r.dtype,e),i=uL(p,t,T,y);x=n.makeTensorInfo(f,r.dtype,i.values)}else{const e=new tG(y,T,p);x=n.runWebGLProgram(e,[r],r.dtype)}}const _=uM({inputs:{x:x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(x),_}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:au,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{separator:r,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:c}=i,{data:u,dataSplits:d}=t,h=n.readSync(u.dataId),p=n.readSync(d.dataId),[f,m]=dL(h,p,r,s,a,o,l,c);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",m)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:ou,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{skipEmpty:r}=i,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=n.readSync(s.dataId),l=n.readSync(a.dataId)[0],[c,u,d]=hL(o,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:lu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{numBuckets:r}=i,{input:s}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=n.readSync(s.dataId),o=pL(a,r);return n.makeTensorInfo(s.shape,"int32",o)}},aG=eM({opSnippet:"return tan(x);"}),oG={kernelName:uu,backendName:"webgl",kernelFunc:aG},lG=eM({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),cG={kernelName:du,backendName:"webgl",kernelFunc:lG};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class uG{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s]*t[s];this.outputShape=n,this.rank=n.length;const i=nO(this.rank),r=function(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let r=0;r<e.length;r++)i.push(`imod(${n[r]}, ${e[r]})`);return i.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        setOutput(getA(${r}));\n      }\n    `}}function dG(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{reps:s}=i;if("string"===r.dtype||r.shape.length>5){const e=n.readSync(r.dataId),t="string"===r.dtype?e.map(e=>_d(e)):e,i=Zh(r.shape,r.dtype,t),a=mL(i,s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}const a=new uG(r.shape,s);return n.runWebGLProgram(a,[r],r.dtype)}const hG={kernelName:hu,backendName:"webgl",kernelFunc:dG};class pG{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class fG{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mG(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function gG(e){let t=1;for(;t<e;)t*=2;return t}const bG={kernelName:pu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{k:s,sorted:a}=i,o=mo().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=mo().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([r])||u<o||s>l){const e=n.readSync(r.dataId),[t,i]=gL(e,c,r.dtype,s,a);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(i.shape,i.dtype,i.values)]}if(0===s)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===u)return[r,J$({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(r.dataId),h=null!==d&&d.isPacked,p=h?n.unpackTensor(r):r,f=Ma(c)/u,m=uM({inputs:{x:p},attrs:{shape:[f,u]},backend:n});h&&mG(n,p);const g=gG(s),b=gG(u);let y=null;const v=()=>null===y?[m,m]:[m,y],T=(e,t,i)=>{const r=v(),s=new pG(i),a=[[u],[null===y?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=y;y=n.runWebGLProgram(s,r,"int32",a),mG(n,o)};for(let I=1;I<g;I*=2){const e=2*I;for(let t=I;t>=1;t/=2)T(e,t,[f,b])}for(let I=b;I>g;I/=2){const e=v(),t=new fG([f,I/2]),i=[[u],[null===y?1:0],[g]],r=y;y=n.runWebGLProgram(t,e,"int32",i),mG(n,r);const s=g/2,a=2*s;for(let n=s;n>=1;n/=2)T(a,n,y.shape)}let x=y;y=gF({inputs:{x:y},backend:n,attrs:{begin:0,size:[f,s]}}),mG(n,x);let _=yB({inputs:{x:m,indices:y},backend:n,attrs:{axis:1,batchDims:1}});mG(n,m);const S=c.slice(0,-1);S.push(s),x=y,y=uM({inputs:{x:y},attrs:{shape:S},backend:n}),mG(n,x);const w=_;return _=uM({inputs:{x:_},attrs:{shape:S},backend:n}),mG(n,w),[_,y]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yG{constructor(e,t,n,i,r,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const a="nearest"===n?1:2;let o;switch(i){case"constant":default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${o} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${r});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${r});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${t}));\n                float mapY = mapCoord(inY, float(${e}));\n\n                if (${a} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:fu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{image:r,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:l,outputShape:c}=i,[u,d,h,p]=r.shape,[f,m]=null!=c?c:[d,h],g=new yG(d,h,a,o,l,[u,f,m,p]);return n.runWebGLProgram(g,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:gu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{axis:r}=n,{x:s}=t;FD(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const a=i.readSync(s.dataId),{outputValues:o,outputShape:l,indices:c}=yL(a,r,s.shape,s.dtype);return[i.makeTensorInfo(l,s.dtype,o),i.makeTensorInfo([c.length],"int32",c)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:bu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{value:r}=t;let{axis:s}=i;s<0&&(s+=r.shape.length);const a=r,o=a.shape.length,l=r.shape[s],c=new Array(o-1);let u=0;for(let m=0;m<o;m++)m!==s&&(c[u++]=a.shape[m]);const d=[],h=new Array(o).fill(0),p=a.shape.slice();p[s]=1;const f=new Array(l);for(let m=0;m<f.length;m++){h[s]=m;const e=gF({inputs:{x:a},backend:n,attrs:{begin:h,size:p}}),t=uM({inputs:{x:e},backend:n,attrs:{shape:c}});f[m]=t,d.push(e)}return d.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _G{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,i=e.batchSize,r=e.inSize,s=e.numSegments,a=s*Math.ceil(r/n);this.outputShape=[i,a];const o=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let u="";r%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return initializationValue;\n        }\n      `);let d="";r%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${d}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${c}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${c}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${c}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG=[SM,IM,CM,AM,PM,LM,MM,FM,VM,HM,jM,XM,YM,QM,eF,iF,rF,oF,lF,cF,hF,yF,vF,TF,IF,EF,NF,jL,OF,GF,YF,t$,n$,i$,r$,s$,o$,c$,d$,y$,v$,T$,_$,I$,E$,A$,N$,D$,O$,M$,F$,B$,U$,V$,W$,X$,Z$,eB,nB,sB,oB,uB,pB,fB,gB,vB,xB,SB,HL,wB,BF,kB,EB,RB,KL,PB,OB,LB,FB,BB,UB,VB,WB,XB,YB,QB,ez,tz,nz,sz,az,oz,lz,cz,dz,fz,gz,Iz,cM,Cz,Az,Nz,Dz,_F,Lz,$z,Bz,Vz,Wz,QL,jz,qz,Xz,Yz,wF,vz,Qz,eU,nU,dM,sU,oU,uU,hU,mU,bU,vU,xU,SU,IU,CU,AU,NU,DU,LU,FU,bF,wz,BU,zU,UU,GU,VU,HU,WU,jU,KU,YU,JU,eG,nG,iG,rG,sG,_z,vM,oG,cG,hG,bG,vG,xM,TG,xG,{kernelName:yu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,segmentIds:s}=t,{numSegments:a}=i,o=r.shape.length,l=[];let c=0;const u=pm([c],o);let d=r;null!=u&&(d=TM({inputs:{x:r},backend:n,attrs:{perm:u}}),l.push(d),c=mm(1,o)[0]);const h=_v(d.shape,c,a),p=Ma([d.shape[c]]),f=uM({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}});l.push(f);const m=Kd(r.dtype),g=(e,t,i,r,s)=>{const a=e.shape[0],o=e.shape[1],c=xv(o,s),u=new _G({windowSize:c,inSize:o,batchSize:a,numSegments:s},t),d=n.compileAndRun(u,[e,i],r);if(l.push(d),d.shape[1]===s)return d;const h=Kz({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=dG({inputs:{x:h},backend:n,attrs:{reps:[o/c]}});l.push(h),l.push(p);return g(d,t,p,r,s)},b=uM({inputs:{x:g(f,"unsortedSegmentSum",s,m,a)},backend:n,attrs:{shape:h}});let y=b;if(null!=u){l.push(b);const e=fm(u);y=TM({inputs:{x:y},backend:n,attrs:{perm:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}},Fz];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const a6 of SG)Nu(a6);
/** @license See the LICENSE file. */!function(e,t){e(t={exports:{}},t.exports)}(function(e){var t=function(e){var t,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(s6){l=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var r=t&&t.prototype instanceof g?t:g,s=Object.create(r.prototype),a=new E(i||[]);return s._invoke=function(e,t,n){var i=d;return function(r,s){if(i===p)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw s;return R()}for(n.method=r,n.arg=s;;){var a=n.delegate;if(a){var o=I(a,n);if(o){if(o===m)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=u(e,t,n);if("normal"===l.type){if(i=n.done?f:h,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=f,n.method="throw",n.arg=l.arg)}}}(e,n,a),s}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(s6){return{type:"throw",arg:s6}}}e.wrap=c;var d="suspendedStart",h="suspendedYield",p="executing",f="completed",m={};function g(){}function b(){}function y(){}var v={};l(v,s,function(){return this});var T=Object.getPrototypeOf,x=T&&T(T(A([])));x&&x!==n&&i.call(x,s)&&(v=x);var _=y.prototype=g.prototype=Object.create(v);function S(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function w(e,t){function n(r,s,a,o){var l=u(e[r],e,s);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,a,o)},function(e){n("throw",e,a,o)}):t.resolve(d).then(function(e){c.value=e,a(c)},function(e){return n("throw",e,a,o)})}o(l.arg)}var r;this._invoke=function(e,i){function s(){return new t(function(t,r){n(e,i,t,r)})}return r=r?r.then(s,s):s()}}function I(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,I(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=u(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,m;var s=r.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function A(e){if(e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:R}}function R(){return{value:t,done:!0}}return b.prototype=y,l(_,"constructor",y),l(y,"constructor",b),b.displayName=l(y,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,o,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},S(w.prototype),l(w.prototype,a,function(){return this}),e.AsyncIterator=w,e.async=function(t,n,i,r,s){void 0===s&&(s=Promise);var a=new w(c(t,n,i,r),s);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},S(_),l(_,o,"Generator"),l(_,s,function(){return this}),l(_,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=A,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return o.type="throw",o.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:A(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}});var wG=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];const IG={YOLO_V5_N_COCO:{config:{source:"https://raw.githubusercontent.com/SkalskiP/yolov5js-zoo/master/models/coco/yolov5n/model.json",classNames:wG},name:"YOLOv5n / COCO"},YOLO_V5_S_COCO:{config:{source:"https://raw.githubusercontent.com/SkalskiP/yolov5js-zoo/master/models/coco/yolov5s/model.json",classNames:wG},name:"YOLOv5s / COCO"},YOLO_V5_M_COCO:{config:{source:"https://raw.githubusercontent.com/SkalskiP/yolov5js-zoo/master/models/coco/yolov5m/model.json",classNames:wG},name:"YOLOv5m / COCO"}},kG=$e(e=>({}),{updateActivePopupTypeAction:yn,submitNewNotificationAction:_s})(({updateActivePopupTypeAction:e,submitNewNotificationAction:t})=>{const[i,r]=n.exports.useState("UPLOAD"),[s,a]=n.exports.useState("YOLO_V5_N_COCO"),[l,c]=n.exports.useState(!1),[h,p]=n.exports.useState([]),[f,m]=n.exports.useState([]),{acceptedFiles:g,getRootProps:b,getInputProps:y}=as({onDrop:e=>{const n=e.filter(e=>e.name.endsWith("json")),i=e.filter(e=>e.name.endsWith("bin")),r=e.filter(e=>e.name.endsWith("txt"));if(0===r.length&&t(vs.createErrorNotification(xs[Ts.LABELS_FILE_UPLOAD_ERROR])),1===n.length&&1===r.length&&i.length>0){const e=e=>{m(e),p([...n,...i])},s=e=>{e instanceof ms&&t(vs.createErrorNotification(xs[Ts.NON_UNIQUE_LABEL_NAMES_ERROR]))};bs.loadLabelsList(r[0],e,s)}}}),v=e=>{r(e),p([]),m([])},T="UPLOAD"===i&&(0===h.length||0===f.length);return o(hs,{title:"Load YOLOv5 model",renderContent:()=>{const e=!l&&"UPLOAD"===i,t=!l&&"DOWNLOAD"===i;return u("div",{className:"load-yolo-v5-model-popup",children:[u("div",{className:"left-container",children:[o(ki,{image:"ico/upload.png",imageAlt:"upload model weights",buttonSize:{width:40,height:40},padding:15,onClick:()=>v("UPLOAD"),externalClassName:"monochrome",isActive:"UPLOAD"===i}),o(ki,{image:"ico/download.png",imageAlt:"download model weights",buttonSize:{width:40,height:40},padding:15,onClick:()=>v("DOWNLOAD"),externalClassName:"monochrome",isActive:"DOWNLOAD"===i})]}),u("div",{className:"right-container",children:[l&&o("div",{className:"loader",children:o(Kt,{size:40,color:fn.getLeadingColor(),loading:!0})}),!l&&o("div",{className:"message",children:"DOWNLOAD"===i?"Use one of ours pretrained YOLOv5 models to speed up annotation process.":"Drag and drop your own YOLOv5 model converted to tensorflow.js format and speed up annotation process. Make sure to upload all required files: model.json, model shards as well as .txt containing list of detected classes names."}),t&&o("div",{className:"options",children:Object.entries(IG).map(([e,t])=>u("div",{className:"options-item",onClick:()=>a(e),children:[o("img",e===s?{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}:{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),t.name]},e))}),e&&o("div",{...b({className:"drop-zone"}),children:0===h.length&&0===f.length?u(d,{children:[o("input",{...y()}),o("img",{draggable:!1,alt:"upload",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:"Drop model files"}),o("p",{children:"or"}),o("p",{className:"extraBold",children:"Click here to select them"})]}):u(d,{children:[o("input",{...y()}),o("img",{draggable:!1,alt:"uploaded",src:"ico/box-closed.png"}),u("p",{className:"extraBold",children:[h.length," model files"]}),u("p",{className:"extraBold",children:[f.length," class names"]})]})})]})]})},disableAcceptButton:T,acceptLabel:"Use model!",onAccept:()=>{c(!0)},rejectLabel:"Back",onReject:()=>{e(Ve.LOAD_AI_MODEL)}})}),CG=({title:e,acceptLabel:t,onAccept:n,disableAcceptButton:i,rejectLabel:r,onReject:s,renderContent:a,renderSideMenuContent:l})=>o(hs,{title:e,renderContent:()=>u("div",{className:"generic-side-menu-popup",children:[o("div",{className:"left-container",children:l()}),o("div",{className:"right-container",children:a()})]}),acceptLabel:t,disableAcceptButton:i,onAccept:n,rejectLabel:r,onReject:s});var EG=(e=>(e.ROBOFLOW="ROBOFLOW",e.MAKESENSE="MAKESENSE",e))(EG||{});const AG={[EG.ROBOFLOW]:{name:"Roboflow Inference Server",imageSrc:"ico/roboflow-logo.png",imageAlt:"roboflow-inference-server",isDisabled:!1},[EG.MAKESENSE]:{name:"Make Sense Inference Server",imageSrc:"ico/make-sense-ico-transparent.png",imageAlt:"make-sense-inference-server",isDisabled:!0}},RG=$e(e=>({roboflowAPIDetails:e.ai.roboflowAPIDetails}),{submitNewNotificationAction:_s,updateRoboflowAPIDetailsAction:function(e){return{type:en.UPDATE_ROBOFLOW_API_DETAILS,payload:{roboflowAPIDetails:e}}}})(({roboflowAPIDetails:e,submitNewNotificationAction:t,updateRoboflowAPIDetailsAction:i})=>{const[r,s]=n.exports.useState(EG.ROBOFLOW),[a,l]=n.exports.useState(!1),[c,h]=n.exports.useState(e.model),[p,f]=n.exports.useState(e.key),m=()=>!!a||(r!==EG.ROBOFLOW||(""===c||""===p)),g=e=>{h(e.target.value)},b=e=>{f(e.target.value)};return o(CG,{title:AG[r].name,renderContent:()=>a?o("div",{className:"loader",children:o(Kt,{size:40,color:fn.getLeadingColor(),loading:!0})}):r===EG.ROBOFLOW?u(d,{children:[o("div",{className:"message",children:"Provide details of the Roboflow model you want to run over tha API, as well as your API key."}),u("div",{className:"details",children:[o(Is,{variant:"standard",id:"roboflow-model",autoComplete:"off",autoFocus:!0,type:"text",margin:"dense",label:"roboflow model",value:c,onChange:g,style:{width:280},InputLabelProps:{shrink:!0}}),o(Is,{variant:"standard",id:"roboflow-api- key",autoComplete:"off",autoFocus:!0,type:"password",margin:"dense",label:"roboflow api key",value:p,onChange:b,style:{width:280},InputLabelProps:{shrink:!0}})]})]}):o("div",{className:"load-model-popup-content"}),renderSideMenuContent:()=>Object.entries(AG).map(([e,n],i)=>{return o(ki,{image:n.imageSrc,imageAlt:n.imageAlt,buttonSize:{width:40,height:40},padding:20,onClick:(a=e,()=>{AG[a].isDisabled?t(vs.createMessageNotification(xs[Ts.UNSUPPORTED_INFERENCE_SERVER_MESSAGE])):s(a)}),isActive:r===e,isDisabled:n.isDisabled},i);var a}),acceptLabel:"Connect",onAccept:()=>{m()||l(!0)},disableAcceptButton:m(),rejectLabel:"Back",onReject:()=>{vi.close()}})}),NG=$e(e=>({activePopupType:e.general.activePopupType}))(({activePopupType:e})=>e&&o("div",{className:"PopupView",children:(()=>{switch(e){case Ve.LOAD_LABEL_NAMES:return o(Ss,{});case Ve.EXPORT_ANNOTATIONS:return o(xa,{});case Ve.IMPORT_ANNOTATIONS:return o(aa,{});case Ve.INSERT_LABEL_NAMES:return o(ks,{isUpdate:!1});case Ve.UPDATE_LABEL:return o(ks,{isUpdate:!0});case Ve.EXIT_PROJECT:return o(Cs,{});case Ve.IMPORT_IMAGES:return o(Es,{});case Ve.LOAD_AI_MODEL:return o(wa,{});case Ve.LOAD_YOLO_V5_MODEL:return o(kG,{});case Ve.CONNECT_AI_MODEL_VIA_API:return o(RG,{});case Ve.SUGGEST_LABEL_NAMES:return o(Ds,{});case Ve.LOADER:return o(Kt,{size:50,color:fn.getLeadingColor(),loading:!0});default:return null}})()})),PG=$e(e=>({size:e.general.windowSize}),{})(({size:e})=>{const[t,i]=n.exports.useState(0),r=e=>e.map(e=>o("div",{className:"EditorFeaturesTiles",children:u("div",{className:"EditorFeaturesTilesWrapper",children:[o("img",{draggable:!1,alt:e.imageAlt,src:e.imageSrc}),o("div",{className:"EditorFeatureLabel",children:e.displayText})]})},e.displayText)),s=u("div",{className:C("MobileTopNavigationBar",{Hide:t<350,Show:t>=350}),children:[o("div",{className:"NavigationBarGroupWrapper",children:u("div",{className:"Header",children:[o("img",{draggable:!1,alt:"make-sense",src:"/make-sense-ico-transparent.png"}),"Make Sense"]})}),o("div",{className:"TriangleHorizontal Bottom",children:o("div",{className:"TriangleHorizontalContent"})})]}),a=u("div",{className:"FirstStage",children:[o("img",{draggable:!1,alt:"main-logo",src:"ico/main-image-color.png"}),o("div",{className:"TriangleHorizontal Bottom",children:o("div",{className:"TriangleHorizontalContent"})})]}),l=o("div",{className:"SecondStage",children:r(cr.slice(0,3))}),c=u("div",{className:"ThirdStage",children:[r(cr.slice(3,6)),o("div",{className:"TriangleHorizontal Top",children:o("div",{className:"TriangleHorizontalContent"})}),o("div",{className:"TriangleHorizontal Bottom",children:o("div",{className:"TriangleHorizontalContent"})})]}),d=u("div",{className:"FourthStage",children:[o("div",{className:"Message",children:"Due to the small size of the screen we do not support our editor on mobile devices. Check what you missed and visit us from a desktop."}),o("div",{className:"SocialMediaWrapper",children:(h={width:40,height:40},lr.map((e,t)=>o(ki,{buttonSize:h,image:e.imageSrc,imageAlt:e.imageAlt,href:e.href},t)))})]});var h;return u("div",{className:"MobileMainView",children:[s,o(Bt,{onScrollFrame:e=>{i(e.scrollTop)},children:u("div",{className:"MobileMainViewContent",style:{width:e.width},children:[a,l,c,d]})})]})}),DG=()=>u("div",{className:"SizeItUpView",children:[o("p",{className:"extraBold",children:"Ops... This window is to tight for me!"}),o("img",{draggable:!1,alt:"small_window",src:"ico/small_window.png"}),u("p",{className:"extraBold",children:["Please... make it at least ",We.EDITOR_MIN_WIDTH," x ",We.EDITOR_MIN_HEIGHT," px."]})]}),OG={deleteNotificationByIdAction:function(e){return{type:en.DELETE_NOTIFICATION_BY_ID,payload:{id:e}}}},LG=$e(e=>({queue:e.notifications.queue}),OG)(e=>{const[t,i]=n.exports.useState("IDLE");e.queue.length>0&&"IDLE"===t&&i("IN");const r=e.queue[0],s=()=>{i("OUT")},a=t=>{switch(t.animationName){case"animation-in":i("DISPLAY");break;case"animation-display":i("OUT");break;case"animation-out":e.deleteNotificationByIdAction(r.id),i("IDLE")}};return"IDLE"!==t?r&&o("div",{className:C("notification-wrapper",{in:"IN"===t,display:"DISPLAY"===t,out:"OUT"===t}),onAnimationEnd:a,onClick:s,children:u("div",{className:C("notification",{error:r.type===ys.ERROR,success:r.type===ys.SUCCESS,message:r.type===ys.MESSAGE,warning:r.type===ys.WARNING}),children:[o("div",{className:"header",children:r.header}),o("div",{className:"content",children:r.description}),o("div",{className:"loader"})]})},r.id):null});class MG{static formatTimeWithFrame(e,t=30){const n=Math.floor(e/3600),i=Math.floor(e%3600/60),r=Math.floor(e%60),s=Math.floor(e%1*1e3),a=Math.floor(e*t);return{formattedTime:`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}.${s.toString().padStart(3,"0")}`,frame:a}}static formatTime(e){const{formattedTime:t}=MG.formatTimeWithFrame(e);return t}static parseTimestamp(e){if(e.endsWith("s")&&!e.includes(":"))return parseFloat(e.slice(0,-1));const t=e.split(":");if(3!==t.length)return 0;const[n,i,r]=t,s=r.split("."),a=parseInt(s[0]),o=s.length>1?parseInt(s[1])/1e3:0;return 3600*parseInt(n)+60*parseInt(i)+a+o}static calculateFrame(e,t=30){return Math.floor(e*t)}}const FG=["#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF"];class $G extends i.Component{constructor(e){super(e),t(this,"dropdownLabel"),t(this,"dropdown"),t(this,"dropdownMargin",4),t(this,"dropdownOptionHeight",30),t(this,"dropdownOptionCount",6),t(this,"markerRef"),t(this,"colorPickerRef"),t(this,"openDropdown",()=>{0===Nn.getLabelNames().length?this.props.updateActivePopupType(Ve.UPDATE_LABEL):(this.setState({isOpen:!0}),window.addEventListener(Pn.MOUSE_DOWN,this.closeDropdown))}),t(this,"closeDropdown",e=>{const t={x:e.clientX,y:e.clientY},n=this.dropdown.getBoundingClientRect(),i={x:n.left,y:n.top,width:n.width,height:n.height};Gt.isPointInside(i,t)||(this.setState({isOpen:!1}),window.removeEventListener(Pn.MOUSE_DOWN,this.closeDropdown))}),t(this,"getDropdownStyle",()=>{if(!this.dropdownLabel)return{};const e=this.dropdownLabel.getBoundingClientRect(),t=Math.min(this.props.options.length,this.dropdownOptionCount)*this.dropdownOptionHeight,n={width:e.width,height:t,left:e.left,zIndex:1e3,minWidth:Math.max(e.width,150)};return 2*window.innerHeight/3<e.top?Object.assign(n,{top:e.top-this.dropdownMargin-t}):Object.assign(n,{top:e.bottom+this.dropdownMargin})}),t(this,"getDropdownOptions",()=>{const e=e=>t=>{this.setState({isOpen:!1}),window.removeEventListener(Pn.MOUSE_DOWN,this.closeDropdown),this.props.onSelectLabel(this.props.id,e),this.props.updateHighlightedLabelId(null),this.props.updateActiveLabelId(this.props.id),t.stopPropagation()};return this.props.options.map(t=>o("div",{className:"DropdownOption",style:{height:this.dropdownOptionHeight},onClick:e(t.id),children:I.exports.truncate(t.name,{length:We.MAX_DROPDOWN_OPTION_LENGTH})},t.id))}),t(this,"mouseEnterHandler",()=>{this.props.updateHighlightedLabelId(this.props.id)}),t(this,"mouseLeaveHandler",()=>{this.props.updateHighlightedLabelId(null)}),t(this,"onClickHandler",e=>{this.props.updateActiveLabelId(this.props.id),this.props.onJumpToStartFrame&&"number"==typeof this.props.startFrame&&(e.stopPropagation(),this.props.onJumpToStartFrame(this.props.startFrame))}),t(this,"openColorPicker",e=>{e.stopPropagation(),this.setState({isColorPickerOpen:!0}),window.addEventListener("mousedown",this.closeColorPicker)}),t(this,"closeColorPicker",e=>{var t,n;const i=e.clientX,r=e.clientY,s=null==(t=this.colorPickerRef)?void 0:t.getBoundingClientRect(),a=null==(n=this.markerRef)?void 0:n.getBoundingClientRect();!s||i>=s.left&&i<=s.right&&r>=s.top&&r<=s.bottom||!a||i>=a.left&&i<=a.right&&r>=a.top&&r<=a.bottom||(this.setState({isColorPickerOpen:!1}),window.removeEventListener("mousedown",this.closeColorPicker))}),t(this,"getColorPickerStyle",()=>{if(!this.markerRef)return{};const e=this.markerRef.getBoundingClientRect();return{position:"absolute",top:e.bottom+4,left:e.left,display:"flex",background:"#fff",padding:4,boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:4,zIndex:2e3}}),t(this,"getColorOptions",()=>FG.map(e=>o("div",{style:{backgroundColor:e,width:20,height:20,margin:4,cursor:"pointer",border:"1px solid #ccc"},onClick:t=>{var n,i;t.stopPropagation(),null==(i=(n=this.props).onChangeColor)||i.call(n,this.props.id,e),this.setState({isColorPickerOpen:!1}),window.removeEventListener("mousedown",this.closeColorPicker)}},e))),this.state={animate:!1,isOpen:!1,isColorPickerOpen:!1}}componentDidMount(){requestAnimationFrame(()=>{this.setState({animate:!0})})}getClassName(){return C("LabelInputField",{loaded:this.state.animate,active:this.props.isActive,highlighted:this.props.isHighlighted})}render(){const{size:e,id:t,value:n,onDelete:i,startTimestamp:r,endTimestamp:s,startFrame:a,endFrame:l,onSetTimestampToCurrentTime:c,onSetEndTimestampToCurrentTime:h,onJumpToStartFrame:p,onJumpToEndFrame:f}=this.props,m=e=>{try{const t=MG.parseTimestamp(e);return MG.formatTime(t)}catch(t){return e}},g=r||"number"==typeof a?u("div",{className:"TimeDisplay",children:[u("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r?o("div",{className:"TimeStamp",onClick:()=>{c&&c()},children:m(r)}):null,"number"==typeof a&&u("div",{className:"FrameInfo",style:{fontSize:"11px",color:"#888",marginTop:2},onClick:p?e=>{e.stopPropagation(),p(a)}:void 0,children:["Frame: ",a]}),o("div",{className:"LabelTag",style:{fontSize:"11px",color:"#666",marginTop:2},children:"start"})]}),(s||"number"==typeof l)&&u(d,{children:[o("span",{children:" - "}),u("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[s?o("div",{className:"TimeStamp",onClick:()=>{h&&h()},children:m(s)}):null,"number"==typeof l&&u("div",{className:"FrameInfo",style:{fontSize:"11px",color:"#888",marginTop:2},onClick:f?e=>{e.stopPropagation(),f(l)}:void 0,children:["Frame: ",l]}),o("div",{className:"LabelTag",style:{fontSize:"11px",color:"#666",marginTop:2},children:"end"})]})]})]}):null;return o("div",{className:this.getClassName(),style:{width:e.width,height:e.height},onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler,onClick:this.onClickHandler,children:o("div",{className:"LabelInputFieldWrapper",style:{width:e.width,height:e.height},children:u("div",{className:"Content Content--flex",children:[u("div",{className:"ContentLeft",children:[o("div",{className:"DropdownLabel",ref:e=>this.dropdownLabel=e,onClick:this.openDropdown,children:n?I.exports.truncate(n.name,{length:We.MAX_DROPDOWN_OPTION_LENGTH}):"Select label"}),this.state.isOpen&&o("div",{className:"Dropdown",style:this.getDropdownStyle(),ref:e=>this.dropdown=e,children:o(Bt,{renderTrackHorizontal:e=>o("div",{...e,className:"track-horizontal"}),children:o("div",{children:this.getDropdownOptions()})})})]}),o("div",{className:"ContentCenter",children:g}),u("div",{className:"ContentRight",children:[o("div",{className:"Marker",ref:e=>this.markerRef=e,onClick:this.openColorPicker,style:n?{backgroundColor:n.color,width:28,height:28,minWidth:28,minHeight:28,marginRight:8,borderRadius:4,cursor:"pointer"}:{width:28,height:28,minWidth:28,minHeight:28,marginRight:8,background:"transparent",cursor:"pointer"}}),this.state.isColorPickerOpen&&o("div",{className:"ColorPicker",style:this.getColorPickerStyle(),ref:e=>this.colorPickerRef=e,children:this.getColorOptions()}),o(ki,{externalClassName:"icon",image:"ico/trash.png",imageAlt:"remove label",buttonSize:{width:28,height:28},onClick:()=>i(t)})]})]})})},t)}}const BG=$e(e=>({}),{updateHighlightedLabelId:sn,updateActiveLabelId:rn,updateActivePopupType:yn})($G),zG=$e(e=>({firstLabelCreatedFlag:e.labels.firstLabelCreatedFlag}),{})(({firstLabelCreatedFlag:e,labelBefore:t,labelAfter:n})=>{const i=u(d,{children:[o("img",{draggable:!1,alt:"lets_start",src:"ico/rocket.png"}),o("p",{className:"extraBold",children:t})]});return o("div",{className:"EmptyLabelList",children:e?u(d,{children:[o("img",{draggable:!1,alt:"no_labels",src:"ico/box-opened.png"}),o("p",{className:"extraBold",children:n})]}):i})}),UG=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn,updateLabelNamesAction:un,jumpToFrame:wn})(({size:e,imageData:t,updateImageDataByIdAction:r,labelNames:s,updateLabelNamesAction:a,updateActiveLabelNameIdAction:l,activeLabelId:c,highlightedLabelId:u,updateActiveLabelIdAction:d,onTimeChange:h,onJumpToTime:p,jumpToFrame:f})=>{const m=(e,n)=>{const i=t.labelRects.find(t=>t.id===e);if(!i||!i.labelId)return;const r=s.map(e=>e.id===i.labelId?{...e,color:n}:e);a(r)};i.useState(null);const g={width:e.width,height:e.height},b={width:e.width,height:80*t.labelRects.length},y=e=>{bi.deleteRectLabelById(t.id,e)},v=e=>{bi.toggleLabelVisibilityById(t.id,e)},T=(e,n)=>{const i={...t,labelRects:t.labelRects.map(t=>t.id===e?{...t,labelId:n,status:zn.ACCEPTED}:t)};r(t.id,i),l(n)},x=n.exports.useRef(null),_=n.exports.useMemo(()=>[...t.labelRects].sort((e,t)=>e.frame-t.frame),[t.labelRects]);n.exports.useEffect(()=>{if(!x.current)return;const e=t.frameIndex;let n=_.findIndex(t=>t.frame<=e&&(void 0===t.endFrame||e<=t.endFrame));n<0&&(n=_.filter(t=>t.frame<=e).length-1),n>=0&&x.current.scrollTop(80*n)},[_,t.frameIndex,80]);return o("div",{className:"RectLabelsList",style:g,onClickCapture:()=>{d(null)},children:0===t.labelRects.length?o(zG,{labelBefore:"Annotate your first behavior clip",labelAfter:"no behavior clips annotated for this video yet"}):o(Bt,{ref:x,children:o("div",{className:"RectLabelsListContent",style:b,children:_.map(n=>{const i=null!==n.labelId?I.exports.findLast(s,{id:n.labelId}):null;return o(BG,{onChangeColor:m,size:{width:e.width,height:80},isActive:n.id===c,isHighlighted:n.id===u,isVisible:n.isVisible,id:n.id,onDelete:y,value:i,options:s,onSelectLabel:T,toggleLabelVisibility:v,startTimestamp:n.timestamp,endTimestamp:n.endTimestamp,startFrame:n.frame,endFrame:n.endFrame,onSetTimestampToCurrentTime:()=>(e=>{if("number"!=typeof t.timestamp||"number"!=typeof t.frameIndex)return;const n=MG.formatTimeWithFrame(t.timestamp,t.frameIndex).formattedTime,i={...t,labelRects:t.labelRects.map(i=>i.id===e?{...i,timestamp:n,frame:t.frameIndex}:i)};r(t.id,i)})(n.id),onSetEndTimestampToCurrentTime:()=>(e=>{if("number"!=typeof t.timestamp||"number"!=typeof t.frameIndex)return;const n=MG.formatTimeWithFrame(t.timestamp,t.frameIndex).formattedTime,i={...t,labelRects:t.labelRects.map(i=>i.id===e?{...i,endTimestamp:n,endFrame:t.frameIndex}:i)};r(t.id,i)})(n.id),onJumpToStartFrame:"number"==typeof n.frame?e=>f(n.frame):void 0,onJumpToEndFrame:"number"==typeof n.endFrame?e=>f(n.endFrame):void 0},n.id)})})})})}),GG=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelPoints.length},d=e=>{bi.deletePointLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelPoints:t.labelPoints.map(t=>t.id===e?{...t,labelId:i}:t)};n(t.id,s),r(i)};return o("div",{className:"PointLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelPoints.filter(e=>e.status===zn.ACCEPTED).length?o(zG,{labelBefore:"mark your first point",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"PointLabelsListContent",style:u,children:t.labelPoints.filter(e=>e.status===zn.ACCEPTED).map(t=>o(BG,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),VG=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelPolygons.length},d=e=>{bi.deletePolygonLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelPolygons:t.labelPolygons.map(t=>t.id===e?{...t,labelId:i}:t)};n(t.id,s),r(i)};return o("div",{className:"PolygonLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelPolygons.length?o(zG,{labelBefore:"draw your first polygon",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"PolygonLabelsListContent",style:u,children:t.labelPolygons.map(t=>o(BG,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),HG=$e(e=>({activeLabelId:e.labels.activeLabelId,highlightedLabelId:e.labels.highlightedLabelId,labelNames:e.labels.labels}),{updateImageDataByIdAction:on,updateActiveLabelNameIdAction:nn,updateActiveLabelIdAction:rn})(({size:e,imageData:t,updateImageDataByIdAction:n,labelNames:i,updateActiveLabelNameIdAction:r,activeLabelId:s,highlightedLabelId:a,updateActiveLabelIdAction:l})=>{const c={width:e.width,height:e.height},u={width:e.width,height:40*t.labelLines.length},d=e=>{bi.deleteLineLabelById(t.id,e)},h=e=>{bi.toggleLabelVisibilityById(t.id,e)},p=(e,i)=>{const s={...t,labelLines:t.labelLines.map(t=>t.id===e?{...t,labelId:i}:t)};n(t.id,s),r(i)};return o("div",{className:"LineLabelsList",style:c,onClickCapture:()=>{l(null)},children:0===t.labelLines.length?o(zG,{labelBefore:"draw your first line",labelAfter:"no labels created for this image yet"}):o(Bt,{children:o("div",{className:"LineLabelsListContent",style:u,children:t.labelLines.map(t=>o(BG,{size:{width:e.width,height:40},isActive:t.id===s,isHighlighted:t.id===a,isVisible:t.isVisible,id:t.id,onDelete:d,value:null!==t.labelId?I.exports.findLast(i,{id:t.labelId}):null,options:i,onSelectLabel:p,toggleLabelVisibility:h},t.id))})})})}),WG=$e(e=>({labelNames:e.labels.labels}),{updateImageDataById:on,updateActivePopupType:yn})(({size:e,imageData:t,updateImageDataById:n,labelNames:i,updateActivePopupType:r})=>{const s={width:e.width,height:e.height},a={width:e.width,height:40*t.labelPolygons.length},l=()=>{r(Ve.UPDATE_LABEL)};return o("div",{className:"TagLabelsList",style:s,children:0===i.length?u("div",{className:"EmptyLabelList",onClick:l,children:[o("img",{draggable:!1,alt:"upload",src:"ico/type-writer.png"}),o("p",{className:"extraBold",children:"Your label list is empty"})]},"empty-label-list"):o(Bt,{children:o("div",{className:"TagLabelsListContent",style:a,children:[...i.map(e=>{return o("div",{className:(i=e.id,C("TagItem",{active:t.labelNameIds.includes(i)})),onClickCapture:()=>(e=>{t.labelNameIds.includes(e)?n(t.id,{...t,labelNameIds:I.exports.remove(t.labelNameIds,t=>t!==e)}):n(t.id,{...t,labelNameIds:t.labelNameIds.concat(e)})})(e.id),children:e.name},e.id);var i}),o(ki,{image:"ico/plus.png",imageAlt:"plus",buttonSize:{width:32,height:32},onClick:l})]},"tag-labels-list-content")})},"tag-labels-list")});class jG extends i.Component{constructor(e){super(e),t(this,"labelsToolkitRef"),t(this,"tabs"),t(this,"updateToolkitSize",()=>{if(!this.labelsToolkitRef)return;const e=this.labelsToolkitRef.getBoundingClientRect();this.setState({size:{width:e.width,height:e.height}})}),t(this,"headerClickHandler",e=>{this.props.updateActiveLabelType(e),this.props.updateActiveLabelId(null)}),t(this,"renderChildren",()=>{const{size:e}=this.state,{activeImageIndex:t,imagesData:n,activeLabelType:i}=this.props;return this.tabs.reduce((r,s,a)=>{const l=s===i,c=I.exports.find(Ii,{labelType:s}),d=e.height-this.tabs.length*We.TOOLKIT_TAB_HEIGHT_PX,h=e=>C(e,{active:l}),p=u("div",{className:h("Header"),onClick:()=>this.headerClickHandler(s),style:{height:We.TOOLKIT_TAB_HEIGHT_PX},children:[o("div",{className:"Marker"}),u("div",{className:"HeaderGroupWrapper",children:[o("img",{draggable:!1,className:"Ico",src:c.imageSrc,alt:c.imageAlt}),c.headerText]}),o("div",{className:"HeaderGroupWrapper",children:o("img",{draggable:!1,className:"Arrow",src:"ico/down.png",alt:"down_arrow"})})]},"Header_"+a),f=u("div",{className:h("Content"),style:{height:l?d:0},children:[s===je.RECT&&o(UG,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.POINT&&o(GG,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.LINE&&o(HG,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.POLYGON&&o(VG,{size:{width:e.width-20,height:d-20},imageData:n[t]}),s===je.VIDEO_RECOGNITION&&o(WG,{size:{width:e.width-20,height:d-20},imageData:n[t]})]},"Content_"+a);return r.push([p,f]),r},[])}),this.state={size:null},this.tabs=e.projectType===ri.VIDEO_RECOGNITION?[je.VIDEO_RECOGNITION]:[je.RECT];const n=e.activeLabelType?e.activeLabelType:this.tabs[0];e.updateActiveLabelType(n)}componentDidMount(){this.updateToolkitSize(),window.addEventListener(Pn.RESIZE,this.updateToolkitSize)}componentWillUnmount(){window.removeEventListener(Pn.RESIZE,this.updateToolkitSize)}render(){return o("div",{className:"LabelsToolkit",ref:e=>this.labelsToolkitRef=e,onClick:()=>_i.switchCtx(bn.RIGHT_NAVBAR),children:this.state.size&&this.renderChildren()})}}const qG=$e(e=>({activeImageIndex:e.labels.activeImageIndex,activeLabelType:e.labels.activeLabelType,imagesData:e.labels.imagesData,projectType:e.general.projectData.type}),{updateImageDataById:on,updateActiveLabelType:an,updateActiveLabelId:rn})(jG),XG=e=>{const{direction:t,isOpen:n,isWithContext:i,renderContent:r,renderCompanion:s}=e;return u("div",{className:C("SideNavigationBar",{left:t===Ge.LEFT,right:t===Ge.RIGHT,"with-context":i,closed:!n}),children:[o("div",{className:"CompanionBar",children:s&&s()}),n&&o("div",{className:"NavigationBarContentWrapper",children:r&&r()})]})},KG=e=>{const{key:t,label:n,onClick:i,style:r,isActive:s,isDisabled:a,image:l,imageAlt:c}=e;return u("div",{className:C("VerticalEditorButton",{active:s,disabled:a}),onClick:i||void 0,style:r,children:[l&&o("img",{draggable:!1,alt:c,src:l}),n]},t)};var YG,ZG="undefined"!=typeof window?window:void 0!==S?S:"undefined"!=typeof self?self:{},QG=void 0!==S?S:"undefined"!=typeof window?window:{},JG=wg;"undefined"!=typeof document?YG=document:(YG=QG["__GLOBAL_DOCUMENT_CACHE@4"])||(YG=QG["__GLOBAL_DOCUMENT_CACHE@4"]=JG);var eV=YG,tV={exports:{}},nV=function(e){if(!e)return!1;var t=iV.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},iV=Object.prototype.toString;function rV(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return sV(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sV(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function sV(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var aV=function(){function e(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},t.addInterceptor=function(e,t){this.typeToInterceptorsMap_.has(e)||this.typeToInterceptorsMap_.set(e,new Set);var n=this.typeToInterceptorsMap_.get(e);return!n.has(t)&&(n.add(t),!0)},t.removeInterceptor=function(e,t){var n=this.typeToInterceptorsMap_.get(e);return!(!n||!n.has(t))&&(n.delete(t),!0)},t.clearInterceptorsByType=function(e){return!!this.typeToInterceptorsMap_.get(e)&&(this.typeToInterceptorsMap_.delete(e),this.typeToInterceptorsMap_.set(e,new Set),!0)},t.clear=function(){return!!this.typeToInterceptorsMap_.size&&(this.typeToInterceptorsMap_=new Map,!0)},t.getForType=function(e){return this.typeToInterceptorsMap_.get(e)||new Set},t.execute=function(e,t){for(var n,i=rV(this.getForType(e));!(n=i()).done;){var r=n.value;try{t=r(t)}catch(r6){}}return t},e}(),oV=function(){function e(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},t.getMaxAttempts=function(){return this.maxAttempts_},t.setMaxAttempts=function(e){this.maxAttempts_=e},t.getDelayFactor=function(){return this.delayFactor_},t.setDelayFactor=function(e){this.delayFactor_=e},t.getFuzzFactor=function(){return this.fuzzFactor_},t.setFuzzFactor=function(e){this.fuzzFactor_=e},t.getInitialDelay=function(){return this.initialDelay_},t.setInitialDelay=function(e){this.initialDelay_=e},t.createRetry=function(e){var t=void 0===e?{}:e,n=t.maxAttempts,i=t.delayFactor,r=t.fuzzFactor,s=t.initialDelay;return new lV({maxAttempts:n||this.maxAttempts_,delayFactor:i||this.delayFactor_,fuzzFactor:r||this.fuzzFactor_,initialDelay:s||this.initialDelay_})},e}(),lV=function(){function e(e){this.maxAttempts_=e.maxAttempts,this.delayFactor_=e.delayFactor,this.fuzzFactor_=e.fuzzFactor,this.currentDelay_=e.initialDelay,this.currentAttempt_=1}var t=e.prototype;return t.moveToNextAttempt=function(){this.currentAttempt_++;var e=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+e},t.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},t.getCurrentDelay=function(){return this.currentDelay_},t.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},t.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},t.getCurrentFuzzedDelay=function(){var e=this.getCurrentMinPossibleDelay(),t=this.getCurrentMaxPossibleDelay();return e+Math.random()*(t-e)},e}(),cV=ZG;var uV=function(e,t){return void 0===t&&(t=!1),function(n,i,r){if(n)e(n);else if(i.statusCode>=400&&i.statusCode<=599){var s=r;if(t)if(cV.TextDecoder){var a=function(e){void 0===e&&(e="");return e.toLowerCase().split(";").reduce(function(e,t){var n=t.split("="),i=n[0],r=n[1];return"charset"===i.trim()?r.trim():e},"utf-8")}(i.headers&&i.headers["content-type"]);try{s=new TextDecoder(a).decode(r)}catch(r6){}}else s=String.fromCharCode.apply(null,new Uint8Array(r));e({cause:s})}else e(null,r)}},dV=ZG,hV=y,pV=nV,fV=aV,mV=oV;yV.httpHandler=uV,yV.requestInterceptorsStorage=new fV,yV.responseInterceptorsStorage=new fV,yV.retryManager=new mV;
/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Björklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */
var gV=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var n=e.indexOf(":"),i=e.slice(0,n).trim().toLowerCase(),r=e.slice(n+1).trim();void 0===t[i]?t[i]=r:Array.isArray(t[i])?t[i].push(r):t[i]=[t[i],r]}),t):t};function bV(e,t,n){var i=e;return pV(t)?(n=t,"string"==typeof e&&(i={uri:e})):i=hV({},t,{uri:e}),i.callback=n,i}function yV(e,t,n){return vV(t=bV(e,t,n))}function vV(e){if(void 0===e.callback)throw new Error("callback argument missing");if(e.requestType&&yV.requestInterceptorsStorage.getIsEnabled()){var t={uri:e.uri||e.url,headers:e.headers||{},body:e.body,metadata:e.metadata||{},retry:e.retry,timeout:e.timeout},n=yV.requestInterceptorsStorage.execute(e.requestType,t);e.uri=n.uri,e.headers=n.headers,e.body=n.body,e.metadata=n.metadata,e.retry=n.retry,e.timeout=n.timeout}var i=!1,r=function(t,n,r){i||(i=!0,e.callback(t,n,r))};function s(){var e=void 0;if(e=u.response?u.response:u.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(r6){}return null}(u),b)try{e=JSON.parse(e)}catch(r6){}return e}function a(t){if(clearTimeout(d),clearTimeout(e.retryTimeout),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,c||!yV.retryManager.getIsEnabled()||!e.retry||!e.retry.shouldRetry()){if(e.requestType&&yV.responseInterceptorsStorage.getIsEnabled()){var n={headers:y.headers||{},body:y.body,responseUrl:u.responseURL,responseType:u.responseType},i=yV.responseInterceptorsStorage.execute(e.requestType,n);y.body=i.body,y.headers=i.headers}return r(t,y)}e.retryTimeout=setTimeout(function(){e.retry.moveToNextAttempt(),e.xhr=u,vV(e)},e.retry.getCurrentFuzzedDelay())}function o(){if(!c){var t;clearTimeout(d),clearTimeout(e.retryTimeout),t=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var n=y,i=null;if(0!==t?(n={body:s(),statusCode:t,method:p,headers:{},url:h,rawRequest:u},u.getAllResponseHeaders&&(n.headers=gV(u.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),e.requestType&&yV.responseInterceptorsStorage.getIsEnabled()){var a={headers:n.headers||{},body:n.body,responseUrl:u.responseURL,responseType:u.responseType},o=yV.responseInterceptorsStorage.execute(e.requestType,a);n.body=o.body,n.headers=o.headers}return r(i,n,n.body)}}var l,c,u=e.xhr||null;u||(u=e.cors||e.useXDR?new yV.XDomainRequest:new yV.XMLHttpRequest);var d,h=u.url=e.uri||e.url,p=u.method=e.method||"GET",f=e.body||e.data,m=u.headers=e.headers||{},g=!!e.sync,b=!1,y={body:void 0,headers:{},statusCode:0,method:p,url:h,rawRequest:u};if("json"in e&&!1!==e.json&&(b=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),u.onreadystatechange=function(){4!==u.readyState||yV.responseInterceptorsStorage.getIsEnabled()||setTimeout(o,0)},u.onload=o,u.onerror=a,u.onprogress=function(){},u.onabort=function(){c=!0,clearTimeout(e.retryTimeout)},u.ontimeout=a,u.open(p,h,!g,e.username,e.password),g||(u.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(d=setTimeout(function(){if(!c){c=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}},e.timeout)),u.setRequestHeader)for(l in m)m.hasOwnProperty(l)&&u.setRequestHeader(l,m[l]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(f||null),u}tV.exports=yV,tV.exports.default=yV,yV.XMLHttpRequest=dV.XMLHttpRequest||function(){},yV.XDomainRequest="withCredentials"in new yV.XMLHttpRequest?yV.XMLHttpRequest:dV.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(e){yV["delete"===e?"del":e]=function(t,n,i){return(n=bV(t,n,i)).method=e.toUpperCase(),vV(n)}});var TV={exports:{}},xV=eV,_V=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function SV(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function wV(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+(0|i)/1e3}var n=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function IV(){this.values=_V(null)}function kV(e,t,n,i){var r=i?e.split(i):[e];for(var s in r)if("string"==typeof r[s]){var a=r[s].split(n);if(2===a.length)t(a[0].trim(),a[1].trim())}}function CV(e,t,n){var i=e;function r(){var t=wV(e);if(null===t)throw new SV(SV.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=r(),s(),"--\x3e"!==e.substr(0,3))throw new SV(SV.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),s(),t.endTime=r(),s(),function(e,t){var i=new IV;kV(e,function(e,t){switch(e){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var s=t.split(","),a=s[0];i.integer(e,a),i.percent(e,a)&&i.set("snapToLines",!1),i.alt(e,a,["auto"]),2===s.length&&i.alt("lineAlign",s[1],["start","center","end"]);break;case"position":s=t.split(","),i.percent(e,s[0]),2===s.length&&i.alt("positionAlign",s[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(r6){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(r6){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(r6){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}SV.prototype=_V(Error.prototype),SV.prototype.constructor=SV,SV.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},IV.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var EV=xV.createElement&&xV.createElement("textarea"),AV={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},RV={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},NV={v:"title",lang:"lang"},PV={rt:"ruby"};function DV(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]*>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function i(e){return EV.innerHTML=e,e=EV.textContent,EV.textContent="",e}function r(e,t){return!PV[t.localName]||PV[t.localName]===e.localName}function s(t,n){var i=AV[t];if(!i)return null;var r=e.document.createElement(i),s=NV[t];return s&&n&&(r[s]=n.trim()),r}for(var a,o=e.document.createElement("div"),l=o,c=[];null!==(a=n());)if("<"!==a[0])l.appendChild(e.document.createTextNode(i(a)));else{if("/"===a[1]){c.length&&c[c.length-1]===a.substr(2).replace(">","")&&(c.pop(),l=l.parentNode);continue}var u,d=wV(a.substr(1,a.length-2));if(d){u=e.document.createProcessingInstruction("timestamp",d),l.appendChild(u);continue}var h=a.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!h)continue;if(!(u=s(h[1],h[3])))continue;if(!r(l,u))continue;if(h[2]){var p=h[2].split(".");p.forEach(function(e){var t=/^bg_/.test(e),n=t?e.slice(3):e;if(RV.hasOwnProperty(n)){var i=t?"background-color":"color",r=RV[n];u.style[i]=r}}),u.className=p.join(" ")}c.push(h[1]),l.appendChild(u),l=u}return o}var OV=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function LV(e){for(var t=0;t<OV.length;t++){var n=OV[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function MV(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function r(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var s=n.match(/^.*(\n|\r)/);return s?(e.length=0,s[0]):n}return"ruby"===t.tagName?r(e):t.childNodes?(i(e,t),r(e)):void 0}for(i(t,e);n=r(t);)for(var s=0;s<n.length;s++)if(LV(n.charCodeAt(s)))return"rtl";return"ltr"}function FV(){}function $V(e,t,n){FV.call(this),this.cue=t,this.cueDiv=DV(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:MV(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":case"line-left":r=t.position;break;case"center":r=t.position-t.size/2;break;case"end":case"line-right":r=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function BV(e){var t,n,i,r;if(e.div){n=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var s=(s=e.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();e=e.div.getBoundingClientRect(),t=s?Math.max(s[0]&&s[0].height||0,e.height/s.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||n,this.bottom=e.bottom||r+(e.height||n),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function zV(e,t,n,i){var r=new BV(t),s=t.cue,a=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,i=0,r=0;r<n.length&&n[r]!==t;r++)"showing"===n[r].mode&&i++;return-1*++i}(s),o=[];if(s.snapToLines){var l;switch(s.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width"}var c=r.lineHeight,u=c*Math.round(a),d=n[l]+c,h=o[0];Math.abs(u)>d&&(u=u<0?-1:1,u*=Math.ceil(d/c)*c),a<0&&(u+=""===s.vertical?n.height:n.width,o=o.reverse()),r.move(h,u)}else{var p=r.lineHeight/n.height*100;switch(s.lineAlign){case"center":a-=p/2;break;case"end":a-=p}switch(s.vertical){case"":t.applyStyles({top:t.formatStyle(a,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(a,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(a,"%")})}o=["+y","-x","+x","-y"],r=new BV(t)}var f=function(e,t){for(var r,s=new BV(e),a=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(n,t[o])||e.within(n)&&e.overlapsAny(i);)e.move(t[o]);if(e.within(n))return e;var l=e.intersectPercentage(n);a>l&&(r=new BV(e),a=l),e=new BV(s)}return r||s}(r,o);t.move(f.toCSSCompatValues(n))}function UV(){}FV.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},FV.prototype.formatStyle=function(e,t){return 0===e?0:e+t},$V.prototype=_V(FV.prototype),$V.prototype.constructor=$V,BV.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},BV.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},BV.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},BV.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},BV.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},BV.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},BV.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},BV.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||n}},UV.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},UV.convertCueToDOMTree=function(e,t){return e&&t?DV(e,t):null};UV.processCues=function(e,t,n){if(!e||!t||!n)return null;for(;n.firstChild;)n.removeChild(n.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",n.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var r=[],s=BV.getSimpleBoxPosition(i),a={font:Math.round(.05*s.height*100)/100+"px sans-serif"};!function(){for(var n,o,l=0;l<t.length;l++)o=t[l],n=new $V(e,o,a),i.appendChild(n.div),zV(0,n,s,r),o.displayState=n.div,r.push(BV.getSimpleBoxPosition(n))}()}else for(var o=0;o<t.length;o++)i.appendChild(t[o].displayState)},UV.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},UV.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof SV))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){for(var e=t.buffer,n=0;n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var i=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),i}function i(e){e.match(/X-TIMESTAMP-MAP/)?kV(e,function(e,n){if("X-TIMESTAMP-MAP"===e)!function(e){var n=new IV;kV(e,function(e,t){switch(e){case"MPEGT":n.integer(e+"S",t);break;case"LOCA":n.set(e+"L",wV(t))}},/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:n.get("MPEGTS"),LOCAL:n.get("LOCAL")})}(n)},/=/):kV(e,function(e,n){if("Region"===e)!function(e){var n=new IV;if(kV(e,function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var r=new IV;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;n.set(e+"X",r.get("x")),n.set(e+"Y",r.get("y"));break;case"scroll":n.alt(e,t,["up"])}},/=/,/\s/),n.has("id")){var i=new(t.vttjs.VTTRegion||t.window.VTTRegion);i.width=n.get("width",100),i.lines=n.get("lines",3),i.regionAnchorX=n.get("regionanchorX",0),i.regionAnchorY=n.get("regionanchorY",100),i.viewportAnchorX=n.get("viewportanchorX",0),i.viewportAnchorY=n.get("viewportanchorY",100),i.scroll=n.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:n.get("id"),region:i})}}(n)},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var s=(r=n()).match(/^WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new SV(SV.Errors.BadSignature);t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=n(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(r6){t.cue.align="middle"}if(t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{CV(r,t.cue,t.regionList)}catch(r6){t.reportOrThrowError(r6),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==r.indexOf("--\x3e");if(!r||o&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":r||(t.state="ID");continue}}}catch(r6){t.reportOrThrowError(r6),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new SV(SV.Errors.BadSignature)}catch(r6){e.reportOrThrowError(r6)}return e.onflush&&e.onflush(),this}};var GV=UV,VV={"":1,lr:1,rl:1},HV={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function WV(e){return"string"==typeof e&&(!!HV[e.toLowerCase()]&&e.toLowerCase())}function jV(e,t,n){this.hasBeenReset=!1;var i="",r=!1,s=e,a=t,o=n,l=null,c="",u=!0,d="auto",h="start",p="auto",f="auto",m=100,g="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return i},set:function(e){i=""+e}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(e){r=!!e}},startTime:{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");s=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");a=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(e){o=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return l},set:function(e){l=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return c},set:function(e){var t=function(e){return"string"==typeof e&&!!VV[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");c=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return u},set:function(e){u=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return d},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");d=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return h},set:function(e){var t=WV(e);t?(h=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return p},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");p=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return f},set:function(e){var t=WV(e);t?(f=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");m=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return g},set:function(e){var t=WV(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");g=t,this.hasBeenReset=!0}}}),this.displayState=void 0}jV.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var qV=jV,XV={"":!0,up:!0};function KV(e){return"number"==typeof e&&e>=0&&e<=100}var YV=function(){var e=100,t=3,n=0,i=100,r=0,s=100,a="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!KV(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return i},set:function(e){if(!KV(e))throw new Error("RegionAnchorX must be between 0 and 100.");i=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!KV(e))throw new Error("RegionAnchorY must be between 0 and 100.");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!KV(e))throw new Error("ViewportAnchorY must be between 0 and 100.");s=e}},viewportAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!KV(e))throw new Error("ViewportAnchorX must be between 0 and 100.");r=e}},scroll:{enumerable:!0,get:function(){return a},set:function(e){var t=function(e){return"string"==typeof e&&!!XV[e.toLowerCase()]&&e.toLowerCase()}(e);!1===t?console.warn("Scroll: an invalid or illegal string was specified."):a=t}}})},ZV=ZG,QV=TV.exports={WebVTT:GV,VTTCue:qV,VTTRegion:YV};ZV.vttjs=QV,ZV.WebVTT=QV.WebVTT;var JV=QV.VTTCue,eH=QV.VTTRegion,tH=ZV.VTTCue,nH=ZV.VTTRegion;QV.shim=function(){ZV.VTTCue=JV,ZV.VTTRegion=eH},QV.restore=function(){ZV.VTTCue=tH,ZV.VTTRegion=nH},ZV.VTTCue||QV.shim();var iH="https://example.com",rH=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=ZG.location&&ZG.location.href||"");var n=/^\/\//.test(e),i=!ZG.location&&!/\/\//i.test(e);e=new ZG.URL(e,ZG.location||iH);var r=new URL(t,e);return i?r.href.slice(19):n?r.href.slice(r.protocol.length):r.href},sH=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();function aH(e){for(var t,n=(t=e,ZG.atob?ZG.atob(t):Buffer.from(t,"base64").toString("binary")),i=new Uint8Array(n.length),r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i}
/*! @name m3u8-parser @version 7.2.0 @license Apache-2.0 */class oH extends sH{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const lH=String.fromCharCode(9),cH=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),n={};return t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),n},uH=function(e){const t={};if(!e)return t;const n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let i,r=n.length;for(;r--;)""!==n[r]&&(i=/([^=]*)=(.*)/.exec(n[r]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),t[i[0]]=i[1]);return t},dH=e=>{const t=e.split("x"),n={};return t[0]&&(n.width=parseInt(t[0],10)),t[1]&&(n.height=parseInt(t[1],10)),n};class hH extends sH{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(0===(e=e.trim()).length)return;if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});this.tagMappers.reduce((t,n)=>{const i=n(e);return i===e?t:t.concat([i])},[e]).forEach(e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void this.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void this.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return n=a(cH(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"map"},t[1]){const e=uH(t[1]);e.URI&&(n.uri=e.URI),e.BYTERANGE&&(n.byterange=cH(e.BYTERANGE))}this.trigger("data",n)}else{if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t)return n={type:"tag",tagType:"stream-inf"},t[1]&&(n.attributes=uH(t[1]),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=dH(n.attributes.RESOLUTION)),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=uH(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=uH(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=uH(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"skip"},n.attributes=uH(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(lH)),void this.trigger("data",n);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part"},n.attributes=uH(t[1]),["DURATION"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["INDEPENDENT","GAP"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=cH(n.attributes.BYTERANGE)),void this.trigger("data",n);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"server-control"},n.attributes=uH(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))}),void this.trigger("data",n);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part-inf"},n.attributes=uH(t[1]),["PART-TARGET"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),void this.trigger("data",n);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"preload-hint"},n.attributes=uH(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(e){if(n.attributes.hasOwnProperty(e)){n.attributes[e]=parseInt(n.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[t]=n.attributes[e],delete n.attributes[e]}}),void this.trigger("data",n);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"rendition-report"},n.attributes=uH(t[1]),["LAST-MSN","LAST-PART"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseInt(n.attributes[e],10))}),void this.trigger("data",n);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=uH(t[1]),["ID","CLASS"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=String(n.attributes[e]))}),["START-DATE","END-DATE"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=new Date(n.attributes[e]))}),["DURATION","PLANNED-DURATION"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["END-ON-NEXT"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/i.test(n.attributes[e]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=n.attributes[e].toString(16))});const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in n.attributes){if(!e.test(t))continue;const i=/[0-9A-Fa-f]{6}/g.test(n.attributes[t]),r=/^\d+(\.\d+)?$/.test(n.attributes[t]);n.attributes[t]=i?n.attributes[t].toString(16):r?parseFloat(n.attributes[t]):String(n.attributes[t])}return void this.trigger("data",n)}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t)this.trigger("data",{type:"tag",tagType:"independent-segments"});else if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"i-frames-only"});else{if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(e),t)return n={type:"tag",tagType:"content-steering"},n.attributes=uH(t[1]),void this.trigger("data",n);if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(e),t)return n={type:"tag",tagType:"i-frame-playlist"},n.attributes=uH(t[1]),n.attributes.URI&&(n.uri=n.attributes.URI),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=dH(n.attributes.RESOLUTION)),n.attributes["AVERAGE-BANDWIDTH"]&&(n.attributes["AVERAGE-BANDWIDTH"]=parseInt(n.attributes["AVERAGE-BANDWIDTH"],10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),void this.trigger("data",n);if(t=/^#EXT-X-DEFINE:(.*)$/.exec(e),t)return n={type:"tag",tagType:"define"},n.attributes=uH(t[1]),void this.trigger("data",n);this.trigger("data",{type:"tag",data:e.slice(4)})}}}}else this.trigger("data",{type:"comment",text:e.slice(1)})})}addParser({expression:e,customType:t,dataParser:n,segment:i}){"function"!=typeof n&&(n=e=>e),this.customParsers.push(r=>{if(e.exec(r))return this.trigger("data",{type:"custom",data:n(r),customType:t,segment:i}),!0})}addTagMapper({expression:e,map:t}){this.tagMappers.push(n=>e.test(n)?t(n):n)}}const pH=function(e){const t={};return Object.keys(e).forEach(function(n){var i;t[(i=n,i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()))]=e[n]}),t},fH=function(e){const{serverControl:t,targetDuration:n,partTargetDuration:i}=e;if(!t)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=n&&3*n,l=i&&2*i;n&&!t.hasOwnProperty(s)&&(t[s]=o,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&t[s]<o&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${t[s]}) to targetDuration * 3 (${o})`}),t[s]=o),i&&!t.hasOwnProperty(a)&&(t[a]=3*i,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[a]}).`})),i&&t[a]<l&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${t[a]}) to partTargetDuration * 2 (${l}).`}),t[a]=l)};class mH extends sH{constructor(e={}){super(),this.lineStream=new oH,this.parseStream=new hH,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,n=[];let i,r,s={},o=!1;const l=function(){},c={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let u=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let d=0,h=0;const p={};this.on("end",()=>{s.uri||!s.parts&&!s.preloadHints||(!s.map&&i&&(s.map=i),!s.key&&r&&(s.key=r),s.timeline||"number"!=typeof u||(s.timeline=u),this.manifest.preloadSegment=s)}),this.parseStream.on("data",function(e){let f,m;if(t.manifest.definitions)for(const n in t.manifest.definitions)if(e.uri&&(e.uri=e.uri.replace(`{$${n}}`,t.manifest.definitions[n])),e.attributes)for(const i in e.attributes)"string"==typeof e.attributes[i]&&(e.attributes[i]=e.attributes[i].replace(`{$${n}}`,t.manifest.definitions[n]));({tag(){({version(){e.version&&(this.manifest.version=e.version)},"allow-cache"(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const t={};"length"in e&&(s.byterange=t,t.length=e.length,"offset"in e||(e.offset=d)),"offset"in e&&(s.byterange=t,t.offset=e.offset),d=t.offset+t.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.title&&(s.title=e.title),e.duration>0&&(s.duration=e.duration),0===e.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("com.apple.streamingkeydelivery"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:e.attributes});if("com.microsoft.playready"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:e.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:aH(e.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(r.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence"(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,u=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type"(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map(){i={},e.uri&&(i.uri=e.uri),e.byterange&&(i.byterange=e.byterange),r&&(i.key=r)},"stream-inf"(){this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||c,e.attributes?(s.attributes||(s.attributes={}),a(s.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||c,!(e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const t=this.manifest.mediaGroups[e.attributes.TYPE];t[e.attributes["GROUP-ID"]]=t[e.attributes["GROUP-ID"]]||{},f=t[e.attributes["GROUP-ID"]],m={default:/yes/i.test(e.attributes.DEFAULT)},m.default?m.autoselect=!0:m.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(m.language=e.attributes.LANGUAGE),e.attributes.URI&&(m.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(m.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(m.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(m.forced=/yes/i.test(e.attributes.FORCED)),f[e.attributes.NAME]=m},discontinuity(){u+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),s.dateTimeString=e.dateTimeString,s.dateTimeObject=e.dateTimeObject;const{lastProgramDateTime:t}=this;this.lastProgramDateTime=new Date(e.dateTimeString).getTime(),null===t&&this.manifest.segments.reduceRight((e,t)=>(t.programDateTime=e-1e3*t.duration,t.programDateTime),this.lastProgramDateTime)},targetduration(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):(this.manifest.targetDuration=e.duration,fH.call(this,this.manifest))},start(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){s.cueOut=e.data},"cue-out-cont"(){s.cueOutCont=e.data},"cue-in"(){s.cueIn=e.data},skip(){this.manifest.skip=pH(e.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",e.attributes,["SKIPPED-SEGMENTS"])},part(){o=!0;const t=this.manifest.segments.length,n=pH(e.attributes);s.parts=s.parts||[],s.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=h),h=n.byterange.offset+n.byterange.length);const i=s.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${i} for segment #${t}`,e.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})})},"server-control"(){const t=this.manifest.serverControl=pH(e.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),fH.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const t=this.manifest.segments.length,n=pH(e.attributes),i=n.type&&"PART"===n.type;s.preloadHints=s.preloadHints||[],s.preloadHints.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=i?h:0,i&&(h=n.byterange.offset+n.byterange.length)));const r=s.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${r} for segment #${t}`,e.attributes,["TYPE","URI"]),n.type)for(let e=0;e<s.preloadHints.length-1;e++){const i=s.preloadHints[e];i.type&&(i.type===n.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${r} for segment #${t} has the same TYPE ${n.type} as preload hint #${e}`}))}},"rendition-report"(){const t=pH(e.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);const n=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];o&&i.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${n}`,e.attributes,i)},"part-inf"(){this.manifest.partInf=pH(e.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",e.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),fH.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(pH(e.attributes));const t=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${t}`,e.attributes,["ID","START-DATE"]);const n=this.manifest.dateRanges[t];n.endDate&&n.startDate&&new Date(n.endDate)<new Date(n.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),n.duration&&n.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),n.plannedDuration&&n.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const i=!!n.endOnNext;if(i&&!n.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),i&&(n.duration||n.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),n.duration&&n.endDate){const e=n.startDate.getTime()+1e3*n.duration;this.manifest.dateRanges[t].endDate=new Date(e)}if(p[n.id]){for(const t in p[n.id])if(n[t]&&JSON.stringify(p[n.id][t])!==JSON.stringify(n[t])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const e=this.manifest.dateRanges.findIndex(e=>e.id===n.id);this.manifest.dateRanges[e]=a(this.manifest.dateRanges[e],n),p[n.id]=a(p[n.id],n),this.manifest.dateRanges.pop()}else p[n.id]=n},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=pH(e.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",e.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const t=(e,t)=>{e in this.manifest.definitions?this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${e}`}):this.manifest.definitions[e]=t};if("QUERYPARAM"in e.attributes){if("NAME"in e.attributes||"IMPORT"in e.attributes)return void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});const n=this.params.get(e.attributes.QUERYPARAM);return n?void t(e.attributes.QUERYPARAM,decodeURIComponent(n)):void this.trigger("error",{message:`EXT-X-DEFINE: No query param ${e.attributes.QUERYPARAM}`})}return"NAME"in e.attributes?"IMPORT"in e.attributes?void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"}):"VALUE"in e.attributes&&"string"==typeof e.attributes.VALUE?void t(e.attributes.NAME,e.attributes.VALUE):void this.trigger("error",{message:`EXT-X-DEFINE: No value for ${e.attributes.NAME}`}):"IMPORT"in e.attributes?this.mainDefinitions[e.attributes.IMPORT]?void t(e.attributes.IMPORT,this.mainDefinitions[e.attributes.IMPORT]):void this.trigger("error",{message:`EXT-X-DEFINE: No value ${e.attributes.IMPORT} to import, or IMPORT used on main playlist`}):void this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:e.attributes,uri:e.uri,timeline:u}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",e.attributes,["BANDWIDTH","URI"])}}[e.tagType]||l).call(t)},uri(){s.uri=e.uri,n.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),r&&(s.key=r),s.timeline=u,i&&(s.map=i),h=0,null!==this.lastProgramDateTime&&(s.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*s.duration),s={}},comment(){},custom(){e.segment?(s.custom=s.custom||{},s.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,n){const i=[];n.forEach(function(e){t.hasOwnProperty(e)||i.push(e)}),i.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${i.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var gH,bH,yH={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},vH=["video","audio","text"],TH=["Video","Audio","Text"],xH=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,n){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)}):e},_H=function(e){void 0===e&&(e="");var t=e.split(","),n=[];return t.forEach(function(e){var t;e=e.trim(),vH.forEach(function(i){var r=yH[i].exec(e.toLowerCase());if(r&&!(r.length<=1)){t=i;var s=e.substring(0,r[1].length),a=e.replace(s,"");n.push({type:s,details:a,mediaType:i})}}),t||n.push({type:e,details:"",mediaType:"unknown"})}),n},SH=function(e){return void 0===e&&(e=""),yH.audio.test(e.trim().toLowerCase())},wH=function(e){if(e&&"string"==typeof e){var t,n=e.toLowerCase().split(",").map(function(e){return xH(e.trim())}),i="video";1===n.length&&SH(n[0])?i="audio":1===n.length&&(void 0===(t=n[0])&&(t=""),yH.text.test(t.trim().toLowerCase()))&&(i="application");var r="mp4";return n.every(function(e){return yH.mp4.test(e)})?r="mp4":n.every(function(e){return yH.webm.test(e)})?r="webm":n.every(function(e){return yH.ogg.test(e)})&&(r="ogg"),i+"/"+r+';codecs="'+e+'"'}},IH=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=!1),ZG.MediaSource&&ZG.MediaSource.isTypeSupported&&ZG.MediaSource.isTypeSupported(wH(e))||t&&ZG.ManagedMediaSource&&ZG.ManagedMediaSource.isTypeSupported&&ZG.ManagedMediaSource.isTypeSupported(wH(e))||!1},kH=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every(function(e){e=e.trim();for(var t=0;t<TH.length;t++){if(yH["muxer"+TH[t]].test(e))return!0}return!1})},CH="mp4a.40.2",EH=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,AH=/^application\/dash\+xml/i,RH=function(e){return EH.test(e)?"hls":AH.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null},NH=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},PH=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||function(e){return NH(e)}(e)||e instanceof ArrayBuffer||(e="number"!=typeof e||"number"==typeof e&&e!=e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},DH=ZG.BigInt||Number,OH=[DH("0x1"),DH("0x100"),DH("0x10000"),DH("0x1000000"),DH("0x100000000"),DH("0x10000000000"),DH("0x1000000000000"),DH("0x100000000000000"),DH("0x10000000000000000")];gH=new Uint16Array([65484]),255===(bH=new Uint8Array(gH.buffer,gH.byteOffset,gH.byteLength))[0]||bH[0];var LH=function(e,t){var n=void 0===t?{}:t,i=n.signed,r=void 0!==i&&i,s=n.le,a=void 0!==s&&s;e=PH(e);var o=a?"reduce":"reduceRight",l=(e[o]?e[o]:Array.prototype[o]).call(e,function(t,n,i){var r=a?i:Math.abs(i+1-e.length);return t+DH(n)*OH[r]},DH(0));if(r){var c=OH[e.length]/DH(2)-DH(1);(l=DH(l))>c&&(l-=c,l-=c,l-=DH(2))}return Number(l)},MH=function(e,t){var n=(void 0===t?{}:t).le,i=void 0!==n&&n;("bigint"!=typeof e&&"number"!=typeof e||"number"==typeof e&&e!=e)&&(e=0),e=DH(e);for(var r,s=(r=e,Math.ceil(function(e){return e.toString(2).length}(r)/8)),a=new Uint8Array(new ArrayBuffer(s)),o=0;o<s;o++){var l=i?o:Math.abs(o+1-a.length);a[l]=Number(e/OH[o]&DH(255)),e<0&&(a[l]=Math.abs(~a[l]),a[l]-=0===o?1:2)}return a},FH=function(e,t){if("string"!=typeof e&&e&&"function"==typeof e.toString&&(e=e.toString()),"string"!=typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n},$H=function(e,t,n){var i=void 0===n?{}:n,r=i.offset,s=void 0===r?0:r,a=i.mask,o=void 0===a?[]:a;e=PH(e);var l=(t=PH(t)).every?t.every:Array.prototype.every;return t.length&&e.length-s>=t.length&&l.call(t,function(t,n){return t===(o[n]?o[n]&e[s+n]:e[s+n])})},BH={},zH={};function UH(e,t){return void 0===t&&(t=Object),t&&"function"==typeof t.freeze?t.freeze(e):e}var GH=UH({HTML:"text/html",isHTML:function(e){return e===GH.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),VH=UH({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===VH.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});zH.assign=function(e,t){if(null===e||"object"!=typeof e)throw new TypeError("target is not an object");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},zH.find=function(e,t,n){if(void 0===n&&(n=Array.prototype),e&&"function"==typeof n.find)return n.find.call(e,t);for(var i=0;i<e.length;i++)if(Object.prototype.hasOwnProperty.call(e,i)){var r=e[i];if(t.call(void 0,r,i,e))return r}},zH.freeze=UH,zH.MIME_TYPE=GH,zH.NAMESPACE=VH;var HH=zH,WH=HH.find,jH=HH.NAMESPACE;function qH(e){return""!==e}function XH(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function KH(e){if(!e)return[];var t=function(e){return e?e.split(/[\t\n\f\r ]+/).filter(qH):[]}(e);return Object.keys(t.reduce(XH,{}))}function YH(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function ZH(e,t){var n=e.prototype;if(!(n instanceof t)){let i=function(){};i.prototype=t.prototype,i=new i,YH(n,i),e.prototype=n=i}n.constructor!=e&&("function"!=typeof e&&console.error("unknown Class:"+e),n.constructor=e)}var QH={},JH=QH.ELEMENT_NODE=1,eW=QH.ATTRIBUTE_NODE=2,tW=QH.TEXT_NODE=3,nW=QH.CDATA_SECTION_NODE=4,iW=QH.ENTITY_REFERENCE_NODE=5,rW=QH.ENTITY_NODE=6,sW=QH.PROCESSING_INSTRUCTION_NODE=7,aW=QH.COMMENT_NODE=8,oW=QH.DOCUMENT_NODE=9,lW=QH.DOCUMENT_TYPE_NODE=10,cW=QH.DOCUMENT_FRAGMENT_NODE=11,uW=QH.NOTATION_NODE=12,dW={},hW={};dW.INDEX_SIZE_ERR=(hW[1]="Index size error",1),dW.DOMSTRING_SIZE_ERR=(hW[2]="DOMString size error",2);var pW=dW.HIERARCHY_REQUEST_ERR=(hW[3]="Hierarchy request error",3);dW.WRONG_DOCUMENT_ERR=(hW[4]="Wrong document",4),dW.INVALID_CHARACTER_ERR=(hW[5]="Invalid character",5),dW.NO_DATA_ALLOWED_ERR=(hW[6]="No data allowed",6),dW.NO_MODIFICATION_ALLOWED_ERR=(hW[7]="No modification allowed",7);var fW=dW.NOT_FOUND_ERR=(hW[8]="Not found",8);dW.NOT_SUPPORTED_ERR=(hW[9]="Not supported",9);var mW=dW.INUSE_ATTRIBUTE_ERR=(hW[10]="Attribute in use",10);function gW(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,hW[e]),this.message=hW[e],Error.captureStackTrace&&Error.captureStackTrace(this,gW);return n.code=e,t&&(this.message=this.message+": "+t),n}function bW(){}function yW(e,t){this._node=e,this._refresh=t,vW(this)}function vW(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!==t){var n=e._refresh(e._node);if(aj(e,"length",n.length),!e.$$length||n.length<e.$$length)for(var i=n.length;i in e;i++)Object.prototype.hasOwnProperty.call(e,i)&&delete e[i];YH(n,e),e._inc=t}}function TW(){}function xW(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function _W(e,t,n,i){if(i?t[xW(t,i)]=n:t[t.length++]=n,e){n.ownerElement=e;var r=e.ownerDocument;r&&(i&&AW(r,e,i),function(e,t,n){e&&e._inc++;var i=n.namespaceURI;i===jH.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(r,e,n))}}function SW(e,t,n){var i=xW(t,n);if(!(i>=0))throw new gW(fW,new Error(e.tagName+"@"+n));for(var r=t.length-1;i<r;)t[i]=t[++i];if(t.length=r,e){var s=e.ownerDocument;s&&(AW(s,e,n),n.ownerElement=null)}}function wW(){}function IW(){}function kW(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function CW(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(CW(e,t))return!0}while(e=e.nextSibling)}function EW(){this.ownerDocument=this}function AW(e,t,n,i){e&&e._inc++,n.namespaceURI===jH.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function RW(e,t,n){if(e&&e._inc){e._inc++;var i=t.childNodes;if(n)i[i.length++]=n;else{for(var r=t.firstChild,s=0;r;)i[s++]=r,r=r.nextSibling;i.length=s,delete i[i.length]}}}function NW(e,t){var n=t.previousSibling,i=t.nextSibling;return n?n.nextSibling=i:e.firstChild=i,i?i.previousSibling=n:e.lastChild=n,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,RW(e.ownerDocument,e),t}function PW(e){return e&&e.nodeType===IW.DOCUMENT_TYPE_NODE}function DW(e){return e&&e.nodeType===IW.ELEMENT_NODE}function OW(e){return e&&e.nodeType===IW.TEXT_NODE}function LW(e,t){var n=e.childNodes||[];if(WH(n,DW)||PW(t))return!1;var i=WH(n,PW);return!(t&&i&&n.indexOf(i)>n.indexOf(t))}function MW(e,t){var n=e.childNodes||[];if(WH(n,function(e){return DW(e)&&e!==t}))return!1;var i=WH(n,PW);return!(t&&i&&n.indexOf(i)>n.indexOf(t))}function FW(e,t,n){if(!function(e){return e&&(e.nodeType===IW.DOCUMENT_NODE||e.nodeType===IW.DOCUMENT_FRAGMENT_NODE||e.nodeType===IW.ELEMENT_NODE)}(e))throw new gW(pW,"Unexpected parent node type "+e.nodeType);if(n&&n.parentNode!==e)throw new gW(fW,"child not in parent");if(!function(e){return e&&(DW(e)||OW(e)||PW(e)||e.nodeType===IW.DOCUMENT_FRAGMENT_NODE||e.nodeType===IW.COMMENT_NODE||e.nodeType===IW.PROCESSING_INSTRUCTION_NODE)}(t)||PW(t)&&e.nodeType!==IW.DOCUMENT_NODE)throw new gW(pW,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function $W(e,t,n){var i=e.childNodes||[],r=t.childNodes||[];if(t.nodeType===IW.DOCUMENT_FRAGMENT_NODE){var s=r.filter(DW);if(s.length>1||WH(r,OW))throw new gW(pW,"More than one element or text in fragment");if(1===s.length&&!LW(e,n))throw new gW(pW,"Element in fragment can not be inserted before doctype")}if(DW(t)&&!LW(e,n))throw new gW(pW,"Only one element can be added and only after doctype");if(PW(t)){if(WH(i,PW))throw new gW(pW,"Only one doctype is allowed");var a=WH(i,DW);if(n&&i.indexOf(a)<i.indexOf(n))throw new gW(pW,"Doctype can only be inserted before an element");if(!n&&a)throw new gW(pW,"Doctype can not be appended since element is present")}}function BW(e,t,n){var i=e.childNodes||[],r=t.childNodes||[];if(t.nodeType===IW.DOCUMENT_FRAGMENT_NODE){var s=r.filter(DW);if(s.length>1||WH(r,OW))throw new gW(pW,"More than one element or text in fragment");if(1===s.length&&!MW(e,n))throw new gW(pW,"Element in fragment can not be inserted before doctype")}if(DW(t)&&!MW(e,n))throw new gW(pW,"Only one element can be added and only after doctype");if(PW(t)){if(WH(i,function(e){return PW(e)&&e!==n}))throw new gW(pW,"Only one doctype is allowed");var a=WH(i,DW);if(n&&i.indexOf(a)<i.indexOf(n))throw new gW(pW,"Doctype can only be inserted before an element")}}function zW(e,t,n,i){FW(e,t,n),e.nodeType===IW.DOCUMENT_NODE&&(i||$W)(e,t,n);var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===cW){var s=t.firstChild;if(null==s)return t;var a=t.lastChild}else s=a=t;var o=n?n.previousSibling:e.lastChild;s.previousSibling=o,a.nextSibling=n,o?o.nextSibling=s:e.firstChild=s,null==n?e.lastChild=a:n.previousSibling=a;do{s.parentNode=e}while(s!==a&&(s=s.nextSibling));return RW(e.ownerDocument||e,e),t.nodeType==cW&&(t.firstChild=t.lastChild=null),t}function UW(){this._nsMap={}}function GW(){}function VW(){}function HW(){}function WW(){}function jW(){}function qW(){}function XW(){}function KW(){}function YW(){}function ZW(){}function QW(){}function JW(){}function ej(e,t){var n=[],i=9==this.nodeType&&this.documentElement||this,r=i.prefix,s=i.namespaceURI;if(s&&null==r&&null==(r=i.lookupPrefix(s)))var a=[{namespace:s,prefix:null}];return ij(this,n,e,t,a),n.join("")}function tj(e,t,n){var i=e.prefix||"",r=e.namespaceURI;if(!r)return!1;if("xml"===i&&r===jH.XML||r===jH.XMLNS)return!1;for(var s=n.length;s--;){var a=n[s];if(a.prefix===i)return a.namespace!==r}return!0}function nj(e,t,n){e.push(" ",t,'="',n.replace(/[<>&"\t\n\r]/g,kW),'"')}function ij(e,t,n,i,r){if(r||(r=[]),i){if(!(e=i(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case JH:var s=e.attributes,a=s.length,o=e.firstChild,l=e.tagName,c=l;if(!(n=jH.isHTML(e.namespaceURI)||n)&&!e.prefix&&e.namespaceURI){for(var u,d=0;d<s.length;d++)if("xmlns"===s.item(d).name){u=s.item(d).value;break}if(!u)for(var h=r.length-1;h>=0;h--){if(""===(p=r[h]).prefix&&p.namespace===e.namespaceURI){u=p.namespace;break}}if(u!==e.namespaceURI)for(h=r.length-1;h>=0;h--){var p;if((p=r[h]).namespace===e.namespaceURI){p.prefix&&(c=p.prefix+":"+l);break}}}t.push("<",c);for(var f=0;f<a;f++){"xmlns"==(m=s.item(f)).prefix?r.push({prefix:m.localName,namespace:m.value}):"xmlns"==m.nodeName&&r.push({prefix:"",namespace:m.value})}for(f=0;f<a;f++){var m,g,b;if(tj(m=s.item(f),0,r))nj(t,(g=m.prefix||"")?"xmlns:"+g:"xmlns",b=m.namespaceURI),r.push({prefix:g,namespace:b});ij(m,t,n,i,r)}if(l===c&&tj(e,0,r))nj(t,(g=e.prefix||"")?"xmlns:"+g:"xmlns",b=e.namespaceURI),r.push({prefix:g,namespace:b});if(o||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(t.push(">"),n&&/^script$/i.test(l))for(;o;)o.data?t.push(o.data):ij(o,t,n,i,r.slice()),o=o.nextSibling;else for(;o;)ij(o,t,n,i,r.slice()),o=o.nextSibling;t.push("</",c,">")}else t.push("/>");return;case oW:case cW:for(o=e.firstChild;o;)ij(o,t,n,i,r.slice()),o=o.nextSibling;return;case eW:return nj(t,e.name,e.value);case tW:return t.push(e.data.replace(/[<&>]/g,kW));case nW:return t.push("<![CDATA[",e.data,"]]>");case aW:return t.push("\x3c!--",e.data,"--\x3e");case lW:var y=e.publicId,v=e.systemId;if(t.push("<!DOCTYPE ",e.name),y)t.push(" PUBLIC ",y),v&&"."!=v&&t.push(" ",v),t.push(">");else if(v&&"."!=v)t.push(" SYSTEM ",v,">");else{var T=e.internalSubset;T&&t.push(" [",T,"]"),t.push(">")}return;case sW:return t.push("<?",e.target," ",e.data,"?>");case iW:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function rj(e,t,n){var i;switch(t.nodeType){case JH:(i=t.cloneNode(!1)).ownerDocument=e;case cW:break;case eW:n=!0}if(i||(i=t.cloneNode(!1)),i.ownerDocument=e,i.parentNode=null,n)for(var r=t.firstChild;r;)i.appendChild(rj(e,r,n)),r=r.nextSibling;return i}function sj(e,t,n){var i=new t.constructor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=t[r];"object"!=typeof s&&s!=i[r]&&(i[r]=s)}switch(t.childNodes&&(i.childNodes=new bW),i.ownerDocument=e,i.nodeType){case JH:var a=t.attributes,o=i.attributes=new TW,l=a.length;o._ownerElement=i;for(var c=0;c<l;c++)i.setAttributeNode(sj(e,a.item(c),!0));break;case eW:n=!0}if(n)for(var u=t.firstChild;u;)i.appendChild(sj(e,u,n)),u=u.nextSibling;return i}function aj(e,t,n){e[t]=n}dW.INVALID_STATE_ERR=(hW[11]="Invalid state",11),dW.SYNTAX_ERR=(hW[12]="Syntax error",12),dW.INVALID_MODIFICATION_ERR=(hW[13]="Invalid modification",13),dW.NAMESPACE_ERR=(hW[14]="Invalid namespace",14),dW.INVALID_ACCESS_ERR=(hW[15]="Invalid access",15),gW.prototype=Error.prototype,YH(dW,gW),bW.prototype={length:0,item:function(e){return e>=0&&e<this.length?this[e]:null},toString:function(e,t){for(var n=[],i=0;i<this.length;i++)ij(this[i],n,e,t);return n.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},yW.prototype.item=function(e){return vW(this),this[e]||null},ZH(yW,bW),TW.prototype={length:0,item:bW.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new gW(mW);var n=this.getNamedItem(e.nodeName);return _W(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new gW(mW);return t=this.getNamedItemNS(e.namespaceURI,e.localName),_W(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return SW(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return SW(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var i=this[n];if(i.localName==t&&i.namespaceURI==e)return i}return null}},wW.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,n){var i=new EW;if(i.implementation=this,i.childNodes=new bW,i.doctype=n||null,n&&i.appendChild(n),t){var r=i.createElementNS(e,t);i.appendChild(r)}return i},createDocumentType:function(e,t,n){var i=new qW;return i.name=e,i.nodeName=e,i.publicId=t||"",i.systemId=n||"",i}},IW.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return zW(this,e,t)},replaceChild:function(e,t){zW(this,e,t,BW),t&&this.removeChild(t)},removeChild:function(e){return NW(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return sj(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==tW&&e.nodeType==tW?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&n[i]===e)return i;t=t.nodeType==eW?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e];t=t.nodeType==eW?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},YH(QH,IW),YH(QH,IW.prototype),EW.prototype={nodeName:"#document",nodeType:oW,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==cW){for(var n=e.firstChild;n;){var i=n.nextSibling;this.insertBefore(n,t),n=i}return e}return zW(this,e,t),e.ownerDocument=this,null===this.documentElement&&e.nodeType===JH&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),NW(this,e)},replaceChild:function(e,t){zW(this,e,t,BW),e.ownerDocument=this,t&&this.removeChild(t),DW(e)&&(this.documentElement=e)},importNode:function(e,t){return rj(this,e,t)},getElementById:function(e){var t=null;return CW(this.documentElement,function(n){if(n.nodeType==JH&&n.getAttribute("id")==e)return t=n,!0}),t},getElementsByClassName:function(e){var t=KH(e);return new yW(this,function(n){var i=[];return t.length>0&&CW(n.documentElement,function(r){if(r!==n&&r.nodeType===JH){var s=r.getAttribute("class");if(s){var a=e===s;if(!a){var o=KH(s);a=t.every((l=o,function(e){return l&&-1!==l.indexOf(e)}))}a&&i.push(r)}}var l}),i})},createElement:function(e){var t=new UW;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new bW,(t.attributes=new TW)._ownerElement=t,t},createDocumentFragment:function(){var e=new ZW;return e.ownerDocument=this,e.childNodes=new bW,e},createTextNode:function(e){var t=new HW;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new WW;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new jW;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new QW;return n.ownerDocument=this,n.tagName=n.nodeName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new GW;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new YW;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new UW,i=t.split(":"),r=n.attributes=new TW;return n.childNodes=new bW,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=t,r._ownerElement=n,n},createAttributeNS:function(e,t){var n=new GW,i=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=t,n}},ZH(EW,IW),UW.prototype={nodeType:JH,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===cW?this.insertBefore(e,null):function(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,RW(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var i=this.ownerDocument.createAttributeNS(e,t);i.value=i.nodeValue=""+n,this.setAttributeNode(i)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new yW(this,function(t){var n=[];return CW(t,function(i){i===t||i.nodeType!=JH||"*"!==e&&i.tagName!=e||n.push(i)}),n})},getElementsByTagNameNS:function(e,t){return new yW(this,function(n){var i=[];return CW(n,function(r){r===n||r.nodeType!==JH||"*"!==e&&r.namespaceURI!==e||"*"!==t&&r.localName!=t||i.push(r)}),i})}},EW.prototype.getElementsByTagName=UW.prototype.getElementsByTagName,EW.prototype.getElementsByTagNameNS=UW.prototype.getElementsByTagNameNS,ZH(UW,IW),GW.prototype.nodeType=eW,ZH(GW,IW),VW.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(hW[pW])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},ZH(VW,IW),HW.prototype={nodeName:"#text",nodeType:tW,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var i=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}},ZH(HW,VW),WW.prototype={nodeName:"#comment",nodeType:aW},ZH(WW,VW),jW.prototype={nodeName:"#cdata-section",nodeType:nW},ZH(jW,VW),qW.prototype.nodeType=lW,ZH(qW,IW),XW.prototype.nodeType=uW,ZH(XW,IW),KW.prototype.nodeType=rW,ZH(KW,IW),YW.prototype.nodeType=iW,ZH(YW,IW),ZW.prototype.nodeName="#document-fragment",ZW.prototype.nodeType=cW,ZH(ZW,IW),QW.prototype.nodeType=sW,ZH(QW,IW),JW.prototype.serializeToString=function(e,t,n){return ej.call(e,t,n)},IW.prototype.toString=ej;try{if(Object.defineProperty){let e=function(t){switch(t.nodeType){case JH:case cW:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}};Object.defineProperty(yW.prototype,"length",{get:function(){return vW(this),this.$$length}}),Object.defineProperty(IW.prototype,"textContent",{get:function(){return e(this)},set:function(e){switch(this.nodeType){case JH:case cW:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),aj=function(e,t,n){e["$$"+t]=n}}}catch(r6){}BH.DocumentType=qW,BH.DOMException=gW,BH.DOMImplementation=wW,BH.Element=UW,BH.Node=IW,BH.NodeList=bW,BH.XMLSerializer=JW;var oj={},lj={};!function(e){var t=zH.freeze;e.XML_ENTITIES=t({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),e.HTML_ENTITIES=t({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),e.entityMap=e.HTML_ENTITIES}(lj);var cj={},uj=zH.NAMESPACE,dj=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,hj=new RegExp("[\\-\\.0-9"+dj.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),pj=new RegExp("^"+dj.source+hj.source+"*(?::"+dj.source+hj.source+"*)?$");function fj(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,fj)}function mj(){}function gj(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function bj(e,t,n,i,r,s){function a(e,t,i){n.attributeNames.hasOwnProperty(e)&&s.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,r),i)}for(var o,l=++t,c=0;;){var u=e.charAt(l);switch(u){case"=":if(1===c)o=e.slice(t,l),c=3;else{if(2!==c)throw new Error("attribute equal must after attrName");c=3}break;case"'":case'"':if(3===c||1===c){if(1===c&&(s.warning('attribute value must after "="'),o=e.slice(t,l)),t=l+1,!((l=e.indexOf(u,t))>0))throw new Error("attribute value no end '"+u+"' match");a(o,d=e.slice(t,l),t-1),c=5}else{if(4!=c)throw new Error('attribute value must after "="');a(o,d=e.slice(t,l),t),s.warning('attribute "'+o+'" missed start quot('+u+")!!"),t=l+1,c=5}break;case"/":switch(c){case 0:n.setTagName(e.slice(t,l));case 5:case 6:case 7:c=7,n.closed=!0;case 4:case 1:break;case 2:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==c&&n.setTagName(e.slice(t,l)),l;case">":switch(c){case 0:n.setTagName(e.slice(t,l));case 5:case 6:case 7:break;case 4:case 1:"/"===(d=e.slice(t,l)).slice(-1)&&(n.closed=!0,d=d.slice(0,-1));case 2:2===c&&(d=o),4==c?(s.warning('attribute "'+d+'" missed quot(")!'),a(o,d,t)):(uj.isHTML(i[""])&&d.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+d+'" missed value!! "'+d+'" instead!!'),a(d,d,t));break;case 3:throw new Error("attribute value missed!!")}return l;case"":u=" ";default:if(u<=" ")switch(c){case 0:n.setTagName(e.slice(t,l)),c=6;break;case 1:o=e.slice(t,l),c=2;break;case 4:var d=e.slice(t,l);s.warning('attribute "'+d+'" missed quot(")!!'),a(o,d,t);case 5:c=6}else switch(c){case 2:n.tagName,uj.isHTML(i[""])&&o.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),a(o,o,t),t=l,c=1;break;case 5:s.warning('attribute space is required"'+o+'"!!');case 6:c=1,t=l;break;case 3:c=4,t=l;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}l++}}function yj(e,t,n){for(var i=e.tagName,r=null,s=e.length;s--;){var a=e[s],o=a.qName,l=a.value;if((h=o.indexOf(":"))>0)var c=a.prefix=o.slice(0,h),u=o.slice(h+1),d="xmlns"===c&&u;else u=o,c=null,d="xmlns"===o&&"";a.localName=u,!1!==d&&(null==r&&(r={},xj(n,n={})),n[d]=r[d]=l,a.uri=uj.XMLNS,t.startPrefixMapping(d,l))}for(s=e.length;s--;){(c=(a=e[s]).prefix)&&("xml"===c&&(a.uri=uj.XML),"xmlns"!==c&&(a.uri=n[c||""]))}var h;(h=i.indexOf(":"))>0?(c=e.prefix=i.slice(0,h),u=e.localName=i.slice(h+1)):(c=null,u=e.localName=i);var p=e.uri=n[c||""];if(t.startElement(p,u,i,e),!e.closed)return e.currentNSMap=n,e.localNSMap=r,!0;if(t.endElement(p,u,i),r)for(c in r)Object.prototype.hasOwnProperty.call(r,c)&&t.endPrefixMapping(c)}function vj(e,t,n,i,r){if(/^(?:script|textarea)$/i.test(n)){var s=e.indexOf("</"+n+">",t),a=e.substring(t+1,s);if(/[&<]/.test(a))return/^script$/i.test(n)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,i),r.characters(a,0,a.length),s)}return t+1}function Tj(e,t,n,i){var r=i[n];return null==r&&((r=e.lastIndexOf("</"+n+">"))<t&&(r=e.lastIndexOf("</"+n)),i[n]=r),r<t}function xj(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function _j(e,t,n,i){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(r=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,r-t-4),r+3):(i.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var r=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,r-t-9),n.endCDATA(),r+3}var s=function(e,t){var n,i=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=t,r.exec(e);for(;n=r.exec(e);)if(i.push(n),n[1])return i}(e,t),a=s.length;if(a>1&&/!doctype/i.test(s[0][0])){var o=s[1][0],l=!1,c=!1;a>3&&(/^public$/i.test(s[2][0])?(l=s[3][0],c=a>4&&s[4][0]):/^system$/i.test(s[2][0])&&(c=s[3][0]));var u=s[a-1];return n.startDTD(o,l,c),n.endDTD(),u.index+u[0].length}return-1}function Sj(e,t,n){var i=e.indexOf("?>",t);if(i){var r=e.substring(t,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return r?(r[0].length,n.processingInstruction(r[1],r[2]),i+2):-1}return-1}function wj(){this.attributeNames={}}fj.prototype=new Error,fj.prototype.name=fj.name,mj.prototype={parse:function(e,t,n){var i=this.domBuilder;i.startDocument(),xj(t,t={}),function(e,t,n,i,r){function s(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function a(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?s(parseInt(t.substr(1).replace("x","0x"))):(r.error("entity not found:"+e),e)}function o(t){if(t>m){var n=e.substring(m,t).replace(/&#?\w+;/g,a);h&&l(m),i.characters(n,0,t-m),m=t}}function l(t,n){for(;t>=u&&(n=d.exec(e));)c=n.index,u=c+n[0].length,h.lineNumber++;h.columnNumber=t-c+1}var c=0,u=0,d=/.*(?:\r\n?|\n)|.*$/g,h=i.locator,p=[{currentNSMap:t}],f={},m=0;for(;;){try{var g=e.indexOf("<",m);if(g<0){if(!e.substr(m).match(/^\s*$/)){var b=i.doc,y=b.createTextNode(e.substr(m));b.appendChild(y),i.currentElement=y}return}switch(g>m&&o(g),e.charAt(g+1)){case"/":var v=e.indexOf(">",g+3),T=e.substring(g+2,v).replace(/[ \t\n\r]+$/g,""),x=p.pop();v<0?(T=e.substring(g+2).replace(/[\s<].*/,""),r.error("end tag name: "+T+" is not complete:"+x.tagName),v=g+1+T.length):T.match(/\s</)&&(T=T.replace(/[\s<].*/,""),r.error("end tag name: "+T+" maybe not complete"),v=g+1+T.length);var _=x.localNSMap,S=x.tagName==T;if(S||x.tagName&&x.tagName.toLowerCase()==T.toLowerCase()){if(i.endElement(x.uri,x.localName,T),_)for(var w in _)Object.prototype.hasOwnProperty.call(_,w)&&i.endPrefixMapping(w);S||r.fatalError("end tag name: "+T+" is not match the current start tagName:"+x.tagName)}else p.push(x);v++;break;case"?":h&&l(g),v=Sj(e,g,i);break;case"!":h&&l(g),v=_j(e,g,i,r);break;default:h&&l(g);var I=new wj,k=p[p.length-1].currentNSMap,C=(v=bj(e,g,I,k,a,r),I.length);if(!I.closed&&Tj(e,v,I.tagName,f)&&(I.closed=!0,n.nbsp||r.warning("unclosed xml attribute")),h&&C){for(var E=gj(h,{}),A=0;A<C;A++){var R=I[A];l(R.offset),R.locator=gj(h,{})}i.locator=E,yj(I,i,k)&&p.push(I),i.locator=h}else yj(I,i,k)&&p.push(I);uj.isHTML(I.uri)&&!I.closed?v=vj(e,v,I.tagName,a,i):v++}}catch(r6){if(r6 instanceof fj)throw r6;r.error("element parse error: "+r6),v=-1}v>m?m=v:o(Math.max(g,m)+1)}}(e,t,n,i,this.errorHandler),i.endDocument()}},wj.prototype={setTagName:function(e){if(!pj.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!pj.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},cj.XMLReader=mj,cj.ParseError=fj;var Ij=zH,kj=lj,Cj=cj,Ej=BH.DOMImplementation,Aj=Ij.NAMESPACE,Rj=Cj.ParseError,Nj=Cj.XMLReader;function Pj(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function Dj(e){this.options=e||{locator:{}}}function Oj(){this.cdata=!1}function Lj(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function Mj(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function Fj(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function $j(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}Dj.prototype.parseFromString=function(e,t){var n=this.options,i=new Nj,r=n.domBuilder||new Oj,s=n.errorHandler,a=n.locator,o=n.xmlns||{},l=/\/x?html?$/.test(t),c=l?kj.HTML_ENTITIES:kj.XML_ENTITIES;a&&r.setDocumentLocator(a),i.errorHandler=function(e,t,n){if(!e){if(t instanceof Oj)return t;e=t}var i={},r=e instanceof Function;function s(t){var s=e[t];!s&&r&&(s=2==e.length?function(n){e(t,n)}:e),i[t]=s&&function(e){s("[xmldom "+t+"]\t"+e+Mj(n))}||function(){}}return n=n||{},s("warning"),s("error"),s("fatalError"),i}(s,r,a),i.domBuilder=n.domBuilder||r,l&&(o[""]=Aj.HTML),o.xml=o.xml||Aj.XML;var u=n.normalizeLineEndings||Pj;return e&&"string"==typeof e?i.parse(u(e),o,c):i.errorHandler.error("invalid doc source"),r.doc},Oj.prototype={startDocument:function(){this.doc=(new Ej).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,i){var r=this.doc,s=r.createElementNS(e,n||t),a=i.length;$j(this,s),this.currentElement=s,this.locator&&Lj(this.locator,s);for(var o=0;o<a;o++){e=i.getURI(o);var l=i.getValue(o),c=(n=i.getQName(o),r.createAttributeNS(e,n));this.locator&&Lj(i.getLocator(o),c),c.value=c.nodeValue=l,s.setAttributeNode(c)}},endElement:function(e,t,n){var i=this.currentElement;i.tagName,this.currentElement=i.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&Lj(this.locator,n),$j(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=Fj.apply(this,arguments)){if(this.cdata)var i=this.doc.createCDATASection(e);else i=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(e)&&this.doc.appendChild(i),this.locator&&Lj(this.locator,i)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=Fj.apply(this,arguments);var i=this.doc.createComment(e);this.locator&&Lj(this.locator,i),$j(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var i=this.doc.implementation;if(i&&i.createDocumentType){var r=i.createDocumentType(e,t,n);this.locator&&Lj(this.locator,r),$j(this,r),this.doc.doctype=r}},warning:function(e){console.warn("[xmldom warning]\t"+e,Mj(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,Mj(this.locator))},fatalError:function(e){throw new Rj(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){Oj.prototype[e]=function(){return null}}),oj.__DOMHandler=Oj,oj.normalizeLineEndings=Pj,oj.DOMParser=Dj;var Bj=oj.DOMParser;
/*! @name mpd-parser @version 1.3.1 @license Apache-2.0 */const zj=e=>!!e&&"object"==typeof e,Uj=(...e)=>e.reduce((e,t)=>("object"!=typeof t||Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):zj(e[n])&&zj(t[n])?e[n]=Uj(e[n],t[n]):e[n]=t[n]}),e),{}),Gj=e=>Object.keys(e).map(t=>e[t]),Vj=e=>e.reduce((e,t)=>e.concat(t),[]),Hj=e=>{if(!e.length)return[];const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t};var Wj="INVALID_NUMBER_OF_PERIOD",jj="DASH_EMPTY_MANIFEST",qj="DASH_INVALID_XML",Xj="NO_BASE_URL",Kj="SEGMENT_TIME_UNSPECIFIED",Yj="UNSUPPORTED_UTC_TIMING_SCHEME";const Zj=({baseUrl:e="",source:t="",range:n="",indexRange:i=""})=>{const r={uri:t,resolvedUri:rH(e||"",t)};if(n||i){const e=(n||i).split("-");let t,s=ZG.BigInt?ZG.BigInt(e[0]):parseInt(e[0],10),a=ZG.BigInt?ZG.BigInt(e[1]):parseInt(e[1],10);s<Number.MAX_SAFE_INTEGER&&"bigint"==typeof s&&(s=Number(s)),a<Number.MAX_SAFE_INTEGER&&"bigint"==typeof a&&(a=Number(a)),t="bigint"==typeof a||"bigint"==typeof s?ZG.BigInt(a)-ZG.BigInt(s)+ZG.BigInt(1):a-s+1,"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),r.byterange={length:t,offset:s}}return r},Qj=e=>(e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e),Jj={static(e){const{duration:t,timescale:n=1,sourceDuration:i,periodDuration:r}=e,s=Qj(e.endNumber),a=t/n;return"number"==typeof s?{start:0,end:s}:"number"==typeof r?{start:0,end:r/a}:{start:0,end:i/a}},dynamic(e){const{NOW:t,clientOffset:n,availabilityStartTime:i,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=e,c=Qj(e.endNumber),u=(t+n)/1e3,d=i+a,h=u+o-d,p=Math.ceil(h*r/s),f=Math.floor((u-d-l)*r/s),m=Math.floor((u-d)*r/s);return{start:Math.max(0,f),end:"number"==typeof c?c:Math.min(p,m)}}},eq=e=>{const{type:t,duration:n,timescale:i=1,periodDuration:r,sourceDuration:s}=e,{start:a,end:o}=Jj[t](e),l=((e,t)=>{const n=[];for(let i=e;i<t;i++)n.push(i);return n})(a,o).map((e=>t=>{const{duration:n,timescale:i=1,periodStart:r,startNumber:s=1}=e;return{number:s+t,duration:n/i,timeline:r,time:t*n}})(e));if("static"===t){const e=l.length-1,t="number"==typeof r?r:s;l[e].duration=t-n/i*e}return l},tq=e=>{const{baseUrl:t,initialization:n={},sourceDuration:i,indexRange:r="",periodStart:s,presentationTime:a,number:o=0,duration:l}=e;if(!t)throw new Error(Xj);const c=Zj({baseUrl:t,source:n.sourceURL,range:n.range}),u=Zj({baseUrl:t,source:t,indexRange:r});if(u.map=c,l){const t=eq(e);t.length&&(u.duration=t[0].duration,u.timeline=t[0].timeline)}else i&&(u.duration=i,u.timeline=s);return u.presentationTime=a||s,u.number=o,[u]},nq=(e,t,n)=>{const i=e.sidx.map?e.sidx.map:null,r=e.sidx.duration,s=e.timeline||0,a=e.sidx.byterange,o=a.offset+a.length,l=t.timescale,c=t.references.filter(e=>1!==e.referenceType),u=[],d=e.endList?"static":"dynamic",h=e.sidx.timeline;let p,f=h,m=e.mediaSequence||0;p="bigint"==typeof t.firstOffset?ZG.BigInt(o)+t.firstOffset:o+t.firstOffset;for(let g=0;g<c.length;g++){const e=t.references[g],a=e.referencedSize,o=e.subsegmentDuration;let c;c="bigint"==typeof p?p+ZG.BigInt(a)-ZG.BigInt(1):p+a-1;const b=tq({baseUrl:n,timescale:l,timeline:s,periodStart:h,presentationTime:f,number:m,duration:o,sourceDuration:r,indexRange:`${p}-${c}`,type:d})[0];i&&(b.map=i),u.push(b),p+="bigint"==typeof p?ZG.BigInt(a):a,f+=o/l,m++}return e.segments=u,e},iq=["AUDIO","SUBTITLES"],rq=1/60,sq=e=>{return(t=e,n=({timeline:e})=>e,Gj(t.reduce((e,t)=>(t.forEach(t=>{e[n(t)]=t}),e),{}))).sort((e,t)=>e.timeline>t.timeline?1:-1);var t,n},aq=e=>{let t=[];var n,i;return n=e,i=(e,n,i,r)=>{t=t.concat(e.playlists||[])},iq.forEach(function(e){for(var t in n.mediaGroups[e])for(var r in n.mediaGroups[e][t]){var s=n.mediaGroups[e][t][r];i(s,e,t,r)}}),t},oq=({playlist:e,mediaSequence:t})=>{e.mediaSequence=t,e.segments.forEach((t,n)=>{t.number=e.mediaSequence+n})},lq=({oldManifest:e,newManifest:t})=>{const n=e.playlists.concat(aq(e)),i=t.playlists.concat(aq(t));return t.timelineStarts=sq([e.timelineStarts,t.timelineStarts]),(({oldPlaylists:e,newPlaylists:t,timelineStarts:n})=>{t.forEach(t=>{t.discontinuitySequence=n.findIndex(function({timeline:e}){return e===t.timeline});const i=((e,t)=>{for(let n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null})(e,t.attributes.NAME);if(!i)return;if(t.sidx)return;const r=t.segments[0],s=i.segments.findIndex(function(e){return Math.abs(e.presentationTime-r.presentationTime)<rq});if(-1===s)return oq({playlist:t,mediaSequence:i.mediaSequence+i.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!i.segments.length&&t.timeline>i.timeline||i.segments.length&&t.timeline>i.segments[i.segments.length-1].timeline)&&t.discontinuitySequence--);i.segments[s].discontinuity&&!r.discontinuity&&(r.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),oq({playlist:t,mediaSequence:i.segments[s].number})})})({oldPlaylists:n,newPlaylists:i,timelineStarts:t.timelineStarts}),t},cq=e=>e&&e.uri+"-"+(e=>{let t;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?ZG.BigInt(e.offset)+ZG.BigInt(e.length)-ZG.BigInt(1):e.offset+e.length-1,`${e.offset}-${t}`})(e.byterange),uq=e=>{const t=e.reduce(function(e,t){return e[t.attributes.baseUrl]||(e[t.attributes.baseUrl]=[]),e[t.attributes.baseUrl].push(t),e},{});let n=[];return Object.values(t).forEach(e=>{const t=Gj(e.reduce((e,t)=>{const n=t.attributes.id+(t.attributes.lang||"");return e[n]?(t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),e[n].segments.push(...t.segments)),t.attributes.contentProtection&&(e[n].attributes.contentProtection=t.attributes.contentProtection)):(e[n]=t,e[n].attributes.timelineStarts=[]),e[n].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e},{}));n=n.concat(t)}),n.map(e=>{var t,n;return e.discontinuityStarts=(t=e.segments||[],n="discontinuity",t.reduce((e,t,i)=>(t[n]&&e.push(i),e),[])),e})},dq=(e,t)=>{const n=cq(e.sidx),i=n&&t[n]&&t[n].sidx;return i&&nq(e,i,e.sidx.resolvedUri),e},hq=(e,t={})=>{if(!Object.keys(t).length)return e;for(const n in e)e[n]=dq(e[n],t);return e},pq=({attributes:e,segments:t,sidx:n,discontinuityStarts:i})=>{const r={attributes:{NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuityStarts:i,timelineStarts:e.timelineStarts,segments:t};return e.frameRate&&(r.attributes["FRAME-RATE"]=e.frameRate),e.contentProtection&&(r.contentProtection=e.contentProtection),e.serviceLocation&&(r.attributes.serviceLocation=e.serviceLocation),n&&(r.sidx=n),r},fq=({attributes:e})=>"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType,mq=({attributes:e})=>"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType,gq=({attributes:e})=>"text/vtt"===e.mimeType||"text"===e.contentType,bq=e=>e?Object.keys(e).reduce((t,n)=>{const i=e[n];return t.concat(i.playlists)},[]):[],yq=({dashPlaylists:e,locations:t,contentSteering:n,sidxMapping:i={},previousManifest:r,eventStream:s})=>{if(!e.length)return{};const{sourceDuration:a,type:o,suggestedPresentationDelay:l,minimumUpdatePeriod:c}=e[0].attributes,u=uq(e.filter(fq)).map(pq),d=uq(e.filter(mq)),h=uq(e.filter(gq)),p=e.map(e=>e.attributes.captionServices).filter(Boolean),f={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:a,playlists:hq(u,i)};c>=0&&(f.minimumUpdatePeriod=1e3*c),t&&(f.locations=t),n&&(f.contentSteering=n),"dynamic"===o&&(f.suggestedPresentationDelay=l),s&&s.length>0&&(f.eventStream=s);const m=0===f.playlists.length,g=d.length?((e,t={},n=!1)=>{let i;const r=e.reduce((e,r)=>{const s=r.attributes.role&&r.attributes.role.value||"",a=r.attributes.lang||"";let o=r.attributes.label||"main";if(a&&!r.attributes.label){const e=s?` (${s})`:"";o=`${r.attributes.lang}${e}`}e[o]||(e[o]={language:a,autoselect:!0,default:"main"===s,playlists:[],uri:""});const l=dq((({attributes:e,segments:t,sidx:n,mediaSequence:i,discontinuitySequence:r,discontinuityStarts:s},a)=>{const o={attributes:{NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuitySequence:r,discontinuityStarts:s,timelineStarts:e.timelineStarts,mediaSequence:i,segments:t};return e.contentProtection&&(o.contentProtection=e.contentProtection),e.serviceLocation&&(o.attributes.serviceLocation=e.serviceLocation),n&&(o.sidx=n),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o})(r,n),t);return e[o].playlists.push(l),void 0===i&&"main"===s&&(i=r,i.default=!0),e},{});i||(r[Object.keys(r)[0]].default=!0);return r})(d,i,m):null,b=h.length?((e,t={})=>e.reduce((e,n)=>{const i=n.attributes.label||n.attributes.lang||"text",r=n.attributes.lang||"und";return e[i]||(e[i]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),e[i].playlists.push(dq((({attributes:e,segments:t,mediaSequence:n,discontinuityStarts:i,discontinuitySequence:r})=>{void 0===t&&(t=[{uri:e.baseUrl,timeline:e.periodStart,resolvedUri:e.baseUrl||"",duration:e.sourceDuration,number:0}],e.duration=e.sourceDuration);const s={NAME:e.id,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1};e.codecs&&(s.CODECS=e.codecs);const a={attributes:s,uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,timelineStarts:e.timelineStarts,discontinuityStarts:i,discontinuitySequence:r,mediaSequence:n,segments:t};return e.serviceLocation&&(a.attributes.serviceLocation=e.serviceLocation),a})(n),t)),e},{}))(h,i):null,y=u.concat(bq(g),bq(b)),v=y.map(({timelineStarts:e})=>e);var T,x;return f.timelineStarts=sq(v),T=y,x=f.timelineStarts,T.forEach(e=>{e.mediaSequence=0,e.discontinuitySequence=x.findIndex(function({timeline:t}){return t===e.timeline}),e.segments&&e.segments.forEach((e,t)=>{e.number=t})}),g&&(f.mediaGroups.AUDIO.audio=g),b&&(f.mediaGroups.SUBTITLES.subs=b),p.length&&(f.mediaGroups["CLOSED-CAPTIONS"].cc=p.reduce((e,t)=>t?(t.forEach(t=>{const{channel:n,language:i}=t;e[i]={autoselect:!1,default:!1,instreamId:n,language:i},t.hasOwnProperty("aspectRatio")&&(e[i].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[i].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[i]["3D"]=t["3D"])}),e):e,{})),r?lq({oldManifest:r,newManifest:f}):f},vq=(e,t,n)=>{const{NOW:i,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:l=0}=e,c=(i+r)/1e3+l-(s+o);return Math.ceil((c*a-t)/n)},Tq=(e,t)=>{const{type:n,minimumUpdatePeriod:i=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:o=1,periodStart:l}=e,c=[];let u=-1;for(let d=0;d<t.length;d++){const h=t[d],p=h.d,f=h.r||0,m=h.t||0;let g;if(u<0&&(u=m),m&&m>u&&(u=m),f<0){const o=d+1;g=o===t.length?"dynamic"===n&&i>0&&r.indexOf("$Number$")>0?vq(e,u,p):(s*a-u)/p:(t[o].t-u)/p}else g=f+1;const b=o+c.length+g;let y=o+c.length;for(;y<b;)c.push({number:y,duration:p/a,time:u,timeline:l}),u+=p,y++}return c},xq=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,_q=(e,t)=>e.replace(xq,(e=>(t,n,i,r)=>{if("$$"===t)return"$";if(void 0===e[n])return t;const s=""+e[n];return"RepresentationID"===n?s:(r=i?parseInt(r,10):1,s.length>=r?s:`${new Array(r-s.length+1).join("0")}${s}`)})(t)),Sq=(e,t)=>{const n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:i={sourceURL:"",range:""}}=e,r=Zj({baseUrl:e.baseUrl,source:_q(i.sourceURL,n),range:i.range}),s=((e,t)=>e.duration||t?e.duration?eq(e):Tq(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}])(e,t);return s.map(t=>{n.Number=t.number,n.Time=t.time;const i=_q(e.media||"",n),s=e.timescale||1,a=e.presentationTimeOffset||0,o=e.periodStart+(t.time-a)/s;return{uri:i,timeline:t.timeline,duration:t.duration,resolvedUri:rH(e.baseUrl||"",i),map:r,number:t.number,presentationTime:o}})},wq=(e,t)=>{const{duration:n,segmentUrls:i=[],periodStart:r}=e;if(!n&&!t||n&&t)throw new Error(Kj);const s=i.map(t=>((e,t)=>{const{baseUrl:n,initialization:i={}}=e,r=Zj({baseUrl:n,source:i.sourceURL,range:i.range}),s=Zj({baseUrl:n,source:t.media,range:t.mediaRange});return s.map=r,s})(e,t));let a;n&&(a=eq(e)),t&&(a=Tq(e,t));return a.map((t,n)=>{if(s[n]){const i=s[n],a=e.timescale||1,o=e.presentationTimeOffset||0;return i.timeline=t.timeline,i.duration=t.duration,i.number=t.number,i.presentationTime=r+(t.time-o)/a,i}}).filter(e=>e)},Iq=({attributes:e,segmentInfo:t})=>{let n,i;t.template?(i=Sq,n=Uj(e,t.template)):t.base?(i=tq,n=Uj(e,t.base)):t.list&&(i=wq,n=Uj(e,t.list));const r={attributes:e};if(!i)return r;const s=i(n,t.segmentTimeline);if(n.duration){const{duration:e,timescale:t=1}=n;n.duration=e/t}else s.length?n.duration=s.reduce((e,t)=>Math.max(e,Math.ceil(t.duration)),0):n.duration=0;return r.attributes=n,r.segments=s,t.base&&n.indexRange&&(r.sidx=s[0],r.segments=[]),r},kq=(e,t)=>Hj(e.childNodes).filter(({tagName:e})=>e===t),Cq=e=>e.textContent.trim(),Eq=e=>{const t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;const[n,i,r,s,a,o]=t.slice(1);return 31536e3*parseFloat(n||0)+2592e3*parseFloat(i||0)+86400*parseFloat(r||0)+3600*parseFloat(s||0)+60*parseFloat(a||0)+parseFloat(o||0)},Aq={mediaPresentationDuration:e=>Eq(e),availabilityStartTime(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:e=>Eq(e),suggestedPresentationDelay:e=>Eq(e),type:e=>e,timeShiftBufferDepth:e=>Eq(e),start:e=>Eq(e),width:e=>parseInt(e,10),height:e=>parseInt(e,10),bandwidth:e=>parseInt(e,10),frameRate:e=>(e=>parseFloat(e.split("/").reduce((e,t)=>e/t)))(e),startNumber:e=>parseInt(e,10),timescale:e=>parseInt(e,10),presentationTimeOffset:e=>parseInt(e,10),duration(e){const t=parseInt(e,10);return isNaN(t)?Eq(e):t},d:e=>parseInt(e,10),t:e=>parseInt(e,10),r:e=>parseInt(e,10),presentationTime:e=>parseInt(e,10),DEFAULT:e=>e},Rq=e=>e&&e.attributes?Hj(e.attributes).reduce((e,t)=>{const n=Aq[t.name]||Aq.DEFAULT;return e[t.name]=n(t.value),e},{}):{},Nq={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},Pq=(e,t)=>t.length?Vj(e.map(function(e){return t.map(function(t){const n=Cq(t),i=rH(e.baseUrl,n),r=Uj(Rq(t),{baseUrl:i});return i!==n&&!r.serviceLocation&&e.serviceLocation&&(r.serviceLocation=e.serviceLocation),r})})):e,Dq=e=>{const t=kq(e,"SegmentTemplate")[0],n=kq(e,"SegmentList")[0],i=n&&kq(n,"SegmentURL").map(e=>Uj({tag:"SegmentURL"},Rq(e))),r=kq(e,"SegmentBase")[0],s=n||t,a=s&&kq(s,"SegmentTimeline")[0],o=n||r||t,l=o&&kq(o,"Initialization")[0],c=t&&Rq(t);c&&l?c.initialization=l&&Rq(l):c&&c.initialization&&(c.initialization={sourceURL:c.initialization});const u={template:c,segmentTimeline:a&&kq(a,"S").map(e=>Rq(e)),list:n&&Uj(Rq(n),{segmentUrls:i,initialization:Rq(l)}),base:r&&Uj(Rq(r),{initialization:Rq(l)})};return Object.keys(u).forEach(e=>{u[e]||delete u[e]}),u},Oq=e=>Vj(kq(e.node,"EventStream").map(t=>{const n=Rq(t),i=n.schemeIdUri;return kq(t,"Event").map(t=>{const r=Rq(t),s=r.presentationTime||0,a=n.timescale||1,o=r.duration||0,l=s/a+e.attributes.start;return{schemeIdUri:i,value:n.value,id:r.id,start:l,end:l+o/a,messageData:Cq(t)||r.messageData,contentEncoding:n.contentEncoding,presentationTimeOffset:n.presentationTimeOffset||0}})})),Lq=(e,t,n)=>i=>{const r=Rq(i),s=Pq(t,kq(i,"BaseURL")),a=kq(i,"Role")[0],o={role:Rq(a)};let l=Uj(e,r,o);const c=kq(i,"Accessibility")[0],u=(e=>{if("urn:scte:dash:cc:cea-608:2015"===e.schemeIdUri)return("string"!=typeof e.value?[]:e.value.split(";")).map(e=>{let t,n;return n=e,/^CC\d=/.test(e)?[t,n]=e.split("="):/^CC\d$/.test(e)&&(t=e),{channel:t,language:n}});if("urn:scte:dash:cc:cea-708:2015"===e.schemeIdUri)return("string"!=typeof e.value?[]:e.value.split(";")).map(e=>{const t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){const[n,i=""]=e.split("=");t.channel=n,t.language=e,i.split(",").forEach(e=>{const[n,i]=e.split(":");"lang"===n?t.language=i:"er"===n?t.easyReader=Number(i):"war"===n?t.aspectRatio=Number(i):"3D"===n&&(t["3D"]=Number(i))})}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})})(Rq(c));u&&(l=Uj(l,{captionServices:u}));const d=kq(i,"Label")[0];if(d&&d.childNodes.length){const e=d.childNodes[0].nodeValue.trim();l=Uj(l,{label:e})}const h=kq(i,"ContentProtection").reduce((e,t)=>{const n=Rq(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const i=Nq[n.schemeIdUri];if(i){e[i]={attributes:n};const r=kq(t,"cenc:pssh")[0];if(r){const t=Cq(r);e[i].pssh=t&&aH(t)}}return e},{});Object.keys(h).length&&(l=Uj(l,{contentProtection:h}));const p=Dq(i),f=kq(i,"Representation"),m=Uj(n,p);return Vj(f.map(((e,t,n)=>i=>{const r=kq(i,"BaseURL"),s=Pq(t,r),a=Uj(e,Rq(i)),o=Dq(i);return s.map(e=>({segmentInfo:Uj(n,o),attributes:Uj(a,e)}))})(l,s,m)))},Mq=(e,t)=>(n,i)=>{const r=Pq(t,kq(n.node,"BaseURL")),s=Uj(e,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(s.periodDuration=n.attributes.duration);const a=kq(n.node,"AdaptationSet"),o=Dq(n.node);return Vj(a.map(Lq(s,r,o)))},Fq=(e,t)=>{if(e.length>1&&t({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!e.length)return null;const n=Uj({serverURL:Cq(e[0])},Rq(e[0]));return n.queryBeforeStart="true"===n.queryBeforeStart,n},$q=e=>{if(""===e)throw new Error(jj);const t=new Bj;let n,i;try{n=t.parseFromString(e,"application/xml"),i=n&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(r6){}if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(qj);return i},Bq=(e,t={})=>{const n=((e,t={})=>{const{manifestUri:n="",NOW:i=Date.now(),clientOffset:r=0,eventHandler:s=function(){}}=t,a=kq(e,"Period");if(!a.length)throw new Error(Wj);const o=kq(e,"Location"),l=Rq(e),c=Pq([{baseUrl:n}],kq(e,"BaseURL")),u=kq(e,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=i,l.clientOffset=r,o.length&&(l.locations=o.map(Cq));const d=[];return a.forEach((e,t)=>{const n=Rq(e),i=d[t-1];n.start=(({attributes:e,priorPeriodAttributes:t,mpdType:n})=>"number"==typeof e.start?e.start:t&&"number"==typeof t.start&&"number"==typeof t.duration?t.start+t.duration:t||"static"!==n?null:0)({attributes:n,priorPeriodAttributes:i?i.attributes:null,mpdType:l.type}),d.push({node:e,attributes:n})}),{locations:l.locations,contentSteeringInfo:Fq(u,s),representationInfo:Vj(d.map(Mq(l,c))),eventStream:Vj(d.map(Oq))}})($q(e),t),i=n.representationInfo.map(Iq);return yq({dashPlaylists:i,locations:n.locations,contentSteering:n.contentSteeringInfo,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest,eventStream:n.eventStream})},zq=e=>(e=>{const t=kq(e,"UTCTiming")[0];if(!t)return null;const n=Rq(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error(Yj)}return n})($q(e));var Uq=Math.pow(2,32),Gq=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:n.getUint32(0)*Uq+n.getUint32(4)},Vq=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},i=12;0===n.version?(n.earliestPresentationTime=t.getUint32(i),n.firstOffset=t.getUint32(i+4),i+=8):(n.earliestPresentationTime=Gq(e.subarray(i)),n.firstOffset=Gq(e.subarray(i+8)),i+=16),i+=2;var r=t.getUint16(i);for(i+=2;r>0;i+=12,r--)n.references.push({referenceType:(128&e[i])>>>7,referencedSize:2147483647&t.getUint32(i),subsegmentDuration:t.getUint32(i+4),startsWithSap:!!(128&e[i+8]),sapType:(112&e[i+8])>>>4,sapDeltaTime:268435455&t.getUint32(i+8)});return n},Hq=PH([73,68,51]),Wq=function e(t,n){return void 0===n&&(n=0),(t=PH(t)).length-n<10||!$H(t,Hq,{offset:n})?n:(n+=function(e,t){void 0===t&&(t=0);var n=(e=PH(e))[t+5],i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&n)>>4?i+20:i+10}(t,n),e(t,n))},jq=function(e){return"string"==typeof e?FH(e):e},qq=function e(t,n,i){void 0===i&&(i=!1),n=function(e){return Array.isArray(e)?e.map(function(e){return jq(e)}):[jq(e)]}(n),t=PH(t);var r=[];if(!n.length)return r;for(var s=0;s<t.length;){var a=(t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3])>>>0,o=t.subarray(s+4,s+8);if(0===a)break;var l=s+a;if(l>t.length){if(i)break;l=t.length}var c=t.subarray(s+8,l);$H(o,n[0])&&(1===n.length?r.push(c):r.push.apply(r,e(c,n.slice(1),i))),s=l}return r},Xq={EBML:PH([26,69,223,163]),DocType:PH([66,130]),Segment:PH([24,83,128,103]),SegmentInfo:PH([21,73,169,102]),Tracks:PH([22,84,174,107]),Track:PH([174]),TrackNumber:PH([215]),DefaultDuration:PH([35,227,131]),TrackEntry:PH([174]),TrackType:PH([131]),FlagDefault:PH([136]),CodecID:PH([134]),CodecPrivate:PH([99,162]),VideoTrack:PH([224]),AudioTrack:PH([225]),Cluster:PH([31,67,182,117]),Timestamp:PH([231]),TimestampScale:PH([42,215,177]),BlockGroup:PH([160]),BlockDuration:PH([155]),Block:PH([161]),SimpleBlock:PH([163])},Kq=[128,64,32,16,8,4,2,1],Yq=function(e,t,n,i){void 0===n&&(n=!0),void 0===i&&(i=!1);var r=function(e){for(var t=1,n=0;n<Kq.length&&!(e&Kq[n]);n++)t++;return t}(e[t]),s=e.subarray(t,t+r);return n&&((s=Array.prototype.slice.call(e,t,t+r))[0]^=Kq[r-1]),{length:r,value:LH(s,{signed:i}),bytes:s}},Zq=function e(t){return"string"==typeof t?t.match(/.{1,2}/g).map(function(t){return e(t)}):"number"==typeof t?MH(t):t},Qq=function e(t,n,i){if(i>=n.length)return n.length;var r=Yq(n,i,!1);if($H(t.bytes,r.bytes))return i;var s=Yq(n,i+r.length);return e(t,n,i+s.length+s.value+r.length)},Jq=function e(t,n){n=function(e){return Array.isArray(e)?e.map(function(e){return Zq(e)}):[Zq(e)]}(n),t=PH(t);var i=[];if(!n.length)return i;for(var r=0;r<t.length;){var s=Yq(t,r,!1),a=Yq(t,r+s.length),o=r+s.length+a.length;127===a.value&&(a.value=Qq(s,t,o),a.value!==t.length&&(a.value-=o));var l=o+a.value>t.length?t.length:o+a.value,c=t.subarray(o,l);$H(n[0],s.bytes)&&(1===n.length?i.push(c):i=i.concat(e(c,n.slice(1)))),r+=s.length+a.length+c.length}return i},eX=PH([0,0,0,1]),tX=PH([0,0,1]),nX=PH([0,0,3]),iX=function(e){for(var t=[],n=1;n<e.length-2;)$H(e.subarray(n,n+3),nX)&&(t.push(n+2),n++),n++;if(0===t.length)return e;var i=e.length-t.length,r=new Uint8Array(i),s=0;for(n=0;n<i;s++,n++)s===t[0]&&(s++,t.shift()),r[n]=e[s];return r},rX=function(e,t,n,i){void 0===i&&(i=1/0),e=PH(e),n=[].concat(n);for(var r,s=0,a=0;s<e.length&&(a<i||r);){var o=void 0;if($H(e.subarray(s),eX)?o=4:$H(e.subarray(s),tX)&&(o=3),o){if(a++,r)return iX(e.subarray(r,s));var l=void 0;"h264"===t?l=31&e[s+o]:"h265"===t&&(l=e[s+o]>>1&63),-1!==n.indexOf(l)&&(r=s+o),s+=o+("h264"===t?1:2)}else s++}return e.subarray(0,0)},sX={webm:PH([119,101,98,109]),matroska:PH([109,97,116,114,111,115,107,97]),flac:PH([102,76,97,67]),ogg:PH([79,103,103,83]),ac3:PH([11,119]),riff:PH([82,73,70,70]),avi:PH([65,86,73]),wav:PH([87,65,86,69]),"3gp":PH([102,116,121,112,51,103]),mp4:PH([102,116,121,112]),fmp4:PH([115,116,121,112]),mov:PH([102,116,121,112,113,116]),moov:PH([109,111,111,118]),moof:PH([109,111,111,102])},aX={aac:function(e){var t=Wq(e);return $H(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Wq(e);return $H(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=Jq(e,[Xq.EBML,Xq.DocType])[0];return $H(t,sX.webm)},mkv:function(e){var t=Jq(e,[Xq.EBML,Xq.DocType])[0];return $H(t,sX.matroska)},mp4:function(e){return!aX["3gp"](e)&&!aX.mov(e)&&(!(!$H(e,sX.mp4,{offset:4})&&!$H(e,sX.fmp4,{offset:4}))||(!(!$H(e,sX.moof,{offset:4})&&!$H(e,sX.moov,{offset:4}))||void 0))},mov:function(e){return $H(e,sX.mov,{offset:4})},"3gp":function(e){return $H(e,sX["3gp"],{offset:4})},ac3:function(e){var t=Wq(e);return $H(e,sX.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];for(var t=0;t+188<e.length&&t<188;){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=Wq(e);return $H(e,sX.flac,{offset:t})},ogg:function(e){return $H(e,sX.ogg)},avi:function(e){return $H(e,sX.riff)&&$H(e,sX.avi,{offset:8})},wav:function(e){return $H(e,sX.riff)&&$H(e,sX.wav,{offset:8})},h264:function(e){return function(e,t,n){return rX(e,"h264",t,n)}(e,7,3).length},h265:function(e){return function(e,t,n){return rX(e,"h265",t,n)}(e,[32,33],3).length}},oX=Object.keys(aX).filter(function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e}).concat(["ts","h264","h265"]);oX.forEach(function(e){var t=aX[e];aX[e]=function(e){return t(PH(e))}});var lX,cX,uX,dX,hX=aX,pX=function(e){e=PH(e);for(var t=0;t<oX.length;t++){var n=oX[t];if(hX[n](e))return n}return""},fX=9e4;var mX=fX,gX=(lX=function(e){return e*fX},cX=function(e,t){return e*t},uX=function(e){return e/fX},dX=function(e,t){return e/t},"8.23.3");
/**
 * @license
 * Video.js 8.23.3 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */const bX={},yX=function(e,t){return bX[e]=bX[e]||[],t&&(bX[e]=bX[e].concat(t)),bX[e]},vX=function(e,t){const n=yX(e).indexOf(t);return!(n<=-1)&&(bX[e]=bX[e].slice(),bX[e].splice(n,1),!0)},TX={prefixed:!0},xX=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],_X=xX[0];let SX;for(let a6=0;a6<xX.length;a6++)if(xX[a6][1]in eV){SX=xX[a6];break}if(SX){for(let e=0;e<SX.length;e++)TX[_X[e]]=SX[e];TX.prefixed=SX[0]!==_X[0]}let wX=[];const IX=function e(t,n=":",i=""){let r,s="info";function a(...e){r("log",s,e)}return r=((e,t,n)=>(i,r,s)=>{const a=t.levels[r],o=new RegExp(`^(${a})$`);let l=e;if("log"!==i&&s.unshift(i.toUpperCase()+":"),n&&(l=`%c${e}`,s.unshift(n)),s.unshift(l+":"),wX){wX.push([].concat(s));const e=wX.length-1e3;wX.splice(0,e>0?e:0)}if(!ZG.console)return;let c=ZG.console[i];c||"debug"!==i||(c=ZG.console.info||ZG.console.log),c&&a&&o.test(i)&&c[Array.isArray(s)?"apply":"call"](ZG.console,s)})(t,a,i),a.createLogger=(r,s,a)=>{const o=void 0!==s?s:n;return e(`${t} ${o} ${r}`,o,void 0!==a?a:i)},a.createNewLogger=(t,n,i)=>e(t,n,i),a.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:s},a.level=e=>{if("string"==typeof e){if(!a.levels.hasOwnProperty(e))throw new Error(`"${e}" in not a valid log level`);s=e}return s},a.history=()=>wX?[].concat(wX):[],a.history.filter=e=>(wX||[]).filter(t=>new RegExp(`.*${e}.*`).test(t[0])),a.history.clear=()=>{wX&&(wX.length=0)},a.history.disable=()=>{null!==wX&&(wX.length=0,wX=null)},a.history.enable=()=>{null===wX&&(wX=[])},a.error=(...e)=>r("error",s,e),a.warn=(...e)=>r("warn",s,e),a.debug=(...e)=>r("debug",s,e),a}("VIDEOJS"),kX=IX.createLogger,CX=Object.prototype.toString,EX=function(e){return NX(e)?Object.keys(e):[]};function AX(e,t){EX(e).forEach(n=>t(e[n],n))}function RX(e,t,n=0){return EX(e).reduce((n,i)=>t(n,e[i],i),n)}function NX(e){return!!e&&"object"==typeof e}function PX(e){return NX(e)&&"[object Object]"===CX.call(e)&&e.constructor===Object}function DX(...e){const t={};return e.forEach(e=>{e&&AX(e,(e,n)=>{PX(e)?(PX(t[n])||(t[n]={}),t[n]=DX(t[n],e)):t[n]=e})}),t}function OX(e={}){const t=[];for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];t.push(i)}return t}function LX(e,t,n,i=!0){const r=n=>Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const e=n();return r(e),e}};return i&&(s.set=r),Object.defineProperty(e,t,s)}var MX=Object.freeze({__proto__:null,each:AX,reduce:RX,isObject:NX,isPlain:PX,merge:DX,values:OX,defineLazyProperty:LX});let FX,$X=!1,BX=null,zX=!1,UX=!1,GX=!1,VX=!1,HX=!1,WX=null,jX=null;const qX=Boolean(ZG.cast&&ZG.cast.framework&&ZG.cast.framework.CastReceiverContext);let XX=null,KX=!1,YX=!1,ZX=!1,QX=!1,JX=!1,eK=!1,tK=!1;const nK=Boolean(lK()&&("ontouchstart"in ZG||ZG.navigator.maxTouchPoints||ZG.DocumentTouch&&ZG.document instanceof ZG.DocumentTouch)),iK=ZG.navigator&&ZG.navigator.userAgentData;if(iK&&iK.platform&&iK.brands&&(zX="Android"===iK.platform,GX=Boolean(iK.brands.find(e=>"Microsoft Edge"===e.brand)),VX=Boolean(iK.brands.find(e=>"Chromium"===e.brand)),HX=!GX&&VX,WX=jX=(iK.brands.find(e=>"Chromium"===e.brand)||{}).version||null,YX="Windows"===iK.platform),!VX){const e=ZG.navigator&&ZG.navigator.userAgent||"";$X=/iPod/i.test(e),BX=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),zX=/Android/i.test(e),FX=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const n=t[1]&&parseFloat(t[1]),i=t[2]&&parseFloat(t[2]);return n&&i?parseFloat(t[1]+"."+t[2]):n||null}(),UX=/Firefox/i.test(e),GX=/Edg/i.test(e),VX=/Chrome/i.test(e)||/CriOS/i.test(e),HX=!GX&&VX,WX=jX=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),XX=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let n=t&&parseFloat(t[1]);return!n&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(n=11),n}(),JX=/Tizen/i.test(e),eK=/Web0S/i.test(e),tK=JX||eK,KX=/Safari/i.test(e)&&!HX&&!zX&&!GX&&!tK,YX=/Windows/i.test(e),ZX=/iPad/i.test(e)||KX&&nK&&!/iPhone/i.test(e),QX=/iPhone/i.test(e)&&!ZX}const rK=QX||ZX||$X,sK=(KX||rK)&&!HX;var aK=Object.freeze({__proto__:null,get IS_IPOD(){return $X},get IOS_VERSION(){return BX},get IS_ANDROID(){return zX},get ANDROID_VERSION(){return FX},get IS_FIREFOX(){return UX},get IS_EDGE(){return GX},get IS_CHROMIUM(){return VX},get IS_CHROME(){return HX},get CHROMIUM_VERSION(){return WX},get CHROME_VERSION(){return jX},IS_CHROMECAST_RECEIVER:qX,get IE_VERSION(){return XX},get IS_SAFARI(){return KX},get IS_WINDOWS(){return YX},get IS_IPAD(){return ZX},get IS_IPHONE(){return QX},get IS_TIZEN(){return JX},get IS_WEBOS(){return eK},get IS_SMART_TV(){return tK},TOUCH_ENABLED:nK,IS_IOS:rK,IS_ANY_SAFARI:sK});function oK(e){return"string"==typeof e&&Boolean(e.trim())}function lK(){return eV===ZG.document}function cK(e){return NX(e)&&1===e.nodeType}function uK(){try{return ZG.parent!==ZG.self}catch(e){return!0}}function dK(e){return function(t,n){if(!oK(t))return eV[e](null);oK(n)&&(n=eV.querySelector(n));const i=cK(n)?n:eV;return i[e]&&i[e](t)}}function hK(e="div",t={},n={},i){const r=eV.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){const n=t[e];"textContent"===e?pK(r,n):r[e]===n&&"tabIndex"!==e||(r[e]=n)}),Object.getOwnPropertyNames(n).forEach(function(e){r.setAttribute(e,n[e])}),i&&PK(r,i),r}function pK(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function fK(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function mK(e,t){return function(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}(t),e.classList.contains(t)}function gK(e,...t){return e.classList.add(...t.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e}function bK(e,...t){return e?(e.classList.remove(...t.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e):(IX.warn("removeClass was called with an element that doesn't exist"),null)}function yK(e,t,n){return"function"==typeof n&&(n=n(e,t)),"boolean"!=typeof n&&(n=void 0),t.split(/\s+/).forEach(t=>e.classList.toggle(t,n)),e}function vK(e,t){Object.getOwnPropertyNames(t).forEach(function(n){const i=t[n];null==i||!1===i?e.removeAttribute(n):e.setAttribute(n,!0===i?"":i)})}function TK(e){const t={},n=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(e&&e.attributes&&e.attributes.length>0){const i=e.attributes;for(let e=i.length-1;e>=0;e--){const r=i[e].name;let s=i[e].value;n.includes(r)&&(s=null!==s),t[r]=s}}return t}function xK(e,t){return e.getAttribute(t)}function _K(e,t,n){e.setAttribute(t,n)}function SK(e,t){e.removeAttribute(t)}function wK(){eV.body.focus(),eV.onselectstart=function(){return!1}}function IK(){eV.onselectstart=function(){return!0}}function kK(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),n={};return["bottom","height","left","right","top","width"].forEach(e=>{void 0!==t[e]&&(n[e]=t[e])}),n.height||(n.height=parseFloat(FK(e,"height"))),n.width||(n.width=parseFloat(FK(e,"width"))),n}}function CK(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,n=e.offsetHeight;let i=0,r=0;for(;e.offsetParent&&e!==eV[TX.fullscreenElement];)i+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:i,top:r,width:t,height:n}}function EK(e,t){const n={x:0,y:0};if(rK){let t=e;for(;t&&"html"!==t.nodeName.toLowerCase();){const e=FK(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);n.x+=t[4],n.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);n.x+=t[12],n.y+=t[13]}if(t.assignedSlot&&t.assignedSlot.parentElement&&ZG.WebKitCSSMatrix){const e=ZG.getComputedStyle(t.assignedSlot.parentElement).transform,i=new ZG.WebKitCSSMatrix(e);n.x+=i.m41,n.y+=i.m42}t=t.parentNode||t.host}}const i={},r=CK(t.target),s=CK(e),a=s.width,o=s.height;let l=t.offsetY-(s.top-r.top),c=t.offsetX-(s.left-r.left);return t.changedTouches&&(c=t.changedTouches[0].pageX-s.left,l=t.changedTouches[0].pageY+s.top,rK&&(c-=n.x,l-=n.y)),i.y=1-Math.max(0,Math.min(1,l/o)),i.x=Math.max(0,Math.min(1,c/a)),i}function AK(e){return NX(e)&&3===e.nodeType}function RK(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function NK(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(e=>("function"==typeof e&&(e=e()),cK(e)||AK(e)?e:"string"==typeof e&&/\S/.test(e)?eV.createTextNode(e):void 0)).filter(e=>e)}function PK(e,t){return NK(t).forEach(t=>e.appendChild(t)),e}function DK(e,t){return PK(RK(e),t)}function OK(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||("mousedown"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons)))}const LK=dK("querySelector"),MK=dK("querySelectorAll");function FK(e,t){if(!e||!t)return"";if("function"==typeof ZG.getComputedStyle){let n;try{n=ZG.getComputedStyle(e)}catch(r6){return""}return n?n.getPropertyValue(t)||n[t]:""}return""}function $K(e){[...eV.styleSheets].forEach(t=>{try{const n=[...t.cssRules].map(e=>e.cssText).join(""),i=eV.createElement("style");i.textContent=n,e.document.head.appendChild(i)}catch(r6){const i=eV.createElement("link");i.rel="stylesheet",i.type=t.type,i.media=t.media.mediaText,i.href=t.href,e.document.head.appendChild(i)}})}var BK=Object.freeze({__proto__:null,isReal:lK,isEl:cK,isInFrame:uK,createEl:hK,textContent:pK,prependTo:fK,hasClass:mK,addClass:gK,removeClass:bK,toggleClass:yK,setAttributes:vK,getAttributes:TK,getAttribute:xK,setAttribute:_K,removeAttribute:SK,blockTextSelection:wK,unblockTextSelection:IK,getBoundingClientRect:kK,findPosition:CK,getPointerPosition:EK,isTextNode:AK,emptyEl:RK,normalizeContent:NK,appendContent:PK,insertContent:DK,isSingleLeftClick:OK,$:LK,$$:MK,computedStyle:FK,copyStyleSheetsToWindow:$K});let zK,UK=!1;const GK=function(){if(!1===zK.options.autoSetup)return;const e=Array.prototype.slice.call(eV.getElementsByTagName("video")),t=Array.prototype.slice.call(eV.getElementsByTagName("audio")),n=Array.prototype.slice.call(eV.getElementsByTagName("video-js")),i=e.concat(t,n);if(i&&i.length>0)for(let r=0,s=i.length;r<s;r++){const e=i[r];if(!e||!e.getAttribute){VK(1);break}if(void 0===e.player){null!==e.getAttribute("data-setup")&&zK(e)}}else UK||VK(1)};function VK(e,t){lK()&&(t&&(zK=t),ZG.setTimeout(GK,e))}function HK(){UK=!0,ZG.removeEventListener("load",HK)}lK()&&("complete"===eV.readyState?HK():ZG.addEventListener("load",HK));const WK=function(e){const t=eV.createElement("style");return t.className=e,t},jK=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var qK=new WeakMap;let XK,KK=3;function YK(){return KK++}function ZK(e,t){if(!qK.has(e))return;const n=qK.get(e);0===n.handlers[t].length&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),Object.getOwnPropertyNames(n.handlers).length<=0&&(delete n.handlers,delete n.dispatcher,delete n.disabled),0===Object.getOwnPropertyNames(n).length&&qK.delete(e)}function QK(e,t,n,i){n.forEach(function(n){e(t,n,i)})}function JK(e){if(e.fixed_)return e;function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const i=e||ZG.event;e={};const r=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const t in i)r.includes(t)||"returnValue"===t&&i.preventDefault||(e[t]=i[t]);if(e.target||(e.target=e.srcElement||eV),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){i.preventDefault&&i.preventDefault(),e.returnValue=!1,i.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),e.cancelBubble=!0,i.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n,null!==e.clientX&&void 0!==e.clientX){const t=eV.documentElement,n=eV.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const eY=["touchstart","touchmove"];function tY(e,t,n){if(Array.isArray(t))return QK(tY,e,t,n);qK.has(e)||qK.set(e,{});const i=qK.get(e);if(i.handlers||(i.handlers={}),i.handlers[t]||(i.handlers[t]=[]),n.guid||(n.guid=YK()),i.handlers[t].push(n),i.dispatcher||(i.disabled=!1,i.dispatcher=function(t,n){if(i.disabled)return;t=JK(t);const r=i.handlers[t.type];if(r){const i=r.slice(0);for(let r=0,s=i.length;r<s&&!t.isImmediatePropagationStopped();r++)try{i[r].call(e,t,n)}catch(r6){IX.error(r6)}}}),1===i.handlers[t].length)if(e.addEventListener){let n=!1;(function(){if("boolean"!=typeof XK){XK=!1;try{const e=Object.defineProperty({},"passive",{get(){XK=!0}});ZG.addEventListener("test",null,e),ZG.removeEventListener("test",null,e)}catch(r6){}}return XK})()&&eY.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,i.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,i.dispatcher)}function nY(e,t,n){if(!qK.has(e))return;const i=qK.get(e);if(!i.handlers)return;if(Array.isArray(t))return QK(nY,e,t,n);const r=function(e,t){i.handlers[t]=[],ZK(e,t)};if(void 0===t){for(const t in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},t)&&r(e,t);return}const s=i.handlers[t];if(s)if(n){if(n.guid)for(let e=0;e<s.length;e++)s[e].guid===n.guid&&s.splice(e--,1);ZK(e,t)}else r(e,t)}function iY(e,t,n){const i=qK.has(e)?qK.get(e):{},r=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=JK(t),i.dispatcher&&i.dispatcher.call(e,t,n),r&&!t.isPropagationStopped()&&!0===t.bubbles)iY.call(null,r,t,n);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){qK.has(t.target)||qK.set(t.target,{});const e=qK.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function rY(e,t,n){if(Array.isArray(t))return QK(rY,e,t,n);const i=function(){nY(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||YK(),tY(e,t,i)}function sY(e,t,n){const i=function(){nY(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||YK(),tY(e,t,i)}var aY=Object.freeze({__proto__:null,fixEvent:JK,on:tY,off:nY,trigger:iY,one:rY,any:sY});const oY=30,lY=function(e,t,n){t.guid||(t.guid=YK());const i=t.bind(e);return i.guid=n?n+"_"+t.guid:t.guid,i},cY=function(e,t){let n=ZG.performance.now();return function(...i){const r=ZG.performance.now();r-n>=t&&(e(...i),n=r)}},uY=function(e,t,n,i=ZG){let r;const s=function(){const s=this,a=arguments;let o=function(){r=null,o=null,n||e.apply(s,a)};!r&&n&&e.apply(s,a),i.clearTimeout(r),r=i.setTimeout(o,t)};return s.cancel=()=>{i.clearTimeout(r),r=null},s};var dY=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:oY,bind_:lY,throttle:cY,debounce:uY});let hY;class pY{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},tY(this,e,t),this.addEventListener=n}off(e,t){nY(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},rY(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},sY(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;"string"==typeof e&&(e={type:t}),e=JK(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),iY(this,e)}queueTrigger(e){hY||(hY=new Map);const t=e.type||e;let n=hY.get(this);n||(n=new Map,hY.set(this,n));const i=n.get(t);n.delete(t),ZG.clearTimeout(i);const r=ZG.setTimeout(()=>{n.delete(t),0===n.size&&(n=null,hY.delete(this)),this.trigger(e)},0);n.set(t,r)}}pY.prototype.allowedEvents_={},pY.prototype.addEventListener=pY.prototype.on,pY.prototype.removeEventListener=pY.prototype.off,pY.prototype.dispatchEvent=pY.prototype.trigger;const fY=e=>"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e,mY=e=>e instanceof pY||!!e.eventBusEl_&&["on","one","off","trigger"].every(t=>"function"==typeof e[t]),gY=e=>"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,bY=(e,t,n)=>{if(!e||!e.nodeName&&!mY(e))throw new Error(`Invalid target for ${fY(t)}#${n}; must be a DOM node or evented object.`)},yY=(e,t,n)=>{if(!gY(e))throw new Error(`Invalid event type for ${fY(t)}#${n}; must be a non-empty string or array.`)},vY=(e,t,n)=>{if("function"!=typeof e)throw new Error(`Invalid listener for ${fY(t)}#${n}; must be a function.`)},TY=(e,t,n)=>{const i=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let r,s,a;return i?(r=e.eventBusEl_,t.length>=3&&t.shift(),[s,a]=t):(r=t[0],s=t[1],a=t[2]),bY(r,e,n),yY(s,e,n),vY(a,e,n),a=lY(e,a),{isTargetingSelf:i,target:r,type:s,listener:a}},xY=(e,t,n,i)=>{bY(e,e,t),e.nodeName?aY[t](e,n,i):e[t](n,i)},_Y={on(...e){const{isTargetingSelf:t,target:n,type:i,listener:r}=TY(this,e,"on");if(xY(n,"on",i,r),!t){const e=()=>this.off(n,i,r);e.guid=r.guid;const t=()=>this.off("dispose",e);t.guid=r.guid,xY(this,"on","dispose",e),xY(n,"on","dispose",t)}},one(...e){const{isTargetingSelf:t,target:n,type:i,listener:r}=TY(this,e,"one");if(t)xY(n,"one",i,r);else{const e=(...t)=>{this.off(n,i,e),r.apply(null,t)};e.guid=r.guid,xY(n,"one",i,e)}},any(...e){const{isTargetingSelf:t,target:n,type:i,listener:r}=TY(this,e,"any");if(t)xY(n,"any",i,r);else{const e=(...t)=>{this.off(n,i,e),r.apply(null,t)};e.guid=r.guid,xY(n,"any",i,e)}},off(e,t,n){if(!e||gY(e))nY(this.eventBusEl_,e,t);else{const i=e,r=t;bY(i,this,"off"),yY(r,this,"off"),vY(n,this,"off"),n=lY(this,n),this.off("dispose",n),i.nodeName?(nY(i,r,n),nY(i,"dispose",n)):mY(i)&&(i.off(r,n),i.off("dispose",n))}},trigger(e,t){bY(this.eventBusEl_,this,"trigger");const n=e&&"string"!=typeof e?e.type:e;if(!gY(n))throw new Error(`Invalid event type for ${fY(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return iY(this.eventBusEl_,e,t)}};function SY(e,t={}){const{eventBusKey:n}=t;if(n){if(!e[n].nodeName)throw new Error(`The eventBusKey "${n}" does not refer to an element.`);e.eventBusEl_=e[n]}else e.eventBusEl_=hK("span",{className:"vjs-event-bus"});return Object.assign(e,_Y),e.eventedCallbacks&&e.eventedCallbacks.forEach(e=>{e()}),e.on("dispose",()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach(function(e){e&&qK.has(e)&&qK.delete(e)}),ZG.setTimeout(()=>{e.eventBusEl_=null},0)}),e}const wY={state:{},setState(e){let t;return"function"==typeof e&&(e=e()),AX(e,(e,n)=>{this.state[n]!==e&&(t=t||{},t[n]={from:this.state[n],to:e}),this.state[n]=e}),t&&mY(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function IY(e,t){return Object.assign(e,wY),e.state=Object.assign({},e.state,t),"function"==typeof e.handleStateChanged&&mY(e)&&e.on("statechanged",e.handleStateChanged),e}const kY=function(e){return"string"!=typeof e?e:e.replace(/./,e=>e.toLowerCase())},CY=function(e){return"string"!=typeof e?e:e.replace(/./,e=>e.toUpperCase())},EY=function(e,t){return CY(e)===CY(t)};var AY=Object.freeze({__proto__:null,toLowerCase:kY,toTitleCase:CY,titleCaseEquals:EY});class RY{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=DX({},this.options_),t=this.options_=DX(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${YK()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(e=>this.addClass(e)),["on","off","one","any","trigger"].forEach(e=>{this[e]=void 0}),!1!==t.evented&&(SY(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),IY(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(n),!1!==t.reportTouchActivity&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=DX(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return hK(e,t,n)}localize(e,t,n=e){const i=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),s=r&&r[i],a=i&&i.split("-")[0],o=r&&r[a];let l=n;return s&&s[e]?l=s[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,n){const i=t[n-1];let r=i;return void 0===i&&(r=e),r})),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((e,t)=>e.concat(t),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",i=hK("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),r=eV.createElementNS(n,"svg");r.setAttributeNS(null,"viewBox","0 0 512 512");const s=eV.createElementNS(n,"use");return r.appendChild(s),s.setAttributeNS(null,"href",`#vjs-icon-${e}`),i.appendChild(r),this.iconIsSet_?t.replaceChild(i,t.querySelector(".vjs-icon-placeholder")):t.appendChild(i),this.iconIsSet_=!0,i}addChild(e,t={},n=this.children_.length){let i,r;if("string"==typeof e){r=CY(e);const n=t.componentClass||r;t.name=r;const s=RY.getComponent(n);if(!s)throw new Error(`Component ${n} does not exist`);if("function"!=typeof s)return null;i=new s(this.player_||this,t)}else i=e;if(i.parentComponent_&&i.parentComponent_.removeChild(i),this.children_.splice(n,0,i),i.parentComponent_=this,"function"==typeof i.id&&(this.childIndex_[i.id()]=i),r=r||i.name&&CY(i.name()),r&&(this.childNameIndex_[r]=i,this.childNameIndex_[kY(r)]=i),"function"==typeof i.el&&i.el()){let e=null;this.children_[n+1]&&(this.children_[n+1].el_?e=this.children_[n+1].el_:cK(this.children_[n+1])&&(e=this.children_[n+1])),this.contentEl().insertBefore(i.el(),e)}return i}removeChild(e){if("string"==typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[CY(e.name())]=null,this.childNameIndex_[kY(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=e=>{const n=e.name;let i=e.opts;if(void 0!==t[n]&&(i=t[n]),!1===i)return;!0===i&&(i={}),i.playerOptions=this.options_.playerOptions;const r=this.addChild(n,i);r&&(this[n]=r)};let i;const r=RY.getComponent("Tech");i=Array.isArray(e)?e:Object.keys(e),i.concat(Object.keys(this.options_).filter(function(e){return!i.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(t=>{let n,i;return"string"==typeof t?(n=t,i=e[n]||this.options_[n]||{}):(n=t.name,i=t),{name:n,opts:i}}).filter(e=>{const t=RY.getComponent(e.opts.componentClass||CY(e.name));return t&&!r.isTech(t)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)}$(e,t){return LK(e,t||this.contentEl())}$$(e,t){return MK(e,t||this.contentEl())}hasClass(e){return mK(this.el_,e)}addClass(...e){gK(this.el_,...e)}removeClass(...e){bK(this.el_,...e)}toggleClass(e,t){yK(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return xK(this.el_,e)}setAttribute(e,t){_K(this.el_,e,t)}removeAttribute(e){SK(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(n||this.trigger("componentresize"));if(!this.el_)return 0;const i=this.el_.style[e],r=i.indexOf("px");return-1!==r?parseInt(i.slice(0,r),10):parseInt(this.el_["offset"+CY(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=FK(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const n=`offset${CY(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect();return{boundingClientRect:{x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},center:{x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2}}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&("Tab"===e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;let n;this.on("touchstart",function(i){1===i.touches.length&&(t={pageX:i.touches[0].pageX,pageY:i.touches[0].pageY},e=ZG.performance.now(),n=!0)}),this.on("touchmove",function(e){if(e.touches.length>1)n=!1;else if(t){const i=e.touches[0].pageX-t.pageX,r=e.touches[0].pageY-t.pageY;Math.sqrt(i*i+r*r)>10&&(n=!1)}});const i=function(){n=!1};this.on("touchleave",i),this.on("touchcancel",i),this.on("touchend",function(i){if(t=null,!0===n){ZG.performance.now()-e<200&&(i.preventDefault(),this.trigger("tap"))}})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=lY(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(n){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=lY(this,e),this.clearTimersOnDispose_(),n=ZG.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),ZG.clearTimeout(e)),e}setInterval(e,t){e=lY(this,e),this.clearTimersOnDispose_();const n=ZG.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),ZG.clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=lY(this,e),t=ZG.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=lY(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),ZG.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((e,n)=>this[t](n))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return Boolean(this.el_.disabled)}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(e){const t=ZG.getComputedStyle(e,null),n=t.getPropertyValue("visibility");return"none"!==t.getPropertyValue("display")&&!["hidden","collapse"].includes(n)}return e||(e=this.el()),!!(function(e){if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(eV.documentElement.clientWidth||ZG.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(eV.documentElement.clientHeight||ZG.innerHeight))return!1;let n=eV.elementFromPoint(t.x,t.y);for(;n;){if(n===e)return!0;if(!n.parentNode)return!1;n=n.parentNode}}(e)&&(n=e,t(n.parentElement)&&t(n)&&"0"!==n.style.opacity&&"0px"!==ZG.getComputedStyle(n).height&&"0px"!==ZG.getComputedStyle(n).width)&&(!e.parentElement||e.tabIndex>=0));var n}static registerComponent(e,t){if("string"!=typeof e||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=RY.getComponent("Tech"),i=n&&n.isTech(t),r=RY===t||RY.prototype.isPrototypeOf(t.prototype);if(i||!r){let t;throw t=i?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${e}"; ${t}.`)}e=CY(e),RY.components_||(RY.components_={});const s=RY.getComponent("Player");if("Player"===e&&s&&s.players){const e=s.players,t=Object.keys(e);if(e&&t.length>0)for(let n=0;n<t.length;n++)if(null!==e[t[n]])throw new Error("Can not register Player component after player has been created.")}return RY.components_[e]=t,RY.components_[kY(e)]=t,t}static getComponent(e){if(e&&RY.components_)return RY.components_[e]}}function NY(e,t,n,i){return function(e,t,n){if("number"!=typeof t||t<0||t>n)throw new Error(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is non-numeric or out of bounds (0-${n}).`)}(e,i,n.length-1),n[i][t]}function PY(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:NY.bind(null,"start",0,e),end:NY.bind(null,"end",1,e)},ZG.Symbol&&ZG.Symbol.iterator&&(t[ZG.Symbol.iterator]=()=>(e||[]).values()),t}function DY(e,t){return Array.isArray(e)?PY(e):void 0===e||void 0===t?PY():PY([[e,t]])}RY.registerComponent("Component",RY);const OY=function(e,t){e=e<0?0:e;let n=Math.floor(e%60),i=Math.floor(e/60%60),r=Math.floor(e/3600);const s=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=i=n="-"),r=r>0||a>0?r+":":"",i=((r||s>=10)&&i<10?"0"+i:i)+":",n=n<10?"0"+n:n,r+i+n};let LY=OY;function MY(e){LY=e}function FY(){LY=OY}function $Y(e,t=e){return LY(e,t)}var BY=Object.freeze({__proto__:null,createTimeRanges:DY,createTimeRange:DY,setFormatTime:MY,resetFormatTime:FY,formatTime:$Y});function zY(e,t){let n,i,r=0;if(!t)return 0;e&&e.length||(e=DY(0,0));for(let s=0;s<e.length;s++)n=e.start(s),i=e.end(s),i>t&&(i=t),r+=i-n;return r/t}function UY(e){if(e instanceof UY)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:NX(e)&&("number"==typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=UY.defaultMessages[this.code]||"")}function GY(e){return null!=e&&"function"==typeof e.then}function VY(e){GY(e)&&e.then(null,e=>{})}UY.prototype.code=0,UY.prototype.message="",UY.prototype.status=null,UY.prototype.metadata=null,UY.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],UY.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."},UY.MEDIA_ERR_CUSTOM=0,UY.prototype.MEDIA_ERR_CUSTOM=0,UY.MEDIA_ERR_ABORTED=1,UY.prototype.MEDIA_ERR_ABORTED=1,UY.MEDIA_ERR_NETWORK=2,UY.prototype.MEDIA_ERR_NETWORK=2,UY.MEDIA_ERR_DECODE=3,UY.prototype.MEDIA_ERR_DECODE=3,UY.MEDIA_ERR_SRC_NOT_SUPPORTED=4,UY.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4,UY.MEDIA_ERR_ENCRYPTED=5,UY.prototype.MEDIA_ERR_ENCRYPTED=5;const HY=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,i)=>(e[n]&&(t[n]=e[n]),t),{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})};var WY=function(e){const t=e.$$("track"),n=Array.prototype.map.call(t,e=>e.track);return Array.prototype.map.call(t,function(e){const t=HY(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===n.indexOf(e)}).map(HY))},jY=function(e,t){return e.forEach(function(e){const n=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(e=>n.addCue(e))}),t.textTracks()},qY=HY;const XY="vjs-modal-dialog";class KY extends RY{constructor(e,t){super(e,t),this.handleKeyDown_=e=>this.handleKeyDown(e),this.close_=e=>this.close(e),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=hK("div",{className:`${XY}-content`},{role:"document"}),this.descEl_=hK("p",{className:`${XY}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),pK(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${XY} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_)return void(this.options_.fillAlways&&this.fill());const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"==typeof e){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const e=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,i=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),DK(t,e),this.trigger("modalfill"),i?n.insertBefore(t,i):n.appendChild(t);const r=this.getChild("closeButton");r&&n.appendChild(r.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),RK(this.contentEl()),this.trigger("modalempty")}content(e){return void 0!==e&&(this.content_=e),this.content_}conditionalFocus_(){const e=eV.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),"Escape"===e.key&&this.closeable())return e.preventDefault(),void this.close();if("Tab"!==e.key)return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let i;for(let r=0;r<t.length;r++)if(n===t[r]){i=r;break}eV.activeElement===this.el_&&(i=0),e.shiftKey&&0===i?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||i!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,e=>(e instanceof ZG.HTMLAnchorElement||e instanceof ZG.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof ZG.HTMLInputElement||e instanceof ZG.HTMLSelectElement||e instanceof ZG.HTMLTextAreaElement||e instanceof ZG.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof ZG.HTMLIFrameElement||e instanceof ZG.HTMLObjectElement||e instanceof ZG.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable"))}}KY.prototype.options_={pauseOnOpen:!0,temporary:!0},RY.registerComponent("ModalDialog",KY);class YY extends pY{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},mY(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,i=this.length;n<i;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,i=this.length;n<i;n++){const i=this[n];if(i.id===e){t=i;break}}return t}}YY.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const a6 in YY.prototype.allowedEvents_)YY.prototype["on"+a6]=null;const ZY=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].enabled=!1)};class QY extends YY{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){ZY(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&ZY(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,ZY(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const JY=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].selected=!1)};class eZ extends YY{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){JY(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&JY(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,JY(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class tZ extends YY{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_);-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map(e=>e.toJSON())}}class nZ{constructor(e){nZ.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const i=e.length;this.cues_=e,this.length_=e.length;const r=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<i)for(n=t;n<i;n++)r.call(this,n)}getCueById(e){let t=null;for(let n=0,i=this.length;n<i;n++){const i=this[n];if(i.id===e){t=i;break}}return t}}const iZ={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},rZ={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},sZ={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},aZ={disabled:"disabled",hidden:"hidden",showing:"showing"};class oZ extends pY{constructor(e={}){super();const t={id:e.id||"vjs_track_"+YK(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const i in t)Object.defineProperty(this,i,{get:()=>t[i],set(){}});Object.defineProperty(this,"label",{get:()=>n,set(e){e!==n&&(n=e,this.trigger("labelchange"))}})}}const lZ=function(e){return new URL(e,eV.baseURI)},cZ=function(e){return new URL(e,eV.baseURI).href},uZ=function(e){if("string"==typeof e){const t=e.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return t?t[1].toLowerCase():""}return""},dZ=function(e,t=ZG.location){return lZ(e).origin!==t.origin};var hZ=Object.freeze({__proto__:null,parseUrl:lZ,getAbsoluteURL:cZ,getFileExtension:uZ,isCrossOrigin:dZ});const pZ=function(e,t){const n=new ZG.WebVTT.Parser(ZG,ZG.vttjs,ZG.WebVTT.StringDecoder()),i=[];n.oncue=function(e){t.addCue(e)},n.onparsingerror=function(e){i.push(e)},n.onflush=function(){t.trigger({type:"loadeddata",target:t})},n.parse(e),i.length>0&&(ZG.console&&ZG.console.groupCollapsed&&ZG.console.groupCollapsed(`Text Track parsing errors for ${t.src}`),i.forEach(e=>IX.error(e)),ZG.console&&ZG.console.groupEnd&&ZG.console.groupEnd()),n.flush()},fZ=function(e,t){const n={uri:e},i=dZ(e);i&&(n.cors=i);const r="use-credentials"===t.tech_.crossOrigin();r&&(n.withCredentials=r),tV.exports(n,lY(this,function(e,n,i){if(e)return IX.error(e,n);t.loaded_=!0,"function"!=typeof ZG.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],e=>{if("vttjserror"!==e.type)return pZ(i,t);IX.error(`vttjs failed to load, stopping trying to process ${t.src}`)}):pZ(i,t)}))};class mZ extends oZ{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=DX(e,{kind:sZ[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=aZ[t.mode]||"disabled";const i=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const r=new nZ(this.cues_),s=new nZ(this.activeCues_);let a=!1;this.timeupdateHandler=lY(this,function(e={}){this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,a&&(this.trigger("cuechange"),a=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))});this.tech_.one("dispose",()=>{this.stopTracking()}),"disabled"!==n&&this.startTracking(),Object.defineProperties(this,{default:{get:()=>i,set(){}},mode:{get:()=>n,set(e){aZ[e]&&n!==e&&(n=e,this.preload_||"disabled"===n||0!==this.cues.length||fZ(this.src,this),this.stopTracking(),"disabled"!==n&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?r:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return s;const e=this.tech_.currentTime(),t=[];for(let n=0,i=this.cues.length;n<i;n++){const i=this.cues[n];i.startTime<=e&&i.endTime>=e&&t.push(i)}if(a=!1,t.length!==this.activeCues_.length)a=!0;else for(let n=0;n<t.length;n++)-1===this.activeCues_.indexOf(t[n])&&(a=!0);return this.activeCues_=t,s.setCues_(this.activeCues_),s},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&fZ(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new ZG.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const n in e)n in t||(t[n]=e[n]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let i=0;i<n.length;i++)n[i]!==this&&n[i].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}toJSON(){return qY(this)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}mZ.prototype.allowedEvents_={cuechange:"cuechange"};class gZ extends oZ{constructor(e={}){const t=DX(e,{kind:rZ[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get:()=>n,set(e){"boolean"==typeof e&&e!==n&&(n=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class bZ extends oZ{constructor(e={}){const t=DX(e,{kind:iZ[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get:()=>n,set(e){"boolean"==typeof e&&e!==n&&(n=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class yZ extends pY{constructor(e={}){let t;super();const n=new mZ(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get:()=>t},track:{get:()=>n}}),t=yZ.NONE,n.addEventListener("loadeddata",()=>{t=yZ.LOADED,this.trigger({type:"load",target:this})})}}yZ.prototype.allowedEvents_={load:"load"},yZ.NONE=0,yZ.LOADING=1,yZ.LOADED=2,yZ.ERROR=3;const vZ={audio:{ListClass:QY,TrackClass:gZ,capitalName:"Audio"},video:{ListClass:eZ,TrackClass:bZ,capitalName:"Video"},text:{ListClass:tZ,TrackClass:mZ,capitalName:"Text"}};Object.keys(vZ).forEach(function(e){vZ[e].getterName=`${e}Tracks`,vZ[e].privateName=`${e}Tracks_`});const TZ={remoteText:{ListClass:tZ,TrackClass:mZ,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:class{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,i=this.trackElements_.length;n<i;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}},TrackClass:yZ,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},xZ=Object.assign({},vZ,TZ);TZ.names=Object.keys(TZ),vZ.names=Object.keys(vZ),xZ.names=[].concat(TZ.names).concat(vZ.names);class _Z extends RY{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=e=>this.onDurationChange(e),this.trackProgress_=e=>this.trackProgress(e),this.trackCurrentTime_=e=>this.trackCurrentTime(e),this.stopTrackingCurrentTime_=e=>this.stopTrackingCurrentTime(e),this.disposeSourceHandler_=e=>this.disposeSourceHandler(e),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),xZ.names.forEach(t=>{const n=xZ[t];e&&e[n.getterName]&&(this[n.privateName]=e[n.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(t=>{!1===e[`native${t}Tracks`]&&(this[`featuresNative${t}Tracks`]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new xZ.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(lY(this,function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return DY(0,0)}bufferedPercent(){return zY(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(vZ.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){(e=[].concat(e)).forEach(e=>{const t=this[`${e}Tracks`]()||[];let n=t.length;for(;n--;){const i=t[n];"text"===e&&this.removeRemoteTextTrack(i),t.removeTrack(i)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new UY(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?DY(0,0):DY()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){vZ.names.forEach(e=>{const t=vZ[e],n=()=>{this.trigger(`${e}trackchange`)},i=this[t.getterName]();i.addEventListener("removetrack",n),i.addEventListener("addtrack",n),this.on("dispose",()=>{i.removeEventListener("removetrack",n),i.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!ZG.WebVTT)if(eV.body.contains(this.el())){if(!this.options_["vtt.js"]&&PX(TV.exports)&&Object.keys(TV.exports).length>0)return void this.trigger("vttjsloaded");const e=eV.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),ZG.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=t=>e.addTrack(t.track),i=t=>e.removeTrack(t.track);t.on("addtrack",n),t.on("removetrack",i),this.addWebVttScript_();const r=()=>this.trigger("texttrackchange"),s=()=>{r();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("cuechange",r),"showing"===n.mode&&n.addEventListener("cuechange",r)}};s(),e.addEventListener("change",s),e.addEventListener("addtrack",s),e.addEventListener("removetrack",s),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",i),e.removeEventListener("change",s),e.removeEventListener("addtrack",s),e.removeEventListener("removetrack",s);for(let t=0;t<e.length;t++){e[t].removeEventListener("cuechange",r)}})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,n,i,r={}){const s=e.textTracks();r.kind=t,n&&(r.label=n),i&&(r.language=i),r.tech=e;const a=new xZ.text.TrackClass(r);return s.addTrack(a),a}(this,e,t,n)}createRemoteTextTrack(e){const t=DX(e,{tech:this});return new TZ.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return"boolean"!=typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!1===t&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=YK();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return _Z.canPlayType(e.type)}static isTech(e){return e.prototype instanceof _Z||e instanceof _Z||e===_Z}static registerTech(e,t){if(_Z.techs_||(_Z.techs_={}),!_Z.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!_Z.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!_Z.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=CY(e),_Z.techs_[e]=t,_Z.techs_[kY(e)]=t,"Tech"!==e&&_Z.defaultTechOrder_.push(e),t}static getTech(e){if(e)return _Z.techs_&&_Z.techs_[e]?_Z.techs_[e]:(e=CY(e),ZG&&ZG.videojs&&ZG.videojs[e]?(IX.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),ZG.videojs[e]):void 0)}}xZ.names.forEach(function(e){const t=xZ[e];_Z.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),_Z.prototype.featuresVolumeControl=!0,_Z.prototype.featuresMuteControl=!0,_Z.prototype.featuresFullscreenResize=!1,_Z.prototype.featuresPlaybackRate=!1,_Z.prototype.featuresProgressEvents=!1,_Z.prototype.featuresSourceset=!1,_Z.prototype.featuresTimeupdateEvents=!1,_Z.prototype.featuresNativeTextTracks=!1,_Z.prototype.featuresVideoFrameCallback=!1,_Z.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){let i=e.sourceHandlers;i||(i=e.sourceHandlers=[]),void 0===n&&(n=i.length),i.splice(n,0,t)},e.canPlayType=function(t){const n=e.sourceHandlers||[];let i;for(let e=0;e<n.length;e++)if(i=n[e].canPlayType(t),i)return i;return""},e.selectSourceHandler=function(t,n){const i=e.sourceHandlers||[];let r;for(let e=0;e<i.length;e++)if(r=i[e].canHandleSource(t,n),r)return i[e];return null},e.canPlaySource=function(t,n){const i=e.selectSourceHandler(t,n);return i?i.canHandleSource(t,n):""};["seekable","seeking","duration"].forEach(function(e){const t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){let n=e.selectSourceHandler(t,this.options_);n||(e.nativeSourceHandler?n=e.nativeSourceHandler:IX.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},RY.registerComponent("Tech",_Z),_Z.registerTech("Tech",_Z),_Z.defaultTechOrder_=[];const SZ={},wZ={},IZ={};function kZ(e,t,n){e.setTimeout(()=>PZ(t,SZ[t.type],n,e),1)}function CZ(e,t,n,i=null){const r="call"+CY(n),s=e.reduce(NZ(r),i),a=s===IZ,o=a?null:t[n](s);return function(e,t,n,i){for(let r=e.length-1;r>=0;r--){const s=e[r];s[t]&&s[t](i,n)}}(e,n,o,a),o}const EZ={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},AZ={setCurrentTime:1,setMuted:1,setVolume:1},RZ={play:1,pause:1};function NZ(e){return(t,n)=>t===IZ?IZ:n[e]?n[e](t):t}function PZ(e={},t=[],n,i,r=[],s=!1){const[a,...o]=t;if("string"==typeof a)PZ(e,SZ[a],n,i,r,s);else if(a){const t=function(e,t){const n=wZ[e.id()];let i=null;if(null==n)return i=t(e),wZ[e.id()]=[[t,i]],i;for(let r=0;r<n.length;r++){const[e,s]=n[r];e===t&&(i=s)}return null===i&&(i=t(e),n.push([t,i])),i}(i,a);if(!t.setSource)return r.push(t),PZ(e,o,n,i,r,s);t.setSource(Object.assign({},e),function(a,l){if(a)return PZ(e,o,n,i,r,s);r.push(t),PZ(l,e.type===l.type?o:SZ[l.type],n,i,r,s)})}else o.length?PZ(e,o,n,i,r,s):s?n(e,r):PZ(e,SZ["*"],n,i,r,!0)}const DZ={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},OZ=function(e=""){const t=uZ(e);return DZ[t.toLowerCase()]||""},LZ=function(e){if(Array.isArray(e)){let t=[];e.forEach(function(e){e=LZ(e),Array.isArray(e)?t=t.concat(e):NX(e)&&t.push(e)}),e=t}else e="string"==typeof e&&e.trim()?[MZ({src:e})]:NX(e)&&"string"==typeof e.src&&e.src&&e.src.trim()?[MZ(e)]:[];return e};function MZ(e){if(!e.type){const t=OZ(e.src);t&&(e.type=t)}return e}const FZ=JX?10009:eK?461:8,$Z={codes:{play:415,pause:19,ff:417,rw:412,back:FZ},names:{415:"play",19:"pause",417:"ff",412:"rw",[FZ]:"back"},isEventKey(e,t){return t=t.toLowerCase(),!(!this.names[e.keyCode]||this.names[e.keyCode]!==t)},getEventName(e){if(this.names[e.keyCode])return this.names[e.keyCode];if(this.codes[e.code]){const t=this.codes[e.code];return this.names[t]}return null}};class BZ extends pY{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const e=t.key.substring(5).toLowerCase();this.move(e)}else if($Z.isEventKey(t,"play")||$Z.isEventKey(t,"pause")||$Z.isEventKey(t,"ff")||$Z.isEventKey(t,"rw")){t.preventDefault();const e=$Z.getEventName(t);this.performMediaAction_(e)}else $Z.isEventKey(t,"Back")&&e.target&&"function"==typeof e.target.closeable&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+5);break;case"rw":this.userSeek_(this.player_.currentTime()-5)}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let n=null;const i=this.getCurrentComponent(e.target);t&&(n=Boolean(t.closest(".video-js")),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(e.currentTarget.contains(e.relatedTarget)||n)&&t||(i&&"CloseButton"===i.name()?this.refocusComponent():(this.pause(),i&&i.el()&&(this.lastFocusedComponent_=i)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function n(e){for(const i of e)i.hasOwnProperty("el_")&&i.getIsFocusable()&&i.getIsAvailableToBeFocused(i.el())&&t.push(i),i.hasOwnProperty("children_")&&i.children_.length>0&&n(i.children_)}return e.children_.forEach(e=>{if(e.hasOwnProperty("el_")){if(e.getIsFocusable&&e.getIsAvailableToBeFocused&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el()))return void t.push(e);e.hasOwnProperty("children_")&&e.children_.length>0?n(e.children_):e.hasOwnProperty("items")&&e.items.length>0?n(e.items):this.findSuitableDOMChild(e)&&t.push(e)}if("ErrorDisplay"===e.name_&&e.opened_){const n=e.el_.querySelector(".vjs-errors-ok-button-container");if(n){n.querySelectorAll("button").forEach((e,n)=>{t.push({name:()=>"ModalButton"+(n+1),el:()=>e,getPositions:()=>{const t=e.getBoundingClientRect();return{boundingClientRect:{x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left},center:{x:t.left+t.width/2,y:t.top+t.height/2,width:0,height:0,top:t.top+t.height/2,right:t.left+t.width/2,bottom:t.top+t.height/2,left:t.left+t.width/2}}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:e=>!0,focus:()=>e.focus()})})}}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){return e.el()?function t(n){if(e.getIsFocusable(n)&&e.getIsAvailableToBeFocused(n))return n;for(let e=0;e<n.children.length;e++){const i=t(n.children[e]);if(i)return i}return null}(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length)for(const n of this.focusableComponents)if(n.el()===t)return n}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name())return this.focusableComponents.splice(t,1),void this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const n=t.getPositions(),i=this.focusableComponents.filter(i=>i!==t&&this.isInDirection_(n.boundingClientRect,i.getPositions().boundingClientRect,e)),r=this.findBestCandidate_(n.center,i,e);r?this.focus(r):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,n){let i=1/0,r=null;for(const s of t){const t=s.getPositions().center,a=this.calculateDistance_(e,t,n);a<i&&(i=a,r=s)}return r}isInDirection_(e,t,n){switch(n){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name())return void this.focus(this.focusableComponents[e])}else this.focus(this.updateFocusableComponents()[0])}focus(e){"object"==typeof e&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,n){const i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);let s;switch(n){case"right":case"left":s=i+100*r;break;case"up":s=2*r+.5*i;break;case"down":s=5*r+i;break;default:s=i+r}return s}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if("TextTrackSelect"===t.constructor.name){e.focus(t);break}}}RY.registerComponent("MediaLoader",class extends RY{constructor(e,t,n){if(super(e,DX({createEl:!1},t),n),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let i=0,r=t.playerOptions.techOrder;i<r.length;i++){const t=CY(r[i]);let n=_Z.getTech(t);if(t||(n=RY.getComponent(t)),n&&n.isSupported()){e.loadTech_(t);break}}}});class zZ extends RY{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=e=>this.handleMouseOver(e),this.handleMouseOut_=e=>this.handleMouseOut(e),this.handleClick_=e=>this.handleClick(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&IX.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const i=hK(e,t,n);return this.player_.options_.experimentalSvgIcons||i.appendChild(hK("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=hK("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(void 0===e)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,pK(this.controlTextEl_,n),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){" "===e.key||"Enter"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}RY.registerComponent("ClickableComponent",zZ);class UZ extends zZ{constructor(e,t){super(e,t),this.update(),this.update_=e=>this.update(e),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return hK("div",{className:"vjs-poster"})}crossOrigin(e){if(void 0===e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(hK("picture",{className:"vjs-poster",tabIndex:-1},{},hK("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?VY(this.player_.play()):this.player_.pause())}}UZ.prototype.crossorigin=UZ.prototype.crossOrigin,RY.registerComponent("PosterImage",UZ);const GZ="#222",VZ="#ccc",HZ={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function WZ(e,t){let n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}function jZ(e,t,n){try{e.style[t]=n}catch(r6){return}}function qZ(e){return e?`${e}px`:""}RY.registerComponent("TextTrackDisplay",class extends RY{constructor(e,t,n){super(e,t,n);const i=e=>this.updateDisplay(e),r=e=>{this.updateDisplayOverlay(),this.updateDisplay(e)};e.on("loadstart",e=>this.toggleDisplay(e)),e.on("useractive",i),e.on("userinactive",i),e.on("texttrackchange",i),e.on("loadedmetadata",e=>{this.updateDisplayOverlay(),this.preselectTrack(e)}),e.ready(lY(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",r),e.on("playerresize",r);const t=ZG.screen.orientation||ZG,n=ZG.screen.orientation?"change":"orientationchange";t.addEventListener(n,r),e.on("dispose",()=>t.removeEventListener(n,r));const i=this.options_.playerOptions.tracks||[];for(let e=0;e<i.length;e++)this.player_.addRemoteTextTrack(i[e],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let i,r,s;for(let a=0;a<t.length;a++){const o=t[a];n&&n.enabled&&n.language&&n.language===o.language&&o.kind in e?o.kind===n.kind?s=o:s||(s=o):n&&!n.enabled?(s=null,i=null,r=null):o.default&&("descriptions"!==o.kind||i?o.kind in e&&!r&&(r=o):i=o)}s?s.mode="showing":r?r.mode="showing":i&&(i.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"==typeof ZG.WebVTT&&ZG.WebVTT.processCues(ZG,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let n=0;n<e.length;++n){const i=e[n];"showing"===i.mode&&t.push(i)}return void this.updateForTrack(t)}let n=null,i=null,r=e.length;for(;r--;){const t=e[r];"showing"===t.mode&&("descriptions"===t.kind?n=t:i=t)}if(i?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(i)):n&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n)),!ZG.CSS.supports("inset","10px")){const e=this.el_,t=e.querySelectorAll(".vjs-text-track-cue"),n=this.player_.controlBar.el_.getBoundingClientRect().height,i=this.player_.el_.getBoundingClientRect().height;e.style="",jZ(e,"position","relative"),jZ(e,"height",i-n+"px"),jZ(e,"top","unset"),jZ(e,"bottom",tK?i+"px":"0px"),t.length>0&&t.forEach(e=>{if(e.style.inset){const t=e.style.inset.split(" ");3===t.length&&Object.assign(e.style,{top:t[0],right:t[1],bottom:t[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!ZG.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),n=e/t,i=this.player_.videoWidth()/this.player_.videoHeight();let r=0,s=0;Math.abs(n-i)>.1&&(n>i?r=Math.round((e-t*i)/2):s=Math.round((t-e/i)/2)),jZ(this.el_,"insetInline",qZ(r)),jZ(this.el_,"insetBlock",qZ(s))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let i=n.length;for(;i--;){const e=n[i];if(!e)continue;const r=e.displayState;if(t.color&&(r.firstChild.style.color=t.color),t.textOpacity&&jZ(r.firstChild,"color",WZ(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(r.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&jZ(r.firstChild,"backgroundColor",WZ(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?jZ(r,"backgroundColor",WZ(t.windowColor,t.windowOpacity)):r.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?r.firstChild.style.textShadow=`2px 2px 3px ${GZ}, 2px 2px 4px ${GZ}, 2px 2px 5px ${GZ}`:"raised"===t.edgeStyle?r.firstChild.style.textShadow=`1px 1px ${GZ}, 2px 2px ${GZ}, 3px 3px ${GZ}`:"depressed"===t.edgeStyle?r.firstChild.style.textShadow=`1px 1px ${VZ}, 0 1px ${VZ}, -1px -1px ${GZ}, 0 -1px ${GZ}`:"uniform"===t.edgeStyle&&(r.firstChild.style.textShadow=`0 0 4px ${GZ}, 0 0 4px ${GZ}, 0 0 4px ${GZ}, 0 0 4px ${GZ}`)),t.fontPercent&&1!==t.fontPercent){const e=ZG.parseFloat(r.style.fontSize);r.style.fontSize=e*t.fontPercent+"px",r.style.height="auto",r.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?r.firstChild.style.fontVariant="small-caps":r.firstChild.style.fontFamily=HZ[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!=typeof ZG.WebVTT||e.every(e=>!e.activeCues))return;const t=[];for(let n=0;n<e.length;++n){const i=e[n];for(let e=0;e<i.activeCues.length;++e)t.push(i.activeCues[e])}ZG.WebVTT.processCues(ZG,t,this.el_);for(let n=0;n<e.length;++n){const t=e[n];for(let e=0;e<t.activeCues.length;++e){const i=t.activeCues[e].displayState;gK(i,"vjs-text-track-cue","vjs-text-track-cue-"+(t.language?t.language:n)),t.language&&_K(i,"lang",t.language)}this.player_.textTrackSettings&&this.updateDisplayState(t)}}});RY.registerComponent("LoadingSpinner",class extends RY{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=hK("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),i=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return i.appendChild(n),i}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}});class XZ extends zZ{createEl(e,t={},n={}){const i=hK("button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n));return this.player_.options_.experimentalSvgIcons||i.appendChild(hK("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}addChild(e,t={}){const n=this.constructor.name;return IX.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),RY.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){" "!==e.key&&"Enter"!==e.key?super.handleKeyDown(e):e.stopPropagation()}}RY.registerComponent("Button",XZ);class KZ extends XZ{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",e=>this.handleMouseDown(e))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if("tap"===e.type||this.mouseused_&&"clientX"in e&&"clientY"in e)return VY(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const n=this.player_.getChild("controlBar"),i=n&&n.getChild("playToggle");if(!i)return void this.player_.tech(!0).focus();const r=()=>i.focus();GY(t)?t.then(r,()=>{}):this.setTimeout(r,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}KZ.prototype.controlText_="Play Video",RY.registerComponent("BigPlayButton",KZ);RY.registerComponent("CloseButton",class extends XZ{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){"Escape"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}});class YZ extends XZ{constructor(e,t={}){super(e,t),t.replay=void 0===t.replay||t.replay,this.setIcon("play"),this.on(e,"play",e=>this.handlePlay(e)),this.on(e,"pause",e=>this.handlePause(e)),t.replay&&this.on(e,"ended",e=>this.handleEnded(e))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?VY(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",e=>this.handleSeeked(e))}}YZ.prototype.controlText_="Play",RY.registerComponent("PlayToggle",YZ);class ZZ extends RY{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],e=>this.update(e)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=hK("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)} `},{role:"presentation"});return t.appendChild(n),this.contentEl_=hK("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){(this.player_.options_.enableSmoothSeeking||"seeking"!==e.type)&&this.updateContent(e)}updateTextNode_(e=0){e=$Y(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,IX.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=eV.createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}ZZ.prototype.labelText_="Time",ZZ.prototype.controlText_="Time",RY.registerComponent("TimeDisplay",ZZ);class QZ extends ZZ{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():e&&e.target&&"function"==typeof e.target.pendingSeekTime?e.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}QZ.prototype.labelText_="Current Time",QZ.prototype.controlText_="Current Time",RY.registerComponent("CurrentTimeDisplay",QZ);class JZ extends ZZ{constructor(e,t){super(e,t);const n=e=>this.updateContent(e);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}JZ.prototype.labelText_="Duration",JZ.prototype.controlText_="Duration",RY.registerComponent("DurationDisplay",JZ);RY.registerComponent("TimeDivider",class extends RY{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}});class eQ extends ZZ{constructor(e,t){super(e,t),this.on(e,"durationchange",e=>this.updateContent(e))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(hK("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!=typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}}eQ.prototype.labelText_="Remaining Time",eQ.prototype.controlText_="Remaining Time",RY.registerComponent("RemainingTimeDisplay",eQ);RY.registerComponent("LiveDisplay",class extends RY{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",e=>this.updateShowing(e))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=hK("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(hK("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(eV.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}});class tQ extends XZ{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=e=>this.updateLiveEdgeStatus(e),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=hK("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}function nQ(e,t,n){return e=Number(e),Math.min(n,Math.max(t,isNaN(e)?t:e))}tQ.prototype.controlText_="Seek to live, currently playing live",RY.registerComponent("SeekToLive",tQ);var iQ=Object.freeze({__proto__:null,clamp:nQ});class rQ extends RY{constructor(e,t){super(e,t),this.handleMouseDown_=e=>this.handleMouseDown(e),this.handleMouseUp_=e=>this.handleMouseUp(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.handleClick_=e=>this.handleClick(e),this.handleMouseMove_=e=>this.handleMouseMove(e),this.update_=e=>this.update(e),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||HX||e.preventDefault(),wK(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;IK(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"})),e}getProgress(){return Number(nQ(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=EK(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,n=t&&t.enabled,i=t&&t.horizontalSeek;n?i&&"ArrowLeft"===e.key||!i&&"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):i&&"ArrowRight"===e.key||!i&&"ArrowUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):"ArrowUp"===e.key||"ArrowRight"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}RY.registerComponent("Slider",rQ);const sQ=(e,t)=>nQ(e/t*100,0,100).toFixed(2)+"%";RY.registerComponent("LoadProgressBar",class extends RY{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",e=>this.update(e))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=hK("span",{className:"vjs-control-text"}),n=hK("span",{textContent:this.localize("Loaded")}),i=eV.createTextNode(": ");return this.percentageEl_=hK("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(i),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():this.player_.duration(),i=this.player_.bufferedEnd(),r=this.partEls_,s=sQ(i,n);this.percent_!==s&&(this.el_.style.width=s,pK(this.percentageEl_,s),this.percent_=s);for(let a=0;a<t.length;a++){const e=t.start(a),n=t.end(a);let s=r[a];s||(s=this.el_.appendChild(hK()),r[a]=s),s.dataset.start===e&&s.dataset.end===n||(s.dataset.start=e,s.dataset.end=n,s.style.left=sQ(e,i),s.style.width=sQ(n-e,i))}for(let a=r.length;a>t.length;a--)this.el_.removeChild(r[a-1]);r.length=t.length})}});RY.registerComponent("TimeTooltip",class extends RY{constructor(e,t){super(e,t),this.update=cY(lY(this,this.update),oY)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const i=CK(this.el_),r=kK(this.player_.el()),s=e.width*t;if(!r||!i)return;let a=e.left-r.left+s,o=e.width-s+(r.right-e.right);o||(o=e.width-s,a=s);let l=i.width/2;a<l?l+=l-a:o<l&&(l=o),l<0?l=0:l>i.width&&(l=i.width),l=Math.round(l),this.el_.style.right=`-${l}px`,this.write(n)}write(e){pK(this.el_,e)}updateTime(e,t,n,i){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let r;const s=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),n=e-t*e;r=(n<1?"":"-")+$Y(n,e)}else r=$Y(n,s);this.update(e,t,r),i&&i()})}});class aQ extends RY{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=cY(lY(this,this.update),oY)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t,n){const i=this.getChild("timeTooltip");if(!i)return;const r=n&&n.target&&"function"==typeof n.target.pendingSeekTime?n.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();i.updateTime(e,t,r)}}aQ.prototype.options_={children:[]},rK||zX||aQ.prototype.options_.children.push("timeTooltip"),RY.registerComponent("PlayProgressBar",aQ);class oQ extends RY{constructor(e,t){super(e,t),this.update=cY(lY(this,this.update),oY)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left=e.width*t+"px"})}}oQ.prototype.options_={children:["timeTooltip"]},RY.registerComponent("MouseTimeDisplay",oQ);class lQ extends rQ{constructor(e,t){(t=DX(lQ.prototype.options_,t)).children=[...t.children];const n=e.options_.disableSeekWhileScrubbingOnMobile&&(rK||zX)||e.options_.disableSeekWhileScrubbingOnSTV;(!rK&&!zX||n)&&t.children.splice(1,0,"mouseTimeDisplay"),super(e,t),this.shouldDisableSeekWhileScrubbing_=n,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=lY(this,this.update),this.update=cY(this.update_,oY),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in eV&&"visibilityState"in eV&&this.on(eV,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===eV.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,oY))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===eV.visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),i=this.player_.liveTracker;let r=this.player_.duration();i&&i.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===n&&this.duration_===r||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[$Y(n,r),$Y(r,r)],"{1} of {2}")),this.currentTime_=n,this.duration_=r),this.bar&&this.bar.update(kK(this.el()),this.getProgress(),e)}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(void 0!==e)if(null!==e){const t=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,t))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(null!==this.pendingSeekTime())return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){OK(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!OK(e)||isNaN(this.player_.duration()))return;let n;t||this.player_.scrubbing()||this.player_.scrubbing(!0);const i=this.calculateDistance(e),r=this.player_.liveTracker;if(r&&r.isLive()){if(i>=.99)return void r.seekToLiveEdge();const e=r.seekableStart(),t=r.liveCurrentTime();if(n=e+i*r.liveWindow(),n>=t&&(n=t),n<=e&&(n=e+.1),n===1/0)return}else n=i*this.player_.duration(),n===this.player_.duration()&&(n-=.1);this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(n):this.userSeek_(n),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?VY(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const t=null!==this.pendingSeekTime()?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(t+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if("Home"===e.key)e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if("End"===e.key)e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const n=.1*parseInt(e.key,10);t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else"PageDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):"PageUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in eV&&"visibilityState"in eV&&this.off(eV,"visibilitychange",this.toggleVisibility_),super.dispose()}}lQ.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12},RY.registerComponent("SeekBar",lQ);class cQ extends RY{constructor(e,t){super(e,t),this.handleMouseMove=cY(lY(this,this.handleMouseMove),oY),this.throttledHandleMouseSeek=cY(lY(this,this.handleMouseSeek),oY),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.handleMouseDownHandler_=e=>this.handleMouseDown(e),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),i=t.getChild("mouseTimeDisplay");if(!n&&!i)return;const r=t.el(),s=CK(r);let a=EK(r,e).x;a=nQ(a,0,1),i&&i.update(s,a),n&&n.update(s,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&VY(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}cQ.prototype.options_={children:["seekBar"]},RY.registerComponent("ProgressControl",cQ);class uQ extends XZ{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],e=>this.handlePictureInPictureChange(e)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],e=>this.handlePictureInPictureEnabledChange(e)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){"audio"===this.player_.currentType().substring(0,5)||this.player_.audioPosterMode()||this.player_.audioOnlyMode()?(this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()):this.show()}handlePictureInPictureEnabledChange(){eV.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in ZG?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){"function"==typeof eV.exitPictureInPicture&&super.show()}}uQ.prototype.controlText_="Picture-in-Picture",RY.registerComponent("PictureInPictureToggle",uQ);class dQ extends XZ{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",e=>this.handleFullscreenChange(e)),!1===eV[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}dQ.prototype.controlText_="Fullscreen",RY.registerComponent("FullscreenToggle",dQ);RY.registerComponent("VolumeLevel",class extends RY{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}});RY.registerComponent("VolumeLevelTooltip",class extends RY{constructor(e,t){super(e,t),this.update=cY(lY(this,this.update),oY)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,i){if(!n){const n=kK(this.el_),i=kK(this.player_.el()),r=e.width*t;if(!i||!n)return;const s=e.left-i.left+r,a=e.width-r+(i.right-e.right);let o=n.width/2;s<o?o+=o-s:a<o&&(o=a),o<0?o=0:o>n.width&&(o=n.width),this.el_.style.right=`-${o}px`}this.write(`${i}%`)}write(e){pK(this.el_,e)}updateVolume(e,t,n,i,r){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,i.toFixed(0)),r&&r()})}});class hQ extends RY{constructor(e,t){super(e,t),this.update=cY(lY(this,this.update),oY)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const i=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,i,()=>{n?this.el_.style.bottom=e.height*t+"px":this.el_.style.left=e.width*t+"px"})}}hQ.prototype.options_={children:["volumeLevelTooltip"]},RY.registerComponent("MouseVolumeLevelDisplay",hQ);class pQ extends rQ{constructor(e,t){super(e,t),this.on("slideractive",e=>this.updateLastVolume_(e)),this.on(e,"volumechange",e=>this.updateARIAAttributes(e)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){OK(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),i=kK(n),r=this.vertical();let s=EK(n,e);s=r?s.y:s.x,s=nQ(s,0,1),t.update(i,s,r)}OK(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)})}}pQ.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},rK||zX||pQ.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),pQ.prototype.playerEvent="volumechange",RY.registerComponent("VolumeBar",pQ);class fQ extends RY{constructor(e,t={}){t.vertical=t.vertical||!1,(void 0===t.volumeBar||PX(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(this,e),this.throttledHandleMouseMove=cY(lY(this,this.handleMouseMove),oY),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.on("mousedown",e=>this.handleMouseDown(e)),this.on("touchstart",e=>this.handleMouseDown(e)),this.on("mousemove",e=>this.handleMouseMove(e)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}fQ.prototype.options_={children:["volumeBar"]},RY.registerComponent("VolumeControl",fQ);class mQ extends XZ{constructor(e,t){super(e,t),function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(this,e),this.on(e,["loadstart","volumechange"],e=>this.update(e))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(0===t){const e=n<.1?.1:n;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),rK&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),bK(this.el_,[0,1,2,3].reduce((e,t)=>e+`${t?" ":""}vjs-vol-${t}`,"")),gK(this.el_,`vjs-vol-${t}`)}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)}}mQ.prototype.controlText_="Mute",RY.registerComponent("MuteToggle",mQ);class gQ extends RY{constructor(e,t={}){void 0!==t.inline?t.inline=t.inline:t.inline=!0,(void 0===t.volumeControl||PX(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=e=>this.handleKeyPress(e),this.on(e,["loadstart"],e=>this.volumePanelState_(e)),this.on(this.muteToggle,"keyup",e=>this.handleKeyPress(e)),this.on(this.volumeControl,"keyup",e=>this.handleVolumeControlKeyUp(e)),this.on("keydown",e=>this.handleKeyPress(e)),this.on("mouseover",e=>this.handleMouseOver(e)),this.on("mouseout",e=>this.handleMouseOut(e)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){"Escape"===e.key&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),tY(eV,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),nY(eV,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){"Escape"===e.key&&this.handleMouseOut()}}gQ.prototype.options_={children:["muteToggle","volumeControl"]},RY.registerComponent("VolumePanel",gQ);class bQ extends XZ{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),n=this.player_.liveTracker,i=n&&n.isLive()?n.seekableEnd():this.player_.duration();let r;r=t+this.skipTime<=i?t+this.skipTime:i,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}bQ.prototype.controlText_="Skip Forward",RY.registerComponent("SkipForward",bQ);class yQ extends XZ{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,i=n&&n.isLive()&&n.seekableStart();let r;r=i&&t-this.skipTime<=i?i:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}yQ.prototype.controlText_="Skip Backward",RY.registerComponent("SkipBackward",yQ);class vQ extends RY{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",e=>this.handleKeyDown(e)),this.boundHandleBlur_=e=>this.handleBlur(e),this.boundHandleTapClick_=e=>this.handleTapClick(e)}addEventListenerForItem(e){e instanceof RY&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof RY&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=hK(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),tY(t,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||eV.activeElement;if(!this.children().some(e=>e.el()===t)){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(t=>t.el()===e.target)[0];if(!n)return;"CaptionSettingsMenuItem"!==n.name()&&this.menuButton_.focus()}}handleKeyDown(e){"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):"ArrowRight"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}RY.registerComponent("Menu",vQ);class TQ extends RY{constructor(e,t={}){super(e,t),this.menuButton_=new XZ(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=XZ.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const i=e=>this.handleClick(e);this.handleMenuKeyUp_=e=>this.handleMenuKeyUp(e),this.on(this.menuButton_,"tap",i),this.on(this.menuButton_,"click",i),this.on(this.menuButton_,"keydown",e=>this.handleKeyDown(e)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),tY(eV,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",e=>this.handleMouseLeave(e)),this.on("keydown",e=>this.handleSubmenuKeyDown(e))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new vQ(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=hK("li",{className:"vjs-menu-title",textContent:CY(this.options_.title),tabIndex:-1}),n=new RY(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";!0===this.options_.inline?e+="-inline":e+="-popup";return`vjs-menu-button ${e} ${XZ.prototype.buildCSSClass()} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),nY(eV,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){"Escape"===e.key||"Tab"===e.key?(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus())):"Up"!==e.key&&("Down"!==e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)||this.buttonPressed_||(e.preventDefault(),this.pressButton())}handleMenuKeyUp(e){"Escape"!==e.key&&"Tab"!==e.key||this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){"Escape"!==e.key&&"Tab"!==e.key||(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),rK&&uK())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}RY.registerComponent("MenuButton",TQ);class xQ extends TQ{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const i=lY(this,this.update);n.addEventListener("removetrack",i),n.addEventListener("addtrack",i),n.addEventListener("labelchange",i),this.player_.on("ready",i),this.player_.on("dispose",function(){n.removeEventListener("removetrack",i),n.removeEventListener("addtrack",i),n.removeEventListener("labelchange",i)})}}RY.registerComponent("TrackButton",xQ);class _Q extends zZ{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const i=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n),r=hK("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?i.appendChild(r):i.replaceChild(r,i.querySelector(".vjs-icon-placeholder")),i}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}RY.registerComponent("MenuItem",_Q);class SQ extends _Q{constructor(e,t){const n=t.track,i=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected="showing"===n.mode,super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const r=(...e)=>{this.handleTracksChange.apply(this,e)},s=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],r),i.addEventListener("change",r),i.addEventListener("selectedlanguagechange",s),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],r),i.removeEventListener("change",r),i.removeEventListener("selectedlanguagechange",s)}),void 0===i.onchange){let e;this.on(["tap","click"],function(){if("object"!=typeof ZG.Event)try{e=new ZG.Event("change")}catch(s6){}e||(e=eV.createEvent("Event"),e.initEvent("change",!0,!0)),i.dispatchEvent(e)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),n)for(let i=0;i<n.length;i++){const e=n[i];-1!==this.kinds.indexOf(e.kind)&&(e===t?"showing"!==e.mode&&(e.mode="showing"):"disabled"!==e.mode&&(e.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}RY.registerComponent("TextTrackMenuItem",SQ);class wQ extends SQ{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(this.options_.kinds.indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(["captions","descriptions","subtitles"].indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}RY.registerComponent("OffTextTrackMenuItem",wQ);class IQ extends xQ{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=SQ){let n;this.label_&&(n=`${this.label_} off`),e.push(new wQ(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const i=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let r=0;r<i.length;r++){const n=i[r];if(this.kinds_.indexOf(n.kind)>-1){const i=new t(this.player_,{track:n,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});i.addClass(`vjs-${n.kind}-menu-item`),e.push(i)}}return e}}RY.registerComponent("TextTrackButton",IQ);class kQ extends _Q{constructor(e,t){const n=t.track,i=t.cue,r=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=i.text,t.selected=i.startTime<=r&&r<i.endTime,super(e,t),this.track=n,this.cue=i}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}RY.registerComponent("ChaptersTrackMenuItem",kQ);class CQ extends IQ{constructor(e,t,n){super(e,t,n),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(e=>{e.selected(this.track_.activeCues[0]===e.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(CY(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new kQ(this.player_,{track:this.track_,cue:i});e.push(r)}return e}}CQ.prototype.kind_="chapters",CQ.prototype.controlText_="Chapters",RY.registerComponent("ChaptersButton",CQ);class EQ extends IQ{constructor(e,t,n){super(e,t,n),this.setIcon("audio-description");const i=e.textTracks(),r=lY(this,this.handleTracksChange);i.addEventListener("change",r),this.on("dispose",function(){i.removeEventListener("change",r)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(e.kind!==this.kind_&&"showing"===e.mode){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}EQ.prototype.kind_="descriptions",EQ.prototype.controlText_="Descriptions",RY.registerComponent("DescriptionsButton",EQ);class AQ extends IQ{constructor(e,t,n){super(e,t,n),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}AQ.prototype.kind_="subtitles",AQ.prototype.controlText_="Subtitles",RY.registerComponent("SubtitlesButton",AQ);class RQ extends SQ{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}RY.registerComponent("CaptionSettingsMenuItem",RQ);class NQ extends IQ{constructor(e,t,n){super(e,t,n),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new RQ(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}NQ.prototype.kind_="captions",NQ.prototype.controlText_="Captions",RY.registerComponent("CaptionsButton",NQ);class PQ extends SQ{createEl(e,t,n){const i=super.createEl(e,t,n),r=i.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",i):r.appendChild(hK("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(hK("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),i}}RY.registerComponent("SubsCapsMenuItem",PQ);class DQ extends IQ{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(CY(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new RQ(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,PQ),e}}DQ.prototype.kinds_=["captions","subtitles"],DQ.prototype.controlText_="Subtitles",RY.registerComponent("SubsCapsButton",DQ);class OQ extends _Q{constructor(e,t){const n=t.track,i=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const r=(...e)=>{this.handleTracksChange.apply(this,e)};i.addEventListener("change",r),this.on("dispose",()=>{i.removeEventListener("change",r)})}createEl(e,t,n){const i=super.createEl(e,t,n),r=i.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(r.appendChild(hK("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(hK("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),i}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const n=e[t];n!==this.track&&(n.enabled=n===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}RY.registerComponent("AudioTrackMenuItem",OQ);class LQ extends xQ{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const i=t[n];e.push(new OQ(this.player_,{track:i,selectable:!0,multiSelectable:!1}))}return e}}LQ.prototype.controlText_="Audio Track",RY.registerComponent("AudioTrackButton",LQ);class MQ extends _Q{constructor(e,t){const n=t.rate,i=parseFloat(n,10);t.label=n,t.selected=i===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=i,this.on(e,"ratechange",e=>this.update(e))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}MQ.prototype.contentElType="button",RY.registerComponent("PlaybackRateMenuItem",MQ);class FQ extends TQ{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",e=>this.updateVisibility(e)),this.on(e,"ratechange",e=>this.updateLabel(e)),this.on(e,"playbackrateschange",e=>this.handlePlaybackRateschange(e))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=hK("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new MQ(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}FQ.prototype.controlText_="Playback Rate",RY.registerComponent("PlaybackRateMenuButton",FQ);class $Q extends RY{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}RY.registerComponent("Spacer",$Q);RY.registerComponent("CustomControlSpacer",class extends $Q{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:" "})}});class BQ extends RY{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}BQ.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},RY.registerComponent("ControlBar",BQ);class zQ extends KY{constructor(e,t){super(e,t),this.on(e,"error",e=>{this.open(e)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}zQ.prototype.options_=Object.assign({},KY.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),RY.registerComponent("ErrorDisplay",zQ);class UQ extends RY{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim();return hK("select",{id:this.options_.id},{},this.options_.SelectOptions.map(e=>{const t=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${YK()}`)+"-"+e[1].replace(/\W+/g,""),n=hK("option",{id:t,value:this.localize(e[0]),textContent:this.localize(e[1])});return n.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${t}`),n}))}}RY.registerComponent("TextTrackSelect",UQ);class GQ extends RY{constructor(e,t={}){super(e,t);const n=hK("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(n);const i=this.options_.selects;for(const r of i){const t=this.options_.selectConfigs[r],n=t.className,i=t.id.replace("%s",this.options_.id_);let s=null;const a=`vjs_select_${YK()}`;if("colors"===this.options_.type){s=hK("span",{className:n});const e=hK("label",{id:i,className:"vjs-label",textContent:this.localize(t.label)});e.setAttribute("for",a),s.appendChild(e)}const o=new UQ(e,{SelectOptions:t.options,legendId:this.options_.legendId,id:a,labelId:i});this.addChild(o),"colors"===this.options_.type&&(s.appendChild(o.el()),this.el().appendChild(s))}}createEl(){return hK("fieldset",{className:this.options_.className})}}RY.registerComponent("TextTrackFieldset",GQ);class VQ extends RY{constructor(e,t={}){super(e,t);const n=this.options_.textTrackComponentid,i=new GQ(e,{id_:n,legendId:`captions-text-legend-${n}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(i);const r=new GQ(e,{id_:n,legendId:`captions-background-${n}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(r);const s=new GQ(e,{id_:n,legendId:`captions-window-${n}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(s)}createEl(){return hK("div",{className:"vjs-track-settings-colors"})}}RY.registerComponent("TextTrackSettingsColors",VQ);class HQ extends RY{constructor(e,t={}){super(e,t);const n=this.options_.textTrackComponentid,i=new GQ(e,{id_:n,legendId:`captions-font-size-${n}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(i);const r=new GQ(e,{id_:n,legendId:`captions-edge-style-${n}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(r);const s=new GQ(e,{id_:n,legendId:`captions-font-family-${n}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(s)}createEl(){return hK("div",{className:"vjs-track-settings-font"})}}RY.registerComponent("TextTrackSettingsFont",HQ);class WQ extends RY{constructor(e,t={}){super(e,t);const n=new XZ(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});n.el().classList.remove("vjs-control","vjs-button"),n.el().textContent=this.localize("Reset"),this.addChild(n);const i=this.localize("Done"),r=new XZ(e,{controlText:i,className:"vjs-done-button"});r.el().classList.remove("vjs-control","vjs-button"),r.el().textContent=i,this.addChild(r)}createEl(){return hK("div",{className:"vjs-track-settings-controls"})}}RY.registerComponent("TrackSettingsControls",WQ);const jQ="vjs-text-track-settings",qQ=["#000","Black"],XQ=["#00F","Blue"],KQ=["#0FF","Cyan"],YQ=["#0F0","Green"],ZQ=["#F0F","Magenta"],QQ=["#F00","Red"],JQ=["#FFF","White"],eJ=["#FF0","Yellow"],tJ=["1","Opaque"],nJ=["0.5","Semi-Transparent"],iJ=["0","Transparent"],rJ={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[qQ,JQ,QQ,YQ,XQ,eJ,ZQ,KQ],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[tJ,nJ,iJ],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[JQ,qQ,QQ,YQ,XQ,eJ,ZQ,KQ],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[tJ,nJ],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[iJ,nJ,tJ],className:"vjs-window-opacity vjs-opacity"}};function sJ(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}rJ.windowColor.options=rJ.backgroundColor.options;RY.registerComponent("TextTrackSettings",class extends KY{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=hK("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new VQ(e,{textTrackComponentid:this.id_,selectConfigs:rJ,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const n=new HQ(e,{textTrackComponentid:this.id_,selectConfigs:rJ,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(n);const i=new WQ(e);this.addChild(i)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),AX(rJ,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return RX(rJ,(e,t,n)=>{const i=(r=this.$(t.selector),s=t.parser,sJ(r.options[r.options.selectedIndex].value,s));var r,s;return void 0!==i&&(e[n]=i),e},{})}setValues(e){AX(rJ,(t,n)=>{!function(e,t,n){if(t)for(let i=0;i<e.options.length;i++)if(sJ(e.options[i].value,n)===t){e.selectedIndex=i;break}}(this.$(t.selector),e[n],t.parser)})}setDefaults(){AX(rJ,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(ZG.localStorage.getItem(jQ))}catch(s6){IX.warn(s6)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?ZG.localStorage.setItem(jQ,JSON.stringify(e)):ZG.localStorage.removeItem(jQ)}catch(s6){IX.warn(s6)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}});RY.registerComponent("ResizeManager",class extends RY{constructor(e,t){let n=t.ResizeObserver||ZG.ResizeObserver;null===t.ResizeObserver&&(n=!1);super(e,DX({createEl:!n,reportTouchActivity:!1},t)),this.ResizeObserver=t.ResizeObserver||ZG.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=uY(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){nY(this,"resize",e),nY(this,"unload",t),t=null};tY(this.el_.contentWindow,"unload",t),tY(this.el_.contentWindow,"resize",e)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}});const aJ={trackingThreshold:20,liveTolerance:15};RY.registerComponent("LiveTracker",class extends RY{constructor(e,t){super(e,DX(aJ,t,{createEl:!1})),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=e=>this.handlePlay(e),this.handleFirstTimeupdate_=e=>this.handleFirstTimeupdate(e),this.handleSeeked_=e=>this.handleSeeked(e),this.seekToLiveEdge_=e=>this.seekToLiveEdge(e),this.reset_(),this.on(this.player_,"durationchange",e=>this.handleDurationchange(e)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(ZG.performance.now().toFixed(4)),n=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const i=this.liveCurrentTime(),r=this.player_.currentTime();let s=this.player_.paused()||this.seekedBehindLive_||Math.abs(i-r)>this.options_.liveTolerance;this.timeupdateSeen_&&i!==1/0||(s=!1),s!==this.behindLiveEdge_&&(this.behindLiveEdge_=s,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,oY),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"==typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}});RY.registerComponent("TitleBar",class extends RY{constructor(e,t){super(e,t),this.on("statechanged",e=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:hK("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${YK()}`}),description:hK("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${YK()}`})},hK("div",{className:"vjs-title-bar"},{},OX(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(e=>{const i=this.state[e],r=this.els[e],s=n[e];RK(r),i&&pK(r,i),t&&(t.removeAttribute(s),i&&t.setAttribute(s,r.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}});const oJ={initialDisplay:4e3,position:[],takeFocus:!1};RY.registerComponent("TransientButton",class extends XZ{constructor(e,t){super(e,t=DX(oJ,t)),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],e=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=hK("button",{},{type:"button",class:this.buildCSSClass()},hK("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}});const lJ=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const n=e.$$("source"),i=[];let r="";if(!n.length)return!1;for(let s=0;s<n.length;s++){const e=n[s].src;e&&-1===i.indexOf(e)&&i.push(e)}return!!i.length&&(1===i.length&&(r=i[0]),e.triggerSourceset(r),!0)},cJ=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=eV.createElement(this.nodeName.toLowerCase());t.innerHTML=e;const n=eV.createDocumentFragment();for(;t.childNodes.length;)n.appendChild(t.childNodes[0]);return this.innerText="",ZG.Element.prototype.appendChild.call(this,n),this.innerHTML}}),uJ=(e,t)=>{let n={};for(let i=0;i<e.length&&(n=Object.getOwnPropertyDescriptor(e[i],t),!(n&&n.set&&n.get));i++);return n.enumerable=!0,n.configurable=!0,n},dJ=function(e){const t=e.el();if(t.resetSourceWatch_)return;const n={},i=(e=>uJ([e.el(),ZG.HTMLMediaElement.prototype,ZG.Element.prototype,cJ],"innerHTML"))(e),r=n=>(...i)=>{const r=n.apply(t,i);return lJ(e),r};["append","appendChild","insertAdjacentHTML"].forEach(e=>{t[e]&&(n[e]=t[e],t[e]=r(n[e]))}),Object.defineProperty(t,"innerHTML",DX(i,{set:r(i.set)})),t.resetSourceWatch_=()=>{t.resetSourceWatch_=null,Object.keys(n).forEach(e=>{t[e]=n[e]}),Object.defineProperty(t,"innerHTML",i)},e.one("sourceset",t.resetSourceWatch_)},hJ=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?cZ(ZG.Element.prototype.getAttribute.call(this,"src")):""},set(e){return ZG.Element.prototype.setAttribute.call(this,"src",e),e}}),pJ=function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const n=(e=>uJ([e.el(),ZG.HTMLMediaElement.prototype,hJ],"src"))(e),i=t.setAttribute,r=t.load;Object.defineProperty(t,"src",DX(n,{set:i=>{const r=n.set.call(t,i);return e.triggerSourceset(t.src),r}})),t.setAttribute=(n,r)=>{const s=i.call(t,n,r);return/src/i.test(n)&&e.triggerSourceset(t.src),s},t.load=()=>{const n=r.call(t);return lJ(e)||(e.triggerSourceset(""),dJ(e)),n},t.currentSrc?e.triggerSourceset(t.currentSrc):lJ(e)||dJ(e),t.resetSourceset_=()=>{t.resetSourceset_=null,t.load=r,t.setAttribute=i,Object.defineProperty(t,"src",n),t.resetSourceWatch_&&t.resetSourceWatch_()}};class fJ extends _Z{constructor(e,t){super(e,t);const n=e.source;let i=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,n&&(this.el_.currentSrc!==n.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const n=[];for(;t--;){const r=e[t];"track"===r.nodeName.toLowerCase()&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),this.textTracks().addTrack(r.track),i||this.el_.hasAttribute("crossorigin")||!dZ(r.src)||(i=!0)):n.push(r))}for(let i=0;i<n.length;i++)this.el_.removeChild(n[i])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&i&&IX.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),(nK||QX)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),fJ.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){pJ(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let n=0;n<e.length;n++){const i=e[n];"metadata"===i.kind&&t.push({track:i,storedMode:i.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const i=()=>{for(let e=0;e<t.length;e++){const n=t[e];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}e.removeEventListener("change",i)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",i),e.addEventListener("change",i)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",i)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(e=>{this.el()[`${n}Tracks`].removeEventListener(e,this[`${n}TracksListeners_`][e])}),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=vZ[e],n=this.el()[t.getterName],i=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const r={change:t=>{const n={type:"change",target:i,currentTarget:i,srcElement:i};i.trigger(n),"text"===e&&this[TZ.remoteText.getterName]().trigger(n)},addtrack(e){i.addTrack(e.track)},removetrack(e){i.removeTrack(e.track)}},s=function(){const e=[];for(let t=0;t<i.length;t++){let r=!1;for(let e=0;e<n.length;e++)if(n[e]===i[t]){r=!0;break}r||e.push(i[t])}for(;e.length;)i.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=r,Object.keys(r).forEach(e=>{const t=r[e];n.addEventListener(e,t),this.on("dispose",i=>n.removeEventListener(e,t))}),this.on("loadstart",s),this.on("dispose",e=>this.off("loadstart",s))}proxyNativeTracks_(){vZ.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),fJ.disposeMediaElement(e),e=t}else{e=eV.createElement("video");const t=DX({},this.options_.tag&&TK(this.options_.tag));nK&&!0===this.options_.nativeControlsForTouch||delete t.controls,vK(e,Object.assign(t,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&_K(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const i=t[n],r=this.options_[i];void 0!==r&&(r?_K(e,i,i):SK(e,i),e[i]=r)}return e}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const n=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready(function(){this.off("loadstart",t),this.off("loadedmetadata",n),e||this.trigger("loadstart")})}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(e){this.trigger(e)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&sK?this.el_.fastSeek(e):this.el_.currentTime=e}catch(r6){IX(r6,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&zX&&HX&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return"function"==typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)VY(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(r6){this.trigger("fullscreenerror",r6)}},0);else try{e.webkitEnterFullScreen()}catch(r6){this.trigger("fullscreenerror",r6)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return IX.error("Invalid source URL."),!1;const n={src:e};t&&(n.type=t);const i=hK("source",{},n);return this.el_.appendChild(i),!0}removeSourceElement(e){if(!e)return IX.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const n of t)if(n.src===e)return this.el_.removeChild(n),!0;return IX.warn(`No matching source element found with src: ${e}`),!1}reset(){fJ.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=eV.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)e!==t[n]&&e!==t[n].track||this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),ZG.performance&&(e.creationTime=ZG.performance.now()),e}}LX(fJ,"TEST_VID",function(){if(!lK())return;const e=eV.createElement("video"),t=eV.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e}),fJ.isSupported=function(){try{fJ.TEST_VID.volume=.5}catch(r6){return!1}return!(!fJ.TEST_VID||!fJ.TEST_VID.canPlayType)},fJ.canPlayType=function(e){return fJ.TEST_VID.canPlayType(e)},fJ.canPlaySource=function(e,t){return fJ.canPlayType(e.type)},fJ.canControlVolume=function(){try{const e=fJ.TEST_VID.volume;fJ.TEST_VID.volume=e/2+.1;const t=e!==fJ.TEST_VID.volume;return t&&rK?(ZG.setTimeout(()=>{fJ&&fJ.prototype&&(fJ.prototype.featuresVolumeControl=e!==fJ.TEST_VID.volume)}),!1):t}catch(r6){return!1}},fJ.canMuteVolume=function(){try{const e=fJ.TEST_VID.muted;return fJ.TEST_VID.muted=!e,fJ.TEST_VID.muted?_K(fJ.TEST_VID,"muted","muted"):SK(fJ.TEST_VID,"muted"),e!==fJ.TEST_VID.muted}catch(r6){return!1}},fJ.canControlPlaybackRate=function(){if(zX&&HX&&jX<58)return!1;try{const e=fJ.TEST_VID.playbackRate;return fJ.TEST_VID.playbackRate=e/2+.1,e!==fJ.TEST_VID.playbackRate}catch(r6){return!1}},fJ.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(eV.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(eV.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(eV.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(eV.createElement("audio"),"innerHTML",{get:e,set:e})}catch(r6){return!1}return!0},fJ.supportsNativeTextTracks=function(){return sK||rK&&HX},fJ.supportsNativeVideoTracks=function(){return!(!fJ.TEST_VID||!fJ.TEST_VID.videoTracks)},fJ.supportsNativeAudioTracks=function(){return!(!fJ.TEST_VID||!fJ.TEST_VID.audioTracks)},fJ.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([e,t]){LX(fJ.prototype,e,()=>fJ[t](),!0)}),fJ.prototype.featuresVolumeControl=fJ.canControlVolume(),fJ.prototype.movingMediaElementInDOM=!rK,fJ.prototype.featuresFullscreenResize=!0,fJ.prototype.featuresProgressEvents=!0,fJ.prototype.featuresTimeupdateEvents=!0,fJ.prototype.featuresVideoFrameCallback=!(!fJ.TEST_VID||!fJ.TEST_VID.requestVideoFrameCallback),fJ.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(r6){}}()}},fJ.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let n=t.length;for(;n--;)e.removeChild(t[n]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(r6){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){fJ.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){fJ.prototype["set"+CY(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(e){fJ.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){fJ.prototype["set"+CY(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){fJ.prototype[e]=function(){return this.el_[e]()}}),_Z.withSourceHandlers(fJ),fJ.nativeSourceHandler={},fJ.nativeSourceHandler.canPlayType=function(e){try{return fJ.TEST_VID.canPlayType(e)}catch(r6){return""}},fJ.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return fJ.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=uZ(e.src);return fJ.nativeSourceHandler.canPlayType(`video/${t}`)}return""},fJ.nativeSourceHandler.handleSource=function(e,t,n){t.setSrc(e.src)},fJ.nativeSourceHandler.dispose=function(){},fJ.registerSourceHandler(fJ.nativeSourceHandler),_Z.registerTech("Html5",fJ);const mJ=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],gJ={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},bJ=["tiny","xsmall","small","medium","large","xlarge","huge"],yJ={};bJ.forEach(e=>{const t="x"===e.charAt(0)?`x-${e.substring(1)}`:e;yJ[e]=`vjs-layout-${t}`});const vJ={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class TJ extends RY{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${YK()}`,(t=Object.assign(TJ.getTagSettings(e),t)).initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const n=e.closest("[lang]");n&&(t.language=n.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=e=>this.documentFullscreenChange_(e),this.boundFullWindowOnEscKey_=e=>this.fullWindowOnEscKey(e),this.boundUpdateStyleEl_=e=>this.updateStyleEl_(e),this.boundApplyInitTime_=e=>this.applyInitTime_(e),this.boundUpdateCurrentBreakpoint_=e=>this.updateCurrentBreakpoint_(e),this.boundHandleTechClick_=e=>this.handleTechClick_(e),this.boundHandleTechDoubleClick_=e=>this.handleTechDoubleClick_(e),this.boundHandleTechTouchStart_=e=>this.handleTechTouchStart_(e),this.boundHandleTechTouchMove_=e=>this.handleTechTouchMove_(e),this.boundHandleTechTouchEnd_=e=>this.handleTechTouchEnd_(e),this.boundHandleTechTap_=e=>this.handleTechTap_(e),this.boundUpdatePlayerHeightOnAudioOnlyMode_=e=>this.updatePlayerHeightOnAudioOnlyMode_(e),this.isFullscreen_=!1,this.log=kX(this.id_),this.fsApi_=TX,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&TK(e),this.language(this.options_.language),t.languages){const e={};Object.getOwnPropertyNames(t.languages).forEach(function(n){e[n.toLowerCase()]=t.languages[n]}),this.languages_=e}else this.languages_=TJ.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(e=>{if("function"!=typeof this[e])throw new Error(`plugin "${e}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),SY(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(tY(eV,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const i=DX(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(e=>{this[e](t.plugins[e])}),t.debug&&this.debug(!0),this.options_.playerOptions=i,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const e=(new ZG.DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play">\n      <path d="M16 10v28l22-14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">\n      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">\n      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">\n      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">\n      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">\n      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">\n      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">\n      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">\n      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">\n      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">\n      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">\n      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">\n      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>\n    </symbol>\n    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">\n      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">\n      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">\n      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">\n      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">\n      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">\n      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-share">\n      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">\n      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-square">\n      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">\n      <circle cx="24" cy="24" r="20"></circle>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">\n      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">\n      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">\n      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">\n      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">\n      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">\n      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">\n      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">\n      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">\n      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>\n    </symbol>\n    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">\n      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">\n      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">\n      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">\n      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">\n      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">\n      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">\n      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>\n      <path fill="none" d="M-1-3h24v24H-1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">\n      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">\n      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">\n      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">\n      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">\n      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>\n    </symbol>\n  </defs>\n</svg>',"image/svg+xml");if(e.querySelector("parsererror"))IX.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const t=e.documentElement;t.style.display="none",this.el_.appendChild(t),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio("audio"===e.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),t.spatialNavigation&&t.spatialNavigation.enabled&&(this.spatialNavigation=new BZ(this),this.addClass("vjs-spatial-navigation-enabled")),nK&&this.addClass("vjs-touch-enabled"),rK||this.addClass("vjs-workinghover"),TJ.players[this.id_]=this;const r=gX.split(".")[0];this.addClass(`vjs-v${r}`),this.userActive(!0),this.reportUserActivity(),this.one("play",e=>this.listenForUserActivity_(e)),this.on("keydown",e=>this.handleKeyDown(e)),this.on("languagechange",e=>this.handleLanguagechange(e)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){var e;this.trigger("dispose"),this.off("dispose"),nY(eV,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),nY(eV,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),TJ.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),e=this,wZ.hasOwnProperty(e.id())&&delete wZ[e.id()],xZ.names.forEach(e=>{const t=this[xZ[e].getterName]();t&&t.off&&t.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,n=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const i="video-js"===this.tag.tagName.toLowerCase();n?e=this.el_=t.parentNode:i||(e=this.el_=super.createEl("div"));const r=TK(t);if(i){for(e=this.el_=t,t=this.tag=eV.createElement("video");e.children.length;)t.appendChild(e.firstChild);mK(e,"video-js")||gK(e,"video-js"),e.appendChild(t),n=this.playerElIngest_=e,Object.keys(e).forEach(n=>{try{t[n]=e[n]}catch(r6){}})}t.setAttribute("tabindex","-1"),r.tabindex="-1",HX&&YX&&(t.setAttribute("role","application"),r.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in r&&delete r.width,"height"in r&&delete r.height,Object.getOwnPropertyNames(r).forEach(function(n){i&&"class"===n||e.setAttribute(n,r[n]),i&&t.setAttribute(n,r[n])}),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused");const s=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(e=>aK[e]).map(e=>"vjs-device-"+e.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...s),!0!==ZG.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=WK("vjs-styles-dimensions");const e=LK(".vjs-styles-defaults"),t=LK("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const a=t.getElementsByTagName("a");for(let o=0;o<a.length;o++){const e=a.item(o);gK(e,"vjs-hidden"),e.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!n&&t.parentNode.insertBefore(e,t),fK(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if(void 0===e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):IX.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(void 0===t)return this[n]||0;if(""===t||"auto"===t)return this[n]=void 0,void this.updateStyleEl_();const i=parseFloat(t);isNaN(i)?IX.error(`Improper value "${t}" supplied for for ${e}`):(this[n]=i,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;var t,n;this.fluid_=!!e,mY(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),n=()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)},mY(t=this)?n():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(n))):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===ZG.VIDEOJS_NO_DYNAMIC_STYLE){const e="number"==typeof this.width_?this.width_:this.options_.width,t="number"==typeof this.height_?this.height_:this.options_.height,n=this.tech_&&this.tech_.el();return void(n&&(e>=0&&(n.width=e),t>=0&&(n.height=t)))}let e,t,n,i;n=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const r=n.split(":"),s=r[1]/r[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/s:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*s,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),jK(this.styleEl_,`\n      .${i} {\n        width: ${e}px;\n        height: ${t}px;\n      }\n\n      .${i}.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ${100*s}%;\n      }\n    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=CY(e),i=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(_Z.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let r=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(r=!1);const s={source:t,autoplay:r,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${i}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};xZ.names.forEach(e=>{const t=xZ[e];s[t.getterName]=this[t.privateName]}),Object.assign(s,this.options_[n]),Object.assign(s,this.options_[i]),Object.assign(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(s.startTime=this.cache_.currentTime);const a=_Z.getTech(e);if(!a)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new a(s),this.tech_.ready(lY(this,this.handleTechReady_),!0),jY(this.textTracksJson_||[],this.tech_),mJ.forEach(e=>{this.on(this.tech_,e,t=>this[`handleTech${CY(e)}_`](t))}),Object.keys(gJ).forEach(e=>{this.on(this.tech_,e,t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${gJ[e]}_`].bind(this),event:t}):this[`handleTech${gJ[e]}_`](t)})}),this.on(this.tech_,"loadstart",e=>this.handleTechLoadStart_(e)),this.on(this.tech_,"sourceset",e=>this.handleTechSourceset_(e)),this.on(this.tech_,"waiting",e=>this.handleTechWaiting_(e)),this.on(this.tech_,"ended",e=>this.handleTechEnded_(e)),this.on(this.tech_,"seeking",e=>this.handleTechSeeking_(e)),this.on(this.tech_,"play",e=>this.handleTechPlay_(e)),this.on(this.tech_,"pause",e=>this.handleTechPause_(e)),this.on(this.tech_,"durationchange",e=>this.handleTechDurationChange_(e)),this.on(this.tech_,"fullscreenchange",(e,t)=>this.handleTechFullscreenChange_(e,t)),this.on(this.tech_,"fullscreenerror",(e,t)=>this.handleTechFullscreenError_(e,t)),this.on(this.tech_,"enterpictureinpicture",e=>this.handleTechEnterPictureInPicture_(e)),this.on(this.tech_,"leavepictureinpicture",e=>this.handleTechLeavePictureInPicture_(e)),this.on(this.tech_,"error",e=>this.handleTechError_(e)),this.on(this.tech_,"posterchange",e=>this.handleTechPosterChange_(e)),this.on(this.tech_,"textdata",e=>this.handleTechTextData_(e)),this.on(this.tech_,"ratechange",e=>this.handleTechRateChange_(e)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||fK(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){xZ.names.forEach(e=>{const t=xZ[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=WY(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&IX.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}version(){return{"video.js":gX}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!=typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const n=this.play();if(GY(n))return n.catch(e=>{throw t(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${e||""}`)})};let n;return"any"!==e||this.muted()?n="muted"!==e||this.muted()?this.play():t():(n=this.play(),GY(n)&&(n=n.catch(t))),GY(n)?n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})}):void 0}updateSourceCaches_(e=""){let t=e,n="";"string"!=typeof t&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=((e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const n=e.cache_.sources.filter(e=>e.src===t);if(n.length)return n[0].type;const i=e.$$("source");for(let r=0;r<i.length;r++){const e=i[r];if(e.type&&e.src&&e.src===t)return e.type}return OZ(t)})(this,t)),this.cache_.source=DX({},e,{src:t,type:n});const i=this.cache_.sources.filter(e=>e.src&&e.src===t),r=[],s=this.$$("source"),a=[];for(let o=0;o<s.length;o++){const e=TK(s[o]);r.push(e),e.src&&e.src===t&&a.push(e.src)}a.length&&!i.length?this.cache_.sources=r:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const n=this.currentSource().src,i=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(i)&&(!this.lastSource_||this.lastSource_.tech!==i&&this.lastSource_.player!==n)&&(t=()=>{}),t(i),e.src||this.tech_.any(["sourceset","loadstart"],e=>{if("sourceset"===e.type)return;const t=this.techGet_("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?VY(this.play()):this.pause()))}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),t=>t.contains(e.target))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!eV.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let i=eV[this.fsApi_.fullscreenElement]===n;!i&&n.matches&&(i=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(i)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in AZ)return function(e,t,n,i){return t[n](e.reduce(NZ(n),i))}(this.middleware_,this.tech_,e,t);if(e in RZ)return CZ(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(r6){throw IX(r6),r6}},!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in EZ)return function(e,t,n){return e.reduceRight(NZ(n),t[n]())}(this.middleware_,this.tech_,e);if(e in RZ)return CZ(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(r6){if(void 0===this.tech_[e])throw IX(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,r6),r6;if("TypeError"===r6.name)throw IX(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,r6),this.tech_.isReady_=!1,r6;throw IX(r6),r6}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=VY){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(sK||rK);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=e=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&n&&this.load());const i=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===i?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(i)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||DY(0,0)}scrubbing(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0===e?(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime):(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),this.cache_.initTime=0,void(isFinite(e)&&(this.cache_.currentTime=Number(e)))):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_)))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=DY(0,0)),e}seekable(){let e=this.techGet_("seekable");return e&&e.length||(e=DY(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return zY(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,i)=>{function r(){t.off("fullscreenerror",a),t.off("fullscreenchange",s)}function s(){r(),n()}function a(e,t){r(),i(t)}t.one("fullscreenchange",s),t.one("fullscreenerror",a);const o=t.requestFullscreenHelper_(e);o&&(o.then(r,r),o.then(n,i))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),e}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function i(){e.off("fullscreenerror",s),e.off("fullscreenchange",r)}function r(){i(),t()}function s(e,t){i(),n(t)}e.one("fullscreenchange",r),e.one("fullscreenerror",s);const a=e.exitFullscreenHelper_();a&&(a.then(i,i),a.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=eV[this.fsApi_.exitFullscreen]();return e&&VY(e.then(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=eV.documentElement.style.overflow,tY(eV,"keydown",this.boundFullWindowOnEscKey_),eV.documentElement.style.overflow="hidden",gK(eV.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){"Escape"===e.key&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,nY(eV,"keydown",this.boundFullWindowOnEscKey_),eV.documentElement.style.overflow=this.docOrigOverflow,bK(eV.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&ZG.documentPictureInPicture){const e=eV.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(hK("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),ZG.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>($K(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",t=>{const n=t.target.querySelector(".video-js");e.parentNode.replaceChild(n,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in eV&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return ZG.documentPictureInPicture&&ZG.documentPictureInPicture.window?(ZG.documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in eV?eV.exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;if(!t||!t.hotkeys)return;(e=>{const t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if("input"===t)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type);return-1!==["textarea"].indexOf(t)})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=t=>"f"===e.key.toLowerCase(),muteKey:i=t=>"m"===e.key.toLowerCase(),playPauseKey:r=t=>"k"===e.key.toLowerCase()||" "===e.key.toLowerCase()}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const t=RY.getComponent("FullscreenToggle");!1!==eV[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else if(i.call(this,e)){e.preventDefault(),e.stopPropagation();RY.getComponent("MuteToggle").prototype.handleClick.call(this,e)}else if(r.call(this,e)){e.preventDefault(),e.stopPropagation();RY.getComponent("PlayToggle").prototype.handleClick.call(this,e)}}canPlayType(e){let t;for(let n=0,i=this.options_.techOrder;n<i.length;n++){const r=i[n];let s=_Z.getTech(r);if(s||(s=RY.getComponent(r)),s){if(s.isSupported()&&(t=s.canPlayType(e),t))return t}else IX.error(`The "${r}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(e){const t=this.options_.techOrder.map(e=>[e,_Z.getTech(e)]).filter(([e,t])=>t?t.isSupported():(IX.error(`The "${e}" tech is undefined. Skipped browser support check for that tech.`),!1)),n=function(e,t,n){let i;return e.some(e=>t.some(t=>{if(i=n(e,t),i)return!0})),i};let i;const r=([e,t],n)=>{if(t.canPlaySource(n,this.options_[e.toLowerCase()]))return{source:n,tech:e}};return i=this.options_.sourceOrder?n(e,t,(e=>(t,n)=>e(n,t))(r)):n(t,e,r),i||!1}handleSrc_(e,t){if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=LZ(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),kZ(this,n[0],(e,i)=>{this.middleware_=i,t||(this.cache_.sources=n),this.updateSourceCaches_(e);if(this.src_(e))return n.length>1?this.handleSrc_(n.slice(1)):(this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void this.triggerReady());var r,s;r=i,s=this.tech_,r.forEach(e=>e.setTech&&e.setTech(s))}),n.length>1){const e=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=()=>{this.off("error",e),this.off("playing",t)}}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(EY(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1))}addSourceElement(e,t){return!!this.tech_&&this.tech_.addSourceElement(e,t)}removeSourceElement(e){return!!this.tech_&&this.tech_.removeSourceElement(e)}load(){this.tech_&&this.tech_.vhs?this.src(this.currentSource()):this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{VY(this.play().then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),mY(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:i}=this.controlBar||{},{seekBar:r}=n||{};e&&e.updateContent(),t&&t.updateContent(),i&&i.updateContent(),r&&(r.update(),r.loadProgressBar&&r.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(yX("beforeerror").forEach(t=>{const n=t(this,e);NX(n)&&!Array.isArray(n)||"string"==typeof n||"number"==typeof n||null===n?e=n:this.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",function(){this.off(["click","touchstart"],t)})}if(null===e)return this.error_=null,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new UY(e),this.addClass("vjs-error"),IX.error(`(CODE:${this.error_.code} ${UY.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),yX("error").forEach(e=>e(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const i=lY(this,this.reportUserActivity),r=function(t){i(),this.clearInterval(e)};this.on("mousedown",function(){i(),this.clearInterval(e),e=this.setInterval(i,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===n||(t=e.screenX,n=e.screenY,i())}),this.on("mouseup",r),this.on("mouseleave",r);const s=this.getChild("controlBar");let a;!s||rK||zX||(s.on("mouseenter",function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),s.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",i),this.on("keyup",i);this.setInterval(function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a);const e=this.options_.inactivityTimeout;e<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))},250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");e&&this.audioOnlyCache_.controlBarHeight!==e.currentHeight()&&(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=n,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){if("boolean"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;if(this.audioPosterMode_=e,e){if(this.audioOnlyMode()){return this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.disablePosterModeUI_()})}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),mY(this)&&this.trigger("languagechange"))}languages(){return DX(TJ.prototype.options_.languages,this.languages_)}toJSON(){const e=DX(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let i=t[n];i=DX(i),i.player=void 0,e.tracks[n]=i}return e}createModal(e,t){(t=t||{}).content=e||"";const n=new KY(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<bJ.length;n++){const i=bJ[n];if(t<=this.breakpoints_[i]){if(e===i)return;e&&this.removeClass(yJ[e]),this.addClass(yJ[i]),this.breakpoint_=i;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Object.assign({},vJ,e),this.updateCurrentBreakpoint_()),Object.assign(this.breakpoints_)}responsive(e){if(void 0===e)return this.responsive_;return(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return yJ[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!=typeof e)return;const n=this.crossOrigin();this.reset(),this.cache_.media=DX(e);const{artist:i,artwork:r,description:s,poster:a,src:o,textTracks:l,title:c}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:OZ(a)}]),n&&this.crossOrigin(n),o&&this.src(o),a&&this.poster(a),Array.isArray(l)&&l.forEach(e=>this.addRemoteTextTrack(e,!1)),this.titleBar&&this.titleBar.update({title:c,description:s||i||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),e=>({kind:e.kind,label:e.label,language:e.language,src:e.src}))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:OZ(t.poster)}]),t}return DX(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=TK(e),i=n["data-setup"];if(mK(e,"vjs-fill")&&(n.fill=!0),mK(e,"vjs-fluid")&&(n.fluid=!0),null!==i)try{Object.assign(n,JSON.parse(i||"{}"))}catch(r6){IX.error("data-setup",r6)}if(Object.assign(t,n),e.hasChildNodes()){const n=e.childNodes;for(let e=0,i=n.length;e<i;e++){const i=n[e],r=i.nodeName.toLowerCase();"source"===r?t.sources.push(TK(i)):"track"===r&&t.tracks.push(TK(i))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(e=>"number"==typeof e)&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}TJ.prototype.videoTracks=()=>{},TJ.prototype.audioTracks=()=>{},TJ.prototype.textTracks=()=>{},TJ.prototype.remoteTextTracks=()=>{},TJ.prototype.remoteTextTrackEls=()=>{},xZ.names.forEach(function(e){const t=xZ[e];TJ.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),TJ.prototype.crossorigin=TJ.prototype.crossOrigin,TJ.players={};const xJ=ZG.navigator;TJ.prototype.options_={techOrder:_Z.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:xJ&&(xJ.languages&&xJ.languages[0]||xJ.userLanguage||xJ.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1},mJ.forEach(function(e){TJ.prototype[`handleTech${CY(e)}_`]=function(){return this.trigger(e)}}),RY.registerComponent("Player",TJ);const _J="plugin",SJ="activePlugins_",wJ={},IJ=e=>wJ.hasOwnProperty(e),kJ=e=>IJ(e)?wJ[e]:void 0,CJ=(e,t)=>{e[SJ]=e[SJ]||{},e[SJ][t]=!0},EJ=(e,t,n)=>{const i=(n?"before":"")+"pluginsetup";e.trigger(i,t),e.trigger(i+":"+t.name,t)},AJ=(e,t)=>(t.prototype.name=e,function(...n){EJ(this,{name:e,plugin:t,instance:null},!0);const i=new t(...[this,...n]);return this[e]=()=>i,EJ(this,i.getEventHash()),i});class RJ{constructor(e){if(this.constructor===RJ)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),SY(this),delete this.trigger,IY(this,this.constructor.defaultState),CJ(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return iY(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[SJ][e]=!1,this.player=this.state=null,t[e]=AJ(e,wJ[e])}static isBasic(e){const t="string"==typeof e?kJ(e):e;return"function"==typeof t&&!RJ.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if("string"!=typeof e)throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(IJ(e))IX.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(TJ.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if("function"!=typeof t)throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return wJ[e]=t,e!==_J&&(RJ.isBasic(t)?TJ.prototype[e]=function(e,t){const n=function(){EJ(this,{name:e,plugin:t,instance:null},!0);const n=t.apply(this,arguments);return CJ(this,e),EJ(this,{name:e,plugin:t,instance:n}),n};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}(e,t):TJ.prototype[e]=AJ(e,t)),t}static deregisterPlugin(e){if(e===_J)throw new Error("Cannot de-register base plugin.");IJ(e)&&(delete wJ[e],delete TJ.prototype[e])}static getPlugins(e=Object.keys(wJ)){let t;return e.forEach(e=>{const n=kJ(e);n&&(t=t||{},t[e]=n)}),t}static getPluginVersion(e){const t=kJ(e);return t&&t.VERSION||""}}function NJ(e,t,n,i){return function(e,t){let n=!1;return function(...i){return n||IX.warn(e),n=!0,t.apply(this,i)}}(`${t} is deprecated and will be removed in ${e}.0; please use ${n} instead.`,i)}RJ.getPlugin=kJ,RJ.BASE_PLUGIN_NAME=_J,RJ.registerPlugin(_J,RJ),TJ.prototype.usingPlugin=function(e){return!!this[SJ]&&!0===this[SJ][e]},TJ.prototype.hasPlugin=function(e){return!!IJ(e)};const PJ=e=>0===e.indexOf("#")?e.slice(1):e;function DJ(e,t,n){let i=DJ.getPlayer(e);if(i)return t&&IX.warn(`Player "${e}" is already initialised. Options will not be applied.`),n&&i.ready(n),i;const r="string"==typeof e?LK("#"+PJ(e)):e;if(!cK(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");const s="getRootNode"in r&&r.getRootNode()instanceof ZG.ShadowRoot?r.getRootNode():r.ownerDocument.body;r.ownerDocument.defaultView&&s.contains(r)||IX.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(r.parentNode&&r.parentNode.hasAttribute&&r.parentNode.hasAttribute("data-vjs-player")?r.parentNode:r).cloneNode(!0)),yX("beforesetup").forEach(e=>{const n=e(r,DX(t));NX(n)&&!Array.isArray(n)?t=DX(t,n):IX.error("please return an object in beforesetup hooks")});const a=RY.getComponent("Player");return i=new a(r,t,n),yX("setup").forEach(e=>e(i)),i}if(DJ.hooks_=bX,DJ.hooks=yX,DJ.hook=function(e,t){yX(e,t)},DJ.hookOnce=function(e,t){yX(e,[].concat(t).map(t=>{const n=(...i)=>(vX(e,n),t(...i));return n}))},DJ.removeHook=vX,!0!==ZG.VIDEOJS_NO_DYNAMIC_STYLE&&lK()){let e=LK(".vjs-styles-defaults");if(!e){e=WK("vjs-styles-defaults");const t=LK("head");t&&t.insertBefore(e,t.firstChild),jK(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}VK(1,DJ),DJ.VERSION=gX,DJ.options=TJ.prototype.options_,DJ.getPlayers=()=>TJ.players,DJ.getPlayer=e=>{const t=TJ.players;let n;if("string"==typeof e){const i=PJ(e),r=t[i];if(r)return r;n=LK("#"+i)}else n=e;if(cK(n)){const{player:e,playerId:i}=n;if(e||t[i])return e||t[i]}},DJ.getAllPlayers=()=>Object.keys(TJ.players).map(e=>TJ.players[e]).filter(Boolean),DJ.players=TJ.players,DJ.getComponent=RY.getComponent,DJ.registerComponent=(e,t)=>(_Z.isTech(t)&&IX.warn(`The ${e} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),RY.registerComponent.call(RY,e,t)),DJ.getTech=_Z.getTech,DJ.registerTech=_Z.registerTech,DJ.use=function(e,t){SZ[e]=SZ[e]||[],SZ[e].push(t)},Object.defineProperty(DJ,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(DJ.middleware,"TERMINATOR",{value:IZ,writeable:!1,enumerable:!0}),DJ.browser=aK,DJ.obj=MX,DJ.mergeOptions=NJ(9,"videojs.mergeOptions","videojs.obj.merge",DX),DJ.defineLazyProperty=NJ(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",LX),DJ.bind=NJ(9,"videojs.bind","native Function.prototype.bind",lY),DJ.registerPlugin=RJ.registerPlugin,DJ.deregisterPlugin=RJ.deregisterPlugin,DJ.plugin=(e,t)=>(IX.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),RJ.registerPlugin(e,t)),DJ.getPlugins=RJ.getPlugins,DJ.getPlugin=RJ.getPlugin,DJ.getPluginVersion=RJ.getPluginVersion,DJ.addLanguage=function(e,t){return e=(""+e).toLowerCase(),DJ.options.languages=DX(DJ.options.languages,{[e]:t}),DJ.options.languages[e]},DJ.log=IX,DJ.createLogger=kX,DJ.time=BY,DJ.createTimeRange=NJ(9,"videojs.createTimeRange","videojs.time.createTimeRanges",DY),DJ.createTimeRanges=NJ(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",DY),DJ.formatTime=NJ(9,"videojs.formatTime","videojs.time.formatTime",$Y),DJ.setFormatTime=NJ(9,"videojs.setFormatTime","videojs.time.setFormatTime",MY),DJ.resetFormatTime=NJ(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",FY),DJ.parseUrl=NJ(9,"videojs.parseUrl","videojs.url.parseUrl",lZ),DJ.isCrossOrigin=NJ(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",dZ),DJ.EventTarget=pY,DJ.any=sY,DJ.on=tY,DJ.one=rY,DJ.off=nY,DJ.trigger=iY,DJ.xhr=tV.exports,DJ.TrackList=YY,DJ.TextTrack=mZ,DJ.TextTrackList=tZ,DJ.AudioTrack=gZ,DJ.AudioTrackList=QY,DJ.VideoTrack=bZ,DJ.VideoTrackList=eZ,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(e=>{DJ[e]=function(){return IX.warn(`videojs.${e}() is deprecated; use videojs.dom.${e}() instead`),BK[e].apply(null,arguments)}}),DJ.computedStyle=NJ(9,"videojs.computedStyle","videojs.dom.computedStyle",FK),DJ.dom=BK,DJ.fn=dY,DJ.num=iQ,DJ.str=AY,DJ.url=hZ,DJ.Error={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};
/*! @name videojs-contrib-quality-levels @version 4.1.0 @license Apache-2.0 */
class OJ{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class LJ extends DJ.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new OJ(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,i=this.length;n<i;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const n=this[t];if(n.id===e)return n}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}LJ.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const a6 in LJ.prototype.allowedEvents_)LJ.prototype["on"+a6]=null;var MJ="4.1.0";const FJ=function(e){return function(e){const t=e.qualityLevels,n=new LJ,i=function(){n.dispose(),e.qualityLevels=t,e.off("dispose",i)};return e.on("dispose",i),e.qualityLevels=()=>n,e.qualityLevels.VERSION=MJ,n}(this,DJ.obj.merge({},e))};DJ.registerPlugin("qualityLevels",FJ),FJ.VERSION=MJ;
/*! @name @videojs/http-streaming @version 3.17.0 @license Apache-2.0 */
const $J=rH,BJ=(e,t)=>t&&t.responseURL&&e!==t.responseURL?t.responseURL:e,zJ=e=>DJ.log.debug?DJ.log.debug.bind(DJ,"VHS:",`${e} >`):function(){};function UJ(...e){const t=DJ.obj||DJ;return(t.merge||t.mergeOptions).apply(t,e)}function GJ(...e){const t=DJ.time||DJ;return(t.createTimeRanges||t.createTimeRanges).apply(t,e)}const VJ=1/30,HJ=.1,WJ=function(e,t){const n=[];let i;if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return GJ(n)},jJ=function(e,t){return WJ(e,function(e,n){return e-HJ<=t&&n+HJ>=t})},qJ=function(e,t){return WJ(e,function(e){return e-VJ>=t})},XJ=e=>{const t=[];if(!e||!e.length)return"";for(let n=0;n<e.length;n++)t.push(e.start(n)+" => "+e.end(n));return t.join(", ")},KJ=e=>{const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},YJ=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},ZJ=function(e,t){let n=0;if(!e||!e.length)return n;for(let i=0;i<e.length;i++){const r=e.start(i),s=e.end(i);t>s||(n+=t>r&&t<=s?s-t:s-r)}return n},QJ=(e,t)=>{if(!t.preload)return t.duration;let n=0;return(t.parts||[]).forEach(function(e){n+=e.duration}),(t.preloadHints||[]).forEach(function(t){"PART"===t.type&&(n+=e.partTargetDuration)}),n},JJ=e=>(e.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(i,r){e.push({duration:i.duration,segmentIndex:n,partIndex:r,part:i,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),e0=e=>{const t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},t0=({preloadSegment:e})=>{if(!e)return;const{parts:t,preloadHints:n}=e;let i=(n||[]).reduce((e,t)=>e+("PART"===t.type?1:0),0);return i+=t&&t.length?t.length:0,i},n0=(e,t)=>{if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;const n=e0(t).length>0;return n&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:n&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},i0=function(e,t,n){if(void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;const i=function(e,t){let n=0,i=t-e.mediaSequence,r=e.segments[i];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;i--;){if(r=e.segments[i],void 0!==r.end)return{result:n+r.end,precise:!0};if(n+=QJ(e,r),void 0!==r.start)return{result:n+r.start,precise:!0}}return{result:n,precise:!1}}(e,t);if(i.precise)return i.result;const r=function(e,t){let n,i=0,r=t-e.mediaSequence;for(;r<e.segments.length;r++){if(n=e.segments[r],void 0!==n.start)return{result:n.start-i,precise:!0};if(i+=QJ(e,n),void 0!==n.end)return{result:n.end-i,precise:!0}}return{result:-1,precise:!1}}(e,t);return r.precise?r.result:i.result+n},r0=function(e,t,n){if(!e)return 0;if("number"!=typeof n&&(n=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return ZG.Infinity}return i0(e,t,n)},s0=function({defaultDuration:e,durationList:t,startIndex:n,endIndex:i}){let r=0;if(n>i&&([n,i]=[i,n]),n<0){for(let t=n;t<Math.min(0,i);t++)r+=e;n=0}for(let s=n;s<i;s++)r+=t[s].duration;return r},a0=function(e,t,n,i){if(!e||!e.segments)return null;if(e.endList)return r0(e);if(null===t)return null;t=t||0;let r=i0(e,e.mediaSequence+e.segments.length,t);return n&&(r-=i="number"==typeof i?i:n0(null,e)),Math.max(0,r)},o0=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},l0=function(e){return e.excludeUntil&&e.excludeUntil===1/0},c0=function(e){const t=o0(e);return!e.disabled&&!t},u0=function(e,t){return t.attributes&&t.attributes[e]},d0=(e,t)=>{if(1===e.playlists.length)return!0;const n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(e=>!!c0(e)&&(e.attributes.BANDWIDTH||0)<n).length},h0=(e,t)=>!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri)))),p0=function(e,t){const n=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{};let i=!1;for(const r in n){for(const e in n[r])if(i=t(n[r][e]),i)break;if(i)break}return!!i},f0=e=>{if(!e||!e.playlists||!e.playlists.length){return p0(e,e=>e.playlists&&e.playlists.length||e.uri)}for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t],i=n.attributes&&n.attributes.CODECS;if(i&&i.split(",").every(e=>SH(e)))continue;if(!p0(e,e=>h0(n,e)))return!1}return!0};var m0={liveEdgeDelay:n0,duration:r0,seekable:function(e,t,n){const i=t||0;let r=a0(e,t,!0,n);return null===r?GJ():(r<i&&(r=i),GJ(i,r))},getMediaInfoForTime:function({playlist:e,currentTime:t,startingSegmentIndex:n,startingPartIndex:i,startTime:r,exactManifestTimings:s}){let a=t-r;const o=JJ(e);let l=0;for(let c=0;c<o.length;c++){const e=o[c];if(n===e.segmentIndex&&("number"!=typeof i||"number"!=typeof e.partIndex||i===e.partIndex)){l=c;break}}if(a<0){if(l>0)for(let t=l-1;t>=0;t--){const n=o[t];if(a+=n.duration,s){if(a<0)continue}else if(a+VJ<=0)continue;return{partIndex:n.partIndex,segmentIndex:n.segmentIndex,startTime:r-s0({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:t})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t}}if(l<0){for(let n=l;n<0;n++)if(a-=e.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t};l=0}for(let c=l;c<o.length;c++){const t=o[c];a-=t.duration;const n=t.duration>VJ;if(!(0===a)&&!(n&&a+VJ>=0)||c===o.length-1){if(s){if(a>0)continue}else if(a-VJ>=0)continue;return{partIndex:t.partIndex,segmentIndex:t.segmentIndex,startTime:r+s0({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:c})}}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:t}},isEnabled:c0,isDisabled:function(e){return e.disabled},isExcluded:o0,isIncompatible:l0,playlistEnd:a0,isAes:function(e){for(let t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},hasAttribute:u0,estimateSegmentRequestTime:function(e,t,n,i=0){if(!u0("BANDWIDTH",n))return NaN;return(e*n.attributes.BANDWIDTH-8*i)/t},isLowestEnabledRendition:d0,isAudioOnly:f0,playlistMatch:h0,segmentDurationWithParts:QJ};const{log:g0}=DJ,b0=(e,t)=>`${e}-${t}`,y0=(e,t,n)=>`placeholder-uri-${e}-${t}-${n}`,v0=(e,t)=>{e.mediaGroups&&["AUDIO","SUBTITLES"].forEach(n=>{if(e.mediaGroups[n])for(const i in e.mediaGroups[n])for(const r in e.mediaGroups[n][i]){const s=e.mediaGroups[n][i][r];t(s,n,i,r)}})},T0=({playlist:e,uri:t,id:n})=>{e.id=n,e.playlistErrors_=0,t&&(e.uri=t),e.attributes=e.attributes||{}},x0=(e,t,n=y0)=>{e.uri=t;for(let r=0;r<e.playlists.length;r++)if(!e.playlists[r].uri){const t=`placeholder-uri-${r}`;e.playlists[r].uri=t}const i=f0(e);v0(e,(t,r,s,o)=>{if(!t.playlists||!t.playlists.length){if(i&&"AUDIO"===r&&!t.uri)for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t];if(n.attributes&&n.attributes.AUDIO&&n.attributes.AUDIO===s)return}t.playlists=[a({},t)]}t.playlists.forEach(function(t,i){const a=n(r,s,o,t),l=b0(i,a);t.uri?t.resolvedUri=t.resolvedUri||$J(e.uri,t.uri):(t.uri=0===i?a:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t})}),(e=>{let t=e.playlists.length;for(;t--;){const n=e.playlists[t];T0({playlist:n,id:b0(t,n.uri)}),n.resolvedUri=$J(e.uri,n.uri),e.playlists[n.id]=n,e.playlists[n.uri]=n,n.attributes.BANDWIDTH||g0.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}})(e),(e=>{v0(e,t=>{t.uri&&(t.resolvedUri=$J(e.uri,t.uri))})})(e)};class _0{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(null!==this.offset_)return;if(!e.length)return;const[t]=e;void 0!==t.programDateTime&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((e,t)=>(e.set(t.id,t),e),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(null===this.offset_)return[];const e={},t=[];this.pendingDateRanges_.forEach((n,i)=>{if(!this.processedDateRanges_.has(i)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),t.push(n),n.class))if(e[n.class]){const t=e[n.class].push(n);n.classListIndex=t-1}else e[n.class]=[n],n.classListIndex=0});for(const n of t){const t=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&t[n.classListIndex+1]?n.endTime=t[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((t,n)=>{t.startDate.getTime()<e&&this.processedDateRanges_.delete(n)})}}const S0=({requestType:e,request:t,error:n,parseFailure:i})=>{const r=t.status<200||t.status>299,s=t.status>=400&&t.status<=499,o={uri:t.uri,requestType:e},l=r&&!s||i;if(n&&s)o.error=a({},n),o.errorType=DJ.Error.NetworkRequestFailed;else if(t.aborted)o.errorType=DJ.Error.NetworkRequestAborted;else if(t.timedout)o.erroType=DJ.Error.NetworkRequestTimeout;else if(l){const e=i?DJ.Error.NetworkBodyParserFailed:DJ.Error.NetworkBadStatus;o.errorType=e,o.status=t.status,o.headers=t.headers}return o},w0=zJ("CodecUtils"),I0=function(e){const t=e.attributes||{};if(t.CODECS)return _H(t.CODECS)},k0=(e,t)=>{const n=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&n.AUDIO&&e.mediaGroups.AUDIO[n.AUDIO]},C0=function(e){const t={};return e.forEach(({mediaType:e,type:n,details:i})=>{t[e]=t[e]||[],t[e].push(xH(`${n}${i}`))}),Object.keys(t).forEach(function(e){if(t[e].length>1)return w0(`multiple ${e} codecs found as attributes: ${t[e].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),void(t[e]=null);t[e]=t[e][0]}),t},E0=function(e){let t=0;return e.audio&&t++,e.video&&t++,t},A0=function(e,t){const n=t.attributes||{},i=C0(I0(t)||[]);if(k0(e,t)&&!i.audio&&!((e,t)=>{if(!k0(e,t))return!0;const n=t.attributes||{},i=e.mediaGroups.AUDIO[n.AUDIO];for(const r in i)if(!i[r].uri&&!i[r].playlists)return!0;return!1})(e,t)){const t=C0(function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var i in n){var r=n[i];if(r.default&&r.playlists)return _H(r.playlists[0].attributes.CODECS)}return null}(e,n.AUDIO)||[]);t.audio&&(i.audio=t.audio)}return i},{EventTarget:R0}=DJ,N0=(e,t)=>{if(!e)return t;const n=UJ(e,t);if(e.preloadHints&&!t.preloadHints&&delete n.preloadHints,e.parts&&!t.parts)delete n.parts;else if(e.parts&&t.parts)for(let i=0;i<t.parts.length;i++)e.parts&&e.parts[i]&&(n.parts[i]=UJ(e.parts[i],t.parts[i]));return!e.skipped&&t.skipped&&(n.skipped=!1),e.preload&&!t.preload&&(n.preload=!1),n},P0=(e,t)=>{!e.resolvedUri&&e.uri&&(e.resolvedUri=$J(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=$J(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=$J(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=$J(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach(e=>{e.resolvedUri||(e.resolvedUri=$J(t,e.uri))}),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach(e=>{e.resolvedUri||(e.resolvedUri=$J(t,e.uri))})},D0=function(e){const t=e.segments||[],n=e.preloadSegment;if(n&&n.parts&&n.parts.length){if(n.preloadHints)for(let e=0;e<n.preloadHints.length;e++)if("MAP"===n.preloadHints[e].type)return t;n.duration=e.targetDuration,n.preload=!0,t.push(n)}return t},O0=(e,t)=>e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment,L0=(e,t,n=O0)=>{const i=UJ(e,{}),r=i.playlists[t.id];if(!r)return null;if(n(r,t))return null;t.segments=D0(t);const s=UJ(r,t);if(s.preloadSegment&&!t.preloadSegment&&delete s.preloadSegment,r.segments){if(t.skip){t.segments=t.segments||[];for(let e=0;e<t.skip.skippedSegments;e++)t.segments.unshift({skipped:!0})}s.segments=((e,t,n)=>{const i=e.slice(),r=t.slice();n=n||0;const s=[];let a;for(let o=0;o<r.length;o++){const e=i[o+n],t=r[o];e?(a=e.map||a,s.push(N0(e,t))):(a&&!t.map&&(t.map=a),s.push(t))}return s})(r.segments,t.segments,t.mediaSequence-r.mediaSequence)}s.segments.forEach(e=>{P0(e,s.resolvedUri)});for(let a=0;a<i.playlists.length;a++)i.playlists[a].id===t.id&&(i.playlists[a]=s);return i.playlists[t.id]=s,i.playlists[t.uri]=s,v0(e,(e,n,i,r)=>{if(e.playlists)for(let a=0;a<e.playlists.length;a++)t.id===e.playlists[a].id&&(e.playlists[a]=s)}),i},M0=(e,t)=>{const n=e.segments||[],i=n[n.length-1],r=i&&i.parts&&i.parts[i.parts.length-1],s=r&&r.duration||i&&i.duration;return t&&s?1e3*s:500*(e.partTargetDuration||e.targetDuration||10)},F0=(e,t,n)=>{if(!e)return;const i=[];return e.forEach(e=>{if(!e.attributes)return;const{BANDWIDTH:t,RESOLUTION:n,CODECS:r}=e.attributes;i.push({id:e.id,bandwidth:t,resolution:n,codecs:r})}),{type:t,isLive:n,renditions:i}};class $0 extends R0{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=zJ("PlaylistLoader");const{withCredentials:i=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=i,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const r=t.options_;this.customTagParsers=r&&r.customTagParsers||[],this.customTagMappers=r&&r.customTagMappers||[],this.llhls=r&&r.llhls,this.dateRangesStorage_=new _0,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();t.length&&this.addDateRangesToTextTrack_&&this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if("HAVE_METADATA"!==this.state)return;const e=this.media();let t=$J(this.main.uri,e.uri);this.llhls&&(t=((e,t)=>{if(t.endList||!t.serverControl)return e;const n={};if(t.serverControl.canBlockReload){const{preloadSegment:e}=t;let i=t.mediaSequence+t.segments.length;if(e){const r=e.parts||[],s=t0(t)-1;s>-1&&s!==r.length-1&&(n._HLS_part=s),(s>-1||r.length)&&i--}n._HLS_msn=i}if(t.serverControl&&t.serverControl.canSkipUntil&&(n._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(n).length){const t=new ZG.URL(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(e){n.hasOwnProperty(e)&&t.searchParams.set(e,n[e])}),e=t.toString()}return e})(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(e,t)=>{if(this.request)return e?this.playlistRequestError(this.request,this.media(),"HAVE_METADATA"):void this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})})}playlistRequestError(e,t,n){const{uri:i,id:r}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[r],status:e.status,message:`HLS playlist request error at URL: ${i}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:S0({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const n=(({onwarn:e,oninfo:t,manifestString:n,customTagParsers:i=[],customTagMappers:r=[],llhls:s})=>{const a=new mH;e&&a.on("warn",e),t&&a.on("info",t),i.forEach(e=>a.addParser(e)),r.forEach(e=>a.addTagMapper(e)),a.push(n),a.end();const o=a.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(e){o.hasOwnProperty(e)&&delete o[e]}),o.segments&&o.segments.forEach(function(e){["parts","preloadHints"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})),!o.targetDuration){let t=10;o.segments&&o.segments.length&&(t=o.segments.reduce((e,t)=>Math.max(e,t.duration),0)),e&&e({message:`manifest has no targetDuration defaulting to ${t}`}),o.targetDuration=t}const l=e0(o);if(l.length&&!o.partTargetDuration){const t=l.reduce((e,t)=>Math.max(e,t.duration),0);e&&(e({message:`manifest has no partTargetDuration defaulting to ${t}`}),g0.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=t}return o})({onwarn:({message:t})=>this.logger_(`m3u8-parser warn for ${e}: ${t}`),oninfo:({message:t})=>this.logger_(`m3u8-parser info for ${e}: ${t}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return n.playlists&&n.playlists.length?(this.excludeAudioOnlyVariants(n.playlists),n):n}catch(n){this.error=n,this.error.metadata={errorType:DJ.Error.StreamingHlsPlaylistParserError,error:n}}}excludeAudioOnlyVariants(e){const t=e=>{const t=e.attributes||{},{width:n,height:i}=t.RESOLUTION||{};if(n&&i)return!0;const r=I0(e)||[],s=C0(r);return Boolean(s.video)};e.some(t)&&e.forEach(e=>{t(e)||(e.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:i}){this.request=null,this.state="HAVE_METADATA";const r={playlistInfo:{type:"media",uri:n}};this.trigger({type:"playlistparsestart",metadata:r});const s=t||this.parseManifest_({url:n,manifestString:e});s.lastRequest=Date.now(),T0({playlist:s,uri:n,id:i});const a=L0(this.main,s);this.targetDuration=s.partTargetDuration||s.targetDuration,this.pendingMedia_=null,a?(this.main=a,this.media_=this.main.playlists[i]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(M0(this.media(),!!a)),r.parsedPlaylist=F0(this.main.playlists,r.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:r}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),ZG.clearTimeout(this.mediaUpdateTimeout),ZG.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new _0,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(ZG.clearTimeout(this.finalRenditionTimeout),t){const t=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;return void(this.finalRenditionTimeout=ZG.setTimeout(this.media.bind(this,e,!1),t))}const n=this.state,i=!this.media_||e.id!==this.media_.id,r=this.main.playlists[e.id];if(r&&r.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(i&&(this.trigger("mediachanging"),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(M0(e,!0)),!i)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const s={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:s}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,i)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=BJ(e.resolvedUri,i),t)return this.playlistRequestError(this.request,e,n);this.trigger({type:"playlistrequestcomplete",metadata:s}),this.haveMetadata({playlistString:i.responseText,url:e.uri,id:e.id}),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(ZG.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(ZG.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const e=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;return void(this.mediaUpdateTimeout=ZG.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},e))}this.started?t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(ZG.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=ZG.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=ZG.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,n)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:n.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:n.responseText,code:2,metadata:S0({requestType:n.requestType,request:n,error:t})},"HAVE_NOTHING"===this.state&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=BJ(this.src,n),this.trigger({type:"playlistparsestart",metadata:e});const i=this.parseManifest_({manifestString:n.responseText,url:this.src});e.parsedPlaylist=F0(i.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(i)})}srcUri(){return"string"==typeof this.src?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists)return this.main=e,x0(this.main,this.srcUri()),e.playlists.forEach(e=>{e.segments=D0(e),e.segments.forEach(t=>{P0(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.main.playlists[0]));const t=this.srcUri()||ZG.location.href;this.main=((e,t)=>{const n=b0(0,t),i={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:ZG.location.href,resolvedUri:ZG.location.href,playlists:[{uri:t,id:n,resolvedUri:t,attributes:{}}]};return i.playlists[n]=i.playlists[0],i.playlists[t]=i.playlists[0],i})(0,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,i=e.ID;let r=n.playlists.length;for(;r--;){const s=n.playlists[r];if(s.attributes["PATHWAY-ID"]===i){const a=s.resolvedUri,o=s.id;if(t){const t=this.createCloneURI_(s.resolvedUri,e),a=b0(i,t),o=this.createCloneAttributes_(i,s.attributes),l=this.createClonePlaylist_(s,a,e,o);n.playlists[r]=l,n.playlists[a]=l,n.playlists[t]=l}else n.playlists.splice(r,1);delete n.playlists[o],delete n.playlists[a]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,i=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{if(n.mediaGroups[e]&&n.mediaGroups[e][i])for(const t in n.mediaGroups[e])if(t===i){for(const i in n.mediaGroups[e][t]){n.mediaGroups[e][t][i].playlists.forEach((e,t)=>{const i=n.playlists[e.id],r=i.id,s=i.resolvedUri;delete n.playlists[r],delete n.playlists[s]})}delete n.mediaGroups[e][t]}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const n=this.main,i=n.playlists.length,r=this.createCloneURI_(t.resolvedUri,e),s=b0(e.ID,r),a=this.createCloneAttributes_(e.ID,t.attributes),o=this.createClonePlaylist_(t,s,e,a);n.playlists[i]=o,n.playlists[s]=o,n.playlists[r]=o,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],i=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{if(i.mediaGroups[r]&&!i.mediaGroups[r][t])for(const s in i.mediaGroups[r])if(s===n){i.mediaGroups[r][t]={};for(const n in i.mediaGroups[r][s]){const o=i.mediaGroups[r][s][n];i.mediaGroups[r][t][n]=a({},o);const l=i.mediaGroups[r][t][n],c=this.createCloneURI_(o.resolvedUri,e);l.resolvedUri=c,l.uri=c,l.playlists=[],o.playlists.forEach((s,a)=>{const o=i.playlists[s.id],c=y0(r,t,n),u=b0(t,c);if(o&&!i.playlists[u]){const t=this.createClonePlaylist_(o,u,e),n=t.resolvedUri;i.playlists[u]=t,i.playlists[n]=t}l.playlists[a]=this.createClonePlaylist_(s,u,e)})}}})}createClonePlaylist_(e,t,n,i){const r=this.createCloneURI_(e.resolvedUri,n),s={resolvedUri:r,uri:r,id:t};return e.segments&&(s.segments=[]),i&&(s.attributes=i),UJ(e,s)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const i=t["URI-REPLACEMENT"].PARAMS;for(const r of Object.keys(i))n.searchParams.set(r,i[r]);return n.href}createCloneAttributes_(e,t){const n={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(i=>{t[i]&&(n[i]=e)}),n}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const i=e.contentProtection[n].attributes.keyId;i&&t.add(i.toLowerCase())}return t}}}const B0=function(e,t,n,i){const r="arraybuffer"===e.responseType?e.response:e.responseText;!t&&r&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=r.byteLength||r.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),n.headers&&(e.responseHeaders=n.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===n.statusCode||206===n.statusCode||0===n.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(r||e.responseText)))),i(t,e)},z0=function(){const e=function e(t,n){t=UJ({timeout:45e3},t);const i=e.beforeRequest||DJ.Vhs.xhr.beforeRequest,r=e._requestCallbackSet||DJ.Vhs.xhr._requestCallbackSet||new Set,s=e._responseCallbackSet||DJ.Vhs.xhr._responseCallbackSet;i&&"function"==typeof i&&(DJ.log.warn("beforeRequest is deprecated, use onRequest instead."),r.add(i));const a=!0===DJ.Vhs.xhr.original?DJ.xhr:DJ.Vhs.xhr,o=((e,t)=>{if(!e||!e.size)return;let n=t;return e.forEach(e=>{n=e(n)}),n})(r,t);r.delete(i);const l=a(o||t,function(e,t){return((e,t,n,i)=>{e&&e.size&&e.forEach(e=>{e(t,n,i)})})(s,l,e,t),B0(l,e,t,n)}),c=l.abort;return l.abort=function(){return l.aborted=!0,c.apply(l,arguments)},l.uri=t.uri,l.requestType=t.requestType,l.requestTime=Date.now(),l};return e.original=!0,e},U0=function(e){const t={};return e.byterange&&(t.Range=function(e){let t;const n=e.offset;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?ZG.BigInt(e.offset)+ZG.BigInt(e.length)-ZG.BigInt(1):e.offset+e.length-1,"bytes="+n+"-"+t}(e.byterange)),t},G0=function(e,t){return e.start(t)+"-"+e.end(t)},V0=function(e,t){const n=e.toString(16);return"00".substring(0,2-n.length)+n+(t%2?" ":"")},H0=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},W0=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];NH(i)?t[n]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:t[n]=i}),t},j0=function(e){const t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},q0=function(e){return e.resolvedUri},X0=e=>{const t=Array.prototype.slice.call(e),n=16;let i,r,s="";for(let a=0;a<t.length/n;a++)i=t.slice(a*n,a*n+n).map(V0).join(""),r=t.slice(a*n,a*n+n).map(H0).join(""),s+=i+" "+r+"\n";return s};var K0=Object.freeze({__proto__:null,createTransferableMessage:W0,initSegmentId:j0,segmentKeyId:q0,hexDump:X0,tagDump:({bytes:e})=>X0(e),textRanges:e=>{let t,n="";for(t=0;t<e.length;t++)n+=G0(e,t)+" ";return n}});const Y0=({playlist:e,time:t,callback:n})=>{if(!n)throw new Error("getProgramTime: callback must be provided");if(!e||void 0===t)return n({message:"getProgramTime: playlist and time must be provided"});const i=((e,t)=>{if(!t||!t.segments||0===t.segments.length)return null;let n,i=0;for(let s=0;s<t.segments.length&&(n=t.segments[s],i=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:i+n.duration,!(e<=i));s++);const r=t.segments[t.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>i){if(e>i+.25*r.duration)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:i-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}})(t,e);if(!i)return n({message:"valid programTime was not found"});if("estimate"===i.type)return n({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:i.estimatedStart});const r={mediaSeconds:t},s=((e,t)=>{if(!t.dateTimeObject)return null;const n=t.videoTimingInfo.transmuxerPrependedSeconds,i=e-(t.videoTimingInfo.transmuxedPresentationStart+n);return new Date(t.dateTimeObject.getTime()+1e3*i)})(t,i.segment);return s&&(r.programDateTime=s.toISOString()),n(null,r)},Z0=({programTime:e,playlist:t,retryCount:n=2,seekTo:i,pauseAfterSeek:r=!0,tech:s,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(void 0===e||!t||!i)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!t.endList&&!s.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!(e=>{if(!e.segments||0===e.segments.length)return!1;for(let t=0;t<e.segments.length;t++)if(!e.segments[t].dateTimeObject)return!1;return!0})(t))return a({message:"programDateTime tags must be provided in the manifest "+t.resolvedUri});const o=((e,t)=>{let n;try{n=new Date(e)}catch(r6){return null}if(!t||!t.segments||0===t.segments.length)return null;let i=t.segments[0];if(n<new Date(i.dateTimeObject))return null;for(let l=0;l<t.segments.length-1&&(i=t.segments[l],!(n<new Date(t.segments[l+1].dateTimeObject)));l++);const r=t.segments[t.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?(o=r.videoTimingInfo).transmuxedPresentationEnd-o.transmuxedPresentationStart-o.transmuxerPrependedSeconds:r.duration+.25*r.duration;var o;return n>new Date(s.getTime()+1e3*a)?null:(n>new Date(s)&&(i=r),{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:m0.duration(t,t.mediaSequence+t.segments.indexOf(i)),type:i.videoTimingInfo?"accurate":"estimate"})})(e,t);if(!o)return a({message:`${e} was not found in the stream`});const l=o.segment,c=((e,t)=>{let n,i;try{n=new Date(e),i=new Date(t)}catch(r6){}const r=n.getTime();return(i.getTime()-r)/1e3})(l.dateTimeObject,e);if("estimate"===o.type)return 0===n?a({message:`${e} is not buffered yet. Try again`}):(i(o.estimatedStart+c),void s.one("seeked",()=>{Z0({programTime:e,playlist:t,retryCount:n-1,seekTo:i,pauseAfterSeek:r,tech:s,callback:a})}));const u=l.start+c;s.one("seeked",()=>a(null,s.currentTime())),r&&s.pause(),i(u)},Q0=(e,t)=>{if(4===e.readyState)return t()},J0=(e,t,n,i)=>{let r,s=[],a=!1;const o=function(e,t,i,r){return t.abort(),a=!0,n(e,t,i,r)},l=function(e,t){if(a)return;if(e)return e.metadata=S0({requestType:i,request:t,error:e}),o(e,t,"",s);const n=t.responseText.substring(s&&s.byteLength||0,t.responseText.length);if(s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter(function(e){return e&&(e.byteLength||e.length)&&"string"!=typeof e}),t.length<=1)return PH(t[0]);var i=t.reduce(function(e,t,n){return e+(t.byteLength||t.length)},0),r=new Uint8Array(i),s=0;return t.forEach(function(e){e=PH(e),r.set(e,s),s+=e.byteLength}),r}(s,FH(n,!0)),r=r||Wq(s),s.length<10||r&&s.length<r+2)return Q0(t,()=>o(e,t,"",s));const l=pX(s);return"ts"===l&&s.length<188||!l&&s.length<376?Q0(t,()=>o(e,t,"",s)):o(null,t,l,s)},c=t({uri:e,beforeSend(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function({total:t,loaded:n}){return B0(e,null,{statusCode:e.status},l)})}},function(e,t){return B0(c,e,t,l)});return c},{EventTarget:e1}=DJ,t1=function(e,t){if(!O0(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(let n=0;n<e.segments.length;n++){const i=e.segments[n],r=t.segments[n];if(i.uri!==r.uri)return!1;if(!i.byterange&&!r.byterange)continue;const s=i.byterange,a=r.byterange;if(s&&!a||!s&&a)return!1;if(s.offset!==a.offset||s.length!==a.length)return!1}return!0},n1=(e,t,n,i)=>`placeholder-uri-${e}-${t}-${i.attributes.NAME||n}`,i1=(e,t,n)=>{let i=!0,r=UJ(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts});for(let s=0;s<t.playlists.length;s++){const e=t.playlists[s];if(e.sidx){const t=cq(e.sidx);n&&n[t]&&n[t].sidx&&nq(e,n[t].sidx,e.sidx.resolvedUri)}const a=L0(r,e,t1);a&&(r=a,i=!1)}return v0(t,(e,t,n,s)=>{if(e.playlists&&e.playlists.length){const a=e.playlists[0].id,o=L0(r,e.playlists[0],t1);o&&(r=o,s in r.mediaGroups[t][n]||(r.mediaGroups[t][n][s]=e),r.mediaGroups[t][n][s].playlists[0]=r.playlists[a],i=!1)}}),((e,t)=>{v0(e,(n,i,r,s)=>{t.mediaGroups[i][r]&&s in t.mediaGroups[i][r]||delete e.mediaGroups[i][r][s]})})(r,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(i=!1),i?null:r},r1=(e,t)=>(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length,s1=(e,t)=>{const n={};for(const i in e){const r=e[i].sidx;if(r){const e=cq(r);if(!t[e])break;const i=t[e].sidxInfo;r1(i,r)&&(n[e]=t[e])}}return n};class a1 extends e1{constructor(e,t,n={},i){super(),this.isPaused_=!0,this.mainPlaylistLoader_=i||this,i||(this.isMain_=!0);const{withCredentials:r=!1}=n;if(this.vhs_=t,this.withCredentials=r,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=zJ("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,n){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata}:e,n&&(this.state=n),this.trigger("error"),!0):void 0)}addSidxSegments_(e,t,n){const i=e.sidx&&cq(e.sidx);if(!e.sidx||!i||this.mainPlaylistLoader_.sidxMapping_[i])return ZG.clearTimeout(this.mediaRequest_),void(this.mediaRequest_=ZG.setTimeout(()=>n(!1),0));const r=BJ(e.sidx.resolvedUri),s=(r,s)=>{if(this.requestErrored_(r,s,t))return;const a=this.mainPlaylistLoader_.sidxMapping_,{requestType:o}=s;let l;try{l=Vq(PH(s.response).subarray(8))}catch(r6){return r6.metadata=S0({requestType:o,request:s,parseFailure:!0}),void this.requestErrored_(r6,s,t)}return a[i]={sidxInfo:e.sidx,sidx:l},nq(e,l,e.sidx.resolvedUri),n(!0)};this.request=J0(r,this.vhs_.xhr,(t,n,i,a)=>{if(t)return s(t,n);if(!i||"mp4"!==i){const t=i||"unknown";return s({status:n.status,message:`Unsupported ${t} container type for sidx segment at URL: ${r}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},n)}const{offset:o,length:l}=e.sidx.byterange;if(a.length>=l+o)return s(t,{response:a.subarray(o,o+l),status:n.status,uri:n.uri});this.request=this.vhs_.xhr({uri:r,responseType:"arraybuffer",requestType:"dash-sidx",headers:U0({byterange:e.sidx.byterange})},s)},"dash-sidx")}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},ZG.clearTimeout(this.minimumUpdatePeriodTimeout_),ZG.clearTimeout(this.mediaRequest_),ZG.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if("string"==typeof e){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,n=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,ZG.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),"HAVE_MAIN_MANIFEST"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),ZG.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(ZG.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)}load(e){this.isPaused_=!1,ZG.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const e=t?t.targetDuration/2*1e3:5e3;return void(this.mediaUpdateTimeout=ZG.setTimeout(()=>this.load(),e))}this.started?t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()}start(){if(this.started=!0,!this.isMain_)return ZG.clearTimeout(this.mediaRequest_),void(this.mediaRequest_=ZG.setTimeout(()=>this.haveMain_(),0));this.requestMain_((e,t)=>{this.haveMain_(),this.hasPendingRequest()||this.media_||this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(n,i)=>{if(n){const{requestType:e}=i;n.metadata=S0({requestType:e,request:i,error:n})}if(this.requestErrored_(n,i))return void("HAVE_NOTHING"===this.state&&(this.started=!1));this.trigger({type:"manifestrequestcomplete",metadata:t});const r=i.responseText!==this.mainPlaylistLoader_.mainXml_;return this.mainPlaylistLoader_.mainXml_=i.responseText,i.responseHeaders&&i.responseHeaders.date?this.mainLoaded_=Date.parse(i.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=BJ(this.mainPlaylistLoader_.srcUrl,i),r?(this.handleMain_(),void this.syncClientServerClock_(()=>e(i,r))):e(i,r)})}syncClientServerClock_(e){const t=zq(this.mainPlaylistLoader_.mainXml_);return null===t?(this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()):"DIRECT"===t.method?(this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:$J(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,i)=>{if(!this.request)return;if(n){const{requestType:t}=i;return this.error.metadata=S0({requestType:t,request:i,error:n}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let r;r="HEAD"===t.method?i.responseHeaders&&i.responseHeaders.date?Date.parse(i.responseHeaders.date):this.mainLoaded_:Date.parse(i.responseText),this.mainPlaylistLoader_.clientOffset_=r-Date.now(),e()}))}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){ZG.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};let n;this.trigger({type:"manifestparsestart",metadata:t});try{n=(({mainXml:e,srcUrl:t,clientOffset:n,sidxMapping:i,previousManifest:r})=>{const s=Bq(e,{manifestUri:t,clientOffset:n,sidxMapping:i,previousManifest:r});return x0(s,t,n1),s})({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(r){this.error=r,this.error.metadata={errorType:DJ.Error.StreamingDashManifestParserError,error:r},this.trigger("error")}e&&(n=i1(e,n,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=n||e;const i=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(i&&i!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=i),(!e||n&&n.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(n),n){const{duration:e,endList:i}=n,r=[];n.playlists.forEach(e=>{r.push({id:e.id,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS})});const s={duration:e,isLive:!i,renditions:r};t.parsedManifest=s,this.trigger({type:"manifestparsecomplete",metadata:t})}return Boolean(n)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(ZG.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!=typeof t||t<=0?t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`):this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=ZG.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=((e,t)=>{let n=s1(e.playlists,t);return v0(e,(e,i,r,s)=>{if(e.playlists&&e.playlists.length){const i=e.playlists;n=UJ(n,s1(i,t))}}),n})(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,e=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const e=()=>{this.media().endList||(this.mediaUpdateTimeout=ZG.setTimeout(()=>{this.trigger("mediaupdatetimeout"),e()},M0(this.media(),Boolean(n))))};e()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const e=this.mainPlaylistLoader_.main.eventStream.map(e=>({cueTime:e.start,frames:[{data:e.messageData}]}));this.addMetadataToTextTrack("EventStream",e,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const i=e.contentProtection[n].attributes["cenc:default_KID"];i&&t.add(i.replace(/-/g,"").toLowerCase())}return t}}}var o1={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const l1=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},c1=function(e){return function(){const t=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(r6){const n=new BlobBuilder;return n.append(e),URL.createObjectURL(n.getBlob())}}(e),n=l1(new Worker(t));n.objURL=t;const i=n.terminate;return n.on=n.addEventListener,n.off=n.removeEventListener,n.terminate=function(){return URL.revokeObjectURL(t),i.call(this)},n}},u1=function(e){return`var browserWorkerPolyFill = ${l1.toString()};\nbrowserWorkerPolyFill(self);\n`+e},d1=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},h1=u1(d1(function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var i;return!!e[t]&&(i=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(i,1),i>-1)},this.trigger=function(t){var n,i,r,s;if(n=e[t])if(2===arguments.length)for(r=n.length,i=0;i<r;++i)n[i].call(this,arguments[1]);else{for(s=[],i=arguments.length,i=1;i<arguments.length;++i)s.push(arguments[i]);for(r=n.length,i=0;i<r;++i)n[i].apply(this,s)}},this.dispose=function(){e={}}}};t.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},t.prototype.push=function(e){this.trigger("data",e)},t.prototype.flush=function(e){this.trigger("done",e)},t.prototype.partialFlush=function(e){this.trigger("partialdone",e)},t.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},t.prototype.reset=function(e){this.trigger("reset",e)};var n,i,r,s,a,o,l,c,u,d,h,p,f,m,g,b,y,v,T,x,_,S,w,I,k,C,E,A,R,N,P,D,O,L,M,F,$,B,z,U,G=t,V=Math.pow(2,32),H={getUint64:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:n.getUint32(0)*V+n.getUint32(4)},MAX_UINT32:V},W=H.MAX_UINT32;!function(){var e;if(S={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in S)S.hasOwnProperty(e)&&(S[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);w=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),k=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),I=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),E=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),A={video:C,audio:E},P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),N=new Uint8Array([0,0,0,0,0,0,0,0]),D=new Uint8Array([0,0,0,0,0,0,0,0]),O=D,L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),M=D,R=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),n=function(e){var t,n,i=[],r=0;for(t=1;t<arguments.length;t++)i.push(arguments[t]);for(t=i.length;t--;)r+=i[t].byteLength;for(n=new Uint8Array(r+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,r=8;t<i.length;t++)n.set(i[t],r),r+=i[t].byteLength;return n},i=function(){return n(S.dinf,n(S.dref,P))},r=function(e){return n(S.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},g=function(e){return n(S.hdlr,A[e])},m=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),n(S.mdhd,t)},f=function(e){return n(S.mdia,m(e),g(e.type),o(e))},a=function(e){return n(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},o=function(e){return n(S.minf,"video"===e.type?n(S.vmhd,R):n(S.smhd,N),i(),y(e))},l=function(e,t){for(var i=[],r=t.length;r--;)i[r]=T(t[r]);return n.apply(null,[S.moof,a(e)].concat(i))},c=function(e){for(var t=e.length,i=[];t--;)i[t]=h(e[t]);return n.apply(null,[S.moov,d(4294967295)].concat(i).concat(u(e)))},u=function(e){for(var t=e.length,i=[];t--;)i[t]=x(e[t]);return n.apply(null,[S.mvex].concat(i))},d=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n(S.mvhd,t)},b=function(e){var t,i,r=e.samples||[],s=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)t=r[i].flags,s[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return n(S.sdtp,s)},y=function(e){return n(S.stbl,v(e),n(S.stts,M),n(S.stsc,O),n(S.stsz,L),n(S.stco,D))},v=function(e){return n(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?F(e):$(e))},F=function(e){var t,i,r=e.sps||[],s=e.pps||[],a=[],o=[];for(t=0;t<r.length;t++)a.push((65280&r[t].byteLength)>>>8),a.push(255&r[t].byteLength),a=a.concat(Array.prototype.slice.call(r[t]));for(t=0;t<s.length;t++)o.push((65280&s[t].byteLength)>>>8),o.push(255&s[t].byteLength),o=o.concat(Array.prototype.slice.call(s[t]));if(i=[S.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n(S.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([r.length],a,[s.length],o))),n(S.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],c=e.sarRatio[1];i.push(n(S.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&c)>>24,(16711680&c)>>16,(65280&c)>>8,255&c])))}return n.apply(null,i)},$=function(e){return n(S.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),r(e))},p=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return n(S.tkhd,t)},T=function(e){var t,i,r,s,a,o;return t=n(S.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(e.baseMediaDecodeTime/W),o=Math.floor(e.baseMediaDecodeTime%W),i=n(S.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),"audio"===e.type?(r=_(e,92),n(S.traf,t,i,r)):(s=b(e),r=_(e,s.length+92),n(S.traf,t,i,r,s))},h=function(e){return e.duration=e.duration||4294967295,n(S.trak,p(e),f(e))},x=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),n(S.trex,t)},U=function(e,t){var n=0,i=0,r=0,s=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(s=8)),[0,0,n|i|r|s,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},z=function(e,t){var i,r,s,a,o,l;for(t+=20+16*(a=e.samples||[]).length,s=U(a,t),(r=new Uint8Array(s.length+16*a.length)).set(s),i=s.length,l=0;l<a.length;l++)o=a[l],r[i++]=(4278190080&o.duration)>>>24,r[i++]=(16711680&o.duration)>>>16,r[i++]=(65280&o.duration)>>>8,r[i++]=255&o.duration,r[i++]=(4278190080&o.size)>>>24,r[i++]=(16711680&o.size)>>>16,r[i++]=(65280&o.size)>>>8,r[i++]=255&o.size,r[i++]=o.flags.isLeading<<2|o.flags.dependsOn,r[i++]=o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,r[i++]=61440&o.flags.degradationPriority,r[i++]=15&o.flags.degradationPriority,r[i++]=(4278190080&o.compositionTimeOffset)>>>24,r[i++]=(16711680&o.compositionTimeOffset)>>>16,r[i++]=(65280&o.compositionTimeOffset)>>>8,r[i++]=255&o.compositionTimeOffset;return n(S.trun,r)},B=function(e,t){var i,r,s,a,o,l;for(t+=20+8*(a=e.samples||[]).length,s=U(a,t),(i=new Uint8Array(s.length+8*a.length)).set(s),r=s.length,l=0;l<a.length;l++)o=a[l],i[r++]=(4278190080&o.duration)>>>24,i[r++]=(16711680&o.duration)>>>16,i[r++]=(65280&o.duration)>>>8,i[r++]=255&o.duration,i[r++]=(4278190080&o.size)>>>24,i[r++]=(16711680&o.size)>>>16,i[r++]=(65280&o.size)>>>8,i[r++]=255&o.size;return n(S.trun,i)},_=function(e,t){return"audio"===e.type?B(e,t):z(e,t)};var j,q,X,K,Y,Z,Q,J,ee={ftyp:s=function(){return n(S.ftyp,w,I,w,k)},mdat:function(e){return n(S.mdat,e)},moof:l,moov:c,initSegment:function(e){var t,n=s(),i=c(e);return(t=new Uint8Array(n.byteLength+i.byteLength)).set(n),t.set(i,n.byteLength),t}},te=function(e,t){var n={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n},ne={groupNalsIntoFrames:function(e){var t,n,i=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,i.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(n=e[t]).nalUnitType?(i.length&&(i.duration=n.dts-i.dts,r.byteLength+=i.byteLength,r.nalCount+=i.length,r.duration+=i.duration,r.push(i)),(i=[n]).byteLength=n.data.byteLength,i.pts=n.pts,i.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(i.keyFrame=!0),i.duration=n.dts-i.dts,i.byteLength+=n.data.byteLength,i.push(n));return r.length&&(!i.duration||i.duration<=0)&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.length,r.duration+=i.duration,r.push(i),r},groupFramesIntoGops:function(e){var t,n,i=[],r=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(n=e[t]).keyFrame?(i.length&&(r.push(i),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration),(i=[n]).nalCount=n.length,i.byteLength=n.byteLength,i.pts=n.pts,i.dts=n.dts,i.duration=n.duration):(i.duration+=n.duration,i.nalCount+=n.length,i.byteLength+=n.byteLength,i.push(n));return r.length&&i.duration<=0&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration,r.push(i),r},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var n,i,r,s,a,o=t||0,l=[];for(n=0;n<e.length;n++)for(s=e[n],i=0;i<s.length;i++)a=s[i],o+=(r=te(a,o)).size,l.push(r);return l},concatenateNalData:function(e){var t,n,i,r,s,a,o=0,l=e.byteLength,c=e.nalCount,u=new Uint8Array(l+4*c),d=new DataView(u.buffer);for(t=0;t<e.length;t++)for(r=e[t],n=0;n<r.length;n++)for(s=r[n],i=0;i<s.length;i++)a=s[i],d.setUint32(o,a.data.byteLength),o+=4,u.set(a.data,o),o+=a.data.byteLength;return u},generateSampleTableForFrame:function(e,t){var n,i=[];return n=te(e,t||0),i.push(n),i},concatenateNalDataForFrame:function(e){var t,n,i=0,r=e.byteLength,s=e.length,a=new Uint8Array(r+4*s),o=new DataView(a.buffer);for(t=0;t<e.length;t++)n=e[t],o.setUint32(i,n.data.byteLength),i+=4,a.set(n.data,i),i+=n.data.byteLength;return a}},ie=[33,16,5,32,164,27],re=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],se=function(e){for(var t=[];e--;)t.push(0);return t},ae=9e4;Z=function(e,t){return q(Y(e,t))},Q=function(e,t){return X(K(e),t)},J=function(e,t,n){return K(n?e:e-t)};var oe={ONE_SECOND_IN_TS:ae,secondsToVideoTs:q=function(e){return e*ae},secondsToAudioTs:X=function(e,t){return e*t},videoTsToSeconds:K=function(e){return e/ae},audioTsToSeconds:Y=function(e,t){return e/t},audioTsToVideoTs:Z,videoTsToAudioTs:Q,metadataTsToSeconds:J},le=function(){if(!j){var e={96e3:[ie,[227,64],se(154),[56]],88200:[ie,[231],se(170),[56]],64e3:[ie,[248,192],se(240),[56]],48e3:[ie,[255,192],se(268),[55,148,128],se(54),[112]],44100:[ie,[255,192],se(268),[55,163,128],se(84),[112]],32e3:[ie,[255,192],se(268),[55,234],se(226),[112]],24e3:[ie,[255,192],se(268),[55,255,128],se(268),[111,112],se(126),[224]],16e3:[ie,[255,192],se(268),[55,255,128],se(268),[111,255],se(269),[223,108],se(195),[1,192]],12e3:[re,se(268),[3,127,248],se(268),[6,255,240],se(268),[13,255,224],se(268),[27,253,128],se(259),[56]],11025:[re,se(268),[3,127,248],se(268),[6,255,240],se(268),[13,255,224],se(268),[27,255,192],se(268),[55,175,128],se(108),[112]],8e3:[re,se(268),[3,121,16],se(47),[7]]};t=e,j=Object.keys(t).reduce(function(e,n){return e[n]=new Uint8Array(t[n].reduce(function(e,t){return e.concat(t)},[])),e},{})}var t;return j},ce=oe,ue={prefixWithSilence:function(e,t,n,i){var r,s,a,o,l,c=0,u=0,d=0;if(t.length&&(r=ce.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(ce.ONE_SECOND_IN_TS/(e.samplerate/1024)),n&&i&&(c=r-Math.max(n,i),d=(u=Math.floor(c/s))*s),!(u<1||d>ce.ONE_SECOND_IN_TS/2))){for((a=le()[e.samplerate])||(a=t[0].data),o=0;o<u;o++)l=t[0],t.splice(0,0,{data:a,dts:l.dts-s,pts:l.pts-s});return e.baseMediaDecodeTime-=Math.floor(ce.videoTsToAudioTs(d,e.samplerate)),d}},trimAdtsFramesByEarliestDts:function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},generateSampleTable:function(e){var t,n,i=[];for(t=0;t<e.length;t++)n=e[t],i.push({size:n.data.byteLength,duration:1024});return i},concatenateFrameData:function(e){var t,n,i=0,r=new Uint8Array(function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t].data.byteLength;return n}(e));for(t=0;t<e.length;t++)n=e[t],r.set(n.data,i),i+=n.data.byteLength;return r}},de=oe.ONE_SECOND_IN_TS,he={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var n,i=e.minSegmentDts;return t||(i-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=i,n=Math.max(0,n),"audio"===e.type&&(n*=e.samplerate/de,n=Math.floor(n)),n},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))}},pe={parseSei:function(e){for(var t=0,n={payloadType:-1,payloadSize:0},i=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)i+=255,t++;for(i+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!n.payload&&4===i){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){n.payloadType=i,n.payloadSize=r,n.payload=e.subarray(t,t+r);break}n.payload=void 0}t+=r,i=0,r=0}return n},parseUserData:function(e){return 181!==e.payload[0]||49!=(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var n,i,r,s,a=[];if(!(64&t[0]))return a;for(i=31&t[0],n=0;n<i;n++)s={type:3&t[(r=3*n)+2],pts:e},4&t[r+2]&&(s.ccData=t[r+3]<<8|t[r+4],a.push(s));return a},discardEmulationPreventionBytes:function(e){for(var t,n,i=e.byteLength,r=[],s=1;s<i-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n},USER_DATA_REGISTERED_ITU_T_T35:4},fe=G,me=pe,ge=function(e){e=e||{},ge.prototype.init.call(this),this.parse708captions_="boolean"!=typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new ke(0,0),new ke(0,1),new ke(1,0),new ke(1,1)],this.parse708captions_&&(this.cc708Stream_=new xe({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ge.prototype=new fe,ge.prototype.push=function(e){var t,n,i;if("sei_rbsp"===e.nalUnitType&&(t=me.parseSei(e.escapedRBSP)).payload&&t.payloadType===me.USER_DATA_REGISTERED_ITU_T_T35&&(n=me.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));i=me.parseCaptionPackets(e.pts,n),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},ge.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},ge.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},ge.prototype.flush=function(){return this.flushStream("flush")},ge.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ge.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},ge.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},ge.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},ge.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},ge.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)},ge.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var be={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},ye=function(e){return 32<=e&&e<=127||160<=e&&e<=255},ve=function(e){this.windowNum=e,this.reset()};ve.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},ve.prototype.getText=function(){return this.rows.join("\n")},ve.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},ve.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},ve.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},ve.prototype.addText=function(e){this.rows[this.rowIdx]+=e},ve.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var Te=function(e,t,n){this.serviceNum=e,this.text="",this.currentWindow=new ve(-1),this.windows=[],this.stream=n,"string"==typeof t&&this.createTextDecoder(t)};Te.prototype.init=function(e,t){this.startPts=e;for(var n=0;n<8;n++)this.windows[n]=new ve(n),"function"==typeof t&&(this.windows[n].beforeRowOverflow=t)},Te.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},Te.prototype.createTextDecoder=function(e){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var xe=function(e){e=e||{},xe.prototype.init.call(this);var t,n=this,i=e.captionServices||{},r={};Object.keys(i).forEach(e=>{t=i[e],/^SERVICE/.test(e)&&(r[e]=t.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(n.new708Packet(),n.add708Bytes(e)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(e))}};xe.prototype=new fe,xe.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},xe.prototype.add708Bytes=function(e){var t=e.ccData,n=t>>>8,i=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(n),this.current708Packet.data.push(i)},xe.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,n=null,i=null,r=0,s=t[r++];for(e.seq=s>>6,e.sizeCode=63&s;r<t.length;r++)i=31&(s=t[r++]),7===(n=s>>5)&&i>0&&(n=s=t[r++]),this.pushServiceBlock(n,r,i),i>0&&(r+=i-1)},xe.prototype.pushServiceBlock=function(e,t,n){var i,r=t,s=this.current708Packet.data,a=this.services[e];for(a||(a=this.initService(e,r));r<t+n&&r<s.length;r++)i=s[r],ye(i)?r=this.handleText(r,a):24===i?r=this.multiByteCharacter(r,a):16===i?r=this.extendedCommands(r,a):128<=i&&i<=135?r=this.setCurrentWindow(r,a):152<=i&&i<=159?r=this.defineWindow(r,a):136===i?r=this.clearWindows(r,a):140===i?r=this.deleteWindows(r,a):137===i?r=this.displayWindows(r,a):138===i?r=this.hideWindows(r,a):139===i?r=this.toggleWindows(r,a):151===i?r=this.setWindowAttributes(r,a):144===i?r=this.setPenAttributes(r,a):145===i?r=this.setPenColor(r,a):146===i?r=this.setPenLocation(r,a):143===i?a=this.reset(r,a):8===i?a.currentWindow.backspace():12===i?a.currentWindow.clearText():13===i?a.currentWindow.pendingNewLine=!0:14===i?a.currentWindow.clearText():141===i&&r++},xe.prototype.extendedCommands=function(e,t){var n=this.current708Packet.data[++e];return ye(n)&&(e=this.handleText(e,t,{isExtended:!0})),e},xe.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},xe.prototype.initService=function(e,t){var n,i,r=this;return(n="SERVICE"+e)in this.serviceEncodings&&(i=this.serviceEncodings[n]),this.services[e]=new Te(e,i,r),this.services[e].init(this.getPts(t),function(t){r.flushDisplayed(t,r.services[e])}),this.services[e]},xe.prototype.handleText=function(e,t,n){var i,r,s,a,o=n&&n.isExtended,l=n&&n.isMultiByte,c=this.current708Packet.data,u=o?4096:0,d=c[e],h=c[e+1],p=t.currentWindow;if(l?(r=[d,h],e++):r=[d],t.textDecoder_&&!o)i=t.textDecoder_.decode(new Uint8Array(r));else if(l){const e=r.map(e=>("0"+(255&e).toString(16)).slice(-2)).join("");i=String.fromCharCode(parseInt(e,16))}else a=be[s=u|d]||s,i=4096&s&&s===a?"":String.fromCharCode(a);return p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(e)),p.pendingNewLine=!1,p.addText(i),e},xe.prototype.multiByteCharacter=function(e,t){var n=this.current708Packet.data,i=n[e+1],r=n[e+2];return ye(i)&&ye(r)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},xe.prototype.setCurrentWindow=function(e,t){var n=7&this.current708Packet.data[e];return t.setCurrentWindow(n),e},xe.prototype.defineWindow=function(e,t){var n=this.current708Packet.data,i=n[e],r=7&i;t.setCurrentWindow(r);var s=t.currentWindow;return i=n[++e],s.visible=(32&i)>>5,s.rowLock=(16&i)>>4,s.columnLock=(8&i)>>3,s.priority=7&i,i=n[++e],s.relativePositioning=(128&i)>>7,s.anchorVertical=127&i,i=n[++e],s.anchorHorizontal=i,i=n[++e],s.anchorPoint=(240&i)>>4,s.rowCount=15&i,i=n[++e],s.columnCount=63&i,i=n[++e],s.windowStyle=(56&i)>>3,s.penStyle=7&i,s.virtualRowCount=s.rowCount+1,e},xe.prototype.setWindowAttributes=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.winAttr;return i=n[++e],r.fillOpacity=(192&i)>>6,r.fillRed=(48&i)>>4,r.fillGreen=(12&i)>>2,r.fillBlue=3&i,i=n[++e],r.borderType=(192&i)>>6,r.borderRed=(48&i)>>4,r.borderGreen=(12&i)>>2,r.borderBlue=3&i,i=n[++e],r.borderType+=(128&i)>>5,r.wordWrap=(64&i)>>6,r.printDirection=(48&i)>>4,r.scrollDirection=(12&i)>>2,r.justify=3&i,i=n[++e],r.effectSpeed=(240&i)>>4,r.effectDirection=(12&i)>>2,r.displayEffect=3&i,e},xe.prototype.flushDisplayed=function(e,t){for(var n=[],i=0;i<8;i++)t.windows[i].visible&&!t.windows[i].isEmpty()&&n.push(t.windows[i].getText());t.endPts=e,t.text=n.join("\n\n"),this.pushCaption(t),t.startPts=e},xe.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},xe.prototype.displayWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&(t.windows[r].visible=1);return e},xe.prototype.hideWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&(t.windows[r].visible=0);return e},xe.prototype.toggleWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&(t.windows[r].visible^=1);return e},xe.prototype.clearWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&t.windows[r].clearText();return e},xe.prototype.deleteWindows=function(e,t){var n=this.current708Packet.data[++e],i=this.getPts(e);this.flushDisplayed(i,t);for(var r=0;r<8;r++)n&1<<r&&t.windows[r].reset();return e},xe.prototype.setPenAttributes=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penAttr;return i=n[++e],r.textTag=(240&i)>>4,r.offset=(12&i)>>2,r.penSize=3&i,i=n[++e],r.italics=(128&i)>>7,r.underline=(64&i)>>6,r.edgeType=(56&i)>>3,r.fontStyle=7&i,e},xe.prototype.setPenColor=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penColor;return i=n[++e],r.fgOpacity=(192&i)>>6,r.fgRed=(48&i)>>4,r.fgGreen=(12&i)>>2,r.fgBlue=3&i,i=n[++e],r.bgOpacity=(192&i)>>6,r.bgRed=(48&i)>>4,r.bgGreen=(12&i)>>2,r.bgBlue=3&i,i=n[++e],r.edgeRed=(48&i)>>4,r.edgeGreen=(12&i)>>2,r.edgeBlue=3&i,e},xe.prototype.setPenLocation=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,i=n[++e],r.row=15&i,i=n[++e],r.column=63&i,e},xe.prototype.reset=function(e,t){var n=this.getPts(e);return this.flushDisplayed(n,t),this.initService(t.serviceNum,e)};var _e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Se=function(e){return null===e?"":(e=_e[e]||e,String.fromCharCode(e))},we=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ie=function(){for(var e=[],t=15;t--;)e.push({text:"",indent:0,offset:0});return e},ke=function(e,t){ke.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,i,r,s;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Ie();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ie();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Ie()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,r))s=Se((i=(3&i)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isExtCharacter(i,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),s=Se((i=(3&i)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isMidRowCode(i,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14&~r||this.addFormatting(e.pts,["i"]),1&~r||this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,r)){const e=3&r;this.nonDisplayed_[this.row_].offset=e,this.column_+=e}else if(this.isPAC(i,r)){var a=we.indexOf(7968&t);if("rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&a>=0&&a<=14&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),!(16&~t)){const e=(14&t)>>1;this.column_=4*e,this.nonDisplayed_[this.row_].indent+=e}this.isColorPAC(r)&&(14&~r||this.addFormatting(e.pts,["i"]))}else this.isNormalChar(i)&&(0===r&&(r=null),s=Se(i),s+=Se(r),this[this.mode_](e.pts,s),this.column_+=s.length)}else this.lastControlCode_=null}};ke.prototype=new fe,ke.prototype.flushDisplayed=function(e){const t=e=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."})},n=[];this.displayed_.forEach((e,i)=>{if(e&&e.text&&e.text.length){try{e.text=e.text.trim()}catch(r6){t(i)}e.text.length&&n.push({text:e.text,line:i+1,position:10+Math.min(70,10*e.indent)+2.5*e.offset})}else null==e&&t(i)}),n.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,content:n,stream:this.name_})},ke.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ie(),this.nonDisplayed_=Ie(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},ke.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},ke.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},ke.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},ke.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},ke.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},ke.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},ke.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},ke.prototype.isNormalChar=function(e){return e>=32&&e<=127},ke.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Ie(),this.displayed_=Ie()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]={text:"",indent:0,offset:0};void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},ke.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,n)},ke.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},ke.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_].text;n+=t,this.nonDisplayed_[this.row_].text=n},ke.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n},ke.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.row_+1;e<15;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},ke.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n};var Ce={CaptionStream:ge,Cea608Stream:ke,Cea708Stream:xe},Ee={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ae=G,Re="shared",Ne=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>4294967296;)e+=8589934592*n;return e},Pe=function(e){var t,n;Pe.prototype.init.call(this),this.type_=e||Re,this.push=function(e){"metadata"!==e.type?this.type_!==Re&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=Ne(e.dts,n),e.pts=Ne(e.pts,n),t=e.dts,this.trigger("data",e)):this.trigger("data",e)},this.flush=function(){n=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Pe.prototype=new Ae;var De,Oe={TimestampRolloverStream:Pe,handleRollover:Ne},Le=(e,t,n)=>{if(!e)return-1;for(var i=n;i<e.length;i++)if(e[i]===t)return i;return-1},Me=3,Fe=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},$e=function(e,t,n){return decodeURIComponent(Fe(e,t,n))},Be=function(e,t,n){return unescape(Fe(e,t,n))},ze=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Ue={APIC:function(e){var t,n,i=1;e.data[0]===Me&&((t=Le(e.data,0,i))<0||(e.mimeType=Be(e.data,i,t),i=t+1,e.pictureType=e.data[i],i++,(n=Le(e.data,0,i))<0||(e.description=$e(e.data,i,n),i=n+1,"--\x3e"===e.mimeType?e.url=Be(e.data,i,e.data.length):e.pictureData=e.data.subarray(i,e.data.length))))},"T*":function(e){e.data[0]===Me&&(e.value=$e(e.data,1,e.data.length).replace(/\0*$/,""),e.values=e.value.split("\0"))},TXXX:function(e){var t;e.data[0]===Me&&-1!==(t=Le(e.data,0,1))&&(e.description=$e(e.data,1,t),e.value=$e(e.data,t+1,e.data.length).replace(/\0*$/,""),e.data=e.value)},"W*":function(e){e.url=Be(e.data,0,e.data.length).replace(/\0.*$/,"")},WXXX:function(e){var t;e.data[0]===Me&&-1!==(t=Le(e.data,0,1))&&(e.description=$e(e.data,1,t),e.url=Be(e.data,t+1,e.data.length).replace(/\0.*$/,""))},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Be(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},Ge={parseId3Frames:function(e){var t,n=10,i=0,r=[];if(!(e.length<10||e[0]!=="I".charCodeAt(0)||e[1]!=="D".charCodeAt(0)||e[2]!=="3".charCodeAt(0))){i=ze(e.subarray(6,10)),i+=10,64&e[5]&&(n+=4,n+=ze(e.subarray(10,14)),i-=ze(e.subarray(16,20)));do{if((t=ze(e.subarray(n+4,n+8)))<1)break;var s={id:String.fromCharCode(e[n],e[n+1],e[n+2],e[n+3]),data:e.subarray(n+10,n+t+10)};s.key=s.id,Ue[s.id]?Ue[s.id](s):"T"===s.id[0]?Ue["T*"](s):"W"===s.id[0]&&Ue["W*"](s),r.push(s),n+=10,n+=t}while(n<i);return r}},parseSyncSafeInteger:ze,frameParsers:Ue},Ve=G,He=Ee,We=Ge;De=function(e){var t,n={descriptor:e&&e.descriptor},i=0,r=[],s=0;if(De.prototype.init.call(this),this.dispatchType=He.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,n,a,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(s=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(e),s+=e.data.byteLength,1===r.length&&(i=We.parseSyncSafeInteger(e.data.subarray(6,10)),i+=10),!(s<i)){for(t={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<i;)t.data.set(r[0].data.subarray(0,i-l),l),l+=r[0].data.byteLength,s-=r[0].data.byteLength,r.shift();n=10,64&t.data[5]&&(n+=4,n+=We.parseSyncSafeInteger(t.data.subarray(10,14)),i-=We.parseSyncSafeInteger(t.data.subarray(16,20)));do{if((a=We.parseSyncSafeInteger(t.data.subarray(n+4,n+8)))<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if((o={id:String.fromCharCode(t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]),data:t.data.subarray(n+10,n+a+10)}).key=o.id,We.frameParsers[o.id]?We.frameParsers[o.id](o):"T"===o.id[0]?We.frameParsers["T*"](o):"W"===o.id[0]&&We.frameParsers["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var c=o.data,u=(1&c[3])<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2;u*=4,u+=3&c[7],o.timeStamp=u,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),n+=10,n+=a}while(n<i);this.trigger("data",t)}}},De.prototype=new Ve;var je,qe,Xe,Ke=De,Ye=G,Ze=Ce,Qe=Ee,Je=Oe.TimestampRolloverStream,et=188;(je=function(){var e=new Uint8Array(et),t=0;je.prototype.init.call(this),this.push=function(n){var i,r=0,s=et;for(t?((i=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),i.set(n,t),t=0):i=n;s<i.byteLength;)71!==i[r]||71!==i[s]?(r++,s++):(this.trigger("data",i.subarray(r,s)),r+=et,s+=et);r<i.byteLength&&(e.set(i.subarray(r),0),t=i.byteLength-r)},this.flush=function(){t===et&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new Ye,(qe=function(){var e,t,n,i;qe.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,i){var r=0;i.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===i.type?t(e.subarray(r),i):n(e.subarray(r),i)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],i.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=i.pmtPid},n=function(e,t){var n,r;if(1&e[5]){for(i.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<n;){var s=e[r],a=(31&e[r+1])<<8|e[r+2];s===Qe.H264_STREAM_TYPE&&null===i.programMapTable.video?i.programMapTable.video=a:s===Qe.ADTS_STREAM_TYPE&&null===i.programMapTable.audio?i.programMapTable.audio=a:s===Qe.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][a]=s),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=i.programMapTable}},this.push=function(t){var n={},i=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(i+=t[i]+1),0===n.pid)n.type="pat",e(t.subarray(i),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(i),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,n]):this.processPes_(t,i,n)},this.processPes_=function(e,t,n){n.pid===this.programMapTable.video?n.streamType=Qe.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?n.streamType=Qe.ADTS_STREAM_TYPE:n.streamType=this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}}).prototype=new Ye,qe.STREAM_TYPES={h264:27,adts:15},Xe=function(){var e,t=this,n=!1,i={data:[],size:0},r={data:[],size:0},s={data:[],size:0},a=function(e,n,i){var r,s,a=new Uint8Array(e.size),o={type:n},l=0,c=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)s=e.data[l],a.set(s.data,c),c+=s.data.byteLength;!function(e,t){var n;const i=e[0]<<16|e[1]<<8|e[2];t.data=new Uint8Array,1===i&&(t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=!!(4&e[6]),192&(n=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&n&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8]))}(a,o),r="video"===n||o.packetLength<=e.size,(i||r)&&(e.size=0,e.data.length=0),r&&t.trigger("data",o)}};Xe.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case Qe.H264_STREAM_TYPE:e=i,t="video";break;case Qe.ADTS_STREAM_TYPE:e=r,t="audio";break;case Qe.METADATA_STREAM_TYPE:e=s,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&a(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var i={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),n=!0,t.trigger("data",i)}})[o.type]()},this.reset=function(){i.size=0,i.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){a(i,"video"),a(r,"audio"),a(s,"timed-metadata")},this.flush=function(){if(!n&&e){var i={type:"metadata",tracks:[]};null!==e.video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",i)}n=!1,this.flushStreams_(),this.trigger("done")}},Xe.prototype=new Ye;var tt={PAT_PID:0,MP2T_PACKET_LENGTH:et,TransportPacketStream:je,TransportParseStream:qe,ElementaryStream:Xe,TimestampRolloverStream:Je,CaptionStream:Ze.CaptionStream,Cea608Stream:Ze.Cea608Stream,Cea708Stream:Ze.Cea708Stream,MetadataStream:Ke};for(var nt in Qe)Qe.hasOwnProperty(nt)&&(tt[nt]=Qe[nt]);var it,rt=tt,st=G,at=oe.ONE_SECOND_IN_TS,ot=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];it=function(e){var t,n=0;it.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:`adts skiping bytes ${e} to ${t} in frame ${n} outside syncword`})},this.push=function(i){var r,s,a,o,l,c=0;if(e||(n=0),"audio"===i.type){var u;for(t&&t.length?(a=t,(t=new Uint8Array(a.byteLength+i.data.byteLength)).set(a),t.set(i.data,a.byteLength)):t=i.data;c+7<t.length;)if(255===t[c]&&240==(246&t[c+1])){if("number"==typeof u&&(this.skipWarn_(u,c),u=null),s=2*(1&~t[c+1]),r=(3&t[c+3])<<11|t[c+4]<<3|(224&t[c+5])>>5,l=(o=1024*(1+(3&t[c+6])))*at/ot[(60&t[c+2])>>>2],t.byteLength-c<r)break;this.trigger("data",{pts:i.pts+n*l,dts:i.dts+n*l,sampleCount:o,audioobjecttype:1+(t[c+2]>>>6&3),channelcount:(1&t[c+2])<<2|(192&t[c+3])>>>6,samplerate:ot[(60&t[c+2])>>>2],samplingfrequencyindex:(60&t[c+2])>>>2,samplesize:16,data:t.subarray(c+7+s,c+r)}),n++,c+=r}else"number"!=typeof u&&(u=c),c++;"number"==typeof u&&(this.skipWarn_(u,c),u=null),t=t.subarray(c)}},this.flush=function(){n=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},it.prototype=new st;var lt,ct,ut,dt=it,ht=G,pt=function(e){var t=e.byteLength,n=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var r=e.byteLength-t,s=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");s.set(e.subarray(r,r+a)),n=new DataView(s.buffer).getUint32(0),i=8*a,t-=a},this.skipBits=function(e){var r;i>e?(n<<=e,i-=e):(e-=i,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),n<<=e,i-=e)},this.readBits=function(e){var r=Math.min(i,e),s=n>>>32-r;return(i-=r)>0?n<<=r:t>0&&this.loadWord(),(r=e-r)>0?s<<r|this.readBits(r):s},this.skipLeadingZeros=function(){var e;for(e=0;e<i;++e)if(n&2147483648>>>e)return n<<=e,i-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};ct=function(){var e,t,n=0;ct.prototype.init.call(this),this.push=function(i){var r;t?((r=new Uint8Array(t.byteLength+i.data.byteLength)).set(t),r.set(i.data,t.byteLength),t=r):t=i.data;for(var s=t.byteLength;n<s-3;n++)if(1===t[n+2]){e=n+5;break}for(;e<s;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<s);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3}t=t.subarray(n),e-=n,n=0},this.reset=function(){t=null,n=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},ct.prototype=new ht,ut={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},lt=function(){var e,t,n,i,r,s,a,o=new ct;lt.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,i=e.dts,o.push(e))},o.on("data",function(a){var o={trackId:t,pts:n,dts:i,data:a,nalUnitTypeCode:31&a[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(a.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(a.subarray(1)),o.config=s(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),o.on("partialdone",function(){e.trigger("partialdone")}),o.on("reset",function(){e.trigger("reset")}),o.on("endedtimeline",function(){e.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},a=function(e,t){var n,i=8,r=8;for(n=0;n<e;n++)0!==r&&(r=(i+t.readExpGolomb()+256)%256),i=0===r?i:r},r=function(e){for(var t,n,i=e.byteLength,r=[],s=1;s<i-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n},s=function(e){var t,n,i,r,s,o,l,c,u,d,h,p,f=0,m=0,g=0,b=0,y=[1,1];if(n=(t=new pt(e)).readUnsignedByte(),r=t.readUnsignedByte(),i=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),ut[n]&&(3===(s=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(h=3!==s?8:12,p=0;p<h;p++)t.readBoolean()&&a(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),c=t.readUnsignedExpGolomb(),u=t.readUnsignedExpGolomb(),0===(d=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(f=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),b=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}y&&(y[0],y[1])}return{profileIdc:n,levelIdc:i,profileCompatibility:r,width:16*(c+1)-2*f-2*m,height:(2-d)*(u+1)*16-2*g-2*b,sarRatio:y}}},lt.prototype=new ht;var ft,mt={H264Stream:lt,NalByteStream:ct},gt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],bt=function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return n=n>=0?n:0,(16&e[t+5])>>4?n+20:n+10},yt=function(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=bt(e,t),yt(e,t))},vt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Tt=function(e,t,n){return unescape(function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r}(e,t,n))},xt={isLikelyAacData:function(e){var t=yt(e,0);return e.length>=t+2&&!(255&~e[t])&&!(240&~e[t+1])&&16==(22&e[t+1])},parseId3TagSize:bt,parseAdtsSize:function(e,t){var n=(224&e[t+5])>>5,i=e[t+4]<<3;return 6144&e[t+3]|i|n},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&!(240&~e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return gt[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,n,i;t=10,64&e[5]&&(t+=4,t+=vt(e.subarray(10,14)));do{if((n=vt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){i=e.subarray(t+10,t+n+10);for(var r=0;r<i.byteLength;r++)if(0===i[r]){if("com.apple.streaming.transportStreamTimestamp"===Tt(i,0,r)){var s=i.subarray(r+1),a=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return a*=4,a+=3&s[7]}break}}t+=10,t+=n}while(t<e.byteLength);return null}},_t=xt;(ft=function(){var e=new Uint8Array,t=0;ft.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var i,r,s,a,o=0,l=0;for(e.length?(a=e.length,(e=new Uint8Array(n.byteLength+a)).set(e.subarray(0,a)),e.set(n,a)):e=n;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255&~e[l]||240&~e[l+1])l++;else{if(e.length-l<7)break;if(l+(o=_t.parseAdtsSize(e,l))>e.length)break;s={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",s),l+=o}else{if(e.length-l<10)break;if(l+(o=_t.parseId3TagSize(e,l))>e.length)break;r={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",r),l+=o}i=e.length-l,e=i>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new G;var St,wt,It,kt,Ct=G,Et=ee,At=ne,Rt=ue,Nt=he,Pt=rt,Dt=oe,Ot=dt,Lt=mt.H264Stream,Mt=ft,Ft=xt.isLikelyAacData,$t=oe.ONE_SECOND_IN_TS,Bt=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],zt=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Ut=function(e,t){t.stream=e,this.trigger("log",t)},Gt=function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];"headOfPipeline"!==r&&t[r].on&&t[r].on("log",Ut.bind(e,r))}},Vt=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},Ht=function(e,t,n,i,r,s){return{start:{dts:e,pts:e+(n-t)},end:{dts:e+(i-t),pts:e+(r-n)},prependedContentDuration:s,baseMediaDecodeTime:e}};wt=function(e,t){var n,i=[],r=0,s=0,a=1/0;n=(t=t||{}).firstSequenceNumber||0,wt.prototype.init.call(this),this.push=function(t){Nt.collectDtsInfo(e,t),e&&Bt.forEach(function(n){e[n]=t[n]}),i.push(t)},this.setEarliestDts=function(e){r=e},this.setVideoBaseMediaDecodeTime=function(e){a=e},this.setAudioAppendStart=function(e){s=e},this.flush=function(){var o,l,c,u,d,h,p;0!==i.length?(o=Rt.trimAdtsFramesByEarliestDts(i,e,r),e.baseMediaDecodeTime=Nt.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),p=Rt.prefixWithSilence(e,o,s,a),e.samples=Rt.generateSampleTable(o),c=Et.mdat(Rt.concatenateFrameData(o)),i=[],l=Et.moof(n,[e]),u=new Uint8Array(l.byteLength+c.byteLength),n++,u.set(l),u.set(c,l.byteLength),Nt.clearDtsInfo(e),d=Math.ceil(1024*$t/e.samplerate),o.length&&(h=o.length*d,this.trigger("segmentTimingInfo",Ht(Dt.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+h,o[0].pts+h,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+h})),this.trigger("data",{track:e,boxes:u}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){Nt.clearDtsInfo(e),i=[],this.trigger("reset")}},wt.prototype=new Ct,St=function(e,t){var n,i,r,s=[],a=[];n=(t=t||{}).firstSequenceNumber||0,St.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){Nt.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.config,e.sps=[t.data],zt.forEach(function(t){e[t]=i[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),s.push(t)},this.flush=function(){for(var i,r,o,l,c,u,d,h,p=0;s.length&&"access_unit_delimiter_rbsp"!==s[0].nalUnitType;)s.shift();if(0===s.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=At.groupNalsIntoFrames(s),(o=At.groupFramesIntoGops(i))[0][0].keyFrame||((r=this.getGopForFusion_(s[0],e))?(p=r.duration,o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=At.extendFirstKeyFrame(o)),a.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");Nt.clearDtsInfo(e),o=f}Nt.collectDtsInfo(e,o),e.samples=At.generateSampleTable(o),c=Et.mdat(At.concatenateNalData(o)),e.baseMediaDecodeTime=Nt.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),d=o[0],h=o[o.length-1],this.trigger("segmentTimingInfo",Ht(e.baseMediaDecodeTime,d.dts,d.pts,h.dts+h.duration,h.pts+h.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=Et.moof(n,[e]),u=new Uint8Array(l.byteLength+c.byteLength),n++,u.set(l),u.set(c,l.byteLength),this.trigger("data",{track:e,boxes:u}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),s=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){Nt.clearDtsInfo(e),i=void 0,r=void 0},this.getGopForFusion_=function(t){var n,i,r,s,a,o=1/0;for(a=0;a<this.gopCache_.length;a++)r=(s=this.gopCache_[a]).gop,e.pps&&Vt(e.pps[0],s.pps[0])&&e.sps&&Vt(e.sps[0],s.sps[0])&&(r.dts<e.timelineStartInfo.dts||(n=t.dts-r.dts-r.duration)>=-1e4&&n<=45e3&&(!i||o>n)&&(i=s,o=n));return i?i.gop:null},this.alignGopsAtStart_=function(e){var t,n,i,r,s,o,l,c;for(s=e.byteLength,o=e.nalCount,l=e.duration,t=n=0;t<a.length&&n<e.length&&(i=a[t],r=e[n],i.pts!==r.pts);)r.pts>i.pts?t++:(n++,s-=r.byteLength,o-=r.nalCount,l-=r.duration);return 0===n?e:n===e.length?null:((c=e.slice(n)).byteLength=s,c.duration=l,c.nalCount=o,c.pts=c[0].pts,c.dts=c[0].dts,c)},this.alignGopsAtEnd_=function(e){var t,n,i,r,s,o,l;for(t=a.length-1,n=e.length-1,s=null,o=!1;t>=0&&n>=0;){if(i=a[t],r=e[n],i.pts===r.pts){o=!0;break}i.pts>r.pts?t--:(t===a.length-1&&(s=n),n--)}if(!o&&null===s)return null;if(0===(l=o?n:s))return e;var c=e.slice(l),u=c.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return c.byteLength=u.byteLength,c.duration=u.duration,c.nalCount=u.nalCount,c.pts=c[0].pts,c.dts=c[0].dts,c},this.alignGopsWith=function(e){a=e}},St.prototype=new Ct,(kt=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"==typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,kt.prototype.init.call(this),this.push=function(e){return e.content||e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}}).prototype=new Ct,kt.prototype.flush=function(e){var t,n,i,r,s=0,a={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,zt.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Bt.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?a.type=this.pendingTracks[0].type:a.type="combined",this.emittedTracks+=this.pendingTracks.length,i=Et.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(i.byteLength),a.initSegment.set(i),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],s),s+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=Dt.metadataTsToSeconds(t.startPts,o,this.keepOriginalTimestamps),t.endTime=Dt.metadataTsToSeconds(t.endPts,o,this.keepOriginalTimestamps),a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(n=this.pendingMetadata[r]).cueTime=Dt.metadataTsToSeconds(n.pts,o,this.keepOriginalTimestamps),a.metadata.push(n);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),r=0;r<a.captions.length;r++)t=a.captions[r],this.trigger("caption",t);for(r=0;r<a.metadata.length;r++)n=a.metadata[r],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},kt.prototype.setRemux=function(e){this.remuxTracks=e},It=function(e){var t,n,i=this,r=!0;It.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new Pt.MetadataStream,r.aacStream=new Mt,r.audioTimestampRolloverStream=new Pt.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new Pt.TimestampRolloverStream("timed-metadata"),r.adtsStream=new Ot,r.coalesceStream=new kt(e,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(e){r.aacStream.setTimestamp(e.timeStamp)}),r.aacStream.on("data",function(s){"timed-metadata"!==s.type&&"audio"!==s.type||r.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:i.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new wt(n,e),r.audioSegmentStream.on("log",i.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",i.trigger.bind(i,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),i.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t}))}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Gt(this,r)},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new Pt.MetadataStream,r.packetStream=new Pt.TransportPacketStream,r.parseStream=new Pt.TransportParseStream,r.elementaryStream=new Pt.ElementaryStream,r.timestampRolloverStream=new Pt.TimestampRolloverStream,r.adtsStream=new Ot,r.h264Stream=new Lt,r.captionStream=new Pt.CaptionStream(e),r.coalesceStream=new kt(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(s){var a;if("metadata"===s.type){for(a=s.tracks.length;a--;)t||"video"!==s.tracks[a].type?n||"audio"!==s.tracks[a].type||((n=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime):(t=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime;t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new St(t,e),r.videoSegmentStream.on("log",i.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",function(t){n&&!e.keepOriginalTimestamps&&(n.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-i.baseMediaDecodeTime))}),r.videoSegmentStream.on("processedGopsInfo",i.trigger.bind(i,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){n&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.videoSegmentStream.on("timingInfo",i.trigger.bind(i,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),n&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new wt(n,e),r.audioSegmentStream.on("log",i.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",i.trigger.bind(i,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),i.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(e){e.dispatchType=r.metadataStream.dispatchType,i.trigger("id3Frame",e)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Gt(this,r)},this.setBaseMediaDecodeTime=function(i){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=i),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,Nt.clearDtsInfo(n),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,Nt.clearDtsInfo(t),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var n=this.transmuxPipeline_;e.remux=t,n&&n.coalesceStream&&n.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(n){n.stream=e,t.trigger("log",n)}},this.push=function(e){if(r){var t=Ft(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},It.prototype=new Ct;var Wt,jt,qt={Transmuxer:It,VideoSegmentStream:St,AudioSegmentStream:wt,AUDIO_PROPERTIES:Bt,VIDEO_PROPERTIES:zt,generateSegmentTimingInfo:Ht},Xt=function(e){return e>>>0},Kt=function(e){return("00"+e.toString(16)).slice(-2)},Yt=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},Zt=Xt,Qt=Yt,Jt=function(e,t){var n,i,r,s,a,o=[];if(!t.length)return null;for(n=0;n<e.byteLength;)i=Zt(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),r=Qt(e.subarray(n+4,n+8)),s=i>1?n+i:e.byteLength,r===t[0]&&(1===t.length?o.push(e.subarray(n+8,s)):(a=Jt(e.subarray(n+8,s),t.slice(1))).length&&(o=o.concat(a))),n=s;return o},en=Jt,tn=Xt,nn=H.getUint64,rn=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=nn(e.subarray(4)):t.baseMediaDecodeTime=tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},sn=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},r=1&i.flags[2],s=2&i.flags[2],a=8&i.flags[2],o=16&i.flags[2],l=32&i.flags[2],c=65536&i.flags[0],u=131072&i.flags[0];return t=8,r&&(t+=4,i.baseDataOffset=n.getUint32(12),t+=4),s&&(i.sampleDescriptionIndex=n.getUint32(t),t+=4),a&&(i.defaultSampleDuration=n.getUint32(t),t+=4),o&&(i.defaultSampleSize=n.getUint32(t),t+=4),l&&(i.defaultSampleFlags=n.getUint32(t)),c&&(i.durationIsEmpty=!0),!r&&u&&(i.baseDataOffsetIsMoof=!0),i},an=H.getUint64,on=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},i=12;0===n.version?(n.earliestPresentationTime=t.getUint32(i),n.firstOffset=t.getUint32(i+4),i+=8):(n.earliestPresentationTime=an(e.subarray(i)),n.firstOffset=an(e.subarray(i+8)),i+=16),i+=2;var r=t.getUint16(i);for(i+=2;r>0;i+=12,r--)n.references.push({referenceType:(128&e[i])>>>7,referencedSize:2147483647&t.getUint32(i),subsegmentDuration:t.getUint32(i+4),startsWithSap:!!(128&e[i+8]),sapType:(112&e[i+8])>>>4,sapDeltaTime:268435455&t.getUint32(i+8)});return n},ln=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},cn=function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&n.flags[2],s=4&n.flags[2],a=1&n.flags[1],o=2&n.flags[1],l=4&n.flags[1],c=8&n.flags[1],u=i.getUint32(4),d=8;for(r&&(n.dataOffset=i.getInt32(d),d+=4),s&&u&&(t={flags:ln(e.subarray(d,d+4))},d+=4,a&&(t.duration=i.getUint32(d),d+=4),o&&(t.size=i.getUint32(d),d+=4),c&&(1===n.version?t.compositionTimeOffset=i.getInt32(d):t.compositionTimeOffset=i.getUint32(d),d+=4),n.samples.push(t),u--);u--;)t={},a&&(t.duration=i.getUint32(d),d+=4),o&&(t.size=i.getUint32(d),d+=4),l&&(t.flags=ln(e.subarray(d,d+4)),d+=4),c&&(1===n.version?t.compositionTimeOffset=i.getInt32(d):t.compositionTimeOffset=i.getUint32(d),d+=4),n.samples.push(t);return n},un=H.getUint64,dn=function(e){return new Date(1e3*e-20828448e5)},hn=Yt,pn=function(e){var t,n,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[];for(t=0;t+4<e.length;t+=n)if(n=i.getUint32(t),t+=4,n<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[t]&31)}return r},fn={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:Wt(e.subarray(78,e.byteLength))}},avcC:function(e){var t,n,i,r,s=new DataView(e.buffer,e.byteOffset,e.byteLength),a={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},o=31&e[5];for(i=6,r=0;r<o;r++)n=s.getUint16(i),i+=2,a.sps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;for(t=e[i],i++,r=0;r<t;r++)n=s.getUint16(i),i+=2,a.pps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;return a},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:Wt(e)}},elst:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},r=n.getUint32(4);for(t=8;r;r--)0===i.version?(i.edits.push({segmentDuration:n.getUint32(t),mediaTime:n.getInt32(t+4),mediaRate:n.getUint16(t+8)+n.getUint16(t+10)/65536}),t+=12):(i.edits.push({segmentDuration:un(e.subarray(t)),mediaTime:un(e.subarray(t+8)),mediaRate:n.getUint16(t+16)+n.getUint16(t+18)/65536}),t+=20);return i},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={majorBrand:hn(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},i=8;i<e.byteLength;)n.compatibleBrands.push(hn(e.subarray(i,i+4))),i+=4;return n},dinf:function(e){return{boxes:Wt(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:Wt(e.subarray(8))}},hdlr:function(e){var t={version:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:hn(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(0===e[n]){n++;break}t.name+=String.fromCharCode(e[n])}return t.name=decodeURIComponent(escape(t.name)),t},mdat:function(e){return{byteLength:e.byteLength,nals:pn(e)}},mdhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===r.version?(i+=4,r.creationTime=dn(n.getUint32(i)),i+=8,r.modificationTime=dn(n.getUint32(i)),i+=4,r.timescale=n.getUint32(i),i+=8,r.duration=n.getUint32(i)):(r.creationTime=dn(n.getUint32(i)),i+=4,r.modificationTime=dn(n.getUint32(i)),i+=4,r.timescale=n.getUint32(i),i+=4,r.duration=n.getUint32(i)),i+=4,t=n.getUint16(i),r.language+=String.fromCharCode(96+(t>>10)),r.language+=String.fromCharCode(96+((992&t)>>5)),r.language+=String.fromCharCode(96+(31&t)),r},mdia:function(e){return{boxes:Wt(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:Wt(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(n.streamDescriptor=Wt(e.subarray(28))[0]),n},moof:function(e){return{boxes:Wt(e)}},moov:function(e){return{boxes:Wt(e)}},mvex:function(e){return{boxes:Wt(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(n+=4,i.creationTime=dn(t.getUint32(n)),n+=8,i.modificationTime=dn(t.getUint32(n)),n+=4,i.timescale=t.getUint32(n),n+=8,i.duration=t.getUint32(n)):(i.creationTime=dn(t.getUint32(n)),n+=4,i.modificationTime=dn(t.getUint32(n)),n+=4,i.timescale=t.getUint32(n),n+=4,i.duration=t.getUint32(n)),n+=4,i.rate=t.getUint16(n)+t.getUint16(n+2)/16,n+=4,i.volume=t.getUint8(n)+t.getUint8(n+1)/8,n+=2,n+=2,n+=8,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,n+=24,i.nextTrackId=t.getUint32(n),i},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)n.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return n},sidx:on,smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:Wt(e)}},ctts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.compositionOffsets.push({sampleCount:n.getUint32(t),sampleOffset:n[0===i.version?"getUint32":"getInt32"](t+4)});return i},stss:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.syncSamples.push(n.getUint32(t));return i},stco:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.chunkOffsets.push(n.getUint32(t));return i},stsc:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=n.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;i;t+=12,i--)r.sampleToChunks.push({firstChunk:n.getUint32(t),samplesPerChunk:n.getUint32(t+4),sampleDescriptionIndex:n.getUint32(t+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:Wt(e.subarray(8))}},stsz:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:n.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)i.entries.push(n.getUint32(t));return i},stts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.timeToSamples.push({sampleCount:n.getUint32(t),sampleDelta:n.getUint32(t+4)});return i},styp:function(e){return fn.ftyp(e)},tfdt:rn,tfhd:sn,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(n+=4,i.creationTime=dn(t.getUint32(n)),n+=8,i.modificationTime=dn(t.getUint32(n)),n+=4,i.trackId=t.getUint32(n),n+=4,n+=8,i.duration=t.getUint32(n)):(i.creationTime=dn(t.getUint32(n)),n+=4,i.modificationTime=dn(t.getUint32(n)),n+=4,i.trackId=t.getUint32(n),n+=4,n+=4,i.duration=t.getUint32(n)),n+=4,n+=8,i.layer=t.getUint16(n),n+=2,i.alternateGroup=t.getUint16(n),n+=2,i.volume=t.getUint8(n)+t.getUint8(n+1)/8,n+=2,n+=2,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,i.width=t.getUint16(n)+t.getUint16(n+2)/65536,n+=4,i.height=t.getUint16(n)+t.getUint16(n+2)/65536,i},traf:function(e){return{boxes:Wt(e)}},trak:function(e){return{boxes:Wt(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:cn,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};Wt=function(e){for(var t,n,i,r,s,a=0,o=[],l=new ArrayBuffer(e.length),c=new Uint8Array(l),u=0;u<e.length;++u)c[u]=e[u];for(t=new DataView(l);a<e.byteLength;)n=t.getUint32(a),i=hn(e.subarray(a+4,a+8)),r=n>1?a+n:e.byteLength,(s=(fn[i]||function(e){return{data:e}})(e.subarray(a+8,r))).size=n,s.type=i,o.push(s),a=r;return o};var mn,gn,bn,yn,vn,Tn,xn,_n={inspect:Wt,textify:jt=function(e,t){var n;return t=t||0,n=new Array(2*t+1).join(" "),e.map(function(e,i){return n+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var i=n+"  "+t+": ",r=e[t];if(r instanceof Uint8Array||r instanceof Uint32Array){var s=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return s?1===s.length?i+"<"+s.join("").slice(1)+">":i+"<\n"+s.map(function(e){return n+"  "+e}).join("\n")+"\n"+n+"  >":i+"<>"}return i+JSON.stringify(r,null,2).split("\n").map(function(e,t){return 0===t?e:n+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+jt(e.boxes,t+1):"")}).join("\n")},parseType:hn,findBox:en,parseTraf:fn.traf,parseTfdt:fn.tfdt,parseHdlr:fn.hdlr,parseTfhd:fn.tfhd,parseTrun:fn.trun,parseSidx:fn.sidx},Sn=function(e){for(var t=0,n=String.fromCharCode(e[t]),i="";"\0"!==n;)i+=n,t++,n=String.fromCharCode(e[t]);return i+=n},wn=H.getUint64,In=function(e,t){var n="\0"!==t.scheme_id_uri,i=0===e&&kn(t.presentation_time_delta)&&n,r=1===e&&kn(t.presentation_time)&&n;return!(e>1)&&i||r},kn=function(e){return void 0!==e||null!==e},Cn={parseEmsgBox:function(e){var t,n,i,r,s,a,o,l=4,c=e[0];if(0===c)l+=(t=Sn(e.subarray(l))).length,l+=(n=Sn(e.subarray(l))).length,i=(u=new DataView(e.buffer)).getUint32(l),l+=4,s=u.getUint32(l),l+=4,a=u.getUint32(l),l+=4,o=u.getUint32(l),l+=4;else if(1===c){var u;i=(u=new DataView(e.buffer)).getUint32(l),l+=4,r=wn(e.subarray(l)),l+=8,a=u.getUint32(l),l+=4,o=u.getUint32(l),l+=4,l+=(t=Sn(e.subarray(l))).length,l+=(n=Sn(e.subarray(l))).length}var d={scheme_id_uri:t,value:n,timescale:i||1,presentation_time:r,presentation_time_delta:s,event_duration:a,id:o,message_data:new Uint8Array(e.subarray(l,e.byteLength))};return In(c,d)?d:void 0},scaleTime:function(e,t,n,i){return e||0===e?e/t:i+n/t}},En="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},An=Xt,Rn=Kt,Nn=en,Pn=Yt,Dn=Cn,On=sn,Ln=cn,Mn=rn,Fn=H.getUint64,$n=En,Bn=Ge.parseId3Frames;mn=function(e){return Nn(e,["moov","trak"]).reduce(function(e,t){var n,i,r,s,a;return(n=Nn(t,["tkhd"])[0])?(i=n[0],s=An(n[r=0===i?12:20]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3]),(a=Nn(t,["mdia","mdhd"])[0])?(r=0===(i=a[0])?12:20,e[s]=An(a[r]<<24|a[r+1]<<16|a[r+2]<<8|a[r+3]),e):null):null},{})},gn=function(e,t){var n=Nn(t,["moof","traf"]).reduce(function(t,n){var i,r=Nn(n,["tfhd"])[0],s=An(r[4]<<24|r[5]<<16|r[6]<<8|r[7]),a=e[s]||9e4,o=Nn(n,["tfdt"])[0],l=new DataView(o.buffer,o.byteOffset,o.byteLength);let c;return"bigint"==typeof(i=1===o[0]?Fn(o.subarray(4,12)):l.getUint32(4))?c=i/$n.BigInt(a):"number"!=typeof i||isNaN(i)||(c=i/a),c<Number.MAX_SAFE_INTEGER&&(c=Number(c)),c<t&&(t=c),t},1/0);return"bigint"==typeof n||isFinite(n)?n:0},bn=function(e,t){var n,i=Nn(t,["moof","traf"]),r=0,s=0;if(i&&i.length){var a=Nn(i[0],["tfhd"])[0],o=Nn(i[0],["trun"])[0],l=Nn(i[0],["tfdt"])[0];if(a)n=On(a).trackId;if(l)r=Mn(l).baseMediaDecodeTime;if(o){var c=Ln(o);c.samples&&c.samples.length&&(s=c.samples[0].compositionTimeOffset||0)}}var u=e[n]||9e4;"bigint"==typeof r&&(s=$n.BigInt(s),u=$n.BigInt(u));var d=(r+s)/u;return"bigint"==typeof d&&d<Number.MAX_SAFE_INTEGER&&(d=Number(d)),d},yn=function(e){var t=Nn(e,["moov","trak"]),n=[];return t.forEach(function(e){var t=Nn(e,["mdia","hdlr"]),i=Nn(e,["tkhd"]);t.forEach(function(e,t){var r,s,a=Pn(e.subarray(8,12)),o=i[t];"vide"===a&&(s=0===(r=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?r.getUint32(12):r.getUint32(20),n.push(s))})}),n},vn=function(e){var t=Nn(e,["moov","trak"]),n=[];return t.forEach(function(e){var t,i,r={},s=Nn(e,["tkhd"])[0];s&&(i=(t=new DataView(s.buffer,s.byteOffset,s.byteLength)).getUint8(0),r.id=0===i?t.getUint32(12):t.getUint32(20));var a=Nn(e,["mdia","hdlr"])[0];if(a){var o=Pn(a.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=Nn(e,["mdia","minf","stbl","stsd"])[0];if(l){var c=l.subarray(8);r.codec=Pn(c.subarray(4,8));var u,d=Nn(c,[r.codec])[0];d&&(/^[asm]vc[1-9]$/i.test(r.codec)?(u=d.subarray(78),"avcC"===Pn(u.subarray(4,8))&&u.length>11?(r.codec+=".",r.codec+=Rn(u[9]),r.codec+=Rn(u[10]),r.codec+=Rn(u[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(u=d.subarray(28),"esds"===Pn(u.subarray(4,8))&&u.length>20&&0!==u[19]?(r.codec+="."+Rn(u[19]),r.codec+="."+Rn(u[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var h=Nn(e,["mdia","mdhd"])[0];h&&(r.timescale=Tn(h)),n.push(r)}),n},xn=function(e,t=0){return Nn(e,["emsg"]).map(e=>{var n=Dn.parseEmsgBox(new Uint8Array(e)),i=Bn(n.message_data);return{cueTime:Dn.scaleTime(n.presentation_time,n.timescale,n.presentation_time_delta,t),duration:Dn.scaleTime(n.event_duration,n.timescale),frames:i}})};var zn={findBox:Nn,parseType:Pn,timescale:mn,startTime:gn,compositionStartTime:bn,videoTrackIds:yn,tracks:vn,getTimescaleFromMediaHeader:Tn=function(e){var t=0===e[0]?12:20;return An(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},getEmsgID3:xn};const{parseTrun:Un}=_n,{findBox:Gn}=zn;var Vn=En,Hn={getMdatTrafPairs:function(e){var t=Gn(e,["moof","traf"]),n=Gn(e,["mdat"]),i=[];return n.forEach(function(e,n){var r=t[n];i.push({mdat:e,traf:r})}),i},parseSamples:function(e,t,n){var i=t,r=n.defaultSampleDuration||0,s=n.defaultSampleSize||0,a=n.trackId,o=[];return e.forEach(function(e){var t=Un(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=s),e.trackId=a,e.dts=i,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"==typeof i?(e.pts=i+Vn.BigInt(e.compositionTimeOffset),i+=Vn.BigInt(e.duration)):(e.pts=i+e.compositionTimeOffset,i+=e.duration)}),o=o.concat(t)}),o}},Wn=pe.discardEmulationPreventionBytes,jn=Ce.CaptionStream,qn=en,Xn=rn,Kn=sn,{getMdatTrafPairs:Yn,parseSamples:Zn}=Hn,Qn=function(e,t){for(var n=e,i=0;i<t.length;i++){var r=t[i];if(n<r.size)return r;n-=r.size}return null},Jn=function(e,t){var n={};return Yn(e).forEach(function(e){var i,r=e.mdat,s=e.traf,a=qn(s,["tfhd"]),o=Kn(a[0]),l=o.trackId,c=qn(s,["tfdt"]),u=c.length>0?Xn(c[0]).baseMediaDecodeTime:0,d=qn(s,["trun"]);t===l&&d.length>0&&(i=function(e,t,n){var i,r,s,a,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<e.length;r+=s)if(s=o.getUint32(r),r+=4,!(s<=0))switch(31&e[r]){case 6:var c=e.subarray(r+1,r+1+s),u=Qn(r,t);if(i={nalUnitType:"sei_rbsp",size:s,data:c,escapedRBSP:Wn(c),trackId:n},u)i.pts=u.pts,i.dts=u.dts,a=u;else{if(!a){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+n+". See mux.js#223."});break}i.pts=a.pts,i.dts=a.dts}l.seiNals.push(i)}return l}(r,Zn(d,u,o),l),n[l]||(n[l]={seiNals:[],logs:[]}),n[l].seiNals=n[l].seiNals.concat(i.seiNals),n[l].logs=n[l].logs.concat(i.logs))}),n},ei=function(){var e,t,n,i,r,s,a=!1;this.isInitialized=function(){return a},this.init=function(t){e=new jn,a=!0,s=!!t&&t.isPartial,e.on("data",function(e){e.startTime=e.startPts/i,e.endTime=e.endPts/i,r.captions.push(e),r.captionStreams[e.stream]=!0}),e.on("log",function(e){r.logs.push(e)})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length)&&(n!==e[0]||i!==t[n])},this.parse=function(e,s,a){var o;if(!this.isInitialized())return null;if(!s||!a)return null;if(this.isNewInit(s,a))n=s[0],i=a[n];else if(null===n||!i)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,s,a)}return o=function(e,t,n){if(null===t)return null;var i=Jn(e,t)[t]||{};return{seiNals:i.seiNals,logs:i.logs,timescale:n}}(e,n,i),o&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;s?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,i=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()};const{parseTfdt:ti}=_n,ni=en,{getTimescaleFromMediaHeader:ii}=zn,{parseSamples:ri,getMdatTrafPairs:si}=Hn;var ai=function(){let e=9e4;this.init=function(t){const n=ni(t,["moov","trak","mdia","mdhd"])[0];n&&(e=ii(n))},this.parseSegment=function(t){const n=[],i=si(t);let r=0;return i.forEach(function(t){const i=t.mdat,s=t.traf,a=ni(s,["tfdt"])[0],o=ni(s,["tfhd"])[0],l=ni(s,["trun"]);if(a){const e=ti(a);r=e.baseMediaDecodeTime}if(l.length&&o){const t=ri(l,r,o);let s=0;t.forEach(function(t){const r=new TextDecoder("utf-8"),a=i.slice(s,s+t.size);if(ni(a,["vtte"])[0])return void(s+=t.size);ni(a,["vttc"]).forEach(function(i){const s=ni(i,["payl"])[0],a=ni(i,["sttg"])[0],o=t.pts/e,l=(t.pts+t.duration)/e;let c,u;if(s)try{c=r.decode(s)}catch(r6){console.error(r6)}if(a)try{u=r.decode(a)}catch(r6){console.error(r6)}t.duration&&c&&n.push({cueText:c,start:o,end:l,settings:u})}),s+=t.size})}}),n}},oi=Ee,li=function(e){var t=31&e[1];return t<<=8,t|=e[2]},ci=function(e){return!!(64&e[1])},ui=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},di=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},hi={parseType:function(e,t){var n=li(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},parsePat:function(e){var t=ci(e),n=4+ui(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},parsePmt:function(e){var t={},n=ci(e),i=4+ui(e);if(n&&(i+=e[i]+1),1&e[i+5]){var r;r=3+((15&e[i+1])<<8|e[i+2])-4;for(var s=12+((15&e[i+10])<<8|e[i+11]);s<r;){var a=i+s;t[(31&e[a+1])<<8|e[a+2]]=e[a],s+=5+((15&e[a+3])<<8|e[a+4])}return t}},parsePayloadUnitStartIndicator:ci,parsePesType:function(e,t){switch(t[li(e)]){case oi.H264_STREAM_TYPE:return"video";case oi.ADTS_STREAM_TYPE:return"audio";case oi.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!ci(e))return null;var t=4+ui(e);if(t>=e.byteLength)return null;var n,i=null;return 192&(n=e[t+7])&&((i={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,i.pts*=4,i.pts+=(6&e[t+13])>>>1,i.dts=i.pts,64&n&&(i.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,i.dts*=4,i.dts+=(6&e[t+18])>>>1)),i},videoPacketContainsKeyFrame:function(e){for(var t=4+ui(e),n=e.subarray(t),i=0,r=0,s=!1;r<n.byteLength-3;r++)if(1===n[r+2]){i=r+5;break}for(;i<n.byteLength;)switch(n[i]){case 0:if(0!==n[i-1]){i+=2;break}if(0!==n[i-2]){i++;break}r+3!==i-2&&"slice_layer_without_partitioning_rbsp_idr"===di(31&n[r+3])&&(s=!0);do{i++}while(1!==n[i]&&i<n.length);r=i-2,i+=3;break;case 1:if(0!==n[i-1]||0!==n[i-2]){i+=3;break}"slice_layer_without_partitioning_rbsp_idr"===di(31&n[r+3])&&(s=!0),r=i-2,i+=3;break;default:i+=3}return n=n.subarray(r),i-=r,r=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===di(31&n[r+3])&&(s=!0),s}},pi=Ee,fi=Oe.handleRollover,mi={};mi.ts=hi,mi.aac=xt;var gi=oe.ONE_SECOND_IN_TS,bi=188,yi=71,vi=function(e,t,n){for(var i,r,s,a,o=0,l=bi,c=!1;l<=e.byteLength;)if(e[o]!==yi||e[l]!==yi&&l!==e.byteLength)o++,l++;else{if(i=e.subarray(o,l),"pes"===mi.ts.parseType(i,t.pid))r=mi.ts.parsePesType(i,t.table),s=mi.ts.parsePayloadUnitStartIndicator(i),"audio"===r&&s&&(a=mi.ts.parsePesTime(i))&&(a.type="audio",n.audio.push(a),c=!0);if(c)break;o+=bi,l+=bi}for(o=(l=e.byteLength)-bi,c=!1;o>=0;)if(e[o]!==yi||e[l]!==yi&&l!==e.byteLength)o--,l--;else{if(i=e.subarray(o,l),"pes"===mi.ts.parseType(i,t.pid))r=mi.ts.parsePesType(i,t.table),s=mi.ts.parsePayloadUnitStartIndicator(i),"audio"===r&&s&&(a=mi.ts.parsePesTime(i))&&(a.type="audio",n.audio.push(a),c=!0);if(c)break;o-=bi,l-=bi}},Ti=function(e,t,n){for(var i,r,s,a,o,l,c,u=0,d=bi,h=!1,p={data:[],size:0};d<e.byteLength;)if(e[u]!==yi||e[d]!==yi)u++,d++;else{if(i=e.subarray(u,d),"pes"===mi.ts.parseType(i,t.pid))if(r=mi.ts.parsePesType(i,t.table),s=mi.ts.parsePayloadUnitStartIndicator(i),"video"===r&&(s&&!h&&(a=mi.ts.parsePesTime(i))&&(a.type="video",n.video.push(a),h=!0),!n.firstKeyFrame)){if(s&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)c=p.data.shift(),o.set(c,l),l+=c.byteLength;if(mi.ts.videoPacketContainsKeyFrame(o)){var f=mi.ts.parsePesTime(o);f?(n.firstKeyFrame=f,n.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(i),p.size+=i.byteLength}if(h&&n.firstKeyFrame)break;u+=bi,d+=bi}for(u=(d=e.byteLength)-bi,h=!1;u>=0;)if(e[u]!==yi||e[d]!==yi)u--,d--;else{if(i=e.subarray(u,d),"pes"===mi.ts.parseType(i,t.pid))r=mi.ts.parsePesType(i,t.table),s=mi.ts.parsePayloadUnitStartIndicator(i),"video"===r&&s&&(a=mi.ts.parsePesTime(i))&&(a.type="video",n.video.push(a),h=!0);if(h)break;u-=bi,d-=bi}},xi=function(e){var t={pid:null,table:null},n={};for(var i in function(e,t){for(var n,i=0,r=bi;r<e.byteLength;)if(e[i]!==yi||e[r]!==yi)i++,r++;else{switch(n=e.subarray(i,r),mi.ts.parseType(n,t.pid)){case"pat":t.pid=mi.ts.parsePat(n);break;case"pmt":var s=mi.ts.parsePmt(n);t.table=t.table||{},Object.keys(s).forEach(function(e){t.table[e]=s[e]})}i+=bi,r+=bi}}(e,t),t.table){if(t.table.hasOwnProperty(i))switch(t.table[i]){case pi.H264_STREAM_TYPE:n.video=[],Ti(e,t,n),0===n.video.length&&delete n.video;break;case pi.ADTS_STREAM_TYPE:n.audio=[],vi(e,t,n),0===n.audio.length&&delete n.audio}}return n},_i=function(e,t){var n;return n=mi.aac.isLikelyAacData(e)?function(e){for(var t,n=!1,i=0,r=null,s=null,a=0,o=0;e.length-o>=3;){switch(mi.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){n=!0;break}if((a=mi.aac.parseId3TagSize(e,o))>e.length){n=!0;break}null===s&&(t=e.subarray(o,o+a),s=mi.aac.parseAacTimestamp(t)),o+=a;break;case"audio":if(e.length-o<7){n=!0;break}if((a=mi.aac.parseAdtsSize(e,o))>e.length){n=!0;break}null===r&&(t=e.subarray(o,o+a),r=mi.aac.parseSampleRate(t)),i++,o+=a;break;default:o++}if(n)return null}if(null===r||null===s)return null;var l=gi/r;return{audio:[{type:"audio",dts:s,pts:s},{type:"audio",dts:s+1024*i*l,pts:s+1024*i*l}]}}(e):xi(e),n&&(n.audio||n.video)?(function(e,t){if(e.audio&&e.audio.length){var n=t;(void 0===n||isNaN(n))&&(n=e.audio[0].dts),e.audio.forEach(function(e){e.dts=fi(e.dts,n),e.pts=fi(e.pts,n),e.dtsTime=e.dts/gi,e.ptsTime=e.pts/gi})}if(e.video&&e.video.length){var i=t;if((void 0===i||isNaN(i))&&(i=e.video[0].dts),e.video.forEach(function(e){e.dts=fi(e.dts,i),e.pts=fi(e.pts,i),e.dtsTime=e.dts/gi,e.ptsTime=e.pts/gi}),e.firstKeyFrame){var r=e.firstKeyFrame;r.dts=fi(r.dts,i),r.pts=fi(r.pts,i),r.dtsTime=r.dts/gi,r.ptsTime=r.pts/gi}}}(n,t),n):null};class Si{constructor(e,t){this.options=t||{},this.self=e,this.init()}init(){var e,t;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new qt.Transmuxer(this.options),e=this.self,(t=this.transmuxer).on("data",function(t){const n=t.initSegment;t.initSegment={data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength};const i=t.data;t.data=i.buffer,e.postMessage({action:"data",segment:t,byteOffset:i.byteOffset,byteLength:i.byteLength},[t.data])}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){const n={start:{decode:oe.videoTsToSeconds(t.start.dts),presentation:oe.videoTsToSeconds(t.start.pts)},end:{decode:oe.videoTsToSeconds(t.end.dts),presentation:oe.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:oe.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=oe.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:n})}),t.on("audioSegmentTimingInfo",function(t){const n={start:{decode:oe.videoTsToSeconds(t.start.dts),presentation:oe.videoTsToSeconds(t.start.pts)},end:{decode:oe.videoTsToSeconds(t.end.dts),presentation:oe.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:oe.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=oe.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:n})}),t.on("id3Frame",function(t){e.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){e.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){e.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:oe.videoTsToSeconds(t.start),end:oe.videoTsToSeconds(t.end)}})}),t.on("videoTimingInfo",function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:oe.videoTsToSeconds(t.start),end:oe.videoTsToSeconds(t.end)}})}),t.on("log",function(t){e.postMessage({action:"log",log:t})})}pushMp4Captions(e){this.captionParser||(this.captionParser=new ei,this.captionParser.init());const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:n&&n.captions||[],logs:n&&n.logs||[],data:t.buffer},[t.buffer])}initMp4WebVttParser(e){this.webVttParser||(this.webVttParser=new ai);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.webVttParser.init(t)}getMp4WebVttText(e){this.webVttParser||(this.webVttParser=new ai);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.webVttParser.parseSegment(t);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:n||[],data:t.buffer},[t.buffer])}probeMp4StartTime({timescales:e,data:t}){const n=zn.startTime(e,t);this.self.postMessage({action:"probeMp4StartTime",startTime:n,data:t},[t.buffer])}probeMp4Tracks({data:e}){const t=zn.tracks(e);this.self.postMessage({action:"probeMp4Tracks",tracks:t,data:e},[e.buffer])}probeEmsgID3({data:e,offset:t}){const n=zn.getEmsgID3(e,t);this.self.postMessage({action:"probeEmsgID3",id3Frames:n,emsgData:e},[e.buffer])}probeTs({data:e,baseStartTime:t}){const n="number"!=typeof t||isNaN(t)?void 0:t*oe.ONE_SECOND_IN_TS,i=_i(e,n);let r=null;i&&(r={hasVideo:i.video&&2===i.video.length||!1,hasAudio:i.audio&&2===i.audio.length||!1},r.hasVideo&&(r.videoStart=i.video[0].ptsTime),r.hasAudio&&(r.audioStart=i.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:r,data:e},[e.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(e){const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}reset(){this.transmuxer.reset()}setTimestampOffset(e){const t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(oe.secondsToVideoTs(t)))}setAudioAppendStart(e){this.transmuxer.setAudioAppendStart(Math.ceil(oe.secondsToVideoTs(e.appendStart)))}setRemux(e){this.transmuxer.setRemux(e.remux)}flush(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new Si(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new Si(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}}));var p1=c1(h1);const f1=e=>{const{transmuxer:t,bytes:n,audioAppendStart:i,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:c,onVideoSegmentTimingInfo:u,onAudioSegmentTimingInfo:d,onId3:h,onCaptions:p,onDone:f,onEndedTimeline:m,onTransmuxerLog:g,isEndOfTimeline:b,segment:y,triggerSegmentEventFn:v}=e,T={buffer:[]};let x=b;if(t.onmessage=n=>{t.currentTransmux===e&&("data"===n.data.action&&((e,t,n)=>{const{type:i,initSegment:r,captions:s,captionStreams:a,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:c}=e.data.segment;t.buffer.push({captions:s,captionStreams:a,metadata:o});const u=e.data.segment.boxes||{data:e.data.segment.data},d={type:i,data:new Uint8Array(u.data,u.data.byteOffset,u.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};void 0!==l&&(d.videoFrameDtsTime=l),void 0!==c&&(d.videoFramePtsTime=c),n(d)})(n,T,a),"trackinfo"===n.data.action&&o(n.data.trackInfo),"gopInfo"===n.data.action&&((e,t)=>{t.gopInfo=e.data.gopInfo})(n,T),"audioTimingInfo"===n.data.action&&l(n.data.audioTimingInfo),"videoTimingInfo"===n.data.action&&c(n.data.videoTimingInfo),"videoSegmentTimingInfo"===n.data.action&&u(n.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===n.data.action&&d(n.data.audioSegmentTimingInfo),"id3Frame"===n.data.action&&h([n.data.id3Frame],n.data.id3Frame.dispatchType),"caption"===n.data.action&&p(n.data.caption),"endedtimeline"===n.data.action&&(x=!1,m()),"log"===n.data.action&&g(n.data.log),"transmuxed"===n.data.type&&(x||(t.onmessage=null,(({transmuxedData:e,callback:t})=>{e.buffer=[],t(e)})({transmuxedData:T,callback:f}),m1(t))))},t.onerror=()=>{const e={message:"Received an error message from the transmuxer worker",metadata:{errorType:DJ.Error.StreamingFailedToTransmuxSegment,segmentInfo:r2({segment:y})}};f(null,e)},i&&t.postMessage({action:"setAudioAppendStart",appendStart:i}),Array.isArray(r)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),void 0!==s&&t.postMessage({action:"setRemux",remux:s}),n.byteLength){const e=n instanceof ArrayBuffer?n:n.buffer,i=n instanceof ArrayBuffer?0:n.byteOffset;v({type:"segmenttransmuxingstart",segment:y}),t.postMessage({action:"push",data:e,byteOffset:i,byteLength:n.byteLength},[e])}b&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},m1=e=>{e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"==typeof e.currentTransmux?e.currentTransmux():f1(e.currentTransmux))},g1=(e,t)=>{e.postMessage({action:t}),m1(e)},b1=(e,t)=>{if(!t.currentTransmux)return t.currentTransmux=e,void g1(t,e);t.transmuxQueue.push(g1.bind(null,t,e))},y1=e=>{if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void f1(e);e.transmuxer.transmuxQueue.push(e)};var v1=e=>{b1("reset",e)},T1=e=>{const t=new p1;t.currentTransmux=null,t.transmuxQueue=[];const n=t.terminate;return t.terminate=()=>(t.currentTransmux=null,t.transmuxQueue.length=0,n.call(t)),t.postMessage({action:"init",options:e}),t};const x1=function(e){const t=e.transmuxer,n=e.endAction||e.action,i=e.callback,r=a({},e,{endAction:null,transmuxer:null,callback:null}),s=r=>{r.data.action===n&&(t.removeEventListener("message",s),r.data.data&&(r.data.data=new Uint8Array(r.data.data,e.byteOffset||0,e.byteLength||r.data.data.byteLength),e.data&&(e.data=r.data.data)),i(r.data))};if(t.addEventListener("message",s),e.data){const n=e.data instanceof ArrayBuffer;r.byteOffset=n?0:e.data.byteOffset,r.byteLength=e.data.byteLength;const i=[n?e.data:e.data.buffer];t.postMessage(r,i)}else t.postMessage(r)},_1=2,S1=-101,w1=-102,I1="wvtt",k1=e=>{e.forEach(e=>{e.abort()})},C1=(e,t)=>{const{requestType:n}=t,i=S0({requestType:n,request:t,error:e});return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:S1,xhr:t,metadata:i}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:w1,xhr:t,metadata:i}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:_1,xhr:t,metadata:i}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:_1,xhr:t,metadata:i}:null},E1=(e,t,n,i)=>(r,s)=>{const a=s.response,o=C1(r,s);if(o)return n(o,e);if(16!==a.byteLength)return n({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:_1,xhr:s},e);const l=new DataView(a),c=new Uint32Array([l.getUint32(0),l.getUint32(4),l.getUint32(8),l.getUint32(12)]);for(let e=0;e<t.length;e++)t[e].bytes=c;const u={uri:s.uri};return i({type:"segmentkeyloadcomplete",segment:e,keyInfo:u}),n(null,e)},A1=(e,t)=>{const n=pX(e.map.bytes);if("mp4"!==n){const i=e.map.resolvedUri||e.map.uri,r=n||"unknown";return t({internal:!0,message:`Found unsupported ${r} container for initialization segment at URL: ${i}`,code:_1,metadata:{mediaType:r}})}x1({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:({tracks:n,data:i})=>(e.map.bytes=i,n.forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"==typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale),"text"===t.type&&((e,t)=>{t===I1&&e.transmuxer.postMessage({action:"initMp4WebVttParser",data:e.map.bytes})})(e,t.codec))}),t(null))})},R1=({segment:e,finishProcessingFn:t,responseType:n,triggerSegmentEventFn:i})=>(r,s)=>{const a=C1(r,s);if(a)return t(a,e);i({type:"segmentloaded",segment:e});const o="arraybuffer"!==n&&s.responseText?(e=>{const t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer})(s.responseText.substring(e.lastReachedChar||0)):s.response;return e.stats=(e=>({bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}))(s),e.key?e.encryptedBytes=new Uint8Array(o):e.bytes=new Uint8Array(o),t(null,e)},N1=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})=>{const f=e.map&&e.map.tracks||{},m=Boolean(f.audio&&f.video);let g=i.bind(null,e,"audio","start");const b=i.bind(null,e,"audio","end");let y=i.bind(null,e,"video","start");const v=i.bind(null,e,"video","end");x1({action:"probeTs",transmuxer:e.transmuxer,data:t,baseStartTime:e.baseStartTime,callback:i=>{e.bytes=t=i.data;const f=i.result;f&&(n(e,{hasAudio:f.hasAudio,hasVideo:f.hasVideo,isMuxed:m}),n=null),y1({bytes:t,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,remux:m,onData:t=>{t.type="combined"===t.type?"video":t.type,u(e,t)},onTrackInfo:t=>{n&&(m&&(t.isMuxed=!0),n(e,t))},onAudioTimingInfo:e=>{g&&void 0!==e.start&&(g(e.start),g=null),b&&void 0!==e.end&&b(e.end)},onVideoTimingInfo:e=>{y&&void 0!==e.start&&(y(e.start),y=null),v&&void 0!==e.end&&v(e.end)},onVideoSegmentTimingInfo:t=>{const n={pts:{start:t.start.presentation,end:t.end.presentation},dts:{start:t.start.decode,end:t.end.decode}};p({type:"segmenttransmuxingtiminginfoavailable",segment:e,timingInfo:n}),r(t)},onAudioSegmentTimingInfo:t=>{const n={pts:{start:t.start.pts,end:t.end.pts},dts:{start:t.start.dts,end:t.end.dts}};p({type:"segmenttransmuxingtiminginfoavailable",segment:e,timingInfo:n}),s(t)},onId3:(t,n)=>{a(e,t,n)},onCaptions:t=>{o(e,[t])},isEndOfTimeline:l,onEndedTimeline:()=>{c()},onTransmuxerLog:h,onDone:(t,n)=>{d&&(t.type="combined"===t.type?"video":t.type,p({type:"segmenttransmuxingcomplete",segment:e}),d(n,e,t))},segment:e,triggerSegmentEventFn:p})}})},P1=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})=>{let f=new Uint8Array(t);if(function(e){return qq(e,["moof"]).length>0}(f)){e.isFmp4=!0;const{tracks:r}=e.map;if(r.text&&(!r.audio||!r.video))return u(e,{data:f,type:"text"}),void((e,t,n)=>{t===I1&&x1({action:"getMp4WebVttText",data:e.bytes,transmuxer:e.transmuxer,callback:({data:t,mp4VttCues:i})=>{e.bytes=t,n(null,e,{mp4VttCues:i})}})})(e,r.text.codec,d);const s={isFmp4:!0,hasVideo:!!r.video,hasAudio:!!r.audio};r.audio&&r.audio.codec&&"enca"!==r.audio.codec&&(s.audioCodec=r.audio.codec),r.video&&r.video.codec&&"encv"!==r.video.codec&&(s.videoCodec=r.video.codec),r.video&&r.audio&&(s.isMuxed=!0),n(e,s);const l=(t,n)=>{u(e,{data:f,type:s.hasAudio&&!s.isMuxed?"audio":"video"}),n&&n.length&&a(e,n),t&&t.length&&o(e,t),d(null,e,{})};return void x1({action:"probeMp4StartTime",timescales:e.map.timescales,data:f,transmuxer:e.transmuxer,callback:({data:n,startTime:a})=>{t=n.buffer,e.bytes=f=n,s.hasAudio&&!s.isMuxed&&i(e,"audio","start",a),s.hasVideo&&i(e,"video","start",a),x1({action:"probeEmsgID3",data:f,transmuxer:e.transmuxer,offset:a,callback:({emsgData:n,id3Frames:i})=>{t=n.buffer,e.bytes=f=n,r.video&&n.byteLength&&e.transmuxer?x1({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:e.transmuxer,data:f,timescales:e.map.timescales,trackIds:[r.video.id],callback:n=>{t=n.data.buffer,e.bytes=f=n.data,n.logs.forEach(function(e){h(UJ(e,{stream:"mp4CaptionParser"}))}),l(n.captions,i)}}):l(void 0,i)}})}})}if(e.transmuxer){if(void 0===e.container&&(e.container=pX(f)),"ts"!==e.container&&"aac"!==e.container)return n(e,{hasAudio:!1,hasVideo:!1}),void d(null,e,{});N1({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})}else d(null,e,{})},D1=function({id:e,key:t,encryptedBytes:n,decryptionWorker:i,segment:r,doneFn:s},a){const o=t=>{if(t.data.source===e){i.removeEventListener("message",o);const e=t.data.decrypted;a(new Uint8Array(e.bytes,e.byteOffset,e.byteLength))}};let l;i.onerror=()=>{const e="An error occurred in the decryption worker",t=r2({segment:r}),n={message:e,metadata:{error:new Error(e),errorType:DJ.Error.StreamingFailedToDecryptSegment,segmentInfo:t,keyInfo:{uri:r.key.resolvedUri||r.map.key.resolvedUri}}};s(n,r)},i.addEventListener("message",o),l=t.bytes.slice?t.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.bytes)),i.postMessage(W0({source:e,encrypted:n,key:l,iv:t.iv}),[n.buffer,l.buffer])},O1=({activeXhrs:e,decryptionWorker:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})=>{let f=0,m=!1;return(g,b)=>{if(!m){if(g)return m=!0,k1(e),d(g,b);if(f+=1,f===e.length){const f=function(){if(b.encryptedBytes)return(({decryptionWorker:e,segment:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})=>{p({type:"segmentdecryptionstart"}),D1({id:t.requestId,key:t.key,encryptedBytes:t.encryptedBytes,decryptionWorker:e,segment:t,doneFn:d},e=>{t.bytes=e,p({type:"segmentdecryptioncomplete",segment:t}),P1({segment:t,bytes:t.bytes,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})})})({decryptionWorker:t,segment:b,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p});P1({segment:b,bytes:b.bytes,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:p})};if(b.endOfAllRequests=Date.now(),b.map&&b.map.encryptedBytes&&!b.map.bytes)return p({type:"segmentdecryptionstart",segment:b}),D1({decryptionWorker:t,id:b.requestId+"-init",encryptedBytes:b.map.encryptedBytes,key:b.map.key,segment:b,doneFn:d},t=>{b.map.bytes=t,p({type:"segmentdecryptioncomplete",segment:b}),A1(b,t=>{if(t)return k1(e),d(t,b);f()})});f()}}}},L1=({segment:e,progressFn:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:c,dataFn:u})=>n=>{if(!n.target.aborted)return e.stats=UJ(e.stats,(e=>{const t=e.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return n.bytesReceived=e.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n})(n)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(n,e)},M1=({xhr:e,xhrOptions:t,decryptionWorker:n,segment:i,abortFn:r,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:c,id3Fn:u,captionsFn:d,isEndOfTimeline:h,endedTimelineFn:p,dataFn:f,doneFn:m,onTransmuxerLog:g,triggerSegmentEventFn:b})=>{const y=[],v=O1({activeXhrs:y,decryptionWorker:n,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:c,id3Fn:u,captionsFn:d,isEndOfTimeline:h,endedTimelineFn:p,dataFn:f,doneFn:m,onTransmuxerLog:g,triggerSegmentEventFn:b});if(i.key&&!i.key.bytes){const n=[i.key];i.map&&!i.map.bytes&&i.map.key&&i.map.key.resolvedUri===i.key.resolvedUri&&n.push(i.map.key);const r=UJ(t,{uri:i.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),s=E1(i,n,v,b);b({type:"segmentkeyloadstart",segment:i,keyInfo:{uri:i.key.resolvedUri}});const a=e(r,s);y.push(a)}if(i.map&&!i.map.bytes){if(i.map.key&&(!i.key||i.key.resolvedUri!==i.map.key.resolvedUri)){const n=UJ(t,{uri:i.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),r=E1(i,[i.map.key],v,b);b({type:"segmentkeyloadstart",segment:i,keyInfo:{uri:i.map.key.resolvedUri}});const s=e(n,r);y.push(s)}const n=UJ(t,{uri:i.map.resolvedUri,responseType:"arraybuffer",headers:U0(i.map),requestType:"segment-media-initialization"}),r=(({segment:e,finishProcessingFn:t,triggerSegmentEventFn:n})=>(i,r)=>{const s=C1(i,r);if(s)return t(s,e);const a=new Uint8Array(r.response);if(n({type:"segmentloaded",segment:e}),e.map.key)return e.map.encryptedBytes=a,t(null,e);e.map.bytes=a,A1(e,function(n){if(n)return n.xhr=r,n.status=r.status,t(n,e);t(null,e)})})({segment:i,finishProcessingFn:v,triggerSegmentEventFn:b});b({type:"segmentloadstart",segment:i});const s=e(n,r);y.push(s)}const T=UJ(t,{uri:i.part&&i.part.resolvedUri||i.resolvedUri,responseType:"arraybuffer",headers:U0(i),requestType:"segment"}),x=R1({segment:i,finishProcessingFn:v,responseType:T.responseType,triggerSegmentEventFn:b});b({type:"segmentloadstart",segment:i});const _=e(T,x);_.addEventListener("progress",L1({segment:i,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:c,id3Fn:u,captionsFn:d,isEndOfTimeline:h,endedTimelineFn:p,dataFn:f})),y.push(_);const S={};return y.forEach(e=>{e.addEventListener("loadend",(({loadendState:e,abortFn:t})=>n=>{n.target.aborted&&t&&!e.calledAbortFn&&(t(),e.calledAbortFn=!0)})({loadendState:S,abortFn:r}))}),()=>k1(y)},F1=zJ("PlaylistSelector"),$1=function(e){if(!e||!e.playlist)return;const t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})},B1=function(e,t){if(!e)return"";const n=ZG.getComputedStyle(e);return n?n[t]:""},z1=function(e,t){const n=e.slice();e.sort(function(e,i){const r=t(e,i);return 0===r?n.indexOf(e)-n.indexOf(i):r})},U1=function(e,t){let n,i;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||ZG.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(i=t.attributes.BANDWIDTH),i=i||ZG.Number.MAX_VALUE,n-i};let G1=function(e){const{main:t,bandwidth:n,playerWidth:i,playerHeight:r,playerObjectFit:s,limitRenditionByPlayerDimensions:a,playlistController:o}=e;if(!t)return;const l={bandwidth:n,width:i,height:r,limitRenditionByPlayerDimensions:a};let c=t.playlists;m0.isAudioOnly(t)&&(c=o.getAudioTrackPlaylists_(),l.audioOnly=!0);let u=c.map(e=>{let t;const n=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,i=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return t=e.attributes&&e.attributes.BANDWIDTH,t=t||ZG.Number.MAX_VALUE,{bandwidth:t,width:n,height:i,playlist:e}});z1(u,(e,t)=>e.bandwidth-t.bandwidth),u=u.filter(e=>!m0.isIncompatible(e.playlist));let d=u.filter(e=>m0.isEnabled(e.playlist));d.length||(d=u.filter(e=>!m0.isDisabled(e.playlist)));const h=d.filter(e=>e.bandwidth*o1.BANDWIDTH_VARIANCE<n);let p=h[h.length-1];const f=h.filter(e=>e.bandwidth===p.bandwidth)[0];if(!1===a){const e=f||d[0]||u[0];if(e&&e.playlist){let t="sortedPlaylistReps";return f&&(t="bandwidthBestRep"),d[0]&&(t="enabledPlaylistReps"),F1(`choosing ${$1(e)} using ${t} with options`,l),e.playlist}return F1("could not choose a playlist with options",l),null}const m=h.filter(e=>e.width&&e.height);z1(m,(e,t)=>e.width-t.width);const g=m.filter(e=>e.width===i&&e.height===r);p=g[g.length-1];const b=g.filter(e=>e.bandwidth===p.bandwidth)[0];let y,v,T,x;if(b||(y=m.filter(e=>"cover"===s?e.width>i&&e.height>r:e.width>i||e.height>r),v=y.filter(e=>e.width===y[0].width&&e.height===y[0].height),p=v[v.length-1],T=v.filter(e=>e.bandwidth===p.bandwidth)[0]),o.leastPixelDiffSelector){const e=m.map(e=>(e.pixelDiff=Math.abs(e.width-i)+Math.abs(e.height-r),e));z1(e,(e,t)=>e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff),x=e[0]}const _=x||T||b||f||d[0]||u[0];if(_&&_.playlist){let e="sortedPlaylistReps";return x?e="leastPixelDiffRep":T?e="resolutionPlusOneRep":b?e="resolutionBestRep":f?e="bandwidthBestRep":d[0]&&(e="enabledPlaylistReps"),F1(`choosing ${$1(_)} using ${e} with options`,l),_.playlist}return F1("could not choose a playlist with options",l),null};const V1=function(){let e=this.useDevicePixelRatio&&ZG.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(e=this.customPixelRatio),G1({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(B1(this.tech_.el(),"width"),10)*e,playerHeight:parseInt(B1(this.tech_.el(),"height"),10)*e,playerObjectFit:this.usePlayerObjectFit?B1(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})};function H1(e){try{return new URL(e).pathname.split("/").slice(-2).join("/")}catch(r6){return""}}const W1=({inbandTextTracks:e,metadataArray:t,timestampOffset:n,videoDuration:i})=>{if(!t)return;const r=ZG.WebKitDataCue||ZG.VTTCue,s=e.metadataTrack_;if(!s)return;if(t.forEach(e=>{const t=e.cueTime+n;!("number"!=typeof t||ZG.isNaN(t)||t<0)&&t<1/0&&e.frames&&e.frames.length&&e.frames.forEach(e=>{const n=new r(t,t,e.value||e.url||e.data||"");n.frame=e,n.value=e,function(e){Object.defineProperties(e.frame,{id:{get:()=>(DJ.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key)},value:{get:()=>(DJ.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data)},privateData:{get:()=>(DJ.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data)}})}(n),s.addCue(n)})}),!s.cues||!s.cues.length)return;const a=s.cues,o=[];for(let u=0;u<a.length;u++)a[u]&&o.push(a[u]);const l=o.reduce((e,t)=>{const n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e},{}),c=Object.keys(l).sort((e,t)=>Number(e)-Number(t));c.forEach((e,t)=>{const n=l[e],r=isFinite(i)?i:e,s=Number(c[t+1])||r;n.forEach(e=>{e.endTime=s})})},j1={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},q1=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),X1=(e,t,n)=>{e.metadataTrack_||(e.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,DJ.browser.IS_ANY_SAFARI||(e.metadataTrack_.inBandMetadataTrackDispatchType=t))},K1=function(e,t,n){let i,r;if(n&&n.cues)for(i=n.cues.length;i--;)r=n.cues[i],r.startTime>=e&&r.endTime<=t&&n.removeCue(r)},Y1=e=>"number"==typeof e&&isFinite(e),Z1=1/60,Q1=e=>{const{startOfSegment:t,duration:n,segment:i,part:r,playlist:{mediaSequence:s,id:a,segments:o=[]},mediaIndex:l,partIndex:c,timeline:u}=e,d=o.length-1;let h="mediaIndex/partIndex increment";e.getMediaInfoForTime?h=`getMediaInfoForTime (${e.getMediaInfoForTime})`:e.isSyncRequest&&(h="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(h+=` with independent ${e.independent}`);const p="number"==typeof c,f=e.segment.uri?"segment":"pre-segment",m=p?t0({preloadSegment:i})-1:0;return`${f} [${s+l}/${s+d}]`+(p?` part [${c}/${m}]`:"")+` segment start/end [${i.start} => ${i.end}]`+(p?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${t}] duration [${n}] timeline [${u}] selected by [${h}] playlist [${a}]`},J1=e=>`${e}TimingInfo`,e2=({timelineChangeController:e,currentTimeline:t,segmentTimeline:n,loaderType:i,audioDisabled:r})=>{if(t===n)return!1;if("audio"===i){const t=e.lastTimelineChange({type:"main"});return!t||t.to!==n}if("main"===i&&r){const t=e.pendingTimelineChange({type:"audio"});return!t||t.to!==n}return!1},t2=e=>{const t=e.pendingSegment_;if(!t)return;if(e2({timelineChangeController:e.timelineChangeController_,currentTimeline:e.currentTimeline_,segmentTimeline:t.timeline,loaderType:e.loaderType_,audioDisabled:e.audioDisabled_})&&(e=>{if(!e)return!1;const t=e.pendingTimelineChange({type:"audio"}),n=e.pendingTimelineChange({type:"main"}),i=t&&n,r=i&&t.to!==n.to;return!(!i||-1===t.from||-1===n.from||!r)})(e.timelineChangeController_)){if((e=>{const t=e.timelineChangeController_.pendingTimelineChange({type:"audio"}),n=e.timelineChangeController_.pendingTimelineChange({type:"main"});return t&&n&&t.to<n.to})(e))return void e.timelineChangeController_.trigger("audioTimelineBehind");e.timelineChangeController_.trigger("fixBadTimelineChange")}},n2=({segmentDuration:e,maxDuration:t})=>!!e&&Math.round(e)>t+VJ,i2=(e,t)=>{if("hls"!==t)return null;const n=(e=>{let t=0;return["video","audio"].forEach(function(n){const i=e[`${n}TimingInfo`];if(!i)return;const{start:r,end:s}=i;let a;"bigint"==typeof r||"bigint"==typeof s?a=ZG.BigInt(s)-ZG.BigInt(r):"number"==typeof r&&"number"==typeof s&&(a=s-r),void 0!==a&&a>t&&(t=a)}),"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),t})({audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo});if(!n)return null;const i=e.playlist.targetDuration,r=n2({segmentDuration:n,maxDuration:2*i}),s=n2({segmentDuration:n,maxDuration:i}),a=`Segment with index ${e.mediaIndex} from playlist ${e.playlist.id} has a duration of ${n} when the reported duration is ${e.duration} and the target duration is ${i}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||s?{severity:r?"warn":"info",message:a}:null},r2=({type:e,segment:t})=>{if(!t)return;const n=Boolean(t.key||t.map&&t.map.ke),i=Boolean(t.map&&!t.map.bytes),r=void 0===t.startOfSegment?t.start:t.startOfSegment;return{type:e||t.type,uri:t.resolvedUri||t.uri,start:r,duration:t.duration,isEncrypted:n,isMediaInitialization:i}};class s2 extends DJ.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=zJ(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(e){e!==this.state_&&(this.logger_(`${this.state_} -> ${e}`),this.state_=e,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():t2(this)}),this.sourceUpdater_.on("codecschange",e=>{this.trigger(a({type:"codecschange"},e))}),"main"===this.loaderType_&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():t2(this)}),"audio"===this.loaderType_&&this.timelineChangeController_.on("timelinechange",e=>{this.trigger(a({type:"timelinechange"},e)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():t2(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():t2(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return T1({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&ZG.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if("WAITING"!==this.state)return this.pendingSegment_&&(this.pendingSegment_=null),void this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,ZG.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)}error(e){return void 0!==e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&v1(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return GJ();if("main"===this.loaderType_){const{hasAudio:t,hasVideo:n,isMuxed:i}=e;if(n&&t&&!this.audioDisabled_&&!i)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=j0(e);let i=this.initSegments_[n];return t&&!i&&e.bytes&&(this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),i||e}segmentKey(e,t=!1){if(!e)return null;const n=q0(e);let i=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!i&&e.bytes&&(this.keyCache_[n]=i={resolvedUri:e.resolvedUri,bytes:e.bytes});const r={resolvedUri:(i||e).resolvedUri};return i&&(r.bytes=i.bytes),r}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;if(this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const n=this.playlist_,i=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));let r=null;if(n&&(n.id?r=n.id:n.uri&&(r=n.uri)),this.logger_(`playlist update [${r} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:\ncurrentTime: ${this.currentTime_()}\nbufferedEnd: ${YJ(this.buffered_())}\n`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){if(null!==this.mediaIndex){!e.endList&&"number"==typeof e.partTargetDuration?this.resetLoader():this.resyncLoader()}return this.currentMediaInfo_=void 0,void this.trigger("playlistupdate")}const s=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${s}]`),null!==this.mediaIndex)if(this.mediaIndex-=s,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const e=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!e.parts||!e.parts.length||!e.parts[this.partIndex])){const e=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=e}}i&&(i.mediaIndex-=s,i.mediaIndex<0?(i.mediaIndex=null,i.partIndex=null):(i.mediaIndex>=0&&(i.segment=e.segments[i.mediaIndex]),i.partIndex>=0&&i.segment.parts&&(i.part=i.segment.parts[i.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(ZG.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return null===this.checkBufferTimeout_}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&v1(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;"hls"===this.sourceType_&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=()=>{},i=!1){if(t===1/0&&(t=this.duration_()),t<=e)return void this.logger_("skipping remove because end ${end} is <= start ${start}");if(!this.sourceUpdater_||!this.getMediaInfo_())return void this.logger_("skipping remove because no source updater or starting media info");let r=1;const s=()=>{r--,0===r&&n()};!i&&this.audioDisabled_||(r++,this.sourceUpdater_.removeAudio(e,t,s)),(i||"main"===this.loaderType_)&&(this.gopBuffer_=((e,t,n,i)=>{const r=Math.ceil((t-i)*mX),s=Math.ceil((n-i)*mX),a=e.slice();let o=e.length;for(;o--&&!(e[o].pts<=s););if(-1===o)return a;let l=o+1;for(;l--&&!(e[l].pts<=r););return l=Math.max(l,0),a.splice(l,o-l+1),a})(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,s));for(const a in this.inbandTextTracks_)K1(e,t,this.inbandTextTracks_[a]);K1(e,t,this.segmentMetadataTrack_),s()}monitorBuffer_(){this.checkBufferTimeout_&&ZG.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=ZG.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&ZG.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=ZG.setTimeout(this.monitorBufferTick_.bind(this),500)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:r2({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),"number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const i="number"==typeof e&&t.segments[e],r=e+1===t.segments.length,s=!i||!i.parts||n+1===i.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&r&&s}chooseNextRequest_(){const e=this.buffered_(),t=YJ(e)||0,n=ZJ(e,this.currentTime_()),i=!this.hasPlayed_()&&n>=1,r=n>=this.goalBufferLength_(),s=this.playlist_.segments;if(!s.length||i||r)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const a={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(a.isSyncRequest)a.mediaIndex=function(e,t,n){t=t||[];const i=[];let r=0;for(let s=0;s<t.length;s++){const a=t[s];if(e===a.timeline&&(i.push(s),r+=a.duration,r>n))return s}return 0===i.length?0:i[i.length-1]}(this.currentTimeline_,s,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${a.mediaIndex}`);else if(null!==this.mediaIndex){const e=s[this.mediaIndex],n="number"==typeof this.partIndex?this.partIndex:-1;a.startOfSegment=e.end?e.end:t,e.parts&&e.parts[n+1]?(a.mediaIndex=this.mediaIndex,a.partIndex=n+1):a.mediaIndex=this.mediaIndex+1}else{let e,n,i;const r=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:\nFor TargetTime: ${r}.\nCurrentTime: ${this.currentTime_()}\nBufferedEnd: ${t}\nFetch At Buffer: ${this.fetchAtBuffer_}\n`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const t=this.getSyncInfoFromMediaSequenceSync_(r);if(!t){const e="No sync info found while using media sequence sync";return this.error({message:e,metadata:{errorType:DJ.Error.StreamingFailedToSelectNextSegment,error:new Error(e)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${t.start} --\x3e ${t.end})`),e=t.segmentIndex,n=t.partIndex,i=t.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const t=m0.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:r,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});e=t.segmentIndex,n=t.partIndex,i=t.startTime}a.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${r}`:`currentTime ${r}`,a.mediaIndex=e,a.startOfSegment=i,a.partIndex=n,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${a.mediaIndex} `)}const o=s[a.mediaIndex];let l=o&&"number"==typeof a.partIndex&&o.parts&&o.parts[a.partIndex];if(!o||"number"==typeof a.partIndex&&!l)return null;"number"!=typeof a.partIndex&&o.parts&&(a.partIndex=0,l=o.parts[0]);const c=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&l&&!c&&!l.independent)if(0===a.partIndex){const e=s[a.mediaIndex-1],t=e.parts&&e.parts.length&&e.parts[e.parts.length-1];t&&t.independent&&(a.mediaIndex-=1,a.partIndex=e.parts.length-1,a.independent="previous segment")}else o.parts[a.partIndex-1].independent&&(a.partIndex-=1,a.independent="previous part");const u=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return a.mediaIndex>=s.length-1&&u&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,a.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(a))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const n=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!n)return null;if(!n.isAppended)return n;const i=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return i?(i.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),i):null}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:i,startOfSegment:r,isSyncRequest:s,partIndex:a,forceTimestampOffset:o,getMediaInfoForTime:l}=e,c=n.segments[i],u="number"==typeof a&&c.parts[a],d={requestId:"segment-loader-"+Math.random(),uri:u&&u.resolvedUri||c.resolvedUri,mediaIndex:i,partIndex:u?a:null,isSyncRequest:s,startOfSegment:r,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:c.timeline,duration:u&&u.duration||c.duration,segment:c,part:u,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},h=void 0!==o?o:this.isPendingTimestampOffset_;d.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:c.timeline,currentTimeline:this.currentTimeline_,startOfSegment:r,buffered:this.buffered_(),overrideCheck:h});const p=YJ(this.sourceUpdater_.audioBuffered());return"number"==typeof p&&(d.audioAppendStart=p-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(d.gopsToAlignWith=((e,t,n)=>{if(null==t||!e.length)return[];const i=Math.ceil((t-n+3)*mX);let r;for(r=0;r<e.length&&!(e[r].pts>i);r++);return e.slice(r)})(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),d}timestampOffsetForSegment_(e){return(({segmentTimeline:e,currentTimeline:t,startOfSegment:n,buffered:i,overrideCheck:r})=>r||e!==t?e<t?n:i.length?i.end(i.length-1):n:null)(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,i=this.pendingSegment_.duration,r=m0.estimateSegmentRequestTime(i,n,this.playlist_,e.bytesReceived),s=function(e,t,n=1){return((e.length?e.end(e.length-1):0)-t)/n}(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(r<=s)return;const a=function(e){const{main:t,currentTime:n,bandwidth:i,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:o,syncController:l}=e,c=t.playlists.filter(e=>!m0.isIncompatible(e));let u=c.filter(m0.isEnabled);u.length||(u=c.filter(e=>!m0.isDisabled(e)));const d=u.filter(m0.hasAttribute.bind(null,"BANDWIDTH")).map(e=>{const t=l.getSyncPoint(e,r,o,n)?1:2;return{playlist:e,rebufferingImpact:m0.estimateSegmentRequestTime(s,i,e)*t-a}}),h=d.filter(e=>e.rebufferingImpact<=0);return z1(h,(e,t)=>U1(t.playlist,e.playlist)),h.length?h[0]:(z1(d,(e,t)=>e.rebufferingImpact-t.rebufferingImpact),d[0]||null)}({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:i,timeUntilRebuffer:s,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!a)return;const o=r-s-a.rebufferingImpact;let l=.5;s<=VJ&&(l=1),!a.playlist||a.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=a.playlist.attributes.BANDWIDTH*o1.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${Q1(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:n,hasVideo:i}=t,r={segmentInfo:r2({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:n,hasVideo:i}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:r}),this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;const n=Object.keys(e).sort(),i=Object.keys(t).sort();if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++){const s=n[r];if(s!==i[r])return!1;if(e[s]!==t[s])return!1}return!0}(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():t2(this)))}handleTimingInfo_(e,t,n,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const r=this.pendingSegment_,s=J1(t);r[s]=r[s]||{},r[s][n]=i,this.logger_(`timinginfo: ${t} - ${n} - ${i}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():t2(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(0===t.length)return void this.logger_("SegmentLoader received no captions from a caption event");if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));const n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),i={};t.forEach(e=>{i[e.stream]=i[e.stream]||{startTime:1/0,captions:[],endTime:0};const t=i[e.stream];t.startTime=Math.min(t.startTime,e.startTime+n),t.endTime=Math.max(t.endTime,e.endTime+n),t.captions.push(e)}),Object.keys(i).forEach(e=>{const{startTime:t,endTime:r,captions:s}=i[e],a=this.inbandTextTracks_;this.logger_(`adding cues from ${t} -> ${r} for ${e}`),function(e,t,n){if(!e[n]){t.trigger({type:"usage",name:"vhs-608"});let i=n;/^cc708_/.test(n)&&(i="SERVICE"+n.split("_")[1]);const r=t.textTracks().getTrackById(i);if(r)e[n]=r;else{let r=n,s=n,a=!1;const o=(t.options_.vhs&&t.options_.vhs.captionServices||{})[i];o&&(r=o.label,s=o.language,a=o.default),e[n]=t.addRemoteTextTrack({kind:"captions",id:i,default:a,label:r,language:s},!1).track}}}(a,this.vhs_.tech_,e),K1(t,r,a[e]),function({inbandTextTracks:e,captionArray:t,timestampOffset:n}){if(!t)return;const i=ZG.WebKitDataCue||ZG.VTTCue;t.forEach(t=>{const r=t.stream;t.content?t.content.forEach(s=>{const a=new i(t.startTime+n,t.endTime+n,s.text);a.line=s.line,a.align="left",a.position=s.position,a.positionAlign="line-left",e[r].addCue(a)}):e[r].addCue(new i(t.startTime+n,t.endTime+n,t.text))})}({captionArray:s,inbandTextTracks:a,timestampOffset:n})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;this.pendingSegment_.hasAppendedData_?this.addMetadataToTextTrack(n,t,this.duration_()):this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n))}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(e=>e())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(e=>e())}hasEnoughInfoToLoad_(){if("audio"!==this.loaderType_)return!0;const e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!e2({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:i,isMuxed:r}=t;return!(i&&!e.videoTimingInfo)&&(!(n&&!this.audioDisabled_&&!r&&!e.audioTimingInfo)&&!e2({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return t2(this),void this.callQueue_.push(this.handleData_.bind(this,e,t));const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[J1(t.type)].start;else{const e=this.getCurrentMediaInfo_(),t="main"===this.loaderType_&&e&&e.hasVideo;let i;t&&(i=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:t,firstVideoFrameTimeForData:i,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:"main"===this.loaderType_});const e=this.chooseNextRequest_();if(e.mediaIndex!==n.mediaIndex||e.partIndex!==n.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){"main"!==this.loaderType_||"number"!=typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:i}){if(n){const e=j0(n);if(this.activeInitSegmentId_===e)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=e}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=i,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},i){const r=this.sourceUpdater_.audioBuffered(),s=this.sourceUpdater_.videoBuffered();r.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+KJ(r).join(", ")),s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+KJ(s).join(", "));const a=r.length?r.start(0):0,o=r.length?r.end(r.length-1):0,l=s.length?s.start(0):0,c=s.length?s.end(s.length-1):0;if(o-a<=1&&c-l<=1)return this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${KJ(r).join(", ")}, video buffer: ${KJ(s).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const u=this.currentTime_()-1;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${u}`),this.remove(0,u,()=>{this.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=ZG.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},i){i&&(22!==i.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",i),this.error({message:`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:DJ.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n}))}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:i,bytes:r}){if(!r){const e=[i];let t=i.byteLength;n&&(e.unshift(n),t+=n.byteLength),r=(e=>{let t,n=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach(e=>{t.set(e,n),n+=e.byteLength})),t})({bytes:t,segments:e})}const s={segmentInfo:r2({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:s}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:r},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:r}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const i=this.pendingSegment_.segment,r=`${e}TimingInfo`;i[r]||(i[r]={}),i[r].transmuxerPrependedSeconds=n.prependedContentDuration||0,i[r].transmuxedPresentationStart=n.start.presentation,i[r].transmuxedDecodeStart=n.start.decode,i[r].transmuxedPresentationEnd=n.end.presentation,i[r].transmuxedDecodeEnd=n.end.decode,i[r].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:i}=t;if(!i||!i.byteLength)return;if("audio"===n&&this.audioDisabled_)return;const r=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:r,data:i})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_())return t2(this),void this.loadQueue_.push(()=>{const t=a({},e,{forceTimestampOffset:!0});a(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),i=null!==this.mediaIndex,r=e.timeline!==this.currentTimeline_&&e.timeline>0,s=n||i&&r;this.logger_(`Requesting\n${H1(e.uri)}\n${Q1(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=M1({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:s,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:t,level:n,stream:i})=>{this.logger_(`${Q1(e)} logged from transmuxer stream ${i} as a ${n}: ${t}`)},triggerSegmentEventFn:({type:e,segment:t,keyInfo:n,trackInfo:i,timingInfo:r})=>{const s={segmentInfo:r2({segment:t})};n&&(s.keyInfo=n),i&&(s.trackInfo=i),r&&(s.timingInfo=r),this.trigger({type:e,metadata:s})}})}trimBackBuffer_(e){const t=((e,t,n)=>{let i=t-o1.BACK_BUFFER_LENGTH;e.length&&(i=Math.max(i,e.start(0)));const r=t-n;return Math.min(r,i)})(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,i=e.segment.key||e.segment.map&&e.segment.map.key,r=e.segment.map&&!e.segment.map.bytes,s={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:i,isMediaInitialization:r},a=e.playlist.segments[e.mediaIndex-1];if(a&&a.timeline===t.timeline&&(a.videoTimingInfo?s.baseStartTime=a.videoTimingInfo.transmuxedDecodeEnd:a.audioTimingInfo&&(s.baseStartTime=a.audioTimingInfo.transmuxedDecodeEnd)),t.key){const n=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);s.key=this.segmentKey(t.key),s.key.iv=n}return t.map&&(s.map=this.initSegmentForMap(t.map)),s}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<Z1)return void this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record 0.016666666666666666`);const n={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:n}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length)return void this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return;if(t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===w1)return;return this.pause(),e.code===S1?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}const i=this.pendingSegment_;this.saveBandwidthRelatedStats_(i.duration,t.stats),i.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=((e,t,n)=>{if(!t.length)return e;if(n)return t.slice();const i=t[0].pts;let r=0;for(;r<e.length&&!(e[r].pts>=i);r++);return e.slice(0,r).concat(t)})(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(i)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){"number"==typeof e.start&&"number"==typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:i,currentVideoTimestampOffset:r,useVideoTimingInfo:s,videoTimingInfo:a,audioTimingInfo:o}){if(void 0!==e)return e;if(!s)return o.start;const l=t.segments[n-1];return 0!==n&&l&&void 0!==l.start&&l.end===i+r?a.start:i}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),void this.trigger("error");const{hasAudio:n,hasVideo:i,isMuxed:r}=t,s="main"===this.loaderType_&&i,a=!this.audioDisabled_&&n&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!=typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);s&&e.waitingOnAppends++,a&&e.waitingOnAppends++,s&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),a&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=((e,t,n)=>"main"===e&&t&&n?n.hasAudio||n.hasVideo?t.hasVideo&&!n.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&n.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null)(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0)}updateSourceBufferTimestampOffset_(e){if(null===e.timestampOffset||"number"!=typeof e.timingInfo.start||e.changedTimestampOffset||"main"!==this.loaderType_)return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&"number"==typeof e.transmuxedDecodeStart?e.transmuxedDecodeStart:t&&"number"==typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),n="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;n&&(e.timingInfo.end="number"==typeof n.end?n.end:n.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const e={segmentInfo:r2({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:e})}if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});const t=i2(e,this.sourceType_);if(t&&("warn"===t.severity?DJ.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_))return void this.logger_(`Throwing away un-appended sync request ${Q1(e)}`);this.logger_(`Appended ${Q1(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,i=e.part,r=n.end&&this.currentTime_()-n.end>3*e.playlist.targetDuration,s=i&&i.end&&this.currentTime_()-i.end>3*e.playlist.partTargetDuration;if(r||s)return this.logger_(`bad ${r?"segment":"part"} ${Q1(e)}`),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<Z1)return void this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record 0.016666666666666666`);const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,i=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(i-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,i=t.end;if(!Y1(n)||!Y1(i))return;K1(n,i,this.segmentMetadataTrack_);const r=ZG.WebKitDataCue||ZG.VTTCue,s={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:i},a=new r(n,i,JSON.stringify(s));a.value=s,this.segmentMetadataTrack_.addCue(a)}}function a2(){}const o2=function(e){return"string"!=typeof e?e:e.replace(/./,e=>e.toUpperCase())},l2=["video","audio"],c2=(e,t)=>{const n=t[`${e}Buffer`];return n&&n.updating||t.queuePending[e]},u2=(e,t)=>{if(0===t.queue.length)return;let n=0,i=t.queue[n];if("mediaSource"!==i.type){if("mediaSource"!==e&&t.ready()&&"closed"!==t.mediaSource.readyState&&!c2(e,t)){if(i.type!==e){if(n=((e,t)=>{for(let n=0;n<t.length;n++){const i=t[n];if("mediaSource"===i.type)return null;if(i.type===e)return n}return null})(e,t.queue),null===n)return;i=t.queue[n]}return t.queue.splice(n,1),t.queuePending[e]=i,i.action(e,t),i.doneFn?void 0:(t.queuePending[e]=null,void u2(e,t))}}else t.updating()||"closed"===t.mediaSource.readyState||(t.queue.shift(),i.action(t),i.doneFn&&i.doneFn(),u2("audio",t),u2("video",t))},d2=(e,t)=>{const n=t[`${e}Buffer`],i=o2(e);n&&(n.removeEventListener("updateend",t[`on${i}UpdateEnd_`]),n.removeEventListener("error",t[`on${i}Error_`]),t.codecs[e]=null,t[`${e}Buffer`]=null)},h2=(e,t)=>e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t),p2=(e,t,n)=>(i,r)=>{const s=r[`${i}Buffer`];if(h2(r.mediaSource,s)){r.logger_(`Appending segment ${t.mediaIndex}'s ${e.length} bytes to ${i}Buffer`);try{s.appendBuffer(e)}catch(r6){r.logger_(`Error with code ${r6.code} `+(22===r6.code?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${t.mediaIndex} to ${i}Buffer`),r.queuePending[i]=null,n(r6)}}},f2=(e,t)=>(n,i)=>{const r=i[`${n}Buffer`];if(h2(i.mediaSource,r)){i.logger_(`Removing ${e} to ${t} from ${n}Buffer`);try{r.remove(e,t)}catch(r6){i.logger_(`Remove ${e} to ${t} from ${n}Buffer failed`)}}},m2=e=>(t,n)=>{const i=n[`${t}Buffer`];h2(n.mediaSource,i)&&(n.logger_(`Setting ${t}timestampOffset to ${e}`),i.timestampOffset=e)},g2=e=>(t,n)=>{e()},b2=e=>t=>{if("open"===t.mediaSource.readyState){t.logger_(`Calling mediaSource endOfStream(${e||""})`);try{t.mediaSource.endOfStream(e)}catch(r6){DJ.log.warn("Failed to call media source endOfStream",r6)}}},y2=e=>t=>{t.logger_(`Setting mediaSource duration to ${e}`);try{t.mediaSource.duration=e}catch(r6){DJ.log.warn("Failed to set media source duration",r6)}},v2=()=>(e,t)=>{if("open"!==t.mediaSource.readyState)return;const n=t[`${e}Buffer`];if(h2(t.mediaSource,n)){t.logger_(`calling abort on ${e}Buffer`);try{n.abort()}catch(r6){DJ.log.warn(`Failed to abort on ${e}Buffer`,r6)}}},T2=(e,t)=>n=>{const i=o2(e),r=wH(t);n.logger_(`Adding ${e}Buffer with codec ${t} to mediaSource`);const s=n.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",n[`on${i}UpdateEnd_`]),s.addEventListener("error",n[`on${i}Error_`]),n.codecs[e]=t,n[`${e}Buffer`]=s},x2=e=>t=>{const n=t[`${e}Buffer`];if(d2(e,t),h2(t.mediaSource,n)){t.logger_(`Removing ${e}Buffer with codec ${t.codecs[e]} from mediaSource`);try{t.mediaSource.removeSourceBuffer(n)}catch(r6){DJ.log.warn(`Failed to removeSourceBuffer ${e}Buffer`,r6)}}},_2=e=>(t,n)=>{const i=n[`${t}Buffer`],r=wH(e);if(!h2(n.mediaSource,i))return;const s=e.substring(0,e.indexOf(".")),a=n.codecs[t];if(a.substring(0,a.indexOf("."))===s)return;const o={codecsChangeInfo:{from:a,to:e}};n.trigger({type:"codecschange",metadata:o}),n.logger_(`changing ${t}Buffer codec from ${a} to ${e}`);try{i.changeType(r),n.codecs[t]=e}catch(r6){o.errorType=DJ.Error.StreamingCodecsChangeError,o.error=r6,r6.metadata=o,n.error_=r6,n.trigger("error"),DJ.log.warn(`Failed to changeType on ${t}Buffer`,r6)}},S2=({type:e,sourceUpdater:t,action:n,doneFn:i,name:r})=>{t.queue.push({type:e,action:n,doneFn:i,name:r}),u2(e,t)},w2=(e,t)=>n=>{const i=function(e){if(0===e.length)return"Buffered Ranges are empty";let t="Buffered Ranges: \n";for(let n=0;n<e.length;n++){const i=e.start(n),r=e.end(n);t+=`${i} --\x3e ${r}. Duration (${r-i})\n`}return t}(t[`${e}Buffered`]());if(t.logger_(`received "updateend" event for ${e} Source Buffer: `,i),t.queuePending[e]){const n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t[`${e}Error_`])}u2(e,t)};class I2 extends DJ.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>u2("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=zJ("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=w2("video",this),this.onAudioUpdateEnd_=w2("audio",this),this.onVideoError_=e=>{this.videoError_=e},this.onAudioError_=e=>{this.audioError_=e},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){S2({type:"mediaSource",sourceUpdater:this,action:T2(e,t),name:"addSourceBuffer"})}abort(e){S2({type:e,sourceUpdater:this,action:v2(e),name:"abort"})}removeSourceBuffer(e){this.canRemoveSourceBuffer()?S2({type:"mediaSource",sourceUpdater:this,action:x2(e),name:"removeSourceBuffer"}):DJ.log.error("removeSourceBuffer is not supported!")}canRemoveSourceBuffer(){return!DJ.browser.IS_FIREFOX&&ZG.MediaSource&&ZG.MediaSource.prototype&&"function"==typeof ZG.MediaSource.prototype.removeSourceBuffer}static canChangeType(){return ZG.SourceBuffer&&ZG.SourceBuffer.prototype&&"function"==typeof ZG.SourceBuffer.prototype.changeType}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){this.canChangeType()?S2({type:e,sourceUpdater:this,action:_2(t),name:"changeType"}):DJ.log.error("changeType is not supported!")}addOrChangeSourceBuffers(e){if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:i,bytes:r}=e;if(this.processedAppend_=!0,"audio"===i&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_(`delayed audio append of ${r.length} until video append`);if(S2({type:i,sourceUpdater:this,action:p2(r,n||{mediaIndex:-1},t),doneFn:t,name:"appendBuffer"}),"video"===i){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const e=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${e.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,e.forEach(e=>{this.appendBuffer.apply(this,e)})}}audioBuffered(){return h2(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:GJ()}videoBuffered(){return h2(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:GJ()}buffered(){const e=h2(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=h2(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():function(e,t){let n=null,i=null,r=0;const s=[],a=[];if(!(e&&e.length&&t&&t.length))return GJ();let o=e.length;for(;o--;)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});for(o=t.length;o--;)s.push({time:t.start(o),type:"start"}),s.push({time:t.end(o),type:"end"});for(s.sort(function(e,t){return e.time-t.time}),o=0;o<s.length;o++)"start"===s[o].type?(r++,2===r&&(n=s[o].time)):"end"===s[o].type&&(r--,1===r&&(i=s[o].time)),null!==n&&null!==i&&(a.push([n,i]),n=null,i=null);return GJ(a)}(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=a2){S2({type:"mediaSource",sourceUpdater:this,action:y2(e),name:"duration",doneFn:t})}endOfStream(e=null,t=a2){"string"!=typeof e&&(e=void 0),S2({type:"mediaSource",sourceUpdater:this,action:b2(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=a2){this.audioBuffered().length&&0!==this.audioBuffered().end(0)?S2({type:"audio",sourceUpdater:this,action:f2(e,t),doneFn:n,name:"remove"}):n()}removeVideo(e,t,n=a2){this.videoBuffered().length&&0!==this.videoBuffered().end(0)?S2({type:"video",sourceUpdater:this,action:f2(e,t),doneFn:n,name:"remove"}):n()}updating(){return!(!c2("audio",this)&&!c2("video",this))}audioTimestampOffset(e){return void 0!==e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(S2({type:"audio",sourceUpdater:this,action:m2(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return void 0!==e&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(S2({type:"video",sourceUpdater:this,action:m2(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&S2({type:"audio",sourceUpdater:this,action:g2(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&S2({type:"video",sourceUpdater:this,action:g2(e),name:"callback"})}dispose(){this.trigger("dispose"),l2.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>d2(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const k2=e=>decodeURIComponent(escape(String.fromCharCode.apply(null,e))),C2=new Uint8Array("\n\n".split("").map(e=>e.charCodeAt(0)));class E2 extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class A2 extends s2{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return GJ();const e=this.subtitlesTrack_.cues;return GJ([[e[0].startTime,e[e.length-1].startTime]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=j0(e);let i=this.initSegments_[n];if(t&&!i&&e.bytes){const t=C2.byteLength+e.bytes.byteLength,r=new Uint8Array(t);r.set(e.bytes),r.set(C2,e.bytes.byteLength),this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:r}}return i||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return void 0===e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_}remove(e,t){K1(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline)){const e=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};return this.syncController_.one("timestampoffset",e),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_)return void(this.state="READY");if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===S1&&this.handleTimeout_(),e.code===w1?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);const i=this.pendingSegment_,r=n.mp4VttCues&&n.mp4VttCues.length;r&&(i.mp4VttCues=n.mp4VttCues),this.saveBandwidthRelatedStats_(i.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const s=i.segment;if(s.map&&(s.map.bytes=t.map.bytes),i.bytes=t.bytes,"function"!=typeof ZG.WebVTT&&"function"==typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));s.requested=!0;try{this.parseVTTCues_(i)}catch(r6){return void this.stopForError({message:r6.message,metadata:{errorType:DJ.Error.StreamingVttParserError,error:r6}})}if(r||this.updateTimeMapping_(i,this.syncController_.timelines[i.timeline],this.playlist_),i.cues.length?i.timingInfo={start:i.cues[0].startTime,end:i.cues[i.cues.length-1].endTime}:i.timingInfo={start:i.startOfSegment,end:i.startOfSegment+i.duration},i.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");i.byteLength=i.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,i.cues.forEach(e=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new ZG.VTTCue(e.startTime,e.endTime,e.text):e)}),function(e){const t=e.cues;if(!t)return;const n={};for(let i=t.length-1;i>=0;i--){const r=t[i],s=`${r.startTime}-${r.endTime}-${r.text}`;n[s]?e.removeCue(r):n[s]=r}}(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const n=e&&"vtt"===e.type,i=t&&"text"===t.type;n&&i&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(n=>{const i=n.start+t,r=n.end+t,s=new ZG.VTTCue(i,r,n.cueText);n.settings&&n.settings.split(" ").forEach(e=>{const t=e.split(":"),n=t[0],i=t[1];s[n]=isNaN(i)?i:Number(i)}),e.cues.push(s)})}parseVTTCues_(e){let t,n=!1;if("function"!=typeof ZG.WebVTT)throw new E2;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues)return void this.parseMp4VttCues_(e);"function"==typeof ZG.TextDecoder?t=new ZG.TextDecoder("utf8"):(t=ZG.WebVTT.StringDecoder(),n=!0);const i=new ZG.WebVTT.Parser(ZG,ZG.vttjs,t);if(i.oncue=e.cues.push.bind(e.cues),i.ontimestampmap=t=>{e.timestampmap=t},i.onparsingerror=e=>{DJ.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){let t=e.segment.map.bytes;n&&(t=k2(t)),i.parse(t)}let r=e.bytes;n&&(r=k2(r)),i.parse(r),i.flush()}updateTimeMapping_(e,t,n){const i=e.segment;if(!t)return;if(!e.cues.length)return void(i.empty=!0);const{MPEGTS:r,LOCAL:s}=e.timestampmap,a=r/mX-s+t.mapping;if(e.cues.forEach(e=>{const n=e.endTime-e.startTime,i=this.handleRollover_(e.startTime+a,t.time);e.startTime=Math.max(i,0),e.endTime=Math.max(i+n,0)}),!n.syncInfo){const t=e.cues[0].startTime,r=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(t,r-i.duration)}}}handleRollover_(e,t){if(null===t)return e;let n=e*mX;const i=t*mX;let r;for(r=i<n?-8589934592:8589934592;Math.abs(n-i)>4294967296;)n+=r;return n/mX}}const R2=function(e,t){const n=e.cues;for(let i=0;i<n.length;i++){const e=n[i];if(t>=e.adStartTime&&t<=e.adEndTime)return e}return null};class N2{constructor({start:e,end:t,segmentIndex:n,partIndex:i=null,appended:r=!1}){this.start_=e,this.end_=t,this.segmentIndex_=n,this.partIndex_=i,this.appended_=r}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class P2{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class D2{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:n,segments:i}=e;if(this.isReliable_=this.isReliablePlaylist_(n,i),this.isReliable_)return this.updateStorage_(i,n,this.calculateBaseTime_(n,i,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const i of n)if(i.isInRange(e))return i}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,n){const i=new Map;let r="\n",s=n,a=t;this.start_=s,e.forEach((e,t)=>{const n=this.storage_.get(a),o=s,l=o+e.duration,c=Boolean(n&&n.segmentSyncInfo&&n.segmentSyncInfo.isAppended),u=new N2({start:o,end:l,appended:c,segmentIndex:t});e.syncInfo=u;let d=s;const h=(e.parts||[]).map((e,i)=>{const s=d,o=d+e.duration,l=Boolean(n&&n.partsSyncInfo&&n.partsSyncInfo[i]&&n.partsSyncInfo[i].isAppended),c=new N2({start:s,end:o,appended:l,segmentIndex:t,partIndex:i});return d=o,r+=`Media Sequence: ${a}.${i} | Range: ${s} --\x3e ${o} | Appended: ${l}\n`,e.syncInfo=c,c});i.set(a,new P2(u,h)),r+=`${H1(e.resolvedUri)} | Media Sequence: ${a} | Range: ${o} --\x3e ${l} | Appended: ${c}\n`,a++,s=l}),this.end_=s,this.storage_=i,this.diagnostics_=r}calculateBaseTime_(e,t,n){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const i=Math.min(...this.storage_.keys());if(e<i){const n=i-e;let r=this.storage_.get(i).segmentSyncInfo.start;for(let e=0;e<n;e++){r-=t[e].duration}return r}return n}isReliablePlaylist_(e,t){return null!=e&&Array.isArray(t)&&t.length}}class O2 extends D2{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,n){if(!this.storage_.size){const t=this.parent_.getSyncInfoForMediaSequence(e);return t?t.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,n)}}const L2=[{name:"VOD",run:(e,t,n,i,r)=>{if(n!==1/0){return{time:0,segmentIndex:0,partIndex:null}}return null}},{name:"MediaSequence",run:(e,t,n,i,r,s)=>{const a=e.getMediaSequenceSync(s);if(!a)return null;if(!a.isReliable)return null;const o=a.getSyncInfoForTime(r);return o?{time:o.start,partIndex:o.partIndex,segmentIndex:o.segmentIndex}:null}},{name:"ProgramDateTime",run:(e,t,n,i,r)=>{if(!Object.keys(e.timelineToDatetimeMappings).length)return null;let s=null,a=null;const o=JJ(t);r=r||0;for(let l=0;l<o.length;l++){const n=o[t.endList||0===r?l:o.length-(l+1)],i=n.segment,c=e.timelineToDatetimeMappings[i.timeline];if(!c||!i.dateTimeObject)continue;let u=i.dateTimeObject.getTime()/1e3+c;if(i.parts&&"number"==typeof n.partIndex)for(let e=0;e<n.partIndex;e++)u+=i.parts[e].duration;const d=Math.abs(r-u);if(null!==a&&(0===d||a<d))break;a=d,s={time:u,segmentIndex:n.segmentIndex,partIndex:n.partIndex}}return s}},{name:"Segment",run:(e,t,n,i,r)=>{let s=null,a=null;r=r||0;const o=JJ(t);for(let l=0;l<o.length;l++){const e=o[t.endList||0===r?l:o.length-(l+1)],n=e.segment,c=e.part&&e.part.start||n&&n.start;if(n.timeline===i&&void 0!==c){const t=Math.abs(r-c);if(null!==a&&a<t)break;(!s||null===a||a>=t)&&(a=t,s={time:c,segmentIndex:e.segmentIndex,partIndex:e.partIndex})}}return s}},{name:"Discontinuity",run:(e,t,n,i,r)=>{let s=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length){let n=null;for(let i=0;i<t.discontinuityStarts.length;i++){const a=t.discontinuityStarts[i],o=t.discontinuitySequence+i+1,l=e.discontinuities[o];if(l){const e=Math.abs(r-l.time);if(null!==n&&n<e)break;(!s||null===n||n>=e)&&(n=e,s={time:l.time,segmentIndex:a,partIndex:null})}}}return s}},{name:"Playlist",run:(e,t,n,i,r)=>{if(t.syncInfo){return{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}}return null}}];class M2 extends DJ.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new D2,n=new O2(t),i=new O2(t);this.mediaSequenceStorage_={main:t,audio:n,vtt:i},this.logger_=zJ("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,n,i,r){if(t!==1/0){return L2.find(({name:e})=>"VOD"===e).run(this,e,t)}const s=this.runStrategies_(e,t,n,i,r);if(!s.length)return null;for(const a of s){const{syncPoint:t,strategy:n}=a,{segmentIndex:r,time:s}=t;if(r<0)continue;const o=s,l=o+e.segments[r].duration;if(this.logger_(`Strategy: ${n}. Current time: ${i}. selected segment: ${r}. Time: [${o} -> ${l}]}`),i>=o&&i<l)return this.logger_("Found sync point with exact match: ",t),t}return this.selectSyncPoint_(s,{key:"time",value:i})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const i=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return i.segmentIndex>0&&(i.time*=-1),Math.abs(i.time+s0({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:i.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,i,r){const s=[];for(let a=0;a<L2.length;a++){const o=L2[a],l=o.run(this,e,t,n,i,r);l&&(l.strategy=o.name,s.push({strategy:o.name,syncPoint:l}))}return s}selectSyncPoint_(e,t){let n=e[0].syncPoint,i=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy;for(let s=1;s<e.length;s++){const a=Math.abs(e[s].syncPoint[t.key]-t.value);a<i&&(i=a,n=e[s].syncPoint,r=e[s].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${r}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+("number"==typeof n.partIndex?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>86400)DJ.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);else for(let i=n-1;i>=0;i--){const n=e.segments[i];if(n&&void 0!==n.start){t.syncInfo={mediaSequence:e.mediaSequence+i,time:n.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),i=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:i.start}));const r=i.dateTimeObject;i.discontinuity&&t&&r&&(this.timelineToDatetimeMappings[i.timeline]=-r.getTime()/1e3)}timestampOffsetForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].time}mappingForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const i=e.segment,r=e.part;let s,a,o=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${o.time}] [mapping: ${o.mapping}]`)),s=e.startOfSegment,a=t.end+o.mapping;else{if(!o)return!1;s=t.start+o.mapping,a=t.end+o.mapping}return r&&(r.start=s,r.end=a),(!i.start||s<i.start)&&(i.start=s),i.end=a,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let i=0;i<t.discontinuityStarts.length;i++){const r=t.discontinuityStarts[i],s=t.discontinuitySequence+i+1,a=r-e.mediaIndex,o=Math.abs(a);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>o){let i;i=a<0?n.start-s0({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):n.end+s0({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[s]={time:i,accuracy:o}}}}dispose(){this.trigger("dispose"),this.off()}}class F2 extends DJ.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return"number"==typeof t&&"number"==typeof n&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){if("number"==typeof t&&"number"==typeof n){this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e];const i={timelineChangeInfo:{from:t,to:n}};this.trigger({type:"timelinechange",metadata:i})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const $2=u1(d1(function(){var e=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();
/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */let t=null;class n{constructor(e){let n,i,r;t||(t=function(){const e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],i=t[4],r=n[4];let s,a,o;const l=[],c=[];let u,d,h,p,f,m;for(s=0;s<256;s++)c[(l[s]=s<<1^283*(s>>7))^s]=s;for(a=o=0;!i[a];a^=u||1,o=c[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^255&p^99,i[a]=p,r[p]=a,h=l[d=l[u=l[a]]],m=16843009*h^65537*d^257*u^16843008*a,f=257*l[p]^16843008*p,s=0;s<4;s++)t[s][a]=f=f<<24^f>>>8,n[s][p]=m=m<<24^m>>>8;for(s=0;s<5;s++)t[s]=t[s].slice(0),n[s]=n[s].slice(0);return e}()),this._tables=[[t[0][0].slice(),t[0][1].slice(),t[0][2].slice(),t[0][3].slice(),t[0][4].slice()],[t[1][0].slice(),t[1][1].slice(),t[1][2].slice(),t[1][3].slice(),t[1][4].slice()]];const s=this._tables[0][4],a=this._tables[1],o=e.length;let l=1;if(4!==o&&6!==o&&8!==o)throw new Error("Invalid aes key size");const c=e.slice(0),u=[];for(this._key=[c,u],n=o;n<4*o+28;n++)r=c[n-1],(n%o===0||8===o&&n%o===4)&&(r=s[r>>>24]<<24^s[r>>16&255]<<16^s[r>>8&255]<<8^s[255&r],n%o===0&&(r=r<<8^r>>>24^l<<24,l=l<<1^283*(l>>7))),c[n]=c[n-o]^r;for(i=0;n;i++,n--)r=c[3&i?n:n-4],u[i]=n<=4||i<4?r:a[0][s[r>>>24]]^a[1][s[r>>16&255]]^a[2][s[r>>8&255]]^a[3][s[255&r]]}decrypt(e,t,n,i,r,s){const a=this._key[1];let o,l,c,u=e^a[0],d=i^a[1],h=n^a[2],p=t^a[3];const f=a.length/4-2;let m,g=4;const b=this._tables[1],y=b[0],v=b[1],T=b[2],x=b[3],_=b[4];for(m=0;m<f;m++)o=y[u>>>24]^v[d>>16&255]^T[h>>8&255]^x[255&p]^a[g],l=y[d>>>24]^v[h>>16&255]^T[p>>8&255]^x[255&u]^a[g+1],c=y[h>>>24]^v[p>>16&255]^T[u>>8&255]^x[255&d]^a[g+2],p=y[p>>>24]^v[u>>16&255]^T[d>>8&255]^x[255&h]^a[g+3],g+=4,u=o,d=l,h=c;for(m=0;m<4;m++)r[(3&-m)+s]=_[u>>>24]<<24^_[d>>16&255]<<16^_[h>>8&255]<<8^_[255&p]^a[g++],o=u,u=d,d=h,h=p,p=o}}class i extends e{constructor(){super(e),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const r=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24};class s{constructor(e,t,n,a){const o=s.STEP,l=new Int32Array(e.buffer),c=new Uint8Array(e.byteLength);let u=0;for(this.asyncStream_=new i,this.asyncStream_.push(this.decryptChunk_(l.subarray(u,u+o),t,n,c)),u=o;u<l.length;u+=o)n=new Uint32Array([r(l[u-4]),r(l[u-3]),r(l[u-2]),r(l[u-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(u,u+o),t,n,c));this.asyncStream_.push(function(){var e;
/*! @name aes-decrypter @version 4.0.2 @license Apache-2.0 */a(null,(e=c).subarray(0,e.byteLength-e[e.byteLength-1]))})}static get STEP(){return 32e3}decryptChunk_(e,t,i,s){return function(){const a=function(e,t,i){const s=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),a=new n(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),l=new Int32Array(o.buffer);let c,u,d,h,p,f,m,g,b;for(c=i[0],u=i[1],d=i[2],h=i[3],b=0;b<s.length;b+=4)p=r(s[b]),f=r(s[b+1]),m=r(s[b+2]),g=r(s[b+3]),a.decrypt(p,f,m,g,l,b),l[b]=r(l[b]^c),l[b+1]=r(l[b+1]^u),l[b+2]=r(l[b+2]^d),l[b+3]=r(l[b+3]^h),c=p,u=f,d=m,h=g;return o}(e,t,i);s.set(a,e.byteOffset)}}}var a,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};a="undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{};var l=a.BigInt||Number;l("0x1"),l("0x100"),l("0x10000"),l("0x1000000"),l("0x100000000"),l("0x10000000000"),l("0x1000000000000"),l("0x100000000000000"),l("0x10000000000000000"),function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();const c=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];!function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer}(i)?t[n]=i:t[n]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}}),t};self.onmessage=function(e){const t=e.data,n=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),i=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),r=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new s(n,i,r,function(e,n){self.postMessage(c({source:t.source,decrypted:n}),[n.buffer])})}}));var B2=c1($2);const z2=e=>{let t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},U2=(e,t)=>{e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},G2=(e,t)=>{t.activePlaylistLoader=e,e.load()},V2={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:n},excludePlaylist:i}=t,r=n.activeTrack(),s=n.activeGroup(),a=(s.filter(e=>e.default)[0]||s[0]).id,o=n.tracks[a];if(r!==o){DJ.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const e in n.tracks)n.tracks[e].enabled=n.tracks[e]===o;n.onTrackChanged()}else i({error:{message:"Problem encountered loading the default audio track."}})},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:n}}=t;DJ.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const i=n.activeTrack();i&&(i.mode="disabled"),n.onTrackChanged()}},H2={AUDIO:(e,t,n)=>{if(!t)return;const{tech:i,requestOptions:r,segmentLoaders:{[e]:s}}=n;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),(!i.paused()||e.endList&&"none"!==i.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),i.paused()||s.load()}),t.on("error",V2[e](e,n))},SUBTITLES:(e,t,n)=>{const{tech:i,requestOptions:r,segmentLoaders:{[e]:s},mediaTypes:{[e]:a}}=n;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),s.track(a.activeTrack()),(!i.paused()||e.endList&&"none"!==i.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),i.paused()||s.load()}),t.on("error",V2[e](e,n))}},W2={AUDIO:(e,t)=>{const{vhs:n,sourceType:i,segmentLoaders:{[e]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[e]:{groups:o,tracks:l,logger_:c}},mainPlaylistLoader:u}=t,d=f0(u.main);a[e]&&0!==Object.keys(a[e]).length||(a[e]={main:{default:{default:!0}}},d&&(a[e].main.default.playlists=u.main.playlists));for(const h in a[e]){o[h]||(o[h]=[]);for(const r in a[e][h]){let p,f=a[e][h][r];if(d?(c(`AUDIO group '${h}' label '${r}' is a main playlist`),f.isMainPlaylist=!0,p=null):p="vhs-json"===i&&f.playlists?new $0(f.playlists[0],n,s):f.resolvedUri?new $0(f.resolvedUri,n,s):f.playlists&&"dash"===i?new a1(f.playlists[0],n,s,u):null,f=UJ({id:r,playlistLoader:p},f),H2[e](e,f.playlistLoader,t),o[h].push(f),void 0===l[r]){const e=new DJ.AudioTrack({id:r,kind:z2(f),enabled:!1,language:f.language,default:f.default,label:r});l[r]=e}}}r.on("error",V2[e](e,t))},SUBTITLES:(e,t)=>{const{tech:n,vhs:i,sourceType:r,segmentLoaders:{[e]:s},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[e]:{groups:l,tracks:c}},mainPlaylistLoader:u}=t;for(const d in o[e]){l[d]||(l[d]=[]);for(const s in o[e][d]){if(!i.options_.useForcedSubtitles&&o[e][d][s].forced)continue;let h,p=o[e][d][s];if("hls"===r)h=new $0(p.resolvedUri,i,a);else if("dash"===r){if(!p.playlists.filter(e=>e.excludeUntil!==1/0).length)return;h=new a1(p.playlists[0],i,a,u)}else"vhs-json"===r&&(h=new $0(p.playlists?p.playlists[0]:p.resolvedUri,i,a));if(p=UJ({id:s,playlistLoader:h},p),H2[e](e,p.playlistLoader,t),l[d].push(p),void 0===c[s]){const e=n.addRemoteTextTrack({id:s,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:s},!1).track;c[s]=e}}}s.on("error",V2[e](e,t))},"CLOSED-CAPTIONS":(e,t)=>{const{tech:n,main:{mediaGroups:i},mediaTypes:{[e]:{groups:r,tracks:s}}}=t;for(const a in i[e]){r[a]||(r[a]=[]);for(const t in i[e][a]){const o=i[e][a][t];if(!/^(?:CC|SERVICE)/.test(o.instreamId))continue;const l=n.options_.vhs&&n.options_.vhs.captionServices||{};let c={label:t,language:o.language,instreamId:o.instreamId,default:o.default&&o.autoselect};if(l[c.instreamId]&&(c=UJ(c,l[c.instreamId])),void 0===c.default&&delete c.default,r[a].push(UJ({id:t},o)),void 0===s[t]){const e=n.addRemoteTextTrack({id:c.instreamId,kind:"captions",default:c.default,language:c.language,label:c.label},!1).track;s[t]=e}}}}},j2=(e,t)=>{for(let n=0;n<e.length;n++){if(h0(t,e[n]))return!0;if(e[n].playlists&&j2(e[n].playlists,t))return!0}return!1},q2={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if(n[e].enabled)return n[e];return null},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if("showing"===n[e].mode||"hidden"===n[e].mode)return n[e];return null}},X2=e=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{W2[t](t,e)});const{mediaTypes:t,mainPlaylistLoader:n,tech:i,vhs:r,segmentLoaders:{AUDIO:s,main:a}}=e;["AUDIO","SUBTITLES"].forEach(n=>{t[n].activeGroup=((e,t)=>n=>{const{mainPlaylistLoader:i,mediaTypes:{[e]:{groups:r}}}=t,s=i.media();if(!s)return null;let a=null;s.attributes[e]&&(a=r[s.attributes[e]]);const o=Object.keys(r);if(!a)if("AUDIO"===e&&o.length>1&&f0(t.main))for(let e=0;e<o.length;e++){const t=r[o[e]];if(j2(t,s)){a=t;break}}else r.main?a=r.main:1===o.length&&(a=r[o[0]]);return void 0===n?a:null!==n&&a&&a.filter(e=>e.id===n.id)[0]||null})(n,e),t[n].activeTrack=q2[n](n,e),t[n].onGroupChanged=((e,t)=>()=>{const{segmentLoaders:{[e]:n,main:i},mediaTypes:{[e]:r}}=t,s=r.activeTrack(),a=r.getActiveGroup(),o=r.activePlaylistLoader,l=r.lastGroup_;a&&l&&a.id===l.id||(r.lastGroup_=a,r.lastTrack_=s,U2(n,r),a&&!a.isMainPlaylist&&(a.playlistLoader?(n.resyncLoader(),G2(a.playlistLoader,r)):o&&i.resetEverything()))})(n,e),t[n].onGroupChanging=((e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:i}}=t;i.lastGroup_=null,n.abort(),n.pause()})(n,e),t[n].onTrackChanged=((e,t)=>()=>{const{mainPlaylistLoader:n,segmentLoaders:{[e]:i,main:r},mediaTypes:{[e]:s}}=t,a=s.activeTrack(),o=s.getActiveGroup(),l=s.activePlaylistLoader,c=s.lastTrack_;if((!c||!a||c.id!==a.id)&&(s.lastGroup_=o,s.lastTrack_=a,U2(i,s),o)){if(o.isMainPlaylist){if(!a||!c||a.id===c.id)return;const e=t.vhs.playlistController_,i=e.selectPlaylist();if(e.media()===i)return;return s.logger_(`track change. Switching main audio from ${c.id} to ${a.id}`),n.pause(),r.resetEverything(),void e.fastQualityChange_(i)}if("AUDIO"===e){if(!o.playlistLoader)return r.setAudio(!0),void r.resetEverything();i.setAudio(!0),r.setAudio(!1)}l!==o.playlistLoader?(i.track&&i.track(a),i.resetEverything(),G2(o.playlistLoader,s)):G2(o.playlistLoader,s)}})(n,e),t[n].getActiveGroup=((e,{mediaTypes:t})=>()=>{const n=t[e].activeTrack();return n?t[e].activeGroup(n):null})(n,e)});const o=t.AUDIO.activeGroup();if(o){const e=(o.filter(e=>e.default)[0]||o[0]).id;t.AUDIO.tracks[e].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged();t.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}n.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanged())}),n.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanging())});const l=()=>{t.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"vhs-audio-change"})};i.audioTracks().addEventListener("change",l),i.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",()=>{i.audioTracks().removeEventListener("change",l),i.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),i.clearTracks("audio");for(const c in t.AUDIO.tracks)i.audioTracks().addTrack(t.AUDIO.tracks[c])};class K2{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){1===e&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=$J(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(e=>[e.ID,e])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class Y2 extends DJ.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new K2,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=zJ("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n)return this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),void this.trigger("error");n.startsWith("data:")?this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1)):(this.steeringManifest.reloadUri=$J(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering"))}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n)return this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),void this.dispose();const i={contentSteeringInfo:{uri:n}};this.trigger({type:"contentsteeringloadstart",metadata:i}),this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(e,t)=>{if(e){if(410===t.status)return this.logger_(`manifest request 410 ${e}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),void this.excludedSteeringManifestURLs.add(n);if(429===t.status){const n=t.responseHeaders["retry-after"];return this.logger_(`manifest request 429 ${e}.`),this.logger_(`content steering will retry in ${n} seconds.`),void this.startTTLTimeout_(parseInt(n,10))}return this.logger_(`manifest failed to load ${e}.`),void this.startTTLTimeout_()}let r;this.trigger({type:"contentsteeringloadcomplete",metadata:i});try{r=JSON.parse(this.request_.responseText)}catch(a){const e={errorType:DJ.Error.StreamingContentSteeringParserError,error:a};this.trigger({type:"error",metadata:e})}this.assignSteeringProperties_(r);const s={contentSteeringInfo:i.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:s}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new ZG.URL(e),n=new ZG.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(ZG.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new ZG.URL(e),n=this.getPathway(),i=this.getBandwidth_();if(n){const e=`_${this.manifestType_}_pathway`;t.searchParams.set(e,n)}if(i){const e=`_${this.manifestType_}_throughput`;t.searchParams.set(e,i)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version)return this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),void this.trigger("error");this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const t=(e=>{for(const t of e)if(this.availablePathways_.has(t))return t;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==t&&(this.currentPathway=t,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=e=>this.excludedSteeringManifestURLs.has(e);if(this.proxyServerUrl_){const n=this.setProxyServerUrl_(e);if(!t(n))return n}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const t=1e3*e;this.ttlTimeout_=ZG.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){ZG.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new K2}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&($J(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}let Z2;const Q2=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],J2=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]};class e3 extends DJ.EventTarget{constructor(e){super(),this.fastQualityChange_=((e,t)=>{let n=null;return(...i)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(null,i)},t)}})(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:n,tech:i,bandwidth:r,externVhs:s,useCueTags:a,playlistExclusionDuration:o,enableLowInitialPlaylist:l,sourceType:c,cacheEncryptionKeys:u,bufferBasedABR:d,leastPixelDiffSelector:h,captionServices:p,experimentalUseMMS:f}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:m}=e;null==m&&(m=1/0),Z2=s,this.bufferBasedABR=Boolean(d),this.leastPixelDiffSelector=Boolean(h),this.withCredentials=n,this.tech_=i,this.vhs_=i.vhs,this.player_=e.player_,this.sourceType_=c,this.useCueTags_=a,this.playlistExclusionDuration=o,this.maxPlaylistRetries=m,this.enableLowInitialPlaylist=l,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:m,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=(()=>{const e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:a2,activeTrack:a2,getActiveGroup:a2,onGroupChanged:a2,onTrackChanged:a2,lastTrack_:null,logger_:zJ(`MediaGroups[${t}]`)}}),e})(),f&&ZG.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new ZG.ManagedMediaSource,this.usingManagedMediaSource_=!0,DJ.log("Using ManagedMediaSource")):ZG.MediaSource&&(this.mediaSource=new ZG.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=GJ(),this.hasPlayed_=!1,this.syncController_=new M2(e),this.segmentMetadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new B2,this.sourceUpdater_=new I2(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new F2,this.keyStatusMap_=new Map;const g={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:p,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:r,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:u,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_="dash"===this.sourceType_?new a1(t,this.vhs_,UJ(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new $0(t,this.vhs_,UJ(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new s2(UJ(g,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new s2(UJ(g,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new A2(UJ(g,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((e,t)=>{function n(){i.off("vttjserror",r),e()}function r(){i.off("vttjsloaded",n),t()}i.one("vttjsloaded",n),i.one("vttjserror",r),i.addWebVttScript_()})}),e);this.contentSteeringController_=new Y2(this.vhs_.xhr,()=>this.mainSegmentLoader_.bandwidth),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),Q2.forEach(e=>{this[e+"_"]=J2.bind(this,e)}),this.logger_=zJ("pc"),this.triggeredFmp4Usage=!1,"none"===this.tech_.preload()?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const b="none"===this.tech_.preload()?"play":"loadstart";this.tech_.one(b,()=>{const e=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-e,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const i=this.media(),r=i&&(i.id||i.uri),s=e&&(e.id||e.uri);if(r&&r!==s){this.logger_(`switch media ${r} -> ${s} from ${t}`);const n={renditionInfo:{id:s,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:n}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,i=this.contentSteeringController_.getPathway();if(n&&i){const t=(n.length?n[0].playlists:n.playlists).filter(e=>e.attributes.serviceLocation===i);t.length&&this.mediaTypes_[e].activePlaylistLoader.media(t[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=ZG.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(ZG.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,i=Object.keys(n);let r;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)r=this.mediaTypes_.AUDIO.activeTrack();else{const e=n.main||i.length&&n[i[0]];for(const t in e)if(e[t].default){r={label:t};break}}if(!r)return t;const s=[];for(const a in n)if(n[a][r.label]){const t=n[a][r.label];if(t.playlists&&t.playlists.length)s.push.apply(s,t.playlists);else if(t.uri)s.push(t);else if(e.playlists.length)for(let n=0;n<e.playlists.length;n++){const t=e.playlists[n];t.attributes&&t.attributes.AUDIO&&t.attributes.AUDIO===a&&s.push(t)}}return s.length?s:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;d0(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&"none"!==this.tech_.preload()&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),X2({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){let t;if(this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_(),this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t))return;this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial");if(!("vhs-json"===this.sourceType_&&this.initialMedia_.segments))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;d0(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,"dash"===this.sourceType_&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if("playlist-unchanged"===e.lastExcludeReason_)return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})});["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(e=>{this.mainPlaylistLoader_.on(e,e=>{this.player_.trigger(a({},e))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let i=!0;const r=Object.keys(n.AUDIO);for(const s in n.AUDIO)for(const e in n.AUDIO[s]){n.AUDIO[s][e].uri||(i=!1)}i&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Z2.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),r.length&&Object.keys(n.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),i=this.bufferLowWaterLine(),r=this.bufferHighWaterLine();return function({currentPlaylist:e,buffered:t,currentTime:n,nextPlaylist:i,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:a,bufferBasedABR:o,log:l}){if(!i)return DJ.log.warn("We received no playlist to switch to. Please check your stream."),!1;const c=`allowing switch ${e&&e.id||"null"} -> ${i.id}`;if(!e)return l(`${c} as current playlist is not set`),!0;if(i.id===e.id)return!1;const u=Boolean(jJ(t,n).length);if(!e.endList)return u||"number"!=typeof e.partTargetDuration?(l(`${c} as current playlist is live`),!0):(l(`not ${c} as current playlist is live llhls, but currentTime isn't in buffered.`),!1);const d=ZJ(t,n),h=o?o1.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:o1.MAX_BUFFER_LOW_WATER_LINE;if(a<h)return l(`${c} as duration < max low water line (${a} < ${h})`),!0;const p=i.attributes.BANDWIDTH,f=e.attributes.BANDWIDTH;if(p<f&&(!o||d<s)){let e=`${c} as next bandwidth < current bandwidth (${p} < ${f})`;return o&&(e+=` and forwardBuffer < bufferHighWaterLine (${d} < ${s})`),l(e),!0}if((!o||p>f)&&d>=r){let e=`${c} as forwardBuffer >= bufferLowWaterLine (${d} >= ${r})`;return o&&(e+=` and next bandwidth > current bandwidth (${p} > ${f})`),l(e),!0}return l(`not ${c} as no switching criteria met`),!1}({buffered:this.tech_.buffered(),currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:i,bufferHighWaterLine:r,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const e=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const e=this.audioSegmentLoader_.pendingSegment_;if(!e||!e.segment||!e.segment.syncInfo)return;const t=e.segment.syncInfo.end+.01;this.tech_.setCurrentTime(t)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",e=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:10}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const e=this.getCodecsOrExclude_();e&&this.sourceUpdater_.addOrChangeSourceBuffers(e)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()});["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(e=>{this.mainSegmentLoader_.on(e,e=>{this.player_.trigger(a({},e))}),this.audioSegmentLoader_.on(e,e=>{this.player_.trigger(a({},e))}),this.subtitleSegmentLoader_.on(e,e=>{this.player_.trigger(a({},e))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){e&&e===this.mainPlaylistLoader_.media()?this.logger_("skipping fastQualityChange because new media is same as old"):(this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0)}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let i=n;if(e.start){const r=e.start.timeOffset;i=r<0?Math.max(n+r,t.start(0)):Math.min(n,r)}this.trigger("firstplay"),this.tech_.setCurrentTime(i)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,e=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;const n=Z2.Playlist.playlistEnd(e,t),i=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return n-i<=HJ;const s=r.end(r.length-1);return s-i<=HJ&&n-s<=HJ}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));e.playlistErrors_++;const i=this.mainPlaylistLoader_.main.playlists,r=i.filter(c0),s=1===r.length&&r[0]===e;if(1===i.length&&n!==1/0)return DJ.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(s);if(s){if(this.main().contentSteering){const t=this.pathwayAttribute_(e),n=1e3*this.contentSteeringController_.steeringManifest.ttl;return this.contentSteeringController_.excludePathway(t),this.excludeThenChangePathway_(),void setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(t)},n)}let t=!1;i.forEach(n=>{if(n===e)return;const i=n.excludeUntil;void 0!==i&&i!==1/0&&(t=!0,delete n.excludeUntil)}),t&&(DJ.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let a;a=e.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*n,e.excludeUntil=a,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const o=this.selectPlaylist();if(!o)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");const l=t.internal?this.logger_:DJ.log.warn,c=t.message?" "+t.message:"";l(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${c} Switching to playlist ${o.id}.`),o.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),o.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const u=o.targetDuration/2*1e3||5e3,d="number"==typeof o.lastRequest&&Date.now()-o.lastRequest<=u;return this.switchMedia_(o,"exclude",s||d)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],i="all"===e;(i||"main"===e)&&n.push(this.mainPlaylistLoader_);const r=[];(i||"audio"===e)&&r.push("AUDIO"),(i||"subtitle"===e)&&(r.push("CLOSED-CAPTIONS"),r.push("SUBTITLES")),r.forEach(e=>{const t=this.mediaTypes_[e]&&this.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)}),["main","audio","subtitle"].forEach(t=>{const i=this[`${t}SegmentLoader_`];!i||e!==t&&"all"!==e||n.push(i)}),n.forEach(e=>t.forEach(t=>{"function"==typeof e[t]&&e[t]()}))}setCurrentTime(e){const t=jJ(this.tech_.buffered(),e);return this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media()&&this.mainPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),void this.load()):0}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Z2.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const n=e.media();if(!n)return null;const i=this.syncController_.getMediaSequenceSync(t);if(i&&i.isReliable){const e=i.start,t=i.end;if(!isFinite(e)||!isFinite(t))return null;const r=Z2.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n);return GJ([[e,Math.max(e,t-r)]])}const r=this.syncController_.getExpiredTime(n,this.duration());if(null===r)return null;const s=Z2.Playlist.seekable(n,r,Z2.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n));return s.length?s:null}computeFinalSeekable_(e,t){if(!t)return e;const n=e.start(0),i=e.end(0),r=t.start(0),s=t.end(0);return r>i||n>s?e:GJ([[Math.max(n,r),Math.min(i,s)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const n=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_)return;if(n&&n.length&&this.seekable_.length&&n.start(0)===this.seekable_.start(0)&&n.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${XJ(this.seekable_)}]`);const i={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:i}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){const e=this.seekable();if(!e.length)return;return void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)))}const t=this.tech_.buffered();let n=Z2.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(e=>{e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=A0(this.main(),t),i={},r=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(i.video=n.video||e.main.videoCodec||"avc1.4d400d"),e.main.isMuxed&&(i.video+=`,${n.audio||e.main.audioCodec||CH}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||r)&&(i.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||CH,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!i.audio&&!i.video)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});const s=(e,t)=>e?IH(t,this.usingManagedMediaSource_):kH(t),a={};let o;if(["video","audio"].forEach(function(t){if(i.hasOwnProperty(t)&&!s(e[t].isFmp4,i[t])){const n=e[t].isFmp4?"browser":"muxer";a[n]=a[n]||[],a[n].push(i[t]),"audio"===t&&(o=n)}}),r&&o&&t.attributes.AUDIO){const e=t.attributes.AUDIO;this.main().playlists.forEach(n=>{(n.attributes&&n.attributes.AUDIO)===e&&n!==t&&(n.excludeUntil=1/0)}),this.logger_(`excluding audio group ${e} as ${o} does not support codec(s): "${i.audio}"`)}if(Object.keys(a).length){const e=Object.keys(a).reduce((e,t)=>(e&&(e+=", "),e+=`${t} does not support codec(s): "${a[t].join(",")}"`),"")+".";return void this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:e},playlistExclusionDuration:1/0})}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const e=[];if(["video","audio"].forEach(t=>{const n=(_H(this.sourceUpdater_.codecs[t]||"")[0]||{}).type,r=(_H(i[t]||"")[0]||{}).type;n&&r&&n.toLowerCase()!==r.toLowerCase()&&e.push(`"${this.sourceUpdater_.codecs[t]}" -> "${i[t]}"`)}),e.length)return void this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${e.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0})}return i}tryToCreateSourceBuffers_(){if("open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers())return;if(!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const i=e[n];if(-1!==t.indexOf(i.id))return;t.push(i.id);const r=A0(this.main,i),s=[];!r.audio||kH(r.audio)||IH(r.audio,this.usingManagedMediaSource_)||s.push(`audio codec ${r.audio}`),!r.video||kH(r.video)||IH(r.video,this.usingManagedMediaSource_)||s.push(`video codec ${r.video}`),r.text&&"stpp.ttml.im1t"===r.text&&s.push(`text codec ${r.text}`),s.length&&(i.excludeUntil=1/0,this.logger_(`excluding ${i.id} for unsupported: ${s.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,i=C0(_H(e)),r=E0(i),s=i.video&&_H(i.video)[0]||null,a=i.audio&&_H(i.audio)[0]||null;Object.keys(n).forEach(e=>{const i=n[e];if(-1!==t.indexOf(i.id)||i.excludeUntil===1/0)return;t.push(i.id);const o=[],l=A0(this.mainPlaylistLoader_.main,i),c=E0(l);if(l.audio||l.video){if(c!==r&&o.push(`codec count "${c}" !== "${r}"`),!this.sourceUpdater_.canChangeType()){const e=l.video&&_H(l.video)[0]||null,t=l.audio&&_H(l.audio)[0]||null;e&&s&&e.type.toLowerCase()!==s.type.toLowerCase()&&o.push(`video codec "${e.type}" !== "${s.type}"`),t&&a&&t.type.toLowerCase()!==a.type.toLowerCase()&&o.push(`audio codec "${t.type}" !== "${a.type}"`)}o.length&&(i.excludeUntil=1/0,this.logger_(`excluding ${i.id}: ${o.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),function(e,t,n=0){if(!e.segments)return;let i,r=n;for(let s=0;s<e.segments.length;s++){const n=e.segments[s];if(i||(i=R2(t,r+n.duration/2)),i){if("cueIn"in n){i.endTime=r,i.adEndTime=r,r+=n.duration,i=null;continue}if(r<i.endTime){r+=n.duration;continue}i.endTime+=n.duration}else if("cueOut"in n&&(i=new ZG.VTTCue(r,r+n.duration,n.cueOut),i.adStartTime=r,i.adEndTime=r+parseFloat(n.cueOut),t.addCue(i)),"cueOutCont"in n){const[e,s]=n.cueOutCont.split("/").map(parseFloat);i=new ZG.VTTCue(r,r+n.duration,""),i.adStartTime=r-e,i.adEndTime=i.adStartTime+s,t.addCue(i)}r+=n.duration}}(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=o1.GOAL_BUFFER_LENGTH,n=o1.GOAL_BUFFER_LENGTH_RATE,i=Math.max(t,o1.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,i)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=o1.BUFFER_LOW_WATER_LINE,n=o1.BUFFER_LOW_WATER_LINE_RATE,i=Math.max(t,o1.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,o1.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?r:i)}bufferHighWaterLine(){return o1.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){X1(this.inbandTextTracks_,"com.apple.streaming",this.tech_),(({inbandTextTracks:e,dateRanges:t})=>{const n=e.metadataTrack_;if(!n)return;const i=ZG.WebKitDataCue||ZG.VTTCue;t.forEach(e=>{for(const t of Object.keys(e)){if(q1.has(t))continue;const r=new i(e.startTime,e.endTime,"");r.id=e.id,r.type="com.apple.quicktime.HLS",r.value={key:j1[t],data:e[t]},"scte35Out"!==t&&"scte35In"!==t||(r.value.data=new Uint8Array(r.value.data.match(/[\da-f]{2}/gi)).buffer),n.addCue(r)}e.processDateRange()})})({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const i=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();X1(this.inbandTextTracks_,e,this.tech_),W1({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:i,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart?this.contentSteeringController_.requestSteeringManifest(!0):this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this));["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(e=>{this.contentSteeringController_.on(e,e=>{this.trigger(a({},e))})}),"dash"===this.sourceType_&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const e=this.main();(this.contentSteeringController_.didDASHTagChange(e.uri,e.contentSteering)||(()=>{const t=this.contentSteeringController_.getAvailablePathways(),n=[];for(const i of e.playlists){const e=i.attributes.serviceLocation;if(e&&(n.push(e),!t.has(e)))return!0}return!(n.length||!t.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const t=this.main().playlists,n=new Set;let i=!1;Object.keys(t).forEach(r=>{const s=t[r],a=this.pathwayAttribute_(s),o=a&&e!==a;s.excludeUntil===1/0&&"content-steering"===s.lastExcludeReason_&&!o&&(delete s.excludeUntil,delete s.lastExcludeReason_,i=!0);const l=!s.excludeUntil&&s.excludeUntil!==1/0;!n.has(s.id)&&o&&l&&(n.add(s.id),s.excludeUntil=1/0,s.lastExcludeReason_="content-steering",this.logger_(`excluding ${s.id} for ${s.lastExcludeReason_}`))}),"DASH"===this.contentSteeringController_.manifestType_&&Object.keys(this.mediaTypes_).forEach(t=>{const n=this.mediaTypes_[t];if(n.activePlaylistLoader){const t=n.activePlaylistLoader.media_;t&&t.attributes.serviceLocation!==e&&(i=!0)}}),i&&this.changeSegmentPathway_()}handlePathwayClones_(){const e=this.main().playlists,t=this.contentSteeringController_.currentPathwayClones,n=this.contentSteeringController_.nextPathwayClones;if(t&&t.size||n&&n.size){for(const[e,i]of t.entries()){n.get(e)||(this.mainPlaylistLoader_.updateOrDeleteClone(i),this.contentSteeringController_.excludePathway(e))}for(const[i,r]of n.entries()){const n=t.get(i);if(!n){e.filter(e=>e.attributes["PATHWAY-ID"]===r["BASE-ID"]).forEach(e=>{this.mainPlaylistLoader_.addClonePathway(r,e)}),this.contentSteeringController_.addAvailablePathway(i);continue}this.equalPathwayClones_(n,r)||(this.mainPlaylistLoader_.updateOrDeleteClone(r,!0),this.contentSteeringController_.addAvailablePathway(i))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...n])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,i=t["URI-REPLACEMENT"].PARAMS;for(const r in n)if(n[r]!==i[r])return!1;for(const r in i)if(n[r]!==i[r])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),"DASH"===this.contentSteeringController_.manifestType_&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const i=this.mainPlaylistLoader_.getKeyIdSet(n);i&&i.size&&i.forEach(i=>{const r="usable",s=this.keyStatusMap_.has(i)&&this.keyStatusMap_.get(i)===r,a=n.lastExcludeReason_===t&&n.excludeUntil===1/0;s?s&&a&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${i} is ${r}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_(`excluding playlist ${n.id} because the key ID ${i} doesn't exist in the keyStatusMap or is not ${r}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(e=>{const n=e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height<720,i=e.excludeUntil===1/0&&e.lastExcludeReason_===t;n&&i&&(delete e.excludeUntil,DJ.log.warn(`enabling non-HD playlist ${e.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const n=("string"==typeof e?e:(e=>{const t=new Uint8Array(e);return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")})(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${n} added to the keyStatusMap`),this.keyStatusMap_.set(n,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}class t3{constructor(e,t,n){const{playlistController_:i}=e,r=i.fastQualityChange_.bind(i);if(t.attributes){const e=t.attributes.RESOLUTION;this.width=e&&e.width,this.height=e&&e.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}var s,a,o;this.codecs=A0(i.main(),t),this.playlist=t,this.id=n,this.enabled=(s=e.playlists,a=t.id,o=r,e=>{const t=s.main.playlists[a],n=l0(t),i=c0(t);if(void 0===e)return i;e?delete t.disabled:t.disabled=!0;const r={renditionInfo:{id:a,bandwidth:t.attributes.BANDWIDTH,resolution:t.attributes.RESOLUTION,codecs:t.attributes.CODECS},cause:"fast-quality"};return e===i||n||(e?(o(t),s.trigger({type:"renditionenabled",metadata:r})):s.trigger({type:"renditiondisabled",metadata:r})),e})}}const n3=["seeking","seeked","pause","playing","error"];class i3 extends DJ.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=zJ("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),i=()=>this.techWaiting_(),r=()=>this.resetTimeUpdate_(),s=this.playlistController_,a=["main","subtitle","audio"],o={};a.forEach(e=>{o[e]={reset:()=>this.resetSegmentDownloads_(e),updateend:()=>this.checkSegmentDownloads_(e)},s[`${e}SegmentLoader_`].on("appendsdone",o[e].updateend),s[`${e}SegmentLoader_`].on("playlistupdate",o[e].reset),this.tech_.on(["seeked","seeking"],o[e].reset)});const l=e=>{["main","audio"].forEach(t=>{s[`${t}SegmentLoader_`][e]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),l("off"))},this.clearSeekingAppendCheck_=()=>l("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),l("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",i),this.tech_.on(n3,r),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",i),this.tech_.off(n3,r),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),a.forEach(e=>{s[`${e}SegmentLoader_`].off("appendsdone",o[e].updateend),s[`${e}SegmentLoader_`].off("playlistupdate",o[e].reset),this.tech_.off(["seeked","seeking"],o[e].reset)}),this.checkCurrentTimeTimeout_&&ZG.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&ZG.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=ZG.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],i=n.buffered_(),r=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e.start(n)!==t.start(n)||e.end(n)!==t.end(n))return!0;return!1}(this[`${e}Buffered_`],i);if(this[`${e}Buffered_`]=i,r){const n={bufferedRanges:i};return t.trigger({type:"bufferedrangeschanged",metadata:n}),void this.resetSegmentDownloads_(e)}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:KJ(i)}),this[`${e}StalledDownloads_`]<10||(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),"subtitle"!==e&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+HJ>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(GJ([this.lastRecordedTime,e]));const t={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:t}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const e=this.seekable(),t=this.tech_.currentTime();let n;if(this.afterSeekableWindow_(e,t,this.media(),this.allowSeeksWithinUnsafeLiveWindow)){n=e.end(e.length-1)}if(this.beforeSeekableWindow_(e,t)){const t=e.start(0);n=t+(t===e.end(0)?0:HJ)}if(void 0!==n)return this.logger_(`Trying to seek outside of seekable at time ${t} with seekable range ${XJ(e)}. Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0;const i=this.playlistController_.sourceUpdater_,r=this.tech_.buffered(),s=i.audioBuffer?i.audioBuffered():null,a=i.videoBuffer?i.videoBuffered():null,o=this.media(),l=o.partTargetDuration?o.partTargetDuration:2*(o.targetDuration-VJ),c=[s,a];for(let d=0;d<c.length;d++){if(!c[d])continue;if(ZJ(c[d],t)<l)return!1}const u=qJ(r,t);return 0!==u.length&&(n=u.start(0)+HJ,this.logger_(`Buffered region starts (${u.start(0)})  just beyond seek point (${t}). Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=jJ(t,e);return n.length&&e+3<=n.end(0)?(this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),void this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"})):void 0}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const n=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${n}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,i=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const r=qJ(i,t);return r.length>0&&(this.logger_(`Stopped at ${t} and seeking to ${r.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0)}afterSeekableWindow_(e,t,n,i=!1){if(!e.length)return!1;let r=e.end(e.length-1)+HJ;const s=!n.endList,a="number"==typeof n.partTargetDuration;return s&&(a||i)&&(r=e.end(e.length-1)+3*n.targetDuration),t>r}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let i;if(e.length&&t.length){const r=jJ(e,n-3),s=jJ(e,n),a=jJ(t,n);a.length&&!s.length&&r.length&&(i={start:r.end(0),end:a.end(0)})}else{qJ(e,n).length||(i=this.gapFromVideoUnderflow_(e,n))}return!!i&&(this.logger_(`Encountered a gap in video from ${i.start} to ${i.end}. Seeking to current time ${n}`),!0)}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),i=qJ(t,n);if(this.resetTimeUpdate_(),0===i.length||n!==e)return;this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",i.start(0)),this.tech_.setCurrentTime(i.start(0)+VJ);const r={gapInfo:{from:n,to:i.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:r}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const n=function(e){if(e.length<2)return GJ();const t=[];for(let n=1;n<e.length;n++){const i=e.end(n-1),r=e.start(n);t.push([i,r])}return GJ(t)}(e);for(let i=0;i<n.length;i++){const e=n.start(i),r=n.end(i);if(t-e<4&&t-e>2)return{start:e,end:r}}return null}}const r3={errorInterval:30,getSource(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},s3=function(e,t){let n=0,i=0;const r=UJ(r3,t);e.ready(()=>{e.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){i&&e.currentTime(i)},a=function(t){null!=t&&(i=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",s),e.src(t),e.trigger({type:"usage",name:"vhs-error-reload"}),e.play())},o=function(){if(Date.now()-n<1e3*r.errorInterval)e.trigger({type:"usage",name:"vhs-error-reload-canceled"});else{if(r.getSource&&"function"==typeof r.getSource)return n=Date.now(),r.getSource.call(e,a);DJ.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function(){e.off("loadedmetadata",s),e.off("error",o),e.off("dispose",l)};e.on("error",o),e.on("dispose",l),e.reloadSourceOnError=function(t){l(),s3(e,t)}},a3=function(e){s3(this,e)};var o3="3.17.0";const l3={PlaylistLoader:$0,Playlist:m0,utils:K0,STANDARD_PLAYLIST_SELECTOR:V1,INITIAL_PLAYLIST_SELECTOR:function(){const e=this.playlists.main.playlists.filter(m0.isEnabled);z1(e,(e,t)=>U1(e,t));return e.filter(e=>!!A0(this.playlists.main,e).video)[0]||null},lastBandwidthSelector:V1,movingAverageBandwidthSelector:function(e){let t=-1,n=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let i=this.useDevicePixelRatio&&ZG.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),t<0&&(t=this.systemBandwidth,n=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==n&&(t=e*this.systemBandwidth+(1-e)*t,n=this.systemBandwidth),G1({main:this.playlists.main,bandwidth:t,playerWidth:parseInt(B1(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(B1(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?B1(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},comparePlaylistBandwidth:U1,comparePlaylistResolution:function(e,t){let n,i;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||ZG.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(i=t.attributes.RESOLUTION.width),i=i||ZG.Number.MAX_VALUE,n===i&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-i},xhr:z0()};Object.keys(o1).forEach(e=>{Object.defineProperty(l3,e,{get:()=>(DJ.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),o1[e]),set(t){DJ.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),"number"!=typeof t||t<0?DJ.log.warn(`value of Vhs.${e} must be greater than or equal to 0`):o1[e]=t}})});const c3="videojs-vhs",u3=function(e,t){const n=t.media();let i=-1;for(let r=0;r<e.length;r++)if(e[r].id===n.id){i=r;break}e.selectedIndex_=i,e.trigger({selectedIndex:i,type:"change"})};l3.canPlaySource=function(){return DJ.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const d3=({player:e,sourceKeySystems:t,audioMedia:n,mainPlaylists:i})=>{if(!e.eme.initializeMediaKeys)return Promise.resolve();const r=((e,t)=>e.reduce((e,n)=>{if(!n.contentProtection)return e;const i=t.reduce((e,t)=>{const i=n.contentProtection[t];return i&&i.pssh&&(e[t]={pssh:i.pssh}),e},{});return Object.keys(i).length&&e.push(i),e},[]))(n?i.concat([n]):i,Object.keys(t)),s=[],a=[];return r.forEach(t=>{a.push(new Promise((t,n)=>{e.tech_.one("keysessioncreated",t)})),s.push(new Promise((n,i)=>{e.eme.initializeMediaKeys({keySystems:t},e=>{e?i(e):n()})}))}),Promise.race([Promise.all(s),Promise.race(a)])},h3=({player:e,sourceKeySystems:t,media:n,audioMedia:i})=>{const r=((e,t,n)=>{if(!e)return e;let i={};t&&t.attributes&&t.attributes.CODECS&&(i=C0(_H(t.attributes.CODECS))),n&&n.attributes&&n.attributes.CODECS&&(i.audio=n.attributes.CODECS);const r=wH(i.video),s=wH(i.audio),a={};for(const o in e)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(a[o].pssh=t.contentProtection[o].pssh),"string"==typeof e[o]&&(a[o].url=e[o]);return UJ(e,a)})(t,n,i);return!!r&&(e.currentSource().keySystems=r,!(r&&!e.eme)||(DJ.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},p3=()=>{if(!ZG.localStorage)return null;const e=ZG.localStorage.getItem(c3);if(!e)return null;try{return JSON.parse(e)}catch(r6){return null}},f3=(e,t)=>{e._requestCallbackSet||(e._requestCallbackSet=new Set),e._requestCallbackSet.add(t)},m3=(e,t)=>{e._responseCallbackSet||(e._responseCallbackSet=new Set),e._responseCallbackSet.add(t)},g3=(e,t)=>{e._requestCallbackSet&&(e._requestCallbackSet.delete(t),e._requestCallbackSet.size||delete e._requestCallbackSet)},b3=(e,t)=>{e._responseCallbackSet&&(e._responseCallbackSet.delete(t),e._responseCallbackSet.size||delete e._responseCallbackSet)};l3.supportsNativeHls=function(){if(!eV||!eV.createElement)return!1;const e=eV.createElement("video");if(!DJ.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),l3.supportsNativeDash=!!(eV&&eV.createElement&&DJ.getTech("Html5").isSupported())&&/maybe|probably/i.test(eV.createElement("video").canPlayType("application/dash+xml")),l3.supportsTypeNatively=e=>"hls"===e?l3.supportsNativeHls:"dash"===e&&l3.supportsNativeDash,l3.isSupported=function(){return DJ.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")},l3.xhr.onRequest=function(e){f3(l3.xhr,e)},l3.xhr.onResponse=function(e){m3(l3.xhr,e)},l3.xhr.offRequest=function(e){g3(l3.xhr,e)},l3.xhr.offResponse=function(e){b3(l3.xhr,e)};const y3=DJ.getComponent("Component");class v3 extends y3{constructor(e,t,n){if(super(t,n.vhs),"number"==typeof n.initialBandwidth&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=zJ("VhsHandler"),t.options_&&t.options_.playerId){const e=DJ.getPlayer(t.options_.playerId);this.player_=e}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(eV,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],e=>{const t=eV.fullscreenElement||eV.webkitFullscreenElement||eV.mozFullScreenElement||eV.msFullscreenElement;t&&t.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=UJ(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=void 0===this.options_.useNetworkInformationApi||this.options_.useNetworkInformationApi,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=!1!==this.options_.llhls,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,"number"!=typeof this.options_.playlistExclusionDuration&&(this.options_.playlistExclusionDuration=60),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){const e=p3();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=o1.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===o1.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(e=>{void 0!==this.source_[e]&&(this.options_[e]=this.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;"number"==typeof t&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;var n;this.setOptions_(),this.options_.src=0===(n=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(n.substring(n.indexOf(",")+1)):n,this.options_.tech=this.tech_,this.options_.externVhs=l3,this.options_.sourceType=RH(t),this.options_.seekTo=e=>{this.tech_.setCurrentTime(e)},this.options_.player_=this.player_,this.playlistController_=new e3(this.options_);const i=UJ({liveRangeSafeTimeDelta:HJ},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new i3(i),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const e=DJ.players[this.tech_.options_.playerId];let t=this.playlistController_.error;"object"!=typeof t||t.code?"string"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)});const r=this.options_.bufferBasedABR?l3.movingAverageBandwidthSelector(.55):l3.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=l3.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(e){this.playlistController_.selectPlaylist=e.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(e){this.playlistController_.mainSegmentLoader_.throughput.rate=e,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let e=this.playlistController_.mainSegmentLoader_.bandwidth;const t=ZG.navigator.connection||ZG.navigator.mozConnection||ZG.navigator.webkitConnection,n=1e7;if(this.options_.useNetworkInformationApi&&t){const i=1e3*t.downlink*1e3;e=i>=n&&e>=n?Math.max(e,i):i}return e},set(e){this.playlistController_.mainSegmentLoader_.bandwidth=e,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const e=1/(this.bandwidth||1);let t;t=this.throughput>0?1/this.throughput:0;return Math.floor(1/(e+t))},set(){DJ.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>KJ(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>KJ(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&(e=>{if(!ZG.localStorage)return!1;let t=p3();t=t?UJ(t,e):e;try{ZG.localStorage.setItem(c3,JSON.stringify(t))}catch(r6){return!1}})({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{var e;(e=this).representations=()=>{const t=e.playlistController_.main(),n=f0(t)?e.playlistController_.getAudioTrackPlaylists_():t.playlists;return n?n.filter(e=>!l0(e)).map((t,n)=>new t3(e,t,t.id)):[]}}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=ZG.URL.createObjectURL(this.playlistController_.mediaSource),(DJ.browser.IS_ANY_SAFARI||DJ.browser.IS_IOS)&&this.options_.overrideNative&&"hls"===this.options_.sourceType&&"function"==typeof this.tech_.addSourceElement?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),d3({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(e=>{this.logger_("error while creating EME key session",e),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=h3({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on("keystatuschange",e=>{this.playlistController_.updatePlaylistByKeyStatus(e.keyId,e.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),t?this.createKeySessions_():this.playlistController_.sourceUpdater_.initializedEme()}setupQualityLevels_(){const e=DJ.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{var e,t;e=this.qualityLevels_,(t=this).representations().forEach(t=>{e.addQualityLevel(t)}),u3(e,t.playlists)}),this.playlists.on("mediachange",()=>{u3(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":o3,"mux.js":"7.1.0","mpd-parser":"1.3.1","m3u8-parser":"7.2.0","aes-decrypter":"4.0.2"}}version(){return this.constructor.version()}canChangeType(){return I2.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&ZG.URL.revokeObjectURL&&(ZG.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return Y0({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,i=2){return Z0({programTime:e,playlist:this.playlistController_.media(),retryCount:i,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{f3(this.xhr,e)},this.xhr.onResponse=e=>{m3(this.xhr,e)},this.xhr.offRequest=e=>{g3(this.xhr,e)},this.xhr.offResponse=e=>{b3(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(e=>{this.playlistController_.on(e,e=>{this.player_.trigger(a({},e))})}),["gapjumped","playedrangeschanged"].forEach(e=>{this.playbackWatcher_.on(e,e=>{this.player_.trigger(a({},e))})})}}const T3={name:"videojs-http-streaming",VERSION:o3,canHandleSource(e,t={}){const n=UJ(DJ.options,t);return!(!n.vhs.experimentalUseMMS&&!IH("avc1.4d400d,mp4a.40.2",!1))&&T3.canPlayType(e.type,n)},handleSource(e,t,n={}){const i=UJ(DJ.options,n);return t.vhs=new v3(e,t,i),t.vhs.xhr=z0(),t.vhs.setupXhrHooks_(),t.vhs.src(e.src,e.type),t.vhs},canPlayType(e,t){const n=RH(e);if(!n)return"";const i=T3.getOverrideNative(t);return!l3.supportsTypeNatively(n)||i?"maybe":""},getOverrideNative(e={}){const{vhs:t={}}=e,n=!(DJ.browser.IS_ANY_SAFARI||DJ.browser.IS_IOS),{overrideNative:i=n}=t;return i}};IH("avc1.4d400d,mp4a.40.2",!0)&&DJ.getTech("Html5").registerSourceHandler(T3,0),DJ.VhsHandler=v3,DJ.VhsSourceHandler=T3,DJ.Vhs=l3,DJ.use||DJ.registerComponent("Vhs",l3),DJ.options.vhs=DJ.options.vhs||{},DJ.getPlugin&&DJ.getPlugin("reloadSourceOnError")||DJ.registerPlugin("reloadSourceOnError",a3);class x3 extends i.Component{constructor(e){super(e),t(this,"videoRef",n.exports.createRef()),t(this,"canvasRef",n.exports.createRef()),t(this,"player",null),t(this,"timeChangeId",null),t(this,"stepFrame",e=>{if(this.player&&this.props.onStepFrame){const t=1/this.state.frameRate,n=this.player.currentTime(),i="forward"===e?Math.min(n+t,this.state.duration):Math.max(n-t,0);this.player.pause(),this.player.currentTime(i),this.setState({currentTime:i,isPlaying:!1})}}),t(this,"stepSeconds",e=>{if(this.player&&this.props.onStepSeconds){const t="forward"===e?Math.min(this.player.currentTime()+3,this.state.duration):Math.max(this.player.currentTime()-3,0);this.player.currentTime(t),this.setState({currentTime:t})}}),t(this,"togglePlay",()=>{console.log("togglePlay"),this.player&&this.props.onTogglePlay&&(this.state.isPlaying?this.player.pause():this.player.play(),this.setState(e=>({isPlaying:!e.isPlaying})))}),t(this,"initializePlayer",()=>{const e=this.videoRef.current;if(!e||!this.state.videoUrl)return void console.warn("Video element or URL not ready yet");if(!document.body.contains(e))return void setTimeout(()=>{this.initializePlayer()},100);this.player=DJ(e,{controls:!0,fluid:!1,responsive:!0,playbackRates:[.5,1,1.5,2,3,5],controlBar:{children:["playToggle","volumePanel","playbackRateMenuButton","fullscreenToggle","progressControl"]}});let t=this.props.imageData.fileData.type||"video/mp4";window.MediaSource&&(new MediaSource,MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')&&(t="video/mp4")),this.player.src({type:t,src:this.state.videoUrl}),this.player.on("loadedmetadata",()=>{var e;const t=(null==(e=this.player.videoTracks()[0])?void 0:e.frameRate)||30;this.setState({duration:this.player.duration(),frameRate:t});const n={...this.props.imageData,frameRate:t};this.props.updateImageDataById(this.props.imageData.id,n)}),this.player.on("timeupdate",()=>{const e=this.player.currentTime(),t=this.player.paused(),n=Math.floor(e*this.state.frameRate);this.setState({currentTime:e,isPlaying:!t}),t&&(this.props.imageData.timestamp===e&&this.props.imageData.frameIndex===n||this.props.updateImageDataById(this.props.imageData.id,{...this.props.imageData,timestamp:e,frameIndex:n}))})}),t(this,"drawAnnotations",()=>{const e=this.canvasRef.current;if(e){const t=e.getContext("2d");if(t){t.clearRect(0,0,e.width,e.height);const{imageData:n}=this.props;n.labelRects&&n.labelRects.forEach(e=>{t.strokeStyle="red"})}}}),t(this,"setTimeChangeId",e=>{this.timeChangeId=e}),t(this,"handleKeyPress",e=>{var t;if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const{labelNames:n,imageData:i}=this.props,r=this.state.currentTime,{formattedTime:s,frame:a}=MG.formatTimeWithFrame(r,this.state.frameRate);if("ArrowLeft"===e.code&&e.shiftKey){e.preventDefault();const t=(i.labelRects||[]).flatMap(e=>[{id:e.id,frame:e.frame,type:"start"},...null!=e.endFrame?[{id:e.id,frame:e.endFrame,type:"end"}]:[]]).filter(e=>e.frame<a);if(t.length){const e=t.reduce((e,t)=>t.frame>e.frame?t:e),n=e.frame/this.state.frameRate,i=MG.formatTimeWithFrame(n,this.state.frameRate).formattedTime;this.jumpToTime(i)}return}if("ArrowRight"===e.code&&e.shiftKey){e.preventDefault();const t=(i.labelRects||[]).flatMap(e=>[{id:e.id,frame:e.frame,type:"start"},...null!=e.endFrame?[{id:e.id,frame:e.endFrame,type:"end"}]:[]]).filter(e=>e.frame>a);if(t.length){const e=t.reduce((e,t)=>t.frame<e.frame?t:e),n=e.frame/this.state.frameRate,i=MG.formatTimeWithFrame(n,this.state.frameRate).formattedTime;this.jumpToTime(i)}return}if("ArrowRight"===e.code&&e.metaKey){e.preventDefault();const t=(i.labelRects||[]).flatMap(e=>[{id:e.id,frame:e.frame,type:"start"},...null!=e.endFrame?[{id:e.id,frame:e.endFrame,type:"end"}]:[]]).filter(e=>e.frame<a);if(t.length){const e=t.reduce((e,t)=>t.frame>e.frame?t:e),n=i.labelRects.map(t=>t.id===e.id?"start"===e.type?{...t,timestamp:s,frame:a}:{...t,endTimestamp:s,endFrame:a}:t);this.props.updateImageDataById(i.id,{...i,labelRects:n})}return}if("ArrowLeft"===e.code&&e.metaKey){e.preventDefault();const t=(i.labelRects||[]).flatMap(e=>[{id:e.id,frame:e.frame,type:"start"},...null!=e.endFrame?[{id:e.id,frame:e.endFrame,type:"end"}]:[]]).filter(e=>e.frame>a);if(t.length){const e=t.reduce((e,t)=>t.frame<e.frame?t:e),n=i.labelRects.map(t=>t.id===e.id?"start"===e.type?{...t,timestamp:s,frame:a}:{...t,endTimestamp:s,endFrame:a}:t);this.props.updateImageDataById(i.id,{...i,labelRects:n})}return}const o=n.find(t=>t.shortcut&&t.shortcut.toLowerCase()===e.key.toLowerCase());if(o){e.preventDefault();const n=null==(t=i.labelRects)?void 0:t.find(e=>e.labelId===o.id&&!e.endTimestamp);if(n){const e=i.labelRects.map(e=>e.id===n.id?{...e,endTimestamp:s,endFrame:a}:e),t={...i,labelRects:e};this.props.updateImageDataById(i.id,t)}else{const e=Xn.createLabelRect(o.id,a,void 0,o.name,i),t={...i,labelRects:[...i.labelRects||[],e]};this.props.updateImageDataById(i.id,t)}}switch(e.code){case"Space":e.preventDefault(),this.togglePlay();break;case"ArrowLeft":e.preventDefault(),this.stepFrame("backward");break;case"ArrowRight":e.preventDefault(),this.stepFrame("forward");break;case"Escape":e.preventDefault(),this.timeChangeId=null}}),t(this,"jumpToTime",e=>{if(this.player){const t=MG.parseTimestamp(e);this.player.currentTime(t),this.setState({currentTime:t,isPlaying:!1}),this.props.onJumpToTime&&this.props.onJumpToTime(e)}}),this.state={duration:0,currentTime:0,isPlaying:!1,videoUrl:null,frameRate:30}}componentDidMount(){this.setVideoUrl(),setTimeout(()=>{this.initializePlayer()},0),this.drawAnnotations(),document.addEventListener("keydown",this.handleKeyPress)}componentDidUpdate(e,t){if(e.imageData.fileData!==this.props.imageData.fileData&&(this.setVideoUrl(),setTimeout(()=>{this.initializePlayer()},0)),t.currentTime!==this.state.currentTime&&this.drawAnnotations(),!this.props.onVideoStateChange||t.currentTime===this.state.currentTime&&t.duration===this.state.duration&&t.isPlaying===this.state.isPlaying&&t.frameRate===this.state.frameRate||this.props.onVideoStateChange({currentTime:this.state.currentTime,duration:this.state.duration,isPlaying:this.state.isPlaying,frameRate:this.state.frameRate}),"number"==typeof this.props.jumpToFrameIndex&&this.props.jumpToFrameIndex!==e.jumpToFrameIndex&&this.player){const e=this.props.jumpToFrameIndex/this.state.frameRate;this.player.currentTime(e),this.setState({currentTime:e,isPlaying:!1}),this.props.jumpToFrame&&this.props.jumpToFrame(null)}}componentWillUnmount(){this.player&&this.player.dispose(),this.state.videoUrl&&URL.revokeObjectURL(this.state.videoUrl),document.removeEventListener("keydown",this.handleKeyPress)}setVideoUrl(){this.state.videoUrl;const e=URL.createObjectURL(this.props.imageData.fileData);this.setState({videoUrl:e})}render(){var e;const{videoUrl:t}=this.state,{size:n}=this.props;return Math.floor(this.state.currentTime*this.state.frameRate),o("div",{className:"Editor",children:u("div",{className:"VideoContainer",children:[o("div",{"data-vjs-player":!0,className:"player-wrapper",children:u("video",{ref:this.videoRef,className:"video-js",playsInline:!0,preload:"auto","data-setup":'{"fluid": false}',children:[o("source",{src:t||"",type:(null==(e=this.props.imageData.fileData)?void 0:e.type)||"video/mp4"}),o("p",{className:"vjs-no-js",children:"To view this video please enable JavaScript, and consider upgrading to a web browser that supports HTML5 video"})]})}),o("canvas",{ref:this.canvasRef,width:n.width,height:n.height,style:{position:"absolute",left:0,top:0,pointerEvents:"none",zIndex:1}})]})})}}const _3=$e(e=>({activeLabelType:e.labels.activeLabelType,activePopupType:e.general.activePopupType,activeLabelId:e.labels.activeLabelId,customCursorStyle:e.general.customCursorStyle,imageDragMode:e.general.imageDragMode,zoom:e.general.zoom,labelNames:e.labels.labels,jumpToFrameIndex:e.general.jumpToFrameIndex}),{updateImageDataById:on,jumpToFrame:wn},null,{forwardRef:!0})(x3),S3=n.exports.forwardRef((e,t)=>o(_3,{...e,ref:t}));function w3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I3(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,v(i.key),i)}}function k3(e,t,n){return t&&I3(e.prototype,t),n&&I3(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function C3(e,t){if(t&&("object"==T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}function E3(e){return(E3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A3(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}function R3(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N3(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function P3(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function D3(e,t){try{var n=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,i)}finally{this.props=n,this.state=i}}function O3(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,i=null,r=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?i="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(i="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?r="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(r="UNSAFE_componentWillUpdate"),null!==n||null!==i||null!==r){var s=e.displayName||e.name,a="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+s+" uses "+a+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==i?"\n  "+i:"")+(null!==r?"\n  "+r:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=N3,t.componentWillReceiveProps=P3),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=D3;var o=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var i=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;o.call(this,e,t,i)}}return e}function L3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function M3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L3(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L3(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function F3(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(F3=function(){return!!e})()}N3.__suppressDeprecationWarning=!0,P3.__suppressDeprecationWarning=!0,D3.__suppressDeprecationWarning=!0;var $3=function(){function e(){var t,n,i,r;w3(this,e);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return n=this,i=e,r=[].concat(a),i=E3(i),R3(t=C3(n,F3()?Reflect.construct(i,r||[],E3(n).constructor):i.apply(n,r)),"state",{scrollToColumn:0,scrollToRow:0,instanceProps:{prevScrollToColumn:0,prevScrollToRow:0}}),R3(t,"_columnStartIndex",0),R3(t,"_columnStopIndex",0),R3(t,"_rowStartIndex",0),R3(t,"_rowStopIndex",0),R3(t,"_onKeyDown",function(e){var n=t.props,i=n.columnCount,r=n.disabled,s=n.mode,a=n.rowCount;if(!r){var o=t._getScrollState(),l=o.scrollToColumn,c=o.scrollToRow,u=t._getScrollState(),d=u.scrollToColumn,h=u.scrollToRow;switch(e.key){case"ArrowDown":h="cells"===s?Math.min(h+1,a-1):Math.min(t._rowStopIndex+1,a-1);break;case"ArrowLeft":d="cells"===s?Math.max(d-1,0):Math.max(t._columnStartIndex-1,0);break;case"ArrowRight":d="cells"===s?Math.min(d+1,i-1):Math.min(t._columnStopIndex+1,i-1);break;case"ArrowUp":h="cells"===s?Math.max(h-1,0):Math.max(t._rowStartIndex-1,0)}d===l&&h===c||(e.preventDefault(),t._updateScrollState({scrollToColumn:d,scrollToRow:h}))}}),R3(t,"_onSectionRendered",function(e){var n=e.columnStartIndex,i=e.columnStopIndex,r=e.rowStartIndex,s=e.rowStopIndex;t._columnStartIndex=n,t._columnStopIndex=i,t._rowStartIndex=r,t._rowStopIndex=s}),t}return A3(e,n.exports.PureComponent),k3(e,[{key:"setScrollIndexes",value:function(e){var t=e.scrollToColumn,n=e.scrollToRow;this.setState({scrollToRow:n,scrollToColumn:t})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.children,i=this._getScrollState(),r=i.scrollToColumn,s=i.scrollToRow;return o("div",{className:t,onKeyDown:this._onKeyDown,children:n({onSectionRendered:this._onSectionRendered,scrollToColumn:r,scrollToRow:s})})}},{key:"_getScrollState",value:function(){return this.props.isControlled?this.props:this.state}},{key:"_updateScrollState",value:function(e){var t=e.scrollToColumn,n=e.scrollToRow,i=this.props,r=i.isControlled,s=i.onScrollToChange;"function"==typeof s&&s({scrollToColumn:t,scrollToRow:n}),r||this.setState({scrollToColumn:t,scrollToRow:n})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.isControlled?{}:e.scrollToColumn!==t.instanceProps.prevScrollToColumn||e.scrollToRow!==t.instanceProps.prevScrollToRow?M3(M3({},t),{},{scrollToColumn:e.scrollToColumn,scrollToRow:e.scrollToRow,instanceProps:{prevScrollToColumn:e.scrollToColumn,prevScrollToRow:e.scrollToRow}}):{}}}])}();function B3(e,t){var n,i,r,s=void 0!==(n=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof self?self:global).document&&n.document.attachEvent;if(!s){var a=(r=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(e){return n.setTimeout(e,20)},function(e){return r(e)}),o=(i=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.clearTimeout,function(e){return i(e)}),l=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},c=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;l(this),this.__resizeRAF__&&o(this.__resizeRAF__),this.__resizeRAF__=a(function(){(function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height})(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach(function(n){n.call(t,e)}))})}},u=!1,d="",h="animationstart",p="Webkit Moz O ms".split(" "),f="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),m=n.document.createElement("fakeelement");if(void 0!==m.style.animationName&&(u=!0),!1===u)for(var g=0;g<p.length;g++)if(void 0!==m.style[p[g]+"AnimationName"]){d="-"+p[g].toLowerCase()+"-",h=f[g],u=!0;break}var b="resizeanim",y="@"+d+"keyframes "+b+" { from { opacity: 0; } to { opacity: 0; } } ",v=d+"animation: 1ms "+b+"; "}return{addResizeListener:function(t,i){if(s)t.attachEvent("onresize",i);else{if(!t.__resizeTriggers__){var r=t.ownerDocument,a=n.getComputedStyle(t);a&&"static"==a.position&&(t.style.position="relative"),function(t){if(!t.getElementById("detectElementResize")){var n=(y||"")+".resize-triggers { "+(v||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',i=t.head||t.getElementsByTagName("head")[0],r=t.createElement("style");r.id="detectElementResize",r.type="text/css",null!=e&&r.setAttribute("nonce",e),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(t.createTextNode(n)),i.appendChild(r)}}(r),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=r.createElement("div")).className="resize-triggers";var o=r.createElement("div");o.className="expand-trigger",o.appendChild(r.createElement("div"));var u=r.createElement("div");u.className="contract-trigger",t.__resizeTriggers__.appendChild(o),t.__resizeTriggers__.appendChild(u),t.appendChild(t.__resizeTriggers__),l(t),t.addEventListener("scroll",c,!0),h&&(t.__resizeTriggers__.__animationListener__=function(e){e.animationName==b&&l(t)},t.__resizeTriggers__.addEventListener(h,t.__resizeTriggers__.__animationListener__))}t.__resizeListeners__.push(i)}},removeResizeListener:function(e,t){if(s)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",c,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(h,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(r6){}}}}}function z3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function U3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z3(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z3(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function G3(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(G3=function(){return!!e})()}R3($3,"defaultProps",{disabled:!1,isControlled:!1,mode:"edges",scrollToColumn:0,scrollToRow:0}),O3($3);var V3=function(){function e(){var t,n,i,r;w3(this,e);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return n=this,i=e,r=[].concat(a),i=E3(i),R3(t=C3(n,G3()?Reflect.construct(i,r||[],E3(n).constructor):i.apply(n,r)),"state",{height:t.props.defaultHeight||0,width:t.props.defaultWidth||0}),R3(t,"_parentNode",void 0),R3(t,"_autoSizer",void 0),R3(t,"_window",void 0),R3(t,"_detectElementResize",void 0),R3(t,"_onResize",function(){var e=t.props,n=e.disableHeight,i=e.disableWidth,r=e.onResize;if(t._parentNode){var s=t._parentNode.offsetHeight||0,a=t._parentNode.offsetWidth||0,o=(t._window||window).getComputedStyle(t._parentNode)||{},l=parseInt(o.paddingLeft,10)||0,c=parseInt(o.paddingRight,10)||0,u=parseInt(o.paddingTop,10)||0,d=parseInt(o.paddingBottom,10)||0,h=s-u-d,p=a-l-c;(!n&&t.state.height!==h||!i&&t.state.width!==p)&&(t.setState({height:s-u-d,width:a-l-c}),r({height:s,width:a}))}}),R3(t,"_setRef",function(e){t._autoSizer=e}),t}return A3(e,n.exports.Component),k3(e,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._window=this._autoSizer.parentNode.ownerDocument.defaultView,this._detectElementResize=B3(e,this._window),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,i=e.disableHeight,r=e.disableWidth,s=e.style,a=this.state,l=a.height,c=a.width,u={overflow:"visible"},d={};return i||(u.height=0,d.height=l),r||(u.width=0,d.width=c),o("div",{className:n,ref:this._setRef,style:U3(U3({},u),s),children:t(d)})}}])}();function H3(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(H3=function(){return!!e})()}R3(V3,"defaultProps",{onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}});var W3=function(){function e(){var t,i,r,s;w3(this,e);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return i=this,r=e,s=[].concat(o),r=E3(r),R3(t=C3(i,H3()?Reflect.construct(r,s||[],E3(i).constructor):r.apply(i,s)),"_child",n.exports.createRef()),R3(t,"_measure",function(){var e=t.props,n=e.cache,i=e.columnIndex,r=void 0===i?0:i,s=e.parent,a=e.rowIndex,o=void 0===a?t.props.index||0:a,l=t._getCellMeasurements(),c=l.height,u=l.width;c===n.getHeight(o,r)&&u===n.getWidth(o,r)||(n.set(o,r,u,c),s&&"function"==typeof s.recomputeGridSize&&s.recomputeGridSize({columnIndex:r,rowIndex:o}))}),R3(t,"_registerChild",function(e){!e||e instanceof Element||console.warn("CellMeasurer registerChild expects to be passed Element or null"),t._child.current=e,e&&t._maybeMeasureCell()}),t}return A3(e,n.exports.PureComponent),k3(e,[{key:"componentDidMount",value:function(){this._maybeMeasureCell()}},{key:"componentDidUpdate",value:function(){this._maybeMeasureCell()}},{key:"render",value:function(){var e=this,t=this.props.children,i="function"==typeof t?t({measure:this._measure,registerChild:this._registerChild}):t;return null===i?i:n.exports.cloneElement(i,{ref:function(t){"function"==typeof i.ref?i.ref(t):i.ref&&(i.ref.current=t),e._child.current=t}})}},{key:"_getCellMeasurements",value:function(){var e=this.props.cache,t=this._child.current;if(t&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){var n=t.style.width,i=t.style.height;e.hasFixedWidth()||(t.style.width="auto"),e.hasFixedHeight()||(t.style.height="auto");var r=Math.ceil(t.offsetHeight),s=Math.ceil(t.offsetWidth);return n&&(t.style.width=n),i&&(t.style.height=i),{height:r,width:s}}return{height:0,width:0}}},{key:"_maybeMeasureCell",value:function(){var e=this.props,t=e.cache,n=e.columnIndex,i=void 0===n?0:n,r=e.parent,s=e.rowIndex,a=void 0===s?this.props.index||0:s;if(!t.has(a,i)){var o=this._getCellMeasurements(),l=o.height,c=o.width;t.set(a,i,c,l),r&&"function"==typeof r.invalidateCellSizeAfterRender&&r.invalidateCellSizeAfterRender({columnIndex:i,rowIndex:a})}}}])}();function j3(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=j3(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function q3(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=j3(e))&&(i&&(i+=" "),i+=t);return i}function X3(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t={};return function(n){var i=n.callback,r=n.indices,s=Object.keys(r),a=!e||s.every(function(e){var t=r[e];return Array.isArray(t)?t.length>0:t>=0}),o=s.length!==Object.keys(t).length||s.some(function(e){var n=t[e],i=r[e];return Array.isArray(i)?n.join(",")!==i.join(","):n!==i});t=r,a&&o&&i(r)}}R3(W3,"__internalCellMeasurerFlag",!1);const K3=!("undefined"==typeof window||!window.document||!window.document.createElement);var Y3;function Z3(e){if((!Y3&&0!==Y3||e)&&K3){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),Y3=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Y3}function Q3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function J3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q3(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q3(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function e4(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(e4=function(){return!!e})()}var t4="observed",n4="requested",i4=function(){function e(){var t,n,i,r;w3(this,e);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return n=this,i=e,r=[].concat(a),i=E3(i),R3(t=C3(n,e4()?Reflect.construct(i,r||[],E3(n).constructor):i.apply(n,r)),"state",{isScrolling:!1,scrollLeft:0,scrollTop:0}),R3(t,"_calculateSizeAndPositionDataOnNextUpdate",!1),R3(t,"_onSectionRenderedMemoizer",X3()),R3(t,"_onScrollMemoizer",X3(!1)),R3(t,"_invokeOnSectionRenderedHelper",function(){var e=t.props,n=e.cellLayoutManager,i=e.onSectionRendered;t._onSectionRenderedMemoizer({callback:i,indices:{indices:n.getLastRenderedIndices()}})}),R3(t,"_setScrollingContainerRef",function(e){t._scrollingContainer=e}),R3(t,"_updateScrollPositionForScrollToCell",function(){var e=t.props,n=e.cellLayoutManager,i=e.height,r=e.scrollToAlignment,s=e.scrollToCell,a=e.width,o=t.state,l=o.scrollLeft,c=o.scrollTop;if(s>=0){var u=n.getScrollPositionForCell({align:r,cellIndex:s,height:i,scrollLeft:l,scrollTop:c,width:a});u.scrollLeft===l&&u.scrollTop===c||t._setScrollPosition(u)}}),R3(t,"_onScroll",function(e){if(e.target===t._scrollingContainer){t._enablePointerEventsAfterDelay();var n=t.props,i=n.cellLayoutManager,r=n.height,s=n.isScrollingChange,a=n.width,o=t._scrollbarSize,l=i.getTotalSize(),c=l.height,u=l.width,d=Math.max(0,Math.min(u-a+o,e.target.scrollLeft)),h=Math.max(0,Math.min(c-r+o,e.target.scrollTop));if(t.state.scrollLeft!==d||t.state.scrollTop!==h){var p=e.cancelable?t4:n4;t.state.isScrolling||s(!0),t.setState({isScrolling:!0,scrollLeft:d,scrollPositionChangeReason:p,scrollTop:h})}t._invokeOnScrollMemoizer({scrollLeft:d,scrollTop:h,totalWidth:u,totalHeight:c})}}),t._scrollbarSize=Z3(),void 0===t._scrollbarSize?(t._scrollbarSizeMeasured=!1,t._scrollbarSize=0):t._scrollbarSizeMeasured=!0,t}return A3(e,n.exports.PureComponent),k3(e,[{key:"recomputeCellSizesAndPositions",value:function(){this._calculateSizeAndPositionDataOnNextUpdate=!0,this.forceUpdate()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.cellLayoutManager,n=e.scrollLeft,i=e.scrollToCell,r=e.scrollTop;this._scrollbarSizeMeasured||(this._scrollbarSize=Z3(),this._scrollbarSizeMeasured=!0,this.setState({})),i>=0?this._updateScrollPositionForScrollToCell():(n>=0||r>=0)&&this._setScrollPosition({scrollLeft:n,scrollTop:r}),this._invokeOnSectionRenderedHelper();var s=t.getTotalSize(),a=s.height,o=s.width;this._invokeOnScrollMemoizer({scrollLeft:n||0,scrollTop:r||0,totalHeight:a,totalWidth:o})}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,i=n.height,r=n.scrollToAlignment,s=n.scrollToCell,a=n.width,o=this.state,l=o.scrollLeft,c=o.scrollPositionChangeReason,u=o.scrollTop;c===n4&&(l>=0&&l!==t.scrollLeft&&l!==this._scrollingContainer.scrollLeft&&(this._scrollingContainer.scrollLeft=l),u>=0&&u!==t.scrollTop&&u!==this._scrollingContainer.scrollTop&&(this._scrollingContainer.scrollTop=u)),i===e.height&&r===e.scrollToAlignment&&s===e.scrollToCell&&a===e.width||this._updateScrollPositionForScrollToCell(),this._invokeOnSectionRenderedHelper()}},{key:"componentWillUnmount",value:function(){this._disablePointerEventsTimeoutId&&clearTimeout(this._disablePointerEventsTimeoutId)}},{key:"render",value:function(){var e=this.props,t=e.autoHeight,n=e.cellCount,i=e.cellLayoutManager,r=e.className,s=e.height,a=e.horizontalOverscanSize,l=e.id,c=e.noContentRenderer,d=e.style,h=e.verticalOverscanSize,p=e.width,f=this.state,m=f.isScrolling,g=f.scrollLeft,b=f.scrollTop;(this._lastRenderedCellCount!==n||this._lastRenderedCellLayoutManager!==i||this._calculateSizeAndPositionDataOnNextUpdate)&&(this._lastRenderedCellCount=n,this._lastRenderedCellLayoutManager=i,this._calculateSizeAndPositionDataOnNextUpdate=!1,i.calculateSizeAndPositionData());var y=i.getTotalSize(),v=y.height,T=y.width,x=Math.max(0,g-a),_=Math.max(0,b-h),S=Math.min(T,g+p+a),w=Math.min(v,b+s+h),I=s>0&&p>0?i.cellRenderers({height:w-_,isScrolling:m,width:S-x,x:x,y:_}):[],k={boxSizing:"border-box",direction:"ltr",height:t?"auto":s,position:"relative",WebkitOverflowScrolling:"touch",width:p,willChange:"transform"},C=v>s?this._scrollbarSize:0,E=T>p?this._scrollbarSize:0;return k.overflowX=T+C<=p?"hidden":"auto",k.overflowY=v+E<=s?"hidden":"auto",u("div",{ref:this._setScrollingContainerRef,"aria-label":this.props["aria-label"],className:q3("ReactVirtualized__Collection",r),id:l,onScroll:this._onScroll,role:"grid",style:J3(J3({},k),d),tabIndex:0,children:[n>0&&o("div",{className:"ReactVirtualized__Collection__innerScrollContainer",style:{height:v,maxHeight:v,maxWidth:T,overflow:"hidden",pointerEvents:m?"none":"",width:T},children:I}),0===n&&c()]})}},{key:"_enablePointerEventsAfterDelay",value:function(){var e=this;this._disablePointerEventsTimeoutId&&clearTimeout(this._disablePointerEventsTimeoutId),this._disablePointerEventsTimeoutId=setTimeout(function(){(0,e.props.isScrollingChange)(!1),e._disablePointerEventsTimeoutId=null,e.setState({isScrolling:!1})},150)}},{key:"_invokeOnScrollMemoizer",value:function(e){var t=this,n=e.scrollLeft,i=e.scrollTop,r=e.totalHeight,s=e.totalWidth;this._onScrollMemoizer({callback:function(e){var n=e.scrollLeft,i=e.scrollTop,a=t.props,o=a.height;(0,a.onScroll)({clientHeight:o,clientWidth:a.width,scrollHeight:r,scrollLeft:n,scrollTop:i,scrollWidth:s})},indices:{scrollLeft:n,scrollTop:i}})}},{key:"_setScrollPosition",value:function(e){var t=e.scrollLeft,n=e.scrollTop,i={scrollPositionChangeReason:n4};t>=0&&(i.scrollLeft=t),n>=0&&(i.scrollTop=n),(t>=0&&t!==this.state.scrollLeft||n>=0&&n!==this.state.scrollTop)&&this.setState(i)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return 0!==e.cellCount||0===t.scrollLeft&&0===t.scrollTop?e.scrollLeft!==t.scrollLeft||e.scrollTop!==t.scrollTop?{scrollLeft:null!=e.scrollLeft?e.scrollLeft:t.scrollLeft,scrollTop:null!=e.scrollTop?e.scrollTop:t.scrollTop,scrollPositionChangeReason:n4}:null:{scrollLeft:0,scrollTop:0,scrollPositionChangeReason:n4}}}])}();R3(i4,"defaultProps",{"aria-label":"grid",horizontalOverscanSize:0,noContentRenderer:function(){return null},onScroll:function(){return null},onSectionRendered:function(){return null},scrollToAlignment:"auto",scrollToCell:-1,style:{},verticalOverscanSize:0}),i4.propTypes={},O3(i4);var r4=function(){return k3(function e(t){var n=t.height,i=t.width,r=t.x,s=t.y;w3(this,e),this.height=n,this.width=i,this.x=r,this.y=s,this._indexMap={},this._indices=[]},[{key:"addCellIndex",value:function(e){var t=e.index;this._indexMap[t]||(this._indexMap[t]=!0,this._indices.push(t))}},{key:"getCellIndices",value:function(){return this._indices}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y," ").concat(this.width,"x").concat(this.height)}}])}(),s4=function(){return k3(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;w3(this,e),this._sectionSize=t,this._cellMetadata=[],this._sections={}},[{key:"getCellIndices",value:function(e){var t=e.height,n=e.width,i=e.x,r=e.y,s={};return this.getSections({height:t,width:n,x:i,y:r}).forEach(function(e){return e.getCellIndices().forEach(function(e){s[e]=e})}),Object.keys(s).map(function(e){return s[e]})}},{key:"getCellMetadata",value:function(e){var t=e.index;return this._cellMetadata[t]}},{key:"getSections",value:function(e){for(var t=e.height,n=e.width,i=e.x,r=e.y,s=Math.floor(i/this._sectionSize),a=Math.floor((i+n-1)/this._sectionSize),o=Math.floor(r/this._sectionSize),l=Math.floor((r+t-1)/this._sectionSize),c=[],u=s;u<=a;u++)for(var d=o;d<=l;d++){var h="".concat(u,".").concat(d);this._sections[h]||(this._sections[h]=new r4({height:this._sectionSize,width:this._sectionSize,x:u*this._sectionSize,y:d*this._sectionSize})),c.push(this._sections[h])}return c}},{key:"getTotalSectionCount",value:function(){return Object.keys(this._sections).length}},{key:"toString",value:function(){var e=this;return Object.keys(this._sections).map(function(t){return e._sections[t].toString()})}},{key:"registerCell",value:function(e){var t=e.cellMetadatum,n=e.index;this._cellMetadata[n]=t,this.getSections(t).forEach(function(e){return e.addCellIndex({index:n})})}}])}();function a4(e){var t=e.align,n=void 0===t?"auto":t,i=e.cellOffset,r=e.cellSize,s=e.containerSize,a=e.currentOffset,o=i,l=o-s+r;switch(n){case"start":return o;case"end":return l;case"center":return o-(s-r)/2;default:return Math.max(l,Math.min(o,a))}}function o4(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(o4=function(){return!!e})()}var l4=function(){function e(t,n){var i,r,s,a;return w3(this,e),r=this,a=[t,n],s=E3(s=e),(i=C3(r,o4()?Reflect.construct(s,a||[],E3(r).constructor):s.apply(r,a)))._cellMetadata=[],i._lastRenderedCellIndices=[],i._cellCache=[],i._isScrollingChange=i._isScrollingChange.bind(i),i._setCollectionViewRef=i._setCollectionViewRef.bind(i),i}return A3(e,n.exports.PureComponent),k3(e,[{key:"forceUpdate",value:function(){void 0!==this._collectionView&&this._collectionView.forceUpdate()}},{key:"recomputeCellSizesAndPositions",value:function(){this._cellCache=[],this._collectionView.recomputeCellSizesAndPositions()}},{key:"render",value:function(){var e=a({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(this.props),this.props));return o(i4,{cellLayoutManager:this,isScrollingChange:this._isScrollingChange,ref:this._setCollectionViewRef,...e})}},{key:"calculateSizeAndPositionData",value:function(){var e=this.props,t=function(e){for(var t=e.cellCount,n=e.cellSizeAndPositionGetter,i=e.sectionSize,r=[],s=new s4(i),a=0,o=0,l=0;l<t;l++){var c=n({index:l});if(null==c.height||isNaN(c.height)||null==c.width||isNaN(c.width)||null==c.x||isNaN(c.x)||null==c.y||isNaN(c.y))throw Error("Invalid metadata returned for cell ".concat(l,":\n        x:").concat(c.x,", y:").concat(c.y,", width:").concat(c.width,", height:").concat(c.height));a=Math.max(a,c.y+c.height),o=Math.max(o,c.x+c.width),r[l]=c,s.registerCell({cellMetadatum:c,index:l})}return{cellMetadata:r,height:a,sectionManager:s,width:o}}({cellCount:e.cellCount,cellSizeAndPositionGetter:e.cellSizeAndPositionGetter,sectionSize:e.sectionSize});this._cellMetadata=t.cellMetadata,this._sectionManager=t.sectionManager,this._height=t.height,this._width=t.width}},{key:"getLastRenderedIndices",value:function(){return this._lastRenderedCellIndices}},{key:"getScrollPositionForCell",value:function(e){var t=e.align,n=e.cellIndex,i=e.height,r=e.scrollLeft,s=e.scrollTop,a=e.width,o=this.props.cellCount;if(n>=0&&n<o){var l=this._cellMetadata[n];r=a4({align:t,cellOffset:l.x,cellSize:l.width,containerSize:a,currentOffset:r,targetIndex:n}),s=a4({align:t,cellOffset:l.y,cellSize:l.height,containerSize:i,currentOffset:s,targetIndex:n})}return{scrollLeft:r,scrollTop:s}}},{key:"getTotalSize",value:function(){return{height:this._height,width:this._width}}},{key:"cellRenderers",value:function(e){var t=this,n=e.height,i=e.isScrolling,r=e.width,s=e.x,a=e.y,o=this.props,l=o.cellGroupRenderer,c=o.cellRenderer;return this._lastRenderedCellIndices=this._sectionManager.getCellIndices({height:n,width:r,x:s,y:a}),l({cellCache:this._cellCache,cellRenderer:c,cellSizeAndPositionGetter:function(e){var n=e.index;return t._sectionManager.getCellMetadata({index:n})},indices:this._lastRenderedCellIndices,isScrolling:i})}},{key:"_isScrollingChange",value:function(e){e||(this._cellCache=[])}},{key:"_setCollectionViewRef",value:function(e){this._collectionView=e}}])}();function c4(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(c4=function(){return!!e})()}function u4(e){var t=e.cellCount,n=e.cellSize,i=e.computeMetadataCallback,r=e.computeMetadataCallbackProps,s=e.nextCellsCount,a=e.nextCellSize,o=e.nextScrollToIndex,l=e.scrollToIndex,c=e.updateScrollOffsetForScrollToIndex;t===s&&("number"!=typeof n&&"number"!=typeof a||n===a)||(i(r),l>=0&&l===o&&c())}function d4(e,t){if(null==e)return{};var n,i,r=s(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}R3(l4,"defaultProps",{"aria-label":"grid",cellGroupRenderer:function(e){var t=e.cellCache,n=e.cellRenderer,i=e.cellSizeAndPositionGetter,r=e.indices,s=e.isScrolling;return r.map(function(e){var r=i({index:e}),a={index:e,isScrolling:s,key:e,style:{height:r.height,left:r.x,position:"absolute",top:r.y,width:r.width}};return s?(e in t||(t[e]=n(a)),t[e]):n(a)}).filter(function(e){return!!e})}}),l4.propTypes={},(function(){function e(t,n){var i,r,s,a;return w3(this,e),r=this,a=[t,n],s=E3(s=e),(i=C3(r,c4()?Reflect.construct(s,a||[],E3(r).constructor):s.apply(r,a)))._registerChild=i._registerChild.bind(i),i}return A3(e,n.exports.PureComponent),k3(e,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.columnMaxWidth,i=t.columnMinWidth,r=t.columnCount,s=t.width;n===e.columnMaxWidth&&i===e.columnMinWidth&&r===e.columnCount&&s===e.width||this._registeredChild&&this._registeredChild.recomputeGridSize()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.columnMaxWidth,i=e.columnMinWidth,r=e.columnCount,s=e.width,a=i||1,o=n?Math.min(n,s):s,l=s/r;return l=Math.max(a,l),l=Math.min(o,l),l=Math.floor(l),t({adjustedWidth:Math.min(s,l*r),columnWidth:l,getColumnWidth:function(){return l},registerChild:this._registerChild})}},{key:"_registerChild",value:function(e){if(e&&"function"!=typeof e.recomputeGridSize)throw Error("Unexpected child type registered; only Grid/MultiGrid children are supported.");this._registeredChild=e,this._registeredChild&&this._registeredChild.recomputeGridSize()}}])}()).propTypes={};var h4,p4=function(){return k3(function e(t){var n=t.cellCount,i=t.cellSizeGetter,r=t.estimatedCellSize;w3(this,e),R3(this,"_cellSizeAndPositionData",{}),R3(this,"_lastMeasuredIndex",-1),R3(this,"_lastBatchedIndex",-1),R3(this,"_cellCount",void 0),R3(this,"_cellSizeGetter",void 0),R3(this,"_estimatedCellSize",void 0),this._cellSizeGetter=i,this._cellCount=n,this._estimatedCellSize=r},[{key:"areOffsetsAdjusted",value:function(){return!1}},{key:"configure",value:function(e){var t=e.cellCount,n=e.estimatedCellSize,i=e.cellSizeGetter;this._cellCount=t,this._estimatedCellSize=n,this._cellSizeGetter=i}},{key:"getCellCount",value:function(){return this._cellCount}},{key:"getEstimatedCellSize",value:function(){return this._estimatedCellSize}},{key:"getLastMeasuredIndex",value:function(){return this._lastMeasuredIndex}},{key:"getOffsetAdjustment",value:function(){return 0}},{key:"getSizeAndPositionOfCell",value:function(e){if(e<0||e>=this._cellCount)throw Error("Requested index ".concat(e," is outside of range 0..").concat(this._cellCount));if(e>this._lastMeasuredIndex)for(var t=this.getSizeAndPositionOfLastMeasuredCell(),n=t.offset+t.size,i=this._lastMeasuredIndex+1;i<=e;i++){var r=this._cellSizeGetter({index:i});if(void 0===r||isNaN(r))throw Error("Invalid size returned for cell ".concat(i," of value ").concat(r));null===r?(this._cellSizeAndPositionData[i]={offset:n,size:0},this._lastBatchedIndex=e):(this._cellSizeAndPositionData[i]={offset:n,size:r},n+=r,this._lastMeasuredIndex=e)}return this._cellSizeAndPositionData[e]}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function(){return this._lastMeasuredIndex>=0?this._cellSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}}},{key:"getTotalSize",value:function(){var e=this.getSizeAndPositionOfLastMeasuredCell();return e.offset+e.size+(this._cellCount-this._lastMeasuredIndex-1)*this._estimatedCellSize}},{key:"getUpdatedOffsetForIndex",value:function(e){var t=e.align,n=void 0===t?"auto":t,i=e.containerSize,r=e.currentOffset,s=e.targetIndex;if(i<=0)return 0;var a,o=this.getSizeAndPositionOfCell(s),l=o.offset,c=l-i+o.size;switch(n){case"start":a=l;break;case"end":a=c;break;case"center":a=l-(i-o.size)/2;break;default:a=Math.max(c,Math.min(l,r))}var u=this.getTotalSize();return Math.max(0,Math.min(u-i,a))}},{key:"getVisibleCellRange",value:function(e){var t=e.containerSize,n=e.offset;if(0===this.getTotalSize())return{};var i=n+t,r=this._findNearestCell(n),s=this.getSizeAndPositionOfCell(r);n=s.offset+s.size;for(var a=r;n<i&&a<this._cellCount-1;)a++,n+=this.getSizeAndPositionOfCell(a).size;return{start:r,stop:a}}},{key:"resetCell",value:function(e){this._lastMeasuredIndex=Math.min(this._lastMeasuredIndex,e-1)}},{key:"_binarySearch",value:function(e,t,n){for(;t<=e;){var i=t+Math.floor((e-t)/2),r=this.getSizeAndPositionOfCell(i).offset;if(r===n)return i;r<n?t=i+1:r>n&&(e=i-1)}return t>0?t-1:0}},{key:"_exponentialSearch",value:function(e,t){for(var n=1;e<this._cellCount&&this.getSizeAndPositionOfCell(e).offset<t;)e+=n,n*=2;return this._binarySearch(Math.min(e,this._cellCount-1),Math.floor(e/2),t)}},{key:"_findNearestCell",value:function(e){if(isNaN(e))throw Error("Invalid offset ".concat(e," specified"));e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredCell(),n=Math.max(0,this._lastMeasuredIndex);return t.offset>=e?this._binarySearch(n,0,e):this._exponentialSearch(n,e)}}])}(),f4=function(){return"undefined"!=typeof window&&window.chrome?16777100:15e5},m4=["maxScrollSize"],g4=function(){return k3(function e(t){var n=t.maxScrollSize,i=void 0===n?f4():n,r=d4(t,m4);w3(this,e),R3(this,"_cellSizeAndPositionManager",void 0),R3(this,"_maxScrollSize",void 0),this._cellSizeAndPositionManager=new p4(r),this._maxScrollSize=i},[{key:"areOffsetsAdjusted",value:function(){return this._cellSizeAndPositionManager.getTotalSize()>this._maxScrollSize}},{key:"configure",value:function(e){this._cellSizeAndPositionManager.configure(e)}},{key:"getCellCount",value:function(){return this._cellSizeAndPositionManager.getCellCount()}},{key:"getEstimatedCellSize",value:function(){return this._cellSizeAndPositionManager.getEstimatedCellSize()}},{key:"getLastMeasuredIndex",value:function(){return this._cellSizeAndPositionManager.getLastMeasuredIndex()}},{key:"getOffsetAdjustment",value:function(e){var t=e.containerSize,n=e.offset,i=this._cellSizeAndPositionManager.getTotalSize(),r=this.getTotalSize(),s=this._getOffsetPercentage({containerSize:t,offset:n,totalSize:r});return Math.round(s*(r-i))}},{key:"getSizeAndPositionOfCell",value:function(e){return this._cellSizeAndPositionManager.getSizeAndPositionOfCell(e)}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function(){return this._cellSizeAndPositionManager.getSizeAndPositionOfLastMeasuredCell()}},{key:"getTotalSize",value:function(){return Math.min(this._maxScrollSize,this._cellSizeAndPositionManager.getTotalSize())}},{key:"getUpdatedOffsetForIndex",value:function(e){var t=e.align,n=void 0===t?"auto":t,i=e.containerSize,r=e.currentOffset,s=e.targetIndex;r=this._safeOffsetToOffset({containerSize:i,offset:r});var a=this._cellSizeAndPositionManager.getUpdatedOffsetForIndex({align:n,containerSize:i,currentOffset:r,targetIndex:s});return this._offsetToSafeOffset({containerSize:i,offset:a})}},{key:"getVisibleCellRange",value:function(e){var t=e.containerSize,n=e.offset;return n=this._safeOffsetToOffset({containerSize:t,offset:n}),this._cellSizeAndPositionManager.getVisibleCellRange({containerSize:t,offset:n})}},{key:"resetCell",value:function(e){this._cellSizeAndPositionManager.resetCell(e)}},{key:"_getOffsetPercentage",value:function(e){var t=e.containerSize,n=e.offset,i=e.totalSize;return i<=t?0:n/(i-t)}},{key:"_offsetToSafeOffset",value:function(e){var t=e.containerSize,n=e.offset,i=this._cellSizeAndPositionManager.getTotalSize(),r=this.getTotalSize();if(i===r)return n;var s=this._getOffsetPercentage({containerSize:t,offset:n,totalSize:i});return Math.round(s*(r-t))}},{key:"_safeOffsetToOffset",value:function(e){var t=e.containerSize,n=e.offset,i=this._cellSizeAndPositionManager.getTotalSize(),r=this.getTotalSize();if(i===r)return n;var s=this._getOffsetPercentage({containerSize:t,offset:n,totalSize:r});return Math.round(s*(i-t))}}])}();function b4(e){var t=e.cellSize,n=e.cellSizeAndPositionManager,i=e.previousCellsCount,r=e.previousCellSize,s=e.previousScrollToAlignment,a=e.previousScrollToIndex,o=e.previousSize,l=e.scrollOffset,c=e.scrollToAlignment,u=e.scrollToIndex,d=e.size,h=e.sizeJustIncreasedFromZero,p=e.updateScrollIndexCallback,f=n.getCellCount(),m=u>=0&&u<f;m&&(d!==o||h||!r||"number"==typeof t&&t!==r||c!==s||u!==a)?p(u):!m&&f>0&&(d<o||f<i)&&l>n.getTotalSize()-d&&p(f-1)}var y4=(h4="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).requestAnimationFrame||h4.webkitRequestAnimationFrame||h4.mozRequestAnimationFrame||h4.oRequestAnimationFrame||h4.msRequestAnimationFrame||function(e){return h4.setTimeout(e,1e3/60)},v4=h4.cancelAnimationFrame||h4.webkitCancelAnimationFrame||h4.mozCancelAnimationFrame||h4.oCancelAnimationFrame||h4.msCancelAnimationFrame||function(e){h4.clearTimeout(e)},T4=y4,x4=v4,_4=function(e){return x4(e.id)},S4=function(e,t){var n;Promise.resolve().then(function(){n=Date.now()});var i=function(){Date.now()-n>=t?e.call():r.id=T4(i)},r={id:T4(i)};return r};function w4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function I4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w4(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w4(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function k4(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(k4=function(){return!!e})()}var C4="observed",E4="requested",A4=function(){function e(t){var n,i,r,s;w3(this,e),i=this,s=[t],r=E3(r=e),R3(n=C3(i,k4()?Reflect.construct(r,s||[],E3(i).constructor):r.apply(i,s)),"_onGridRenderedMemoizer",X3()),R3(n,"_onScrollMemoizer",X3(!1)),R3(n,"_deferredInvalidateColumnIndex",null),R3(n,"_deferredInvalidateRowIndex",null),R3(n,"_recomputeScrollLeftFlag",!1),R3(n,"_recomputeScrollTopFlag",!1),R3(n,"_horizontalScrollBarSize",0),R3(n,"_verticalScrollBarSize",0),R3(n,"_scrollbarPresenceChanged",!1),R3(n,"_scrollingContainer",void 0),R3(n,"_childrenToDisplay",void 0),R3(n,"_columnStartIndex",void 0),R3(n,"_columnStopIndex",void 0),R3(n,"_rowStartIndex",void 0),R3(n,"_rowStopIndex",void 0),R3(n,"_renderedColumnStartIndex",0),R3(n,"_renderedColumnStopIndex",0),R3(n,"_renderedRowStartIndex",0),R3(n,"_renderedRowStopIndex",0),R3(n,"_initialScrollTop",void 0),R3(n,"_initialScrollLeft",void 0),R3(n,"_disablePointerEventsTimeoutId",void 0),R3(n,"_styleCache",{}),R3(n,"_cellCache",{}),R3(n,"_debounceScrollEndedCallback",function(){n._disablePointerEventsTimeoutId=null,n.setState({isScrolling:!1,needToResetStyleCache:!1})}),R3(n,"_invokeOnGridRenderedHelper",function(){var e=n.props.onSectionRendered;n._onGridRenderedMemoizer({callback:e,indices:{columnOverscanStartIndex:n._columnStartIndex,columnOverscanStopIndex:n._columnStopIndex,columnStartIndex:n._renderedColumnStartIndex,columnStopIndex:n._renderedColumnStopIndex,rowOverscanStartIndex:n._rowStartIndex,rowOverscanStopIndex:n._rowStopIndex,rowStartIndex:n._renderedRowStartIndex,rowStopIndex:n._renderedRowStopIndex}})}),R3(n,"_setScrollingContainerRef",function(e){n._scrollingContainer=e,"function"==typeof n.props.elementRef?n.props.elementRef(e):"object"===T(n.props.elementRef)&&(n.props.elementRef.current=e)}),R3(n,"_onScroll",function(e){e.target===n._scrollingContainer&&n.handleScrollEvent(e.target)});var a=new g4({cellCount:t.columnCount,cellSizeGetter:function(n){return e._wrapSizeGetter(t.columnWidth)(n)},estimatedCellSize:e._getEstimatedColumnSize(t)}),o=new g4({cellCount:t.rowCount,cellSizeGetter:function(n){return e._wrapSizeGetter(t.rowHeight)(n)},estimatedCellSize:e._getEstimatedRowSize(t)});return n.state={instanceProps:{columnSizeAndPositionManager:a,rowSizeAndPositionManager:o,prevColumnWidth:t.columnWidth,prevRowHeight:t.rowHeight,prevColumnCount:t.columnCount,prevRowCount:t.rowCount,prevIsScrolling:!0===t.isScrolling,prevScrollToColumn:t.scrollToColumn,prevScrollToRow:t.scrollToRow,scrollbarSize:0,scrollbarSizeMeasured:!1},isScrolling:!1,scrollDirectionHorizontal:1,scrollDirectionVertical:1,scrollLeft:0,scrollTop:0,scrollPositionChangeReason:null,needToResetStyleCache:!1},t.scrollToRow>0&&(n._initialScrollTop=n._getCalculatedScrollTop(t,n.state)),t.scrollToColumn>0&&(n._initialScrollLeft=n._getCalculatedScrollLeft(t,n.state)),n}return A3(e,n.exports.PureComponent),k3(e,[{key:"getOffsetForCell",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alignment,n=void 0===t?this.props.scrollToAlignment:t,i=e.columnIndex,r=void 0===i?this.props.scrollToColumn:i,s=e.rowIndex,a=void 0===s?this.props.scrollToRow:s,o=I4(I4({},this.props),{},{scrollToAlignment:n,scrollToColumn:r,scrollToRow:a});return{scrollLeft:this._getCalculatedScrollLeft(o),scrollTop:this._getCalculatedScrollTop(o)}}},{key:"getTotalRowsHeight",value:function(){return this.state.instanceProps.rowSizeAndPositionManager.getTotalSize()}},{key:"getTotalColumnsWidth",value:function(){return this.state.instanceProps.columnSizeAndPositionManager.getTotalSize()}},{key:"handleScrollEvent",value:function(e){var t=e.scrollLeft,n=void 0===t?0:t,i=e.scrollTop,r=void 0===i?0:i;if(!(r<0)){this._debounceScrollEnded();var s=this.props,a=s.autoHeight,o=s.autoWidth,l=s.height,c=s.width,u=this.state.instanceProps,d=u.scrollbarSize,h=u.rowSizeAndPositionManager.getTotalSize(),p=u.columnSizeAndPositionManager.getTotalSize(),f=Math.min(Math.max(0,p-c+d),n),m=Math.min(Math.max(0,h-l+d),r);if(this.state.scrollLeft!==f||this.state.scrollTop!==m){var g={isScrolling:!0,scrollDirectionHorizontal:f!==this.state.scrollLeft?f>this.state.scrollLeft?1:-1:this.state.scrollDirectionHorizontal,scrollDirectionVertical:m!==this.state.scrollTop?m>this.state.scrollTop?1:-1:this.state.scrollDirectionVertical,scrollPositionChangeReason:C4};a||(g.scrollTop=m),o||(g.scrollLeft=f),g.needToResetStyleCache=!1,this.setState(g)}this._invokeOnScrollMemoizer({scrollLeft:f,scrollTop:m,totalColumnsWidth:p,totalRowsHeight:h})}}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this._deferredInvalidateColumnIndex="number"==typeof this._deferredInvalidateColumnIndex?Math.min(this._deferredInvalidateColumnIndex,t):t,this._deferredInvalidateRowIndex="number"==typeof this._deferredInvalidateRowIndex?Math.min(this._deferredInvalidateRowIndex,n):n}},{key:"measureAllCells",value:function(){var e=this.props,t=e.columnCount,n=e.rowCount,i=this.state.instanceProps;i.columnSizeAndPositionManager.getSizeAndPositionOfCell(t-1),i.rowSizeAndPositionManager.getSizeAndPositionOfCell(n-1)}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i,s=this.props,a=s.scrollToColumn,o=s.scrollToRow,l=this.state.instanceProps;l.columnSizeAndPositionManager.resetCell(n),l.rowSizeAndPositionManager.resetCell(r),this._recomputeScrollLeftFlag=a>=0&&(1===this.state.scrollDirectionHorizontal?n<=a:n>=a),this._recomputeScrollTopFlag=o>=0&&(1===this.state.scrollDirectionVertical?r<=o:r>=o),this._styleCache={},this._cellCache={},this.forceUpdate()}},{key:"scrollToCell",value:function(e){var t=e.columnIndex,n=e.rowIndex,i=this.props.columnCount,r=this.props;i>1&&void 0!==t&&this._updateScrollLeftForScrollToColumn(I4(I4({},r),{},{scrollToColumn:t})),void 0!==n&&this._updateScrollTopForScrollToRow(I4(I4({},r),{},{scrollToRow:n}))}},{key:"componentDidMount",value:function(){var t=this.props,n=t.getScrollbarSize,i=t.height,r=t.scrollLeft,s=t.scrollToColumn,a=t.scrollTop,o=t.scrollToRow,l=t.width,c=this.state.instanceProps;if(this._initialScrollTop=0,this._initialScrollLeft=0,this._handleInvalidatedGridSize(),c.scrollbarSizeMeasured||this.setState(function(e){var t=I4(I4({},e),{},{needToResetStyleCache:!1});return t.instanceProps.scrollbarSize=n(),t.instanceProps.scrollbarSizeMeasured=!0,t}),"number"==typeof r&&r>=0||"number"==typeof a&&a>=0){var u=e._getScrollToPositionStateUpdate({prevState:this.state,scrollLeft:r,scrollTop:a});u&&(u.needToResetStyleCache=!1,this.setState(u))}this._scrollingContainer&&(this._scrollingContainer.scrollLeft!==this.state.scrollLeft&&(this._scrollingContainer.scrollLeft=this.state.scrollLeft),this._scrollingContainer.scrollTop!==this.state.scrollTop&&(this._scrollingContainer.scrollTop=this.state.scrollTop));var d=i>0&&l>0;s>=0&&d&&this._updateScrollLeftForScrollToColumn(),o>=0&&d&&this._updateScrollTopForScrollToRow(),this._invokeOnGridRenderedHelper(),this._invokeOnScrollMemoizer({scrollLeft:r||0,scrollTop:a||0,totalColumnsWidth:c.columnSizeAndPositionManager.getTotalSize(),totalRowsHeight:c.rowSizeAndPositionManager.getTotalSize()}),this._maybeCallOnScrollbarPresenceChange()}},{key:"componentDidUpdate",value:function(e,t){var n=this,i=this.props,r=i.autoHeight,s=i.autoWidth,a=i.columnCount,o=i.height,l=i.rowCount,c=i.scrollToAlignment,u=i.scrollToColumn,d=i.scrollToRow,h=i.width,p=this.state,f=p.scrollLeft,m=p.scrollPositionChangeReason,g=p.scrollTop,b=p.instanceProps;this._handleInvalidatedGridSize();var y=a>0&&0===e.columnCount||l>0&&0===e.rowCount;m===E4&&(!s&&f>=0&&(f!==this._scrollingContainer.scrollLeft||y)&&(this._scrollingContainer.scrollLeft=f),!r&&g>=0&&(g!==this._scrollingContainer.scrollTop||y)&&(this._scrollingContainer.scrollTop=g));var v=(0===e.width||0===e.height)&&o>0&&h>0;if(this._recomputeScrollLeftFlag?(this._recomputeScrollLeftFlag=!1,this._updateScrollLeftForScrollToColumn(this.props)):b4({cellSizeAndPositionManager:b.columnSizeAndPositionManager,previousCellsCount:e.columnCount,previousCellSize:e.columnWidth,previousScrollToAlignment:e.scrollToAlignment,previousScrollToIndex:e.scrollToColumn,previousSize:e.width,scrollOffset:f,scrollToAlignment:c,scrollToIndex:u,size:h,sizeJustIncreasedFromZero:v,updateScrollIndexCallback:function(){return n._updateScrollLeftForScrollToColumn(n.props)}}),this._recomputeScrollTopFlag?(this._recomputeScrollTopFlag=!1,this._updateScrollTopForScrollToRow(this.props)):b4({cellSizeAndPositionManager:b.rowSizeAndPositionManager,previousCellsCount:e.rowCount,previousCellSize:e.rowHeight,previousScrollToAlignment:e.scrollToAlignment,previousScrollToIndex:e.scrollToRow,previousSize:e.height,scrollOffset:g,scrollToAlignment:c,scrollToIndex:d,size:o,sizeJustIncreasedFromZero:v,updateScrollIndexCallback:function(){return n._updateScrollTopForScrollToRow(n.props)}}),this._invokeOnGridRenderedHelper(),f!==t.scrollLeft||g!==t.scrollTop){var T=b.rowSizeAndPositionManager.getTotalSize(),x=b.columnSizeAndPositionManager.getTotalSize();this._invokeOnScrollMemoizer({scrollLeft:f,scrollTop:g,totalColumnsWidth:x,totalRowsHeight:T})}this._maybeCallOnScrollbarPresenceChange()}},{key:"componentWillUnmount",value:function(){this._disablePointerEventsTimeoutId&&_4(this._disablePointerEventsTimeoutId)}},{key:"render",value:function(){var e=this.props,t=e.autoContainerWidth,n=e.autoHeight,i=e.autoWidth,r=e.className,s=e.containerProps,a=e.containerRole,l=e.containerStyle,c=e.height,d=e.id,h=e.noContentRenderer,p=e.role,f=e.style,m=e.tabIndex,g=e.width,b=this.state,y=b.instanceProps,v=b.needToResetStyleCache,T=this._isScrolling(),x={boxSizing:"border-box",direction:"ltr",height:n?"auto":c,position:"relative",width:i?"auto":g,WebkitOverflowScrolling:"touch",willChange:"transform"};v&&(this._styleCache={}),this.state.isScrolling||this._resetStyleCache(),this._calculateChildrenToRender(this.props,this.state);var _=y.columnSizeAndPositionManager.getTotalSize(),S=y.rowSizeAndPositionManager.getTotalSize(),w=S>c?y.scrollbarSize:0,I=_>g?y.scrollbarSize:0;I===this._horizontalScrollBarSize&&w===this._verticalScrollBarSize||(this._horizontalScrollBarSize=I,this._verticalScrollBarSize=w,this._scrollbarPresenceChanged=!0),x.overflowX=_+w<=g?"hidden":"auto",x.overflowY=S+I<=c?"hidden":"auto";var k=this._childrenToDisplay,C=0===k.length&&c>0&&g>0;return u("div",{ref:this._setScrollingContainerRef,...s,"aria-label":this.props["aria-label"],"aria-readonly":this.props["aria-readonly"],className:q3("ReactVirtualized__Grid",r),id:d,onScroll:this._onScroll,role:p,style:I4(I4({},x),f),tabIndex:m,children:[k.length>0&&o("div",{className:"ReactVirtualized__Grid__innerScrollContainer",role:a,style:I4({width:t?"auto":_,height:S,maxWidth:_,maxHeight:S,overflow:"hidden",pointerEvents:T?"none":"",position:"relative"},l),children:k}),C&&h()]})}},{key:"_calculateChildrenToRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,n=e.cellRenderer,i=e.cellRangeRenderer,r=e.columnCount,s=e.deferredMeasurementCache,a=e.height,o=e.overscanColumnCount,l=e.overscanIndicesGetter,c=e.overscanRowCount,u=e.rowCount,d=e.width,h=e.isScrollingOptOut,p=t.scrollDirectionHorizontal,f=t.scrollDirectionVertical,m=t.instanceProps,g=this._initialScrollTop>0?this._initialScrollTop:t.scrollTop,b=this._initialScrollLeft>0?this._initialScrollLeft:t.scrollLeft,y=this._isScrolling(e,t);if(this._childrenToDisplay=[],a>0&&d>0){var v=m.columnSizeAndPositionManager.getVisibleCellRange({containerSize:d,offset:b}),T=m.rowSizeAndPositionManager.getVisibleCellRange({containerSize:a,offset:g}),x=m.columnSizeAndPositionManager.getOffsetAdjustment({containerSize:d,offset:b}),_=m.rowSizeAndPositionManager.getOffsetAdjustment({containerSize:a,offset:g});this._renderedColumnStartIndex=v.start,this._renderedColumnStopIndex=v.stop,this._renderedRowStartIndex=T.start,this._renderedRowStopIndex=T.stop;var S=l({direction:"horizontal",cellCount:r,overscanCellsCount:o,scrollDirection:p,startIndex:"number"==typeof v.start?v.start:0,stopIndex:"number"==typeof v.stop?v.stop:-1}),w=l({direction:"vertical",cellCount:u,overscanCellsCount:c,scrollDirection:f,startIndex:"number"==typeof T.start?T.start:0,stopIndex:"number"==typeof T.stop?T.stop:-1}),I=S.overscanStartIndex,k=S.overscanStopIndex,C=w.overscanStartIndex,E=w.overscanStopIndex;if(s){if(!s.hasFixedHeight())for(var A=C;A<=E;A++)if(!s.has(A,0)){I=0,k=r-1;break}if(!s.hasFixedWidth())for(var R=I;R<=k;R++)if(!s.has(0,R)){C=0,E=u-1;break}}this._childrenToDisplay=i({cellCache:this._cellCache,cellRenderer:n,columnSizeAndPositionManager:m.columnSizeAndPositionManager,columnStartIndex:I,columnStopIndex:k,deferredMeasurementCache:s,horizontalOffsetAdjustment:x,isScrolling:y,isScrollingOptOut:h,parent:this,rowSizeAndPositionManager:m.rowSizeAndPositionManager,rowStartIndex:C,rowStopIndex:E,scrollLeft:b,scrollTop:g,styleCache:this._styleCache,verticalOffsetAdjustment:_,visibleColumnIndices:v,visibleRowIndices:T}),this._columnStartIndex=I,this._columnStopIndex=k,this._rowStartIndex=C,this._rowStopIndex=E}}},{key:"_debounceScrollEnded",value:function(){var e=this.props.scrollingResetTimeInterval;this._disablePointerEventsTimeoutId&&_4(this._disablePointerEventsTimeoutId),this._disablePointerEventsTimeoutId=S4(this._debounceScrollEndedCallback,e)}},{key:"_handleInvalidatedGridSize",value:function(){if("number"==typeof this._deferredInvalidateColumnIndex&&"number"==typeof this._deferredInvalidateRowIndex){var e=this._deferredInvalidateColumnIndex,t=this._deferredInvalidateRowIndex;this._deferredInvalidateColumnIndex=null,this._deferredInvalidateRowIndex=null,this.recomputeGridSize({columnIndex:e,rowIndex:t})}}},{key:"_invokeOnScrollMemoizer",value:function(e){var t=this,n=e.scrollLeft,i=e.scrollTop,r=e.totalColumnsWidth,s=e.totalRowsHeight;this._onScrollMemoizer({callback:function(e){var n=e.scrollLeft,i=e.scrollTop,a=t.props,o=a.height;(0,a.onScroll)({clientHeight:o,clientWidth:a.width,scrollHeight:s,scrollLeft:n,scrollTop:i,scrollWidth:r})},indices:{scrollLeft:n,scrollTop:i}})}},{key:"_isScrolling",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;return Object.hasOwnProperty.call(e,"isScrolling")?Boolean(e.isScrolling):Boolean(t.isScrolling)}},{key:"_maybeCallOnScrollbarPresenceChange",value:function(){if(this._scrollbarPresenceChanged){var e=this.props.onScrollbarPresenceChange;this._scrollbarPresenceChanged=!1,e({horizontal:this._horizontalScrollBarSize>0,size:this.state.instanceProps.scrollbarSize,vertical:this._verticalScrollBarSize>0})}}},{key:"scrollToPosition",value:function(t){var n=t.scrollLeft,i=t.scrollTop,r=e._getScrollToPositionStateUpdate({prevState:this.state,scrollLeft:n,scrollTop:i});r&&(r.needToResetStyleCache=!1,this.setState(r))}},{key:"_getCalculatedScrollLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;return e._getCalculatedScrollLeft(t,n)}},{key:"_updateScrollLeftForScrollToColumn",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,i=e._getScrollLeftForScrollToColumnStateUpdate(t,n);i&&(i.needToResetStyleCache=!1,this.setState(i))}},{key:"_getCalculatedScrollTop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;return e._getCalculatedScrollTop(t,n)}},{key:"_resetStyleCache",value:function(){var e=this._styleCache,t=this._cellCache,n=this.props.isScrollingOptOut;this._cellCache={},this._styleCache={};for(var i=this._rowStartIndex;i<=this._rowStopIndex;i++)for(var r=this._columnStartIndex;r<=this._columnStopIndex;r++){var s="".concat(i,"-").concat(r);this._styleCache[s]=e[s],n&&(this._cellCache[s]=t[s])}}},{key:"_updateScrollTopForScrollToRow",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,i=e._getScrollTopForScrollToRowStateUpdate(t,n);i&&(i.needToResetStyleCache=!1,this.setState(i))}}],[{key:"getDerivedStateFromProps",value:function(t,n){var i={};0===t.columnCount&&0!==n.scrollLeft||0===t.rowCount&&0!==n.scrollTop?(i.scrollLeft=0,i.scrollTop=0):(t.scrollLeft!==n.scrollLeft&&t.scrollToColumn<0||t.scrollTop!==n.scrollTop&&t.scrollToRow<0)&&Object.assign(i,e._getScrollToPositionStateUpdate({prevState:n,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}));var r,s,a=n.instanceProps;return i.needToResetStyleCache=!1,t.columnWidth===a.prevColumnWidth&&t.rowHeight===a.prevRowHeight||(i.needToResetStyleCache=!0),a.columnSizeAndPositionManager.configure({cellCount:t.columnCount,estimatedCellSize:e._getEstimatedColumnSize(t),cellSizeGetter:e._wrapSizeGetter(t.columnWidth)}),a.rowSizeAndPositionManager.configure({cellCount:t.rowCount,estimatedCellSize:e._getEstimatedRowSize(t),cellSizeGetter:e._wrapSizeGetter(t.rowHeight)}),0!==a.prevColumnCount&&0!==a.prevRowCount||(a.prevColumnCount=0,a.prevRowCount=0),t.autoHeight&&!1===t.isScrolling&&!0===a.prevIsScrolling&&Object.assign(i,{isScrolling:!1}),u4({cellCount:a.prevColumnCount,cellSize:"number"==typeof a.prevColumnWidth?a.prevColumnWidth:null,computeMetadataCallback:function(){return a.columnSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:t,nextCellsCount:t.columnCount,nextCellSize:"number"==typeof t.columnWidth?t.columnWidth:null,nextScrollToIndex:t.scrollToColumn,scrollToIndex:a.prevScrollToColumn,updateScrollOffsetForScrollToIndex:function(){r=e._getScrollLeftForScrollToColumnStateUpdate(t,n)}}),u4({cellCount:a.prevRowCount,cellSize:"number"==typeof a.prevRowHeight?a.prevRowHeight:null,computeMetadataCallback:function(){return a.rowSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:t,nextCellsCount:t.rowCount,nextCellSize:"number"==typeof t.rowHeight?t.rowHeight:null,nextScrollToIndex:t.scrollToRow,scrollToIndex:a.prevScrollToRow,updateScrollOffsetForScrollToIndex:function(){s=e._getScrollTopForScrollToRowStateUpdate(t,n)}}),a.prevColumnCount=t.columnCount,a.prevColumnWidth=t.columnWidth,a.prevIsScrolling=!0===t.isScrolling,a.prevRowCount=t.rowCount,a.prevRowHeight=t.rowHeight,a.prevScrollToColumn=t.scrollToColumn,a.prevScrollToRow=t.scrollToRow,a.scrollbarSize=t.getScrollbarSize(),void 0===a.scrollbarSize?(a.scrollbarSizeMeasured=!1,a.scrollbarSize=0):a.scrollbarSizeMeasured=!0,i.instanceProps=a,I4(I4(I4({},i),r),s)}},{key:"_getEstimatedColumnSize",value:function(e){return"number"==typeof e.columnWidth?e.columnWidth:e.estimatedColumnSize}},{key:"_getEstimatedRowSize",value:function(e){return"number"==typeof e.rowHeight?e.rowHeight:e.estimatedRowSize}},{key:"_getScrollToPositionStateUpdate",value:function(e){var t=e.prevState,n=e.scrollLeft,i=e.scrollTop,r={scrollPositionChangeReason:E4};return"number"==typeof n&&n>=0&&(r.scrollDirectionHorizontal=n>t.scrollLeft?1:-1,r.scrollLeft=n),"number"==typeof i&&i>=0&&(r.scrollDirectionVertical=i>t.scrollTop?1:-1,r.scrollTop=i),"number"==typeof n&&n>=0&&n!==t.scrollLeft||"number"==typeof i&&i>=0&&i!==t.scrollTop?r:{}}},{key:"_wrapSizeGetter",value:function(e){return"function"==typeof e?e:function(){return e}}},{key:"_getCalculatedScrollLeft",value:function(e,t){var n=e.columnCount,i=e.height,r=e.scrollToAlignment,s=e.scrollToColumn,a=e.width,o=t.scrollLeft,l=t.instanceProps;if(n>0){var c=n-1,u=s<0?c:Math.min(c,s),d=l.rowSizeAndPositionManager.getTotalSize(),h=l.scrollbarSizeMeasured&&d>i?l.scrollbarSize:0;return l.columnSizeAndPositionManager.getUpdatedOffsetForIndex({align:r,containerSize:a-h,currentOffset:o,targetIndex:u})}return 0}},{key:"_getScrollLeftForScrollToColumnStateUpdate",value:function(t,n){var i=n.scrollLeft,r=e._getCalculatedScrollLeft(t,n);return"number"==typeof r&&r>=0&&i!==r?e._getScrollToPositionStateUpdate({prevState:n,scrollLeft:r,scrollTop:-1}):{}}},{key:"_getCalculatedScrollTop",value:function(e,t){var n=e.height,i=e.rowCount,r=e.scrollToAlignment,s=e.scrollToRow,a=e.width,o=t.scrollTop,l=t.instanceProps;if(i>0){var c=i-1,u=s<0?c:Math.min(c,s),d=l.columnSizeAndPositionManager.getTotalSize(),h=l.scrollbarSizeMeasured&&d>a?l.scrollbarSize:0;return l.rowSizeAndPositionManager.getUpdatedOffsetForIndex({align:r,containerSize:n-h,currentOffset:o,targetIndex:u})}return 0}},{key:"_getScrollTopForScrollToRowStateUpdate",value:function(t,n){var i=n.scrollTop,r=e._getCalculatedScrollTop(t,n);return"number"==typeof r&&r>=0&&i!==r?e._getScrollToPositionStateUpdate({prevState:n,scrollLeft:-1,scrollTop:r}):{}}}])}();R3(A4,"defaultProps",{"aria-label":"grid","aria-readonly":!0,autoContainerWidth:!1,autoHeight:!1,autoWidth:!1,cellRangeRenderer:function(e){for(var t=e.cellCache,n=e.cellRenderer,r=e.columnSizeAndPositionManager,s=e.columnStartIndex,a=e.columnStopIndex,o=e.deferredMeasurementCache,l=e.horizontalOffsetAdjustment,c=e.isScrolling,u=e.isScrollingOptOut,d=e.parent,h=e.rowSizeAndPositionManager,p=e.rowStartIndex,f=e.rowStopIndex,m=e.styleCache,g=e.verticalOffsetAdjustment,b=e.visibleColumnIndices,y=e.visibleRowIndices,v=[],T=r.areOffsetsAdjusted()||h.areOffsetsAdjusted(),x=!c&&!T,_=p;_<=f;_++)for(var S=h.getSizeAndPositionOfCell(_),w=s;w<=a;w++){var I=r.getSizeAndPositionOfCell(w),k=w>=b.start&&w<=b.stop&&_>=y.start&&_<=y.stop,C="".concat(_,"-").concat(w),E=void 0;x&&m[C]?E=m[C]:o&&!o.has(_,w)?E={height:"auto",left:0,position:"absolute",top:0,width:"auto"}:(E={height:S.size,left:I.offset+l,position:"absolute",top:S.offset+g,width:I.size},m[C]=E);var A={columnIndex:w,isScrolling:c,isVisible:k,key:C,parent:d,rowIndex:_,style:E},R=void 0;!u&&!c||l||g?R=n(A):(t[C]||(t[C]=n(A)),R=t[C]),null!=R&&!1!==R&&(R.props.role||(R=i.cloneElement(R,{role:"gridcell"})),v.push(R))}return v},containerRole:"row",containerStyle:{},estimatedColumnSize:100,estimatedRowSize:30,getScrollbarSize:Z3,noContentRenderer:function(){return null},onScroll:function(){},onScrollbarPresenceChange:function(){},onSectionRendered:function(){},overscanColumnCount:0,overscanIndicesGetter:function(e){var t=e.cellCount,n=e.overscanCellsCount,i=e.scrollDirection,r=e.startIndex,s=e.stopIndex;return 1===i?{overscanStartIndex:Math.max(0,r),overscanStopIndex:Math.min(t-1,s+n)}:{overscanStartIndex:Math.max(0,r-n),overscanStopIndex:Math.min(t-1,s)}},overscanRowCount:10,role:"grid",scrollingResetTimeInterval:150,scrollToAlignment:"auto",scrollToColumn:-1,scrollToRow:-1,style:{},tabIndex:0,isScrollingOptOut:!1}),O3(A4);function R4(e){var t=e.cellCount,n=e.overscanCellsCount,i=e.scrollDirection,r=e.startIndex,s=e.stopIndex;return n=Math.max(1,n),1===i?{overscanStartIndex:Math.max(0,r-1),overscanStopIndex:Math.min(t-1,s+n)}:{overscanStartIndex:Math.max(0,r-n),overscanStopIndex:Math.min(t-1,s+1)}}function N4(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function P4(e,t){if(e){if("string"==typeof e)return N4(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N4(e,t):void 0}}function D4(e){return function(e){if(Array.isArray(e))return N4(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P4(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O4(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(O4=function(){return!!e})()}var L4=function(){function e(t,n){var i,r,s,a;return w3(this,e),r=this,a=[t,n],s=E3(s=e),(i=C3(r,O4()?Reflect.construct(s,a||[],E3(r).constructor):s.apply(r,a)))._loadMoreRowsMemoizer=X3(),i._onRowsRendered=i._onRowsRendered.bind(i),i._registerChild=i._registerChild.bind(i),i}return A3(e,n.exports.PureComponent),k3(e,[{key:"resetLoadMoreRowsCache",value:function(e){this._loadMoreRowsMemoizer=X3(),e&&this._doStuff(this._lastRenderedStartIndex,this._lastRenderedStopIndex)}},{key:"render",value:function(){return(0,this.props.children)({onRowsRendered:this._onRowsRendered,registerChild:this._registerChild})}},{key:"_loadUnloadedRanges",value:function(e){var t=this,n=this.props.loadMoreRows;e.forEach(function(e){var i=n(e);i&&i.then(function(){var n,i,r,s,a;n={lastRenderedStartIndex:t._lastRenderedStartIndex,lastRenderedStopIndex:t._lastRenderedStopIndex,startIndex:e.startIndex,stopIndex:e.stopIndex},i=n.lastRenderedStartIndex,r=n.lastRenderedStopIndex,s=n.startIndex,a=n.stopIndex,s>r||a<i||t._registeredChild&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n="function"==typeof e.recomputeGridSize?e.recomputeGridSize:e.recomputeRowHeights;n?n.call(e,t):e.forceUpdate()}(t._registeredChild,t._lastRenderedStartIndex)})})}},{key:"_onRowsRendered",value:function(e){var t=e.startIndex,n=e.stopIndex;this._lastRenderedStartIndex=t,this._lastRenderedStopIndex=n,this._doStuff(t,n)}},{key:"_doStuff",value:function(e,t){var n,i=this,r=this.props,s=r.isRowLoaded,a=r.minimumBatchSize,o=r.rowCount,l=r.threshold,c=function(e){for(var t=e.isRowLoaded,n=e.minimumBatchSize,i=e.rowCount,r=e.startIndex,s=e.stopIndex,a=[],o=null,l=null,c=r;c<=s;c++){t({index:c})?null!==l&&(a.push({startIndex:o,stopIndex:l}),o=l=null):(l=c,null===o&&(o=c))}if(null!==l){for(var u=Math.min(Math.max(l,o+n-1),i-1),d=l+1;d<=u&&!t({index:d});d++)l=d;a.push({startIndex:o,stopIndex:l})}if(a.length)for(var h=a[0];h.stopIndex-h.startIndex+1<n&&h.startIndex>0;){var p=h.startIndex-1;if(t({index:p}))break;h.startIndex=p}return a}({isRowLoaded:s,minimumBatchSize:a,rowCount:o,startIndex:Math.max(0,e-l),stopIndex:Math.min(o-1,t+l)}),u=(n=[]).concat.apply(n,D4(c.map(function(e){return[e.startIndex,e.stopIndex]})));this._loadMoreRowsMemoizer({callback:function(){i._loadUnloadedRanges(c)},indices:{squashedUnloadedRanges:u}})}},{key:"_registerChild",value:function(e){this._registeredChild=e}}])}();function M4(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(M4=function(){return!!e})()}R3(L4,"defaultProps",{minimumBatchSize:10,rowCount:0,threshold:15}),L4.propTypes={};var F4=function(){function e(){var t,n,i,r;w3(this,e);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return n=this,i=e,r=[].concat(a),i=E3(i),R3(t=C3(n,M4()?Reflect.construct(i,r||[],E3(n).constructor):i.apply(n,r)),"Grid",void 0),R3(t,"_cellRenderer",function(e){var n=e.parent,i=e.rowIndex,r=e.style,s=e.isScrolling,a=e.isVisible,o=e.key,l=t.props.rowRenderer,c=Object.getOwnPropertyDescriptor(r,"width");return c&&c.writable&&(r.width="100%"),l({index:i,style:r,isScrolling:s,isVisible:a,key:o,parent:n})}),R3(t,"_setRef",function(e){t.Grid=e}),R3(t,"_onScroll",function(e){var n=e.clientHeight,i=e.scrollHeight,r=e.scrollTop;(0,t.props.onScroll)({clientHeight:n,scrollHeight:i,scrollTop:r})}),R3(t,"_onSectionRendered",function(e){var n=e.rowOverscanStartIndex,i=e.rowOverscanStopIndex,r=e.rowStartIndex,s=e.rowStopIndex;(0,t.props.onRowsRendered)({overscanStartIndex:n,overscanStopIndex:i,startIndex:r,stopIndex:s})}),t}return A3(e,n.exports.PureComponent),k3(e,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.noRowsRenderer,i=e.scrollToIndex,r=e.width,s=q3("ReactVirtualized__List",t);return o(A4,{...this.props,autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:s,columnWidth:r,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:i})}}])}();function $4(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,c=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==t);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,t)||P4(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}R3(F4,"defaultProps",{autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:R4,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}});const B4={ge:function(e,t,n,i,r){return"function"==typeof n?function(e,t,n,i,r){for(var s=n+1;t<=n;){var a=t+n>>>1;r(e[a],i)>=0?(s=a,n=a-1):t=a+1}return s}(e,void 0===i?0:0|i,void 0===r?e.length-1:0|r,t,n):function(e,t,n,i){for(var r=n+1;t<=n;){var s=t+n>>>1;e[s]>=i?(r=s,n=s-1):t=s+1}return r}(e,void 0===n?0:0|n,void 0===i?e.length-1:0|i,t)},gt:function(e,t,n,i,r){return"function"==typeof n?function(e,t,n,i,r){for(var s=n+1;t<=n;){var a=t+n>>>1;r(e[a],i)>0?(s=a,n=a-1):t=a+1}return s}(e,void 0===i?0:0|i,void 0===r?e.length-1:0|r,t,n):function(e,t,n,i){for(var r=n+1;t<=n;){var s=t+n>>>1;e[s]>i?(r=s,n=s-1):t=s+1}return r}(e,void 0===n?0:0|n,void 0===i?e.length-1:0|i,t)},lt:function(e,t,n,i,r){return"function"==typeof n?function(e,t,n,i,r){for(var s=t-1;t<=n;){var a=t+n>>>1;r(e[a],i)<0?(s=a,t=a+1):n=a-1}return s}(e,void 0===i?0:0|i,void 0===r?e.length-1:0|r,t,n):function(e,t,n,i){for(var r=t-1;t<=n;){var s=t+n>>>1;e[s]<i?(r=s,t=s+1):n=s-1}return r}(e,void 0===n?0:0|n,void 0===i?e.length-1:0|i,t)},le:function(e,t,n,i,r){return"function"==typeof n?function(e,t,n,i,r){for(var s=t-1;t<=n;){var a=t+n>>>1;r(e[a],i)<=0?(s=a,t=a+1):n=a-1}return s}(e,void 0===i?0:0|i,void 0===r?e.length-1:0|r,t,n):function(e,t,n,i){for(var r=t-1;t<=n;){var s=t+n>>>1;e[s]<=i?(r=s,t=s+1):n=s-1}return r}(e,void 0===n?0:0|n,void 0===i?e.length-1:0|i,t)},eq:function(e,t,n,i,r){return"function"==typeof n?function(e,t,n,i,r){for(;t<=n;){var s=t+n>>>1,a=r(e[s],i);if(0===a)return s;a<=0?t=s+1:n=s-1}return-1}(e,void 0===i?0:0|i,void 0===r?e.length-1:0|r,t,n):function(e,t,n,i){for(;t<=n;){var r=t+n>>>1,s=e[r];if(s===i)return r;s<=i?t=r+1:n=r-1}return-1}(e,void 0===n?0:0|n,void 0===i?e.length-1:0|i,t)}};function z4(e,t,n,i,r){this.mid=e,this.left=t,this.right=n,this.leftPoints=i,this.rightPoints=r,this.count=(t?t.count:0)+(n?n.count:0)+i.length}var U4=z4.prototype;function G4(e,t){e.mid=t.mid,e.left=t.left,e.right=t.right,e.leftPoints=t.leftPoints,e.rightPoints=t.rightPoints,e.count=t.count}function V4(e,t){var n=Q4(t);e.mid=n.mid,e.left=n.left,e.right=n.right,e.leftPoints=n.leftPoints,e.rightPoints=n.rightPoints,e.count=n.count}function H4(e,t){var n=e.intervals([]);n.push(t),V4(e,n)}function W4(e,t){var n=e.intervals([]),i=n.indexOf(t);return i<0?0:(n.splice(i,1),V4(e,n),1)}function j4(e,t,n){for(var i=0;i<e.length&&e[i][0]<=t;++i){var r=n(e[i]);if(r)return r}}function q4(e,t,n){for(var i=e.length-1;i>=0&&e[i][1]>=t;--i){var r=n(e[i]);if(r)return r}}function X4(e,t){for(var n=0;n<e.length;++n){var i=t(e[n]);if(i)return i}}function K4(e,t){return e-t}function Y4(e,t){var n=e[0]-t[0];return n||e[1]-t[1]}function Z4(e,t){var n=e[1]-t[1];return n||e[0]-t[0]}function Q4(e){if(0===e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e[n][0],e[n][1]);t.sort(K4);var i=t[t.length>>1],r=[],s=[],a=[];for(n=0;n<e.length;++n){var o=e[n];o[1]<i?r.push(o):i<o[0]?s.push(o):a.push(o)}var l=a,c=a.slice();return l.sort(Y4),c.sort(Z4),new z4(i,Q4(r),Q4(s),l,c)}function J4(e){this.root=e}U4.intervals=function(e){return e.push.apply(e,this.leftPoints),this.left&&this.left.intervals(e),this.right&&this.right.intervals(e),e},U4.insert=function(e){var t=this.count-this.leftPoints.length;if(this.count+=1,e[1]<this.mid)this.left?4*(this.left.count+1)>3*(t+1)?H4(this,e):this.left.insert(e):this.left=Q4([e]);else if(e[0]>this.mid)this.right?4*(this.right.count+1)>3*(t+1)?H4(this,e):this.right.insert(e):this.right=Q4([e]);else{var n=B4.ge(this.leftPoints,e,Y4),i=B4.ge(this.rightPoints,e,Z4);this.leftPoints.splice(n,0,e),this.rightPoints.splice(i,0,e)}},U4.remove=function(e){var t=this.count-this.leftPoints;if(e[1]<this.mid)return this.left?4*(this.right?this.right.count:0)>3*(t-1)?W4(this,e):2===(s=this.left.remove(e))?(this.left=null,this.count-=1,1):(1===s&&(this.count-=1),s):0;if(e[0]>this.mid)return this.right?4*(this.left?this.left.count:0)>3*(t-1)?W4(this,e):2===(s=this.right.remove(e))?(this.right=null,this.count-=1,1):(1===s&&(this.count-=1),s):0;if(1===this.count)return this.leftPoints[0]===e?2:0;if(1===this.leftPoints.length&&this.leftPoints[0]===e){if(this.left&&this.right){for(var n=this,i=this.left;i.right;)n=i,i=i.right;if(n===this)i.right=this.right;else{var r=this.left,s=this.right;n.count-=i.count,n.right=i.left,i.left=r,i.right=s}G4(this,i),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?G4(this,this.left):G4(this,this.right);return 1}for(r=B4.ge(this.leftPoints,e,Y4);r<this.leftPoints.length&&this.leftPoints[r][0]===e[0];++r)if(this.leftPoints[r]===e){this.count-=1,this.leftPoints.splice(r,1);for(s=B4.ge(this.rightPoints,e,Z4);s<this.rightPoints.length&&this.rightPoints[s][1]===e[1];++s)if(this.rightPoints[s]===e)return this.rightPoints.splice(s,1),1}return 0},U4.queryPoint=function(e,t){if(e<this.mid){if(this.left)if(n=this.left.queryPoint(e,t))return n;return j4(this.leftPoints,e,t)}if(e>this.mid){var n;if(this.right)if(n=this.right.queryPoint(e,t))return n;return q4(this.rightPoints,e,t)}return X4(this.leftPoints,t)},U4.queryInterval=function(e,t,n){var i;if(e<this.mid&&this.left&&(i=this.left.queryInterval(e,t,n)))return i;if(t>this.mid&&this.right&&(i=this.right.queryInterval(e,t,n)))return i;return t<this.mid?j4(this.leftPoints,t,n):e>this.mid?q4(this.rightPoints,e,n):X4(this.leftPoints,n)};var e5=J4.prototype;e5.insert=function(e){this.root?this.root.insert(e):this.root=new z4(e[0],null,null,[e],[e])},e5.remove=function(e){if(this.root){var t=this.root.remove(e);return 2===t&&(this.root=null),0!==t}return!1},e5.queryPoint=function(e,t){if(this.root)return this.root.queryPoint(e,t)},e5.queryInterval=function(e,t,n){if(e<=t&&this.root)return this.root.queryInterval(e,t,n)},Object.defineProperty(e5,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(e5,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});var t5=function(){return k3(function e(){var t;w3(this,e),R3(this,"_columnSizeMap",{}),R3(this,"_intervalTree",t&&0!==t.length?new J4(Q4(t)):new J4(null)),R3(this,"_leftMap",{})},[{key:"estimateTotalHeight",value:function(e,t,n){var i=e-this.count;return this.tallestColumnSize+Math.ceil(i/t)*n}},{key:"range",value:function(e,t,n){var i=this;this._intervalTree.queryInterval(e,e+t,function(e){var t=$4(e,3),r=t[0];t[1];var s=t[2];return n(s,i._leftMap[s],r)})}},{key:"setPosition",value:function(e,t,n,i){this._intervalTree.insert([n,n+i,e]),this._leftMap[e]=t;var r=this._columnSizeMap,s=r[t];r[t]=void 0===s?n+i:Math.max(s,n+i)}},{key:"count",get:function(){return this._intervalTree.count}},{key:"shortestColumnSize",get:function(){var e=this._columnSizeMap,t=0;for(var n in e){var i=e[n];t=0===t?i:Math.min(t,i)}return t}},{key:"tallestColumnSize",get:function(){var e=this._columnSizeMap,t=0;for(var n in e){var i=e[n];t=Math.max(t,i)}return t}}])}();function n5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function i5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?n5(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n5(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(r5=function(){return!!e})()}var s5=function(){function e(){var t,n,i,r;w3(this,e);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return n=this,i=e,r=[].concat(a),i=E3(i),R3(t=C3(n,r5()?Reflect.construct(i,r||[],E3(n).constructor):i.apply(n,r)),"state",{isScrolling:!1,scrollTop:0}),R3(t,"_debounceResetIsScrollingId",void 0),R3(t,"_invalidateOnUpdateStartIndex",null),R3(t,"_invalidateOnUpdateStopIndex",null),R3(t,"_positionCache",new t5),R3(t,"_startIndex",null),R3(t,"_startIndexMemoized",null),R3(t,"_stopIndex",null),R3(t,"_stopIndexMemoized",null),R3(t,"_debounceResetIsScrollingCallback",function(){t.setState({isScrolling:!1})}),R3(t,"_setScrollingContainerRef",function(e){t._scrollingContainer=e}),R3(t,"_onScroll",function(e){var n=t.props.height,i=e.currentTarget.scrollTop,r=Math.min(Math.max(0,t._getEstimatedTotalHeight()-n),i);i===r&&(t._debounceResetIsScrolling(),t.state.scrollTop!==r&&t.setState({isScrolling:!0,scrollTop:r}))}),t}return A3(e,n.exports.PureComponent),k3(e,[{key:"clearCellPositions",value:function(){this._positionCache=new t5,this.forceUpdate()}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.rowIndex;null===this._invalidateOnUpdateStartIndex?(this._invalidateOnUpdateStartIndex=t,this._invalidateOnUpdateStopIndex=t):(this._invalidateOnUpdateStartIndex=Math.min(this._invalidateOnUpdateStartIndex,t),this._invalidateOnUpdateStopIndex=Math.max(this._invalidateOnUpdateStopIndex,t))}},{key:"recomputeCellPositions",value:function(){var e=this._positionCache.count-1;this._positionCache=new t5,this._populatePositionCache(0,e),this.forceUpdate()}},{key:"componentDidMount",value:function(){this._checkInvalidateOnUpdate(),this._invokeOnScrollCallback(),this._invokeOnCellsRenderedCallback()}},{key:"componentDidUpdate",value:function(e,t){this._checkInvalidateOnUpdate(),this._invokeOnScrollCallback(),this._invokeOnCellsRenderedCallback(),this.props.scrollTop!==e.scrollTop&&this._debounceResetIsScrolling()}},{key:"componentWillUnmount",value:function(){this._debounceResetIsScrollingId&&_4(this._debounceResetIsScrollingId)}},{key:"render",value:function(){var e,t=this,n=this.props,i=n.autoHeight,r=n.cellCount,s=n.cellMeasurerCache,a=n.cellRenderer,l=n.className,c=n.height,u=n.id,d=n.keyMapper,h=n.overscanByPixels,p=n.role,f=n.style,m=n.tabIndex,g=n.width,b=n.rowDirection,y=this.state,v=y.isScrolling,T=y.scrollTop,x=[],_=this._getEstimatedTotalHeight(),S=this._positionCache.shortestColumnSize,w=this._positionCache.count,I=0;if(this._positionCache.range(Math.max(0,T-h),c+2*h,function(n,i,r){void 0===e?(I=n,e=n):(I=Math.min(I,n),e=Math.max(e,n)),x.push(a({index:n,isScrolling:v,key:d(n),parent:t,style:R3(R3(R3(R3({height:s.getHeight(n)},"ltr"===b?"left":"right",i),"position","absolute"),"top",r),"width",s.getWidth(n))}))}),S<T+c+h&&w<r)for(var k=Math.min(r-w,Math.ceil((T+c+h-S)/s.defaultHeight*g/s.defaultWidth)),C=w;C<w+k;C++)e=C,x.push(a({index:C,isScrolling:v,key:d(C),parent:this,style:{width:s.getWidth(C)}}));return this._startIndex=I,this._stopIndex=e,o("div",{ref:this._setScrollingContainerRef,"aria-label":this.props["aria-label"],className:q3("ReactVirtualized__Masonry",l),id:u,onScroll:this._onScroll,role:p,style:i5({boxSizing:"border-box",direction:"ltr",height:i?"auto":c,overflowX:"hidden",overflowY:_<c?"hidden":"auto",position:"relative",width:g,WebkitOverflowScrolling:"touch",willChange:"transform"},f),tabIndex:m,children:o("div",{className:"ReactVirtualized__Masonry__innerScrollContainer",style:{width:"100%",height:_,maxWidth:"100%",maxHeight:_,overflow:"hidden",pointerEvents:v?"none":"",position:"relative"},children:x})})}},{key:"_checkInvalidateOnUpdate",value:function(){if("number"==typeof this._invalidateOnUpdateStartIndex){var e=this._invalidateOnUpdateStartIndex,t=this._invalidateOnUpdateStopIndex;this._invalidateOnUpdateStartIndex=null,this._invalidateOnUpdateStopIndex=null,this._populatePositionCache(e,t),this.forceUpdate()}}},{key:"_debounceResetIsScrolling",value:function(){var e=this.props.scrollingResetTimeInterval;this._debounceResetIsScrollingId&&_4(this._debounceResetIsScrollingId),this._debounceResetIsScrollingId=S4(this._debounceResetIsScrollingCallback,e)}},{key:"_getEstimatedTotalHeight",value:function(){var e=this.props,t=e.cellCount,n=e.cellMeasurerCache,i=e.width,r=Math.max(1,Math.floor(i/n.defaultWidth));return this._positionCache.estimateTotalHeight(t,r,n.defaultHeight)}},{key:"_invokeOnScrollCallback",value:function(){var e=this.props,t=e.height,n=e.onScroll,i=this.state.scrollTop;this._onScrollMemoized!==i&&(n({clientHeight:t,scrollHeight:this._getEstimatedTotalHeight(),scrollTop:i}),this._onScrollMemoized=i)}},{key:"_invokeOnCellsRenderedCallback",value:function(){this._startIndexMemoized===this._startIndex&&this._stopIndexMemoized===this._stopIndex||((0,this.props.onCellsRendered)({startIndex:this._startIndex,stopIndex:this._stopIndex}),this._startIndexMemoized=this._startIndex,this._stopIndexMemoized=this._stopIndex)}},{key:"_populatePositionCache",value:function(e,t){for(var n=this.props,i=n.cellMeasurerCache,r=n.cellPositioner,s=e;s<=t;s++){var a=r(s),o=a.left,l=a.top;this._positionCache.setPosition(s,o,l,i.getHeight(s))}}}],[{key:"getDerivedStateFromProps",value:function(e,t){return void 0!==e.scrollTop&&t.scrollTop!==e.scrollTop?{isScrolling:!0,scrollTop:e.scrollTop}:null}}])}();function a5(){}R3(s5,"defaultProps",{autoHeight:!1,keyMapper:function(e){return e},onCellsRendered:a5,onScroll:a5,overscanByPixels:20,role:"grid",scrollingResetTimeInterval:150,style:{},tabIndex:0,rowDirection:"ltr"}),O3(s5);var o5=function(){return k3(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w3(this,e),R3(this,"_cellMeasurerCache",void 0),R3(this,"_columnIndexOffset",void 0),R3(this,"_rowIndexOffset",void 0),R3(this,"columnWidth",function(e){var n=e.index;t._cellMeasurerCache.columnWidth({index:n+t._columnIndexOffset})}),R3(this,"rowHeight",function(e){var n=e.index;t._cellMeasurerCache.rowHeight({index:n+t._rowIndexOffset})});var i=n.cellMeasurerCache,r=n.columnIndexOffset,s=void 0===r?0:r,a=n.rowIndexOffset,o=void 0===a?0:a;this._cellMeasurerCache=i,this._columnIndexOffset=s,this._rowIndexOffset=o},[{key:"clear",value:function(e,t){this._cellMeasurerCache.clear(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"clearAll",value:function(){this._cellMeasurerCache.clearAll()}},{key:"defaultHeight",get:function(){return this._cellMeasurerCache.defaultHeight}},{key:"defaultWidth",get:function(){return this._cellMeasurerCache.defaultWidth}},{key:"hasFixedHeight",value:function(){return this._cellMeasurerCache.hasFixedHeight()}},{key:"hasFixedWidth",value:function(){return this._cellMeasurerCache.hasFixedWidth()}},{key:"getHeight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._cellMeasurerCache.getHeight(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"getWidth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._cellMeasurerCache.getWidth(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"has",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._cellMeasurerCache.has(e+this._rowIndexOffset,t+this._columnIndexOffset)}},{key:"set",value:function(e,t,n,i){this._cellMeasurerCache.set(e+this._rowIndexOffset,t+this._columnIndexOffset,n,i)}}])}(),l5=["rowIndex"],c5=["columnIndex","rowIndex"],u5=["columnIndex"],d5=["onScroll","onSectionRendered","onScrollbarPresenceChange","scrollLeft","scrollToColumn","scrollTop","scrollToRow"];function h5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function p5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h5(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h5(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(f5=function(){return!!e})()}var m5=function(){function e(t,n){var i,r,s,a;w3(this,e),r=this,a=[t,n],s=E3(s=e),R3(i=C3(r,f5()?Reflect.construct(s,a||[],E3(r).constructor):s.apply(r,a)),"state",{scrollLeft:0,scrollTop:0,scrollbarSize:0,showHorizontalScrollbar:!1,showVerticalScrollbar:!1}),R3(i,"_deferredInvalidateColumnIndex",null),R3(i,"_deferredInvalidateRowIndex",null),R3(i,"_bottomLeftGridRef",function(e){i._bottomLeftGrid=e}),R3(i,"_bottomRightGridRef",function(e){i._bottomRightGrid=e}),R3(i,"_cellRendererBottomLeftGrid",function(e){var t=e.rowIndex,n=d4(e,l5),r=i.props,s=r.cellRenderer,a=r.fixedRowCount;return t===r.rowCount-a?o("div",{style:p5(p5({},n.style),{},{height:20})},n.key):s(p5(p5({},n),{},{parent:i,rowIndex:t+a}))}),R3(i,"_cellRendererBottomRightGrid",function(e){var t=e.columnIndex,n=e.rowIndex,r=d4(e,c5),s=i.props,a=s.cellRenderer,o=s.fixedColumnCount,l=s.fixedRowCount;return a(p5(p5({},r),{},{columnIndex:t+o,parent:i,rowIndex:n+l}))}),R3(i,"_cellRendererTopRightGrid",function(e){var t=e.columnIndex,n=d4(e,u5),r=i.props,s=r.cellRenderer,a=r.columnCount,l=r.fixedColumnCount;return t===a-l?o("div",{style:p5(p5({},n.style),{},{width:20})},n.key):s(p5(p5({},n),{},{columnIndex:t+l,parent:i}))}),R3(i,"_columnWidthRightGrid",function(e){var t=e.index,n=i.props,r=n.columnCount,s=n.fixedColumnCount,a=n.columnWidth,o=i.state,l=o.scrollbarSize;return o.showHorizontalScrollbar&&t===r-s?l:"function"==typeof a?a({index:t+s}):a}),R3(i,"_onScroll",function(e){var t=e.scrollLeft,n=e.scrollTop;i.setState({scrollLeft:t,scrollTop:n});var r=i.props.onScroll;r&&r(e)}),R3(i,"_onScrollbarPresenceChange",function(e){var t=e.horizontal,n=e.size,r=e.vertical,s=i.state,a=s.showHorizontalScrollbar,o=s.showVerticalScrollbar;if(t!==a||r!==o){i.setState({scrollbarSize:n,showHorizontalScrollbar:t,showVerticalScrollbar:r});var l=i.props.onScrollbarPresenceChange;"function"==typeof l&&l({horizontal:t,size:n,vertical:r})}}),R3(i,"_onScrollLeft",function(e){var t=e.scrollLeft;i._onScroll({scrollLeft:t,scrollTop:i.state.scrollTop})}),R3(i,"_onScrollTop",function(e){var t=e.scrollTop;i._onScroll({scrollTop:t,scrollLeft:i.state.scrollLeft})}),R3(i,"_rowHeightBottomGrid",function(e){var t=e.index,n=i.props,r=n.fixedRowCount,s=n.rowCount,a=n.rowHeight,o=i.state,l=o.scrollbarSize;return o.showVerticalScrollbar&&t===s-r?l:"function"==typeof a?a({index:t+r}):a}),R3(i,"_topLeftGridRef",function(e){i._topLeftGrid=e}),R3(i,"_topRightGridRef",function(e){i._topRightGrid=e});var l=t.deferredMeasurementCache,c=t.fixedColumnCount,u=t.fixedRowCount;return i._maybeCalculateCachedStyles(!0),l&&(i._deferredMeasurementCacheBottomLeftGrid=u>0?new o5({cellMeasurerCache:l,columnIndexOffset:0,rowIndexOffset:u}):l,i._deferredMeasurementCacheBottomRightGrid=c>0||u>0?new o5({cellMeasurerCache:l,columnIndexOffset:c,rowIndexOffset:u}):l,i._deferredMeasurementCacheTopRightGrid=c>0?new o5({cellMeasurerCache:l,columnIndexOffset:c,rowIndexOffset:0}):l),i}return A3(e,n.exports.PureComponent),k3(e,[{key:"forceUpdateGrids",value:function(){this._bottomLeftGrid&&this._bottomLeftGrid.forceUpdate(),this._bottomRightGrid&&this._bottomRightGrid.forceUpdate(),this._topLeftGrid&&this._topLeftGrid.forceUpdate(),this._topRightGrid&&this._topRightGrid.forceUpdate()}},{key:"invalidateCellSizeAfterRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i;this._deferredInvalidateColumnIndex="number"==typeof this._deferredInvalidateColumnIndex?Math.min(this._deferredInvalidateColumnIndex,n):n,this._deferredInvalidateRowIndex="number"==typeof this._deferredInvalidateRowIndex?Math.min(this._deferredInvalidateRowIndex,r):r}},{key:"measureAllCells",value:function(){this._bottomLeftGrid&&this._bottomLeftGrid.measureAllCells(),this._bottomRightGrid&&this._bottomRightGrid.measureAllCells(),this._topLeftGrid&&this._topLeftGrid.measureAllCells(),this._topRightGrid&&this._topRightGrid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i,s=this.props,a=s.fixedColumnCount,o=s.fixedRowCount,l=Math.max(0,n-a),c=Math.max(0,r-o);this._bottomLeftGrid&&this._bottomLeftGrid.recomputeGridSize({columnIndex:n,rowIndex:c}),this._bottomRightGrid&&this._bottomRightGrid.recomputeGridSize({columnIndex:l,rowIndex:c}),this._topLeftGrid&&this._topLeftGrid.recomputeGridSize({columnIndex:n,rowIndex:r}),this._topRightGrid&&this._topRightGrid.recomputeGridSize({columnIndex:l,rowIndex:r}),this._leftGridWidth=null,this._topGridHeight=null,this._maybeCalculateCachedStyles(!0)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.scrollLeft,n=e.scrollTop;if(t>0||n>0){var i={};t>0&&(i.scrollLeft=t),n>0&&(i.scrollTop=n),this.setState(i)}this._handleInvalidatedGridSize()}},{key:"componentDidUpdate",value:function(){this._handleInvalidatedGridSize()}},{key:"render",value:function(){var e=this.props,t=e.onScroll,n=e.onSectionRendered;e.onScrollbarPresenceChange,e.scrollLeft;var i=e.scrollToColumn;e.scrollTop;var r=e.scrollToRow,s=d4(e,d5);if(this._prepareForRender(),0===this.props.width||0===this.props.height)return null;var a=this.state,o=a.scrollLeft,l=a.scrollTop;return u("div",{style:this._containerOuterStyle,children:[u("div",{style:this._containerTopStyle,children:[this._renderTopLeftGrid(s),this._renderTopRightGrid(p5(p5({},s),{},{onScroll:t,scrollLeft:o}))]}),u("div",{style:this._containerBottomStyle,children:[this._renderBottomLeftGrid(p5(p5({},s),{},{onScroll:t,scrollTop:l})),this._renderBottomRightGrid(p5(p5({},s),{},{onScroll:t,onSectionRendered:n,scrollLeft:o,scrollToColumn:i,scrollToRow:r,scrollTop:l}))]})]})}},{key:"_getBottomGridHeight",value:function(e){return e.height-this._getTopGridHeight(e)}},{key:"_getLeftGridWidth",value:function(e){var t=e.fixedColumnCount,n=e.columnWidth;if(null==this._leftGridWidth)if("function"==typeof n){for(var i=0,r=0;r<t;r++)i+=n({index:r});this._leftGridWidth=i}else this._leftGridWidth=n*t;return this._leftGridWidth}},{key:"_getRightGridWidth",value:function(e){return e.width-this._getLeftGridWidth(e)}},{key:"_getTopGridHeight",value:function(e){var t=e.fixedRowCount,n=e.rowHeight;if(null==this._topGridHeight)if("function"==typeof n){for(var i=0,r=0;r<t;r++)i+=n({index:r});this._topGridHeight=i}else this._topGridHeight=n*t;return this._topGridHeight}},{key:"_handleInvalidatedGridSize",value:function(){if("number"==typeof this._deferredInvalidateColumnIndex){var e=this._deferredInvalidateColumnIndex,t=this._deferredInvalidateRowIndex;this._deferredInvalidateColumnIndex=null,this._deferredInvalidateRowIndex=null,this.recomputeGridSize({columnIndex:e,rowIndex:t}),this.forceUpdate()}}},{key:"_maybeCalculateCachedStyles",value:function(e){var t=this.props,n=t.columnWidth,i=t.enableFixedColumnScroll,r=t.enableFixedRowScroll,s=t.height,a=t.fixedColumnCount,o=t.fixedRowCount,l=t.rowHeight,c=t.style,u=t.styleBottomLeftGrid,d=t.styleBottomRightGrid,h=t.styleTopLeftGrid,p=t.styleTopRightGrid,f=t.width,m=e||s!==this._lastRenderedHeight||f!==this._lastRenderedWidth,g=e||n!==this._lastRenderedColumnWidth||a!==this._lastRenderedFixedColumnCount,b=e||o!==this._lastRenderedFixedRowCount||l!==this._lastRenderedRowHeight;(e||m||c!==this._lastRenderedStyle)&&(this._containerOuterStyle=p5({height:s,overflow:"visible",width:f},c)),(e||m||b)&&(this._containerTopStyle={height:this._getTopGridHeight(this.props),position:"relative",width:f},this._containerBottomStyle={height:s-this._getTopGridHeight(this.props),overflow:"visible",position:"relative",width:f}),(e||u!==this._lastRenderedStyleBottomLeftGrid)&&(this._bottomLeftGridStyle=p5({left:0,overflowX:"hidden",overflowY:i?"auto":"hidden",position:"absolute"},u)),(e||g||d!==this._lastRenderedStyleBottomRightGrid)&&(this._bottomRightGridStyle=p5({left:this._getLeftGridWidth(this.props),position:"absolute"},d)),(e||h!==this._lastRenderedStyleTopLeftGrid)&&(this._topLeftGridStyle=p5({left:0,overflowX:"hidden",overflowY:"hidden",position:"absolute",top:0},h)),(e||g||p!==this._lastRenderedStyleTopRightGrid)&&(this._topRightGridStyle=p5({left:this._getLeftGridWidth(this.props),overflowX:r?"auto":"hidden",overflowY:"hidden",position:"absolute",top:0},p)),this._lastRenderedColumnWidth=n,this._lastRenderedFixedColumnCount=a,this._lastRenderedFixedRowCount=o,this._lastRenderedHeight=s,this._lastRenderedRowHeight=l,this._lastRenderedStyle=c,this._lastRenderedStyleBottomLeftGrid=u,this._lastRenderedStyleBottomRightGrid=d,this._lastRenderedStyleTopLeftGrid=h,this._lastRenderedStyleTopRightGrid=p,this._lastRenderedWidth=f}},{key:"_prepareForRender",value:function(){this._lastRenderedColumnWidth===this.props.columnWidth&&this._lastRenderedFixedColumnCount===this.props.fixedColumnCount||(this._leftGridWidth=null),this._lastRenderedFixedRowCount===this.props.fixedRowCount&&this._lastRenderedRowHeight===this.props.rowHeight||(this._topGridHeight=null),this._maybeCalculateCachedStyles(),this._lastRenderedColumnWidth=this.props.columnWidth,this._lastRenderedFixedColumnCount=this.props.fixedColumnCount,this._lastRenderedFixedRowCount=this.props.fixedRowCount,this._lastRenderedRowHeight=this.props.rowHeight}},{key:"_renderBottomLeftGrid",value:function(e){var t=e.enableFixedColumnScroll,n=e.fixedColumnCount,i=e.fixedRowCount,r=e.rowCount,s=e.hideBottomLeftGridScrollbar,a=this.state.showVerticalScrollbar;if(!n)return null;var l=a?1:0,c=this._getBottomGridHeight(e),u=this._getLeftGridWidth(e),d=this.state.showVerticalScrollbar?this.state.scrollbarSize:0,h=s?u+d:u,p=o(A4,{...e,cellRenderer:this._cellRendererBottomLeftGrid,className:this.props.classNameBottomLeftGrid,columnCount:n,deferredMeasurementCache:this._deferredMeasurementCacheBottomLeftGrid,height:c,onScroll:t?this._onScrollTop:void 0,ref:this._bottomLeftGridRef,rowCount:Math.max(0,r-i)+l,rowHeight:this._rowHeightBottomGrid,style:this._bottomLeftGridStyle,tabIndex:null,width:h});return s?o("div",{className:"BottomLeftGrid_ScrollWrapper",style:p5(p5({},this._bottomLeftGridStyle),{},{height:c,width:u,overflowY:"hidden"}),children:p}):p}},{key:"_renderBottomRightGrid",value:function(e){var t=e.columnCount,n=e.fixedColumnCount,i=e.fixedRowCount,r=e.rowCount,s=e.scrollToColumn,a=e.scrollToRow;return o(A4,{...e,cellRenderer:this._cellRendererBottomRightGrid,className:this.props.classNameBottomRightGrid,columnCount:Math.max(0,t-n),columnWidth:this._columnWidthRightGrid,deferredMeasurementCache:this._deferredMeasurementCacheBottomRightGrid,height:this._getBottomGridHeight(e),onScroll:this._onScroll,onScrollbarPresenceChange:this._onScrollbarPresenceChange,ref:this._bottomRightGridRef,rowCount:Math.max(0,r-i),rowHeight:this._rowHeightBottomGrid,scrollToColumn:s-n,scrollToRow:a-i,style:this._bottomRightGridStyle,width:this._getRightGridWidth(e)})}},{key:"_renderTopLeftGrid",value:function(e){var t=e.fixedColumnCount,n=e.fixedRowCount;return t&&n?o(A4,{...e,className:this.props.classNameTopLeftGrid,columnCount:t,height:this._getTopGridHeight(e),ref:this._topLeftGridRef,rowCount:n,style:this._topLeftGridStyle,tabIndex:null,width:this._getLeftGridWidth(e)}):null}},{key:"_renderTopRightGrid",value:function(e){var t=e.columnCount,n=e.enableFixedRowScroll,i=e.fixedColumnCount,r=e.fixedRowCount,s=e.scrollLeft,a=e.hideTopRightGridScrollbar,l=this.state,c=l.showHorizontalScrollbar,u=l.scrollbarSize;if(!r)return null;var d=c?1:0,h=this._getTopGridHeight(e),p=this._getRightGridWidth(e),f=c?u:0,m=h,g=this._topRightGridStyle;a&&(m=h+f,g=p5(p5({},this._topRightGridStyle),{},{left:0}));var b=o(A4,{...e,cellRenderer:this._cellRendererTopRightGrid,className:this.props.classNameTopRightGrid,columnCount:Math.max(0,t-i)+d,columnWidth:this._columnWidthRightGrid,deferredMeasurementCache:this._deferredMeasurementCacheTopRightGrid,height:m,onScroll:n?this._onScrollLeft:void 0,ref:this._topRightGridRef,rowCount:r,scrollLeft:s,style:g,tabIndex:null,width:p});return a?o("div",{className:"TopRightGrid_ScrollWrapper",style:p5(p5({},this._topRightGridStyle),{},{height:h,width:p,overflowX:"hidden"}),children:b}):b}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.scrollLeft!==t.scrollLeft||e.scrollTop!==t.scrollTop?{scrollLeft:null!=e.scrollLeft&&e.scrollLeft>=0?e.scrollLeft:t.scrollLeft,scrollTop:null!=e.scrollTop&&e.scrollTop>=0?e.scrollTop:t.scrollTop}:null}}])}();function g5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(g5=function(){return!!e})()}R3(m5,"defaultProps",{classNameBottomLeftGrid:"",classNameBottomRightGrid:"",classNameTopLeftGrid:"",classNameTopRightGrid:"",enableFixedColumnScroll:!1,enableFixedRowScroll:!1,fixedColumnCount:0,fixedRowCount:0,scrollToColumn:-1,scrollToRow:-1,style:{},styleBottomLeftGrid:{},styleBottomRightGrid:{},styleTopLeftGrid:{},styleTopRightGrid:{},hideTopRightGridScrollbar:!1,hideBottomLeftGridScrollbar:!1}),m5.propTypes={},O3(m5);var b5=function(){function e(t,n){var i,r,s,a;return w3(this,e),r=this,a=[t,n],s=E3(s=e),(i=C3(r,g5()?Reflect.construct(s,a||[],E3(r).constructor):s.apply(r,a))).state={clientHeight:0,clientWidth:0,scrollHeight:0,scrollLeft:0,scrollTop:0,scrollWidth:0},i._onScroll=i._onScroll.bind(i),i}return A3(e,n.exports.PureComponent),k3(e,[{key:"render",value:function(){var e=this.props.children,t=this.state,n=t.clientHeight,i=t.clientWidth,r=t.scrollHeight,s=t.scrollLeft,a=t.scrollTop,o=t.scrollWidth;return e({clientHeight:n,clientWidth:i,onScroll:this._onScroll,scrollHeight:r,scrollLeft:s,scrollTop:a,scrollWidth:o})}},{key:"_onScroll",value:function(e){var t=e.clientHeight,n=e.clientWidth,i=e.scrollHeight,r=e.scrollLeft,s=e.scrollTop,a=e.scrollWidth;this.setState({clientHeight:t,clientWidth:n,scrollHeight:i,scrollLeft:r,scrollTop:s,scrollWidth:a})}}])}();b5.propTypes={};var y5="ASC",v5="DESC";function T5(e){var t=e.sortDirection,n=q3("ReactVirtualized__Table__sortableHeaderIcon",{"ReactVirtualized__Table__sortableHeaderIcon--ASC":t===y5,"ReactVirtualized__Table__sortableHeaderIcon--DESC":t===v5});return u("svg",{className:n,width:18,height:18,viewBox:"0 0 24 24",children:[o("path",t===y5?{d:"M7 14l5-5 5 5z"}:{d:"M7 10l5 5 5-5z"}),o("path",{d:"M0 0h24v24H0z",fill:"none"})]})}function x5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(x5=function(){return!!e})()}T5.propTypes={};var _5=function(){function e(){return w3(this,e),t=this,i=arguments,n=E3(n=e),C3(t,x5()?Reflect.construct(n,i||[],E3(t).constructor):n.apply(t,i));var t,n,i}return A3(e,n.exports.Component),k3(e)}();function S5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function w5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S5(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S5(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function I5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(I5=function(){return!!e})()}R3(_5,"defaultProps",{cellDataGetter:function(e){var t=e.dataKey,n=e.rowData;return"function"==typeof n.get?n.get(t):n[t]},cellRenderer:function(e){var t=e.cellData;return null==t?"":String(t)},defaultSortDirection:y5,flexGrow:0,flexShrink:1,headerRenderer:function(e){var t=e.dataKey,n=e.label,i=e.sortBy,r=e.sortDirection,s=i===t,a=[o("span",{className:"ReactVirtualized__Table__headerTruncatedText",title:"string"==typeof n?n:null,children:n},"label")];return s&&a.push(o(T5,{sortDirection:r},"SortIndicator")),a},style:{}}),_5.propTypes={};var k5=function(){function e(t){var n,i,r,s;return w3(this,e),i=this,s=[t],r=E3(r=e),(n=C3(i,I5()?Reflect.construct(r,s||[],E3(i).constructor):r.apply(i,s))).state={scrollbarWidth:0},n._createColumn=n._createColumn.bind(n),n._createRow=n._createRow.bind(n),n._onScroll=n._onScroll.bind(n),n._onSectionRendered=n._onSectionRendered.bind(n),n._setRef=n._setRef.bind(n),n._setGridElementRef=n._setGridElementRef.bind(n),n}return A3(e,n.exports.PureComponent),k3(e,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"getScrollbarWidth",value:function(){if(this.GridElement){var e=this.GridElement,t=e.clientWidth||0;return(e.offsetWidth||0)-t}return 0}},{key:"componentDidMount",value:function(){this._setScrollbarWidth()}},{key:"componentDidUpdate",value:function(){this._setScrollbarWidth()}},{key:"render",value:function(){var e=this,t=this.props,i=t.children,r=t.className,s=t.disableHeader,a=t.gridClassName,l=t.gridStyle,c=t.headerHeight,d=t.headerRowRenderer,h=t.height,p=t.id,f=t.noRowsRenderer,m=t.rowClassName,g=t.rowStyle,b=t.scrollToIndex,y=t.style,v=t.width,T=this.state.scrollbarWidth,x=s?h:h-c,_="function"==typeof m?m({index:-1}):m,S="function"==typeof g?g({index:-1}):g;return this._cachedColumnStyles=[],n.exports.Children.toArray(i).forEach(function(t,n){var i=e._getFlexStyleForColumn(t,t.props.style||_5.defaultProps.style);e._cachedColumnStyles[n]=w5({overflow:"hidden"},i)}),u("div",{"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-colcount":n.exports.Children.toArray(i).length,"aria-rowcount":this.props.rowCount,className:q3("ReactVirtualized__Table",r),id:p,role:"grid",style:y,children:[!s&&d({className:q3("ReactVirtualized__Table__headerRow",_),columns:this._getHeaderColumns(),style:w5({height:c,overflow:"hidden",paddingRight:T,width:v},S)}),o(A4,{...this.props,elementRef:this._setGridElementRef,"aria-readonly":null,autoContainerWidth:!0,className:q3("ReactVirtualized__Table__Grid",a),cellRenderer:this._createRow,columnWidth:v,columnCount:1,height:x,id:void 0,noContentRenderer:f,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,role:"rowgroup",scrollbarWidth:T,scrollToRow:b,style:w5(w5({},l),{},{overflowX:"hidden"})})]})}},{key:"_createColumn",value:function(e){var t=e.column,n=e.columnIndex,i=e.isScrolling,r=e.parent,s=e.rowData,a=e.rowIndex,l=this.props.onColumnClick,c=t.props,u=c.cellDataGetter,d=c.cellRenderer,h=c.className,p=c.columnData,f=c.dataKey,m=c.id,g=d({cellData:u({columnData:p,dataKey:f,rowData:s}),columnData:p,columnIndex:n,dataKey:f,isScrolling:i,parent:r,rowData:s,rowIndex:a}),b=this._cachedColumnStyles[n],y="string"==typeof g?g:null;return o("div",{"aria-colindex":n+1,"aria-describedby":m,className:q3("ReactVirtualized__Table__rowColumn",h),onClick:function(e){l&&l({columnData:p,dataKey:f,event:e})},role:"gridcell",style:b,title:y,children:g},"Row"+a+"-Col"+n)}},{key:"_createHeader",value:function(e){var t,n,i,r,s,a=e.column,l=e.index,c=this.props,u=c.headerClassName,d=c.headerStyle,h=c.onHeaderClick,p=c.sort,f=c.sortBy,m=c.sortDirection,g=a.props,b=g.columnData,y=g.dataKey,v=g.defaultSortDirection,T=g.disableSort,x=g.headerRenderer,_=g.id,S=g.label,w=!T&&p,I=q3("ReactVirtualized__Table__headerColumn",u,a.props.headerClassName,{ReactVirtualized__Table__sortableHeaderColumn:w}),k=this._getFlexStyleForColumn(a,w5(w5({},d),a.props.headerStyle)),C=x({columnData:b,dataKey:y,disableSort:T,label:S,sortBy:f,sortDirection:m});if(w||h){var E=f!==y?v:m===v5?y5:v5,A=function(e){w&&p({defaultSortDirection:v,event:e,sortBy:y,sortDirection:E}),h&&h({columnData:b,dataKey:y,event:e})};s=a.props["aria-label"]||S||y,r="none",i=0,t=A,n=function(e){"Enter"!==e.key&&" "!==e.key||A(e)}}return f===y&&(r=m===y5?"ascending":"descending"),o("div",{"aria-label":s,"aria-sort":r,className:I,id:_,onClick:t,onKeyDown:n,role:"columnheader",style:k,tabIndex:i,children:C},"Header-Col"+l)}},{key:"_createRow",value:function(e){var t=this,i=e.rowIndex,r=e.isScrolling,s=e.key,a=e.parent,o=e.style,l=this.props,c=l.children,u=l.onRowClick,d=l.onRowDoubleClick,h=l.onRowRightClick,p=l.onRowMouseOver,f=l.onRowMouseOut,m=l.rowClassName,g=l.rowGetter,b=l.rowRenderer,y=l.rowStyle,v=this.state.scrollbarWidth,T="function"==typeof m?m({index:i}):m,x="function"==typeof y?y({index:i}):y,_=g({index:i}),S=n.exports.Children.toArray(c).map(function(e,n){return t._createColumn({column:e,columnIndex:n,isScrolling:r,parent:a,rowData:_,rowIndex:i,scrollbarWidth:v})}),w=q3("ReactVirtualized__Table__row",T),I=w5(w5({},o),{},{height:this._getRowHeight(i),overflow:"hidden",paddingRight:v},x);return b({className:w,columns:S,index:i,isScrolling:r,key:s,onRowClick:u,onRowDoubleClick:d,onRowRightClick:h,onRowMouseOver:p,onRowMouseOut:f,rowData:_,style:I})}},{key:"_getFlexStyleForColumn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(e.props.flexGrow," ").concat(e.props.flexShrink," ").concat(e.props.width,"px"),i=w5(w5({},t),{},{flex:n,msFlex:n,WebkitFlex:n});return e.props.maxWidth&&(i.maxWidth=e.props.maxWidth),e.props.minWidth&&(i.minWidth=e.props.minWidth),i}},{key:"_getHeaderColumns",value:function(){var e=this,t=this.props,i=t.children;return(t.disableHeader?[]:n.exports.Children.toArray(i)).map(function(t,n){return e._createHeader({column:t,index:n})})}},{key:"_getRowHeight",value:function(e){var t=this.props.rowHeight;return"function"==typeof t?t({index:e}):t}},{key:"_onScroll",value:function(e){var t=e.clientHeight,n=e.scrollHeight,i=e.scrollTop;(0,this.props.onScroll)({clientHeight:t,scrollHeight:n,scrollTop:i})}},{key:"_onSectionRendered",value:function(e){var t=e.rowOverscanStartIndex,n=e.rowOverscanStopIndex,i=e.rowStartIndex,r=e.rowStopIndex;(0,this.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:n,startIndex:i,stopIndex:r})}},{key:"_setRef",value:function(e){this.Grid=e}},{key:"_setGridElementRef",value:function(e){this.GridElement=e}},{key:"_setScrollbarWidth",value:function(){var e=this.getScrollbarWidth();this.setState({scrollbarWidth:e})}}])}();R3(k5,"defaultProps",{disableHeader:!1,estimatedRowSize:30,headerHeight:0,headerStyle:{},noRowsRenderer:function(){return null},onRowsRendered:function(){return null},onScroll:function(){return null},overscanIndicesGetter:R4,overscanRowCount:10,rowRenderer:function(e){var t=e.className,i=e.columns,r=e.index,s=e.key,a=e.onRowClick,o=e.onRowDoubleClick,l=e.onRowMouseOut,c=e.onRowMouseOver,u=e.onRowRightClick,d=e.rowData,h=e.style,p={"aria-rowindex":r+1};return(a||o||l||c||u)&&(p["aria-label"]="row",p.tabIndex=0,a&&(p.onClick=function(e){return a({event:e,index:r,rowData:d})}),o&&(p.onDoubleClick=function(e){return o({event:e,index:r,rowData:d})}),l&&(p.onMouseOut=function(e){return l({event:e,index:r,rowData:d})}),c&&(p.onMouseOver=function(e){return c({event:e,index:r,rowData:d})}),u&&(p.onContextMenu=function(e){return u({event:e,index:r,rowData:d})})),n.exports.createElement("div",{...p,className:t,key:s,role:"row",style:h},i)},headerRowRenderer:function(e){var t=e.className,n=e.columns,i=e.style;return o("div",{className:t,role:"row",style:i,children:n})},rowStyle:{},scrollToAlignment:"auto",scrollToIndex:-1,style:{}}),k5.propTypes={};var C5=[],E5=null,A5=null;function R5(){A5&&(A5=null,document.body&&null!=E5&&(document.body.style.pointerEvents=E5),E5=null)}function N5(){R5(),C5.forEach(function(e){return e.__resetIsScrolling()})}function P5(e){e.currentTarget===window&&null==E5&&document.body&&(E5=document.body.style.pointerEvents,document.body.style.pointerEvents="none"),function(){A5&&_4(A5);var e=0;C5.forEach(function(t){e=Math.max(e,t.props.scrollingResetTimeInterval)}),A5=S4(N5,e)}(),C5.forEach(function(t){t.props.scrollElement===e.currentTarget&&t.__handleWindowScrollEvent()})}function D5(e,t){C5.some(function(e){return e.props.scrollElement===t})||t.addEventListener("scroll",P5),C5.push(e)}function O5(e,t){(C5=C5.filter(function(t){return t!==e})).length||(t.removeEventListener("scroll",P5),A5&&(_4(A5),R5()))}var L5=function(e){return e===window},M5=function(e){return e.getBoundingClientRect()};function F5(e,t){if(e){if(L5(e)){var n=window,i=n.innerHeight,r=n.innerWidth;return{height:"number"==typeof i?i:0,width:"number"==typeof r?r:0}}return M5(e)}return{height:t.serverHeight,width:t.serverWidth}}function $5(e){return L5(e)&&document.documentElement?{top:"scrollY"in window?window.scrollY:document.documentElement.scrollTop,left:"scrollX"in window?window.scrollX:document.documentElement.scrollLeft}:{top:e.scrollTop,left:e.scrollLeft}}function B5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function z5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B5(Object(n),!0).forEach(function(t){R3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B5(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function U5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(U5=function(){return!!e})()}var G5=function(){return"undefined"!=typeof window?window:void 0},V5=function(){function e(){var t,i,r,s;w3(this,e);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return i=this,r=e,s=[].concat(o),r=E3(r),R3(t=C3(i,U5()?Reflect.construct(r,s||[],E3(i).constructor):r.apply(i,s)),"_window",G5()),R3(t,"_isMounted",!1),R3(t,"_positionFromTop",0),R3(t,"_positionFromLeft",0),R3(t,"_detectElementResize",void 0),R3(t,"_child",void 0),R3(t,"_windowScrollerRef",n.exports.createRef()),R3(t,"state",z5(z5({},F5(t.props.scrollElement,t.props)),{},{isScrolling:!1,scrollLeft:0,scrollTop:0})),R3(t,"_registerChild",function(e){!e||e instanceof Element||console.warn("WindowScroller registerChild expects to be passed Element or null"),t._child=e,t.updatePosition()}),R3(t,"_onChildScroll",function(e){var n=e.scrollTop;if(t.state.scrollTop!==n){var i=t.props.scrollElement;i&&("function"==typeof i.scrollTo?i.scrollTo(0,n+t._positionFromTop):i.scrollTop=n+t._positionFromTop)}}),R3(t,"_registerResizeListener",function(e){e===window?window.addEventListener("resize",t._onResize,!1):t._detectElementResize.addResizeListener(e,t._onResize)}),R3(t,"_unregisterResizeListener",function(e){e===window?window.removeEventListener("resize",t._onResize,!1):e&&t._detectElementResize.removeResizeListener(e,t._onResize)}),R3(t,"_onResize",function(){t.updatePosition()}),R3(t,"__handleWindowScrollEvent",function(){if(t._isMounted){var e=t.props.onScroll,n=t.props.scrollElement;if(n){var i=$5(n),r=Math.max(0,i.left-t._positionFromLeft),s=Math.max(0,i.top-t._positionFromTop);t.setState({isScrolling:!0,scrollLeft:r,scrollTop:s}),e({scrollLeft:r,scrollTop:s})}}}),R3(t,"__resetIsScrolling",function(){t.setState({isScrolling:!1})}),t}return A3(e,n.exports.PureComponent),k3(e,[{key:"updatePosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.scrollElement,t=this.props.onResize,n=this.state,i=n.height,r=n.width,s=this._child||this._windowScrollerRef.current;if(s instanceof Element&&e){var a=function(e,t){if(L5(t)&&document.documentElement){var n=document.documentElement,i=M5(e),r=M5(n);return{top:i.top-r.top,left:i.left-r.left}}var s=$5(t),a=M5(e),o=M5(t);return{top:a.top+s.top-o.top,left:a.left+s.left-o.left}}(s,e);this._positionFromTop=a.top,this._positionFromLeft=a.left}var o=F5(e,this.props);i===o.height&&r===o.width||(this.setState({height:o.height,width:o.width}),t({height:o.height,width:o.width})),!0===this.props.updateScrollTopOnUpdatePosition&&(this.__handleWindowScrollEvent(),this.__resetIsScrolling())}},{key:"componentDidMount",value:function(){var e=this.props.scrollElement;this._detectElementResize=B3(),this.updatePosition(e),e&&(D5(this,e),this._registerResizeListener(e)),this._isMounted=!0}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.scrollElement,i=e.scrollElement;i!==n&&null!=i&&null!=n&&(this.updatePosition(n),O5(this,i),D5(this,n),this._unregisterResizeListener(i),this._registerResizeListener(n))}},{key:"componentWillUnmount",value:function(){var e=this.props.scrollElement;e&&(O5(this,e),this._unregisterResizeListener(e)),this._isMounted=!1}},{key:"render",value:function(){var e=this.props.children,t=this.state,n=t.isScrolling,i=t.scrollTop,r=t.scrollLeft,s=t.height,a=t.width;return o("div",{ref:this._windowScrollerRef,children:e({onChildScroll:this._onChildScroll,registerChild:this._registerChild,height:s,isScrolling:n,scrollLeft:r,scrollTop:i,width:a})})}}])}();function H5(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.map(function(t){return t.split(" ").map(function(t){return t?""+e+t:""}).join(" ")}).join(" ")}R3(V5,"defaultProps",{onResize:function(){},onScroll:function(){},scrollingResetTimeInterval:150,scrollElement:G5(),serverHeight:0,serverWidth:0});var W5={exports:{}};!function(e){e.exports=function(){function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach(function(t){o(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,n)}}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},p.apply(this,arguments)}function f(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}var m=function(e){return!(!e||!e.Window)&&e instanceof e.Window},g=void 0,b=void 0;function y(e){g=e;var t=e.document.createTextNode("");t.ownerDocument!==e.document&&"function"==typeof e.wrap&&e.wrap(t)===t&&(e=e.wrap(e)),b=e}function v(e){return m(e)?e:(e.ownerDocument||e).defaultView||b.window}"undefined"!=typeof window&&window&&y(window);var T=function(e){return!!e&&"object"===i(e)},x=function(e){return"function"==typeof e},_={window:function(e){return e===b||m(e)},docFrag:function(e){return T(e)&&11===e.nodeType},object:T,func:x,number:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e},string:function(e){return"string"==typeof e},element:function(e){if(!e||"object"!==i(e))return!1;var t=v(e)||b;return/object|function/.test("undefined"==typeof Element?"undefined":i(Element))?e instanceof Element||e instanceof t.Element:1===e.nodeType&&"string"==typeof e.nodeName},plainObject:function(e){return T(e)&&!!e.constructor&&/function Object\b/.test(e.constructor.toString())},array:function(e){return T(e)&&void 0!==e.length&&x(e.splice)}};function S(e){var t=e.interaction;if("drag"===t.prepared.name){var n=t.prepared.axis;"x"===n?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):"y"===n&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function w(e){var t=e.iEvent,n=e.interaction;if("drag"===n.prepared.name){var i=n.prepared.axis;if("x"===i||"y"===i){var r="x"===i?"y":"x";t.page[r]=n.coords.start.page[r],t.client[r]=n.coords.start.client[r],t.delta[r]=0}}}var I={id:"actions/drag",install:function(e){var t=e.actions,n=e.Interactable,i=e.defaults;n.prototype.draggable=I.draggable,t.map.drag=I,t.methodDict.drag="draggable",i.actions.drag=I.defaults},listeners:{"interactions:before-action-move":S,"interactions:action-resume":S,"interactions:action-move":w,"auto-start:check":function(e){var t=e.interaction,n=e.interactable,i=e.buttons,r=n.options.drag;if(r&&r.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||0!=(i&n.options.drag.mouseButtons)))return e.action={name:"drag",axis:"start"===r.lockAxis?r.startAxis:r.lockAxis},!1}},draggable:function(e){return _.object(e)?(this.options.drag.enabled=!1!==e.enabled,this.setPerAction("drag",e),this.setOnEvents("drag",e),/^(xy|x|y|start)$/.test(e.lockAxis)&&(this.options.drag.lockAxis=e.lockAxis),/^(xy|x|y)$/.test(e.startAxis)&&(this.options.drag.startAxis=e.startAxis),this):_.bool(e)?(this.options.drag.enabled=e,this):this.options.drag},beforeMove:S,move:w,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(e){return 0===e.search("drag")}},k=I,C={init:function(e){var t=e;C.document=t.document,C.DocumentFragment=t.DocumentFragment||E,C.SVGElement=t.SVGElement||E,C.SVGSVGElement=t.SVGSVGElement||E,C.SVGElementInstance=t.SVGElementInstance||E,C.Element=t.Element||E,C.HTMLElement=t.HTMLElement||C.Element,C.Event=t.Event,C.Touch=t.Touch||E,C.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function E(){}var A=C,R={init:function(e){var t=A.Element,n=e.navigator||{};R.supportsTouch="ontouchstart"in e||_.func(e.DocumentTouch)&&A.document instanceof e.DocumentTouch,R.supportsPointerEvent=!1!==n.pointerEnabled&&!!A.PointerEvent,R.isIOS=/iP(hone|od|ad)/.test(n.platform),R.isIOS7=/iP(hone|od|ad)/.test(n.platform)&&/OS 7[^\d]/.test(n.appVersion),R.isIe9=/MSIE 9/.test(n.userAgent),R.isOperaMobile="Opera"===n.appName&&R.supportsTouch&&/Presto/.test(n.userAgent),R.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",R.pEventTypes=R.supportsPointerEvent?A.PointerEvent===e.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,R.wheelEvent=A.document&&"onmousewheel"in A.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},N=R;function P(e,t){if(e.contains)return e.contains(t);for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function D(e,t){for(;_.element(e);){if(L(e,t))return e;e=O(e)}return null}function O(e){var t=e.parentNode;if(_.docFrag(t)){for(;(t=t.host)&&_.docFrag(t););return t}return t}function L(e,t){return b!==g&&(t=t.replace(/\/deep\//g," ")),e[N.prefixedMatchesSelector](t)}var M=function(e){return e.parentNode||e.host};function F(e,t){for(var n,i=[],r=e;(n=M(r))&&r!==t&&n!==r.ownerDocument;)i.unshift(r),r=n;return i}function $(e,t,n){for(;_.element(e);){if(L(e,t))return!0;if((e=O(e))===n)return L(e,t)}return!1}function B(e){return e.correspondingUseElement||e}function z(e){var t=e instanceof A.SVGElement?e.getBoundingClientRect():e.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function U(e){var t,n=z(e);if(!N.isIOS7&&n){var i={x:(t=(t=v(e))||b).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};n.left+=i.x,n.right+=i.x,n.top+=i.y,n.bottom+=i.y}return n}function G(e){for(var t=[];e;)t.push(e),e=O(e);return t}function V(e){return!!_.string(e)&&(A.document.querySelector(e),!0)}function H(e,t){for(var n in t)e[n]=t[n];return e}function W(e,t,n){return"parent"===e?O(n):"self"===e?t.getRect(n):D(n,e)}function j(e,t,n,i){var r=e;return _.string(r)?r=W(r,t,n):_.func(r)&&(r=r.apply(void 0,i)),_.element(r)&&(r=U(r)),r}function q(e){return e&&{x:"x"in e?e.x:e.left,y:"y"in e?e.y:e.top}}function X(e){return!e||"x"in e&&"y"in e||((e=H({},e)).x=e.left||0,e.y=e.top||0,e.width=e.width||(e.right||0)-e.x,e.height=e.height||(e.bottom||0)-e.y),e}function K(e,t,n){e.left&&(t.left+=n.x),e.right&&(t.right+=n.x),e.top&&(t.top+=n.y),e.bottom&&(t.bottom+=n.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function Y(e,t,n){var i=n&&e.options[n];return q(j(i&&i.origin||e.options.origin,e,t,[e&&t]))||{x:0,y:0}}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!0},i=arguments.length>3?arguments[3]:void 0;if(i=i||{},_.string(e)&&-1!==e.search(" ")&&(e=Q(e)),_.array(e))return e.forEach(function(e){return Z(e,t,n,i)}),i;if(_.object(e)&&(t=e,e=""),_.func(t)&&n(e))i[e]=i[e]||[],i[e].push(t);else if(_.array(t))for(var r=0,s=t;r<s.length;r++){var a=s[r];Z(e,a,n,i)}else if(_.object(t))for(var o in t)Z(Q(o).map(function(t){return"".concat(e).concat(t)}),t[o],n,i);return i}function Q(e){return e.trim().split(/ +/)}var J=function(e,t){return Math.sqrt(e*e+t*t)},ee=["webkit","moz"];function te(e,t){e.__set||(e.__set={});var n=function(n){if(ee.some(function(e){return 0===n.indexOf(e)}))return 1;"function"!=typeof e[n]&&"__set"!==n&&Object.defineProperty(e,n,{get:function(){return n in e.__set?e.__set[n]:e.__set[n]=t[n]},set:function(t){e.__set[n]=t},configurable:!0})};for(var i in t)n(i);return e}function ne(e,t){e.page=e.page||{},e.page.x=t.page.x,e.page.y=t.page.y,e.client=e.client||{},e.client.x=t.client.x,e.client.y=t.client.y,e.timeStamp=t.timeStamp}function ie(e){e.page.x=0,e.page.y=0,e.client.x=0,e.client.y=0}function re(e){return e instanceof A.Event||e instanceof A.Touch}function se(e,t,n){return e=e||"page",(n=n||{}).x=t[e+"X"],n.y=t[e+"Y"],n}function ae(e,t){return t=t||{x:0,y:0},N.isOperaMobile&&re(e)?(se("screen",e,t),t.x+=window.scrollX,t.y+=window.scrollY):se("page",e,t),t}function oe(e){return _.number(e.pointerId)?e.pointerId:e.identifier}function le(e,t,n){var i,r,s=t.length>1?ue(t):t[0];ae(s,e.page),i=s,r=(r=e.client)||{},N.isOperaMobile&&re(i)?se("screen",i,r):se("client",i,r),e.timeStamp=n}function ce(e){var t=[];return _.array(e)?(t[0]=e[0],t[1]=e[1]):"touchend"===e.type?1===e.touches.length?(t[0]=e.touches[0],t[1]=e.changedTouches[0]):0===e.touches.length&&(t[0]=e.changedTouches[0],t[1]=e.changedTouches[1]):(t[0]=e.touches[0],t[1]=e.touches[1]),t}function ue(e){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},n=0;n<e.length;n++){var i=e[n];for(var r in t)t[r]+=i[r]}for(var s in t)t[s]/=e.length;return t}function de(e){if(!e.length)return null;var t=ce(e),n=Math.min(t[0].pageX,t[1].pageX),i=Math.min(t[0].pageY,t[1].pageY),r=Math.max(t[0].pageX,t[1].pageX),s=Math.max(t[0].pageY,t[1].pageY);return{x:n,y:i,left:n,top:i,right:r,bottom:s,width:r-n,height:s-i}}function he(e,t){var n=t+"X",i=t+"Y",r=ce(e),s=r[0][n]-r[1][n],a=r[0][i]-r[1][i];return J(s,a)}function pe(e,t){var n=t+"X",i=t+"Y",r=ce(e),s=r[1][n]-r[0][n],a=r[1][i]-r[0][i];return 180*Math.atan2(a,s)/Math.PI}function fe(e){return _.string(e.pointerType)?e.pointerType:_.number(e.pointerType)?[void 0,void 0,"touch","pen","mouse"][e.pointerType]:/touch/.test(e.type||"")||e instanceof A.Touch?"touch":"mouse"}function me(e){var t=_.func(e.composedPath)?e.composedPath():e.path;return[B(t?t[0]:e.target),B(e.currentTarget)]}var ge=function(){function e(t){r(this,e),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return a(e,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),e}();Object.defineProperty(ge.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var be=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.push(i)}return e},ye=function(e){return be([],e)},ve=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return n;return-1},Te=function(e,t){return e[ve(e,t)]},xe=function(e){l(n,e);var t=h(n);function n(e,i,s){var a;r(this,n),(a=t.call(this,i._interaction)).dropzone=void 0,a.dragEvent=void 0,a.relatedTarget=void 0,a.draggable=void 0,a.propagationStopped=!1,a.immediatePropagationStopped=!1;var o="dragleave"===s?e.prev:e.cur,l=o.element,c=o.dropzone;return a.type=s,a.target=l,a.currentTarget=l,a.dropzone=c,a.dragEvent=i,a.relatedTarget=i.target,a.draggable=i.interactable,a.timeStamp=i.timeStamp,a}return a(n,[{key:"reject",value:function(){var e=this,t=this._interaction.dropState;if("dropactivate"===this.type||this.dropzone&&t.cur.dropzone===this.dropzone&&t.cur.element===this.target)if(t.prev.dropzone=this.dropzone,t.prev.element=this.target,t.rejected=!0,t.events.enter=null,this.stopImmediatePropagation(),"dropactivate"===this.type){var i=t.activeDrops,r=ve(i,function(t){var n=t.dropzone,i=t.element;return n===e.dropzone&&i===e.target});t.activeDrops.splice(r,1);var s=new n(t,this.dragEvent,"dropdeactivate");s.dropzone=this.dropzone,s.target=this.target,this.dropzone.fire(s)}else this.dropzone.fire(new n(t,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n}(ge);function _e(e,t){for(var n=0,i=e.slice();n<i.length;n++){var r=i[n],s=r.dropzone,a=r.element;t.dropzone=s,t.target=a,s.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function Se(e,t){for(var n=function(e,t){for(var n=[],i=0,r=e.interactables.list;i<r.length;i++){var s=r[i];if(s.options.drop.enabled){var a=s.options.drop.accept;if(!(_.element(a)&&a!==t||_.string(a)&&!L(t,a)||_.func(a)&&!a({dropzone:s,draggableElement:t})))for(var o=0,l=s.getAllElements();o<l.length;o++){var c=l[o];c!==t&&n.push({dropzone:s,element:c,rect:s.getRect(c)})}}}return n}(e,t),i=0;i<n.length;i++){var r=n[i];r.rect=r.dropzone.getRect(r.element)}return n}function we(e,t,n){for(var i=e.dropState,r=e.interactable,s=e.element,a=[],o=0,l=i.activeDrops;o<l.length;o++){var c=l[o],u=c.dropzone,d=c.element,h=c.rect,p=u.dropCheck(t,n,r,s,d,h);a.push(p?d:null)}var f=function(e){for(var t,n,i,r=[],s=0;s<e.length;s++){var a=e[s],o=e[t];if(a&&s!==t)if(o){var l=M(a),c=M(o);if(l!==a.ownerDocument)if(c!==a.ownerDocument)if(l!==c){r=r.length?r:F(o);var u=void 0;if(o instanceof A.HTMLElement&&a instanceof A.SVGElement&&!(a instanceof A.SVGSVGElement)){if(a===c)continue;u=a.ownerSVGElement}else u=a;for(var d=F(u,o.ownerDocument),h=0;d[h]&&d[h]===r[h];)h++;var p=[d[h-1],d[h],r[h]];if(p[0])for(var f=p[0].lastChild;f;){if(f===p[1]){t=s,r=d;break}if(f===p[2])break;f=f.previousSibling}}else i=o,(parseInt(v(n=a).getComputedStyle(n).zIndex,10)||0)>=(parseInt(v(i).getComputedStyle(i).zIndex,10)||0)&&(t=s);else t=s}else t=s}return t}(a);return i.activeDrops[f]||null}function Ie(e,t,n){var i=e.dropState,r={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return"dragstart"===n.type&&(r.activate=new xe(i,n,"dropactivate"),r.activate.target=null,r.activate.dropzone=null),"dragend"===n.type&&(r.deactivate=new xe(i,n,"dropdeactivate"),r.deactivate.target=null,r.deactivate.dropzone=null),i.rejected||(i.cur.element!==i.prev.element&&(i.prev.dropzone&&(r.leave=new xe(i,n,"dragleave"),n.dragLeave=r.leave.target=i.prev.element,n.prevDropzone=r.leave.dropzone=i.prev.dropzone),i.cur.dropzone&&(r.enter=new xe(i,n,"dragenter"),n.dragEnter=i.cur.element,n.dropzone=i.cur.dropzone)),"dragend"===n.type&&i.cur.dropzone&&(r.drop=new xe(i,n,"drop"),n.dropzone=i.cur.dropzone,n.relatedTarget=i.cur.element),"dragmove"===n.type&&i.cur.dropzone&&(r.move=new xe(i,n,"dropmove"),n.dropzone=i.cur.dropzone)),r}function ke(e,t){var n=e.dropState,i=n.activeDrops,r=n.cur,s=n.prev;t.leave&&s.dropzone.fire(t.leave),t.enter&&r.dropzone.fire(t.enter),t.move&&r.dropzone.fire(t.move),t.drop&&r.dropzone.fire(t.drop),t.deactivate&&_e(i,t.deactivate),n.prev.dropzone=r.dropzone,n.prev.element=r.element}function Ce(e,t){var n=e.interaction,i=e.iEvent,r=e.event;if("dragmove"===i.type||"dragend"===i.type){var s=n.dropState;t.dynamicDrop&&(s.activeDrops=Se(t,n.element));var a=i,o=we(n,a,r);s.rejected=s.rejected&&!!o&&o.dropzone===s.cur.dropzone&&o.element===s.cur.element,s.cur.dropzone=o&&o.dropzone,s.cur.element=o&&o.element,s.events=Ie(n,0,a)}}var Ee={id:"actions/drop",install:function(e){var t=e.actions,n=e.interactStatic,i=e.Interactable,r=e.defaults;e.usePlugin(k),i.prototype.dropzone=function(e){return function(e,t){if(_.object(t)){if(e.options.drop.enabled=!1!==t.enabled,t.listeners){var n=Z(t.listeners),i=Object.keys(n).reduce(function(e,t){return e[/^(enter|leave)/.test(t)?"drag".concat(t):/^(activate|deactivate|move)/.test(t)?"drop".concat(t):t]=n[t],e},{}),r=e.options.drop.listeners;r&&e.off(r),e.on(i),e.options.drop.listeners=i}return _.func(t.ondrop)&&e.on("drop",t.ondrop),_.func(t.ondropactivate)&&e.on("dropactivate",t.ondropactivate),_.func(t.ondropdeactivate)&&e.on("dropdeactivate",t.ondropdeactivate),_.func(t.ondragenter)&&e.on("dragenter",t.ondragenter),_.func(t.ondragleave)&&e.on("dragleave",t.ondragleave),_.func(t.ondropmove)&&e.on("dropmove",t.ondropmove),/^(pointer|center)$/.test(t.overlap)?e.options.drop.overlap=t.overlap:_.number(t.overlap)&&(e.options.drop.overlap=Math.max(Math.min(1,t.overlap),0)),"accept"in t&&(e.options.drop.accept=t.accept),"checker"in t&&(e.options.drop.checker=t.checker),e}return _.bool(t)?(e.options.drop.enabled=t,e):e.options.drop}(this,e)},i.prototype.dropCheck=function(e,t,n,i,r,s){return function(e,t,n,i,r,s,a){var o=!1;if(!(a=a||e.getRect(s)))return!!e.options.drop.checker&&e.options.drop.checker(t,n,o,e,s,i,r);var l=e.options.drop.overlap;if("pointer"===l){var c=Y(i,r,"drag"),u=ae(t);u.x+=c.x,u.y+=c.y;var d=u.x>a.left&&u.x<a.right,h=u.y>a.top&&u.y<a.bottom;o=d&&h}var p=i.getRect(r);if(p&&"center"===l){var f=p.left+p.width/2,m=p.top+p.height/2;o=f>=a.left&&f<=a.right&&m>=a.top&&m<=a.bottom}return p&&_.number(l)&&(o=Math.max(0,Math.min(a.right,p.right)-Math.max(a.left,p.left))*Math.max(0,Math.min(a.bottom,p.bottom)-Math.max(a.top,p.top))/(p.width*p.height)>=l),e.options.drop.checker&&(o=e.options.drop.checker(t,n,o,e,s,i,r)),o}(this,e,t,n,i,r,s)},n.dynamicDrop=function(t){return _.bool(t)?(e.dynamicDrop=t,n):e.dynamicDrop},H(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",e.dynamicDrop=!1,r.actions.drop=Ee.defaults},listeners:{"interactions:before-action-start":function(e){var t=e.interaction;"drag"===t.prepared.name&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(e,t){var n=e.interaction,i=(e.event,e.iEvent);if("drag"===n.prepared.name){var r=n.dropState;r.activeDrops=[],r.events={},r.activeDrops=Se(t,n.element),r.events=Ie(n,0,i),r.events.activate&&(_e(r.activeDrops,r.events.activate),t.fire("actions/drop:start",{interaction:n,dragEvent:i}))}},"interactions:action-move":Ce,"interactions:after-action-move":function(e,t){var n=e.interaction,i=e.iEvent;if("drag"===n.prepared.name){var r=n.dropState;ke(n,r.events),t.fire("actions/drop:move",{interaction:n,dragEvent:i}),r.events={}}},"interactions:action-end":function(e,t){if("drag"===e.interaction.prepared.name){var n=e.interaction,i=e.iEvent;Ce(e,t),ke(n,n.dropState.events),t.fire("actions/drop:end",{interaction:n,dragEvent:i})}},"interactions:stop":function(e){var t=e.interaction;if("drag"===t.prepared.name){var n=t.dropState;n&&(n.activeDrops=null,n.events=null,n.cur.dropzone=null,n.cur.element=null,n.prev.dropzone=null,n.prev.element=null,n.rejected=!1)}}},getActiveDrops:Se,getDrop:we,getDropEvents:Ie,fireDropEvents:ke,filterEventType:function(e){return 0===e.search("drag")||0===e.search("drop")},defaults:{enabled:!1,accept:null,overlap:"pointer"}},Ae=Ee;function Re(e){var t=e.interaction,n=e.iEvent,i=e.phase;if("gesture"===t.prepared.name){var r=t.pointers.map(function(e){return e.pointer}),s="start"===i,a="end"===i,o=t.interactable.options.deltaSource;if(n.touches=[r[0],r[1]],s)n.distance=he(r,o),n.box=de(r),n.scale=1,n.ds=0,n.angle=pe(r,o),n.da=0,t.gesture.startDistance=n.distance,t.gesture.startAngle=n.angle;else if(a||t.pointers.length<2){var l=t.prevEvent;n.distance=l.distance,n.box=l.box,n.scale=l.scale,n.ds=0,n.angle=l.angle,n.da=0}else n.distance=he(r,o),n.box=de(r),n.scale=n.distance/t.gesture.startDistance,n.angle=pe(r,o),n.ds=n.scale-t.gesture.scale,n.da=n.angle-t.gesture.angle;t.gesture.distance=n.distance,t.gesture.angle=n.angle,_.number(n.scale)&&n.scale!==1/0&&!isNaN(n.scale)&&(t.gesture.scale=n.scale)}}var Ne={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(e){var t=e.actions,n=e.Interactable,i=e.defaults;n.prototype.gesturable=function(e){return _.object(e)?(this.options.gesture.enabled=!1!==e.enabled,this.setPerAction("gesture",e),this.setOnEvents("gesture",e),this):_.bool(e)?(this.options.gesture.enabled=e,this):this.options.gesture},t.map.gesture=Ne,t.methodDict.gesture="gesturable",i.actions.gesture=Ne.defaults},listeners:{"interactions:action-start":Re,"interactions:action-move":Re,"interactions:action-end":Re,"interactions:new":function(e){e.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(e){if(!(e.interaction.pointers.length<2)){var t=e.interactable.options.gesture;if(t&&t.enabled)return e.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(e){return 0===e.search("gesture")}},Pe=Ne;function De(e,t,n,i,r,s,a){if(!t)return!1;if(!0===t){var o=_.number(s.width)?s.width:s.right-s.left,l=_.number(s.height)?s.height:s.bottom-s.top;if(a=Math.min(a,Math.abs(("left"===e||"right"===e?o:l)/2)),o<0&&("left"===e?e="right":"right"===e&&(e="left")),l<0&&("top"===e?e="bottom":"bottom"===e&&(e="top")),"left"===e){var c=o>=0?s.left:s.right;return n.x<c+a}if("top"===e){var u=l>=0?s.top:s.bottom;return n.y<u+a}if("right"===e)return n.x>(o>=0?s.right:s.left)-a;if("bottom"===e)return n.y>(l>=0?s.bottom:s.top)-a}return!!_.element(i)&&(_.element(t)?t===i:$(i,t,r))}function Oe(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.resizeAxes){var i=t;n.interactable.options.resize.square?("y"===n.resizeAxes?i.delta.x=i.delta.y:i.delta.y=i.delta.x,i.axes="xy"):(i.axes=n.resizeAxes,"x"===n.resizeAxes?i.delta.y=0:"y"===n.resizeAxes&&(i.delta.x=0))}}var Le,Me,Fe={id:"actions/resize",before:["actions/drag"],install:function(e){var t=e.actions,n=e.browser,i=e.Interactable,r=e.defaults;Fe.cursors=n.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"},Fe.defaultMargin=n.supportsTouch||n.supportsPointerEvent?20:10,i.prototype.resizable=function(t){return function(e,t,n){return _.object(t)?(e.options.resize.enabled=!1!==t.enabled,e.setPerAction("resize",t),e.setOnEvents("resize",t),_.string(t.axis)&&/^x$|^y$|^xy$/.test(t.axis)?e.options.resize.axis=t.axis:null===t.axis&&(e.options.resize.axis=n.defaults.actions.resize.axis),_.bool(t.preserveAspectRatio)?e.options.resize.preserveAspectRatio=t.preserveAspectRatio:_.bool(t.square)&&(e.options.resize.square=t.square),e):_.bool(t)?(e.options.resize.enabled=t,e):e.options.resize}(this,t,e)},t.map.resize=Fe,t.methodDict.resize="resizable",r.actions.resize=Fe.defaults},listeners:{"interactions:new":function(e){e.interaction.resizeAxes="xy"},"interactions:action-start":function(e){!function(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.prepared.edges){var i=t,r=n.rect;n._rects={start:H({},r),corrected:H({},r),previous:H({},r),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},i.edges=n.prepared.edges,i.rect=n._rects.corrected,i.deltaRect=n._rects.delta}}(e),Oe(e)},"interactions:action-move":function(e){!function(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.prepared.edges){var i=t,r=n.interactable.options.resize.invert,s="reposition"===r||"negate"===r,a=n.rect,o=n._rects,l=o.start,c=o.corrected,u=o.delta,d=o.previous;if(H(d,c),s){if(H(c,a),"reposition"===r){if(c.top>c.bottom){var h=c.top;c.top=c.bottom,c.bottom=h}if(c.left>c.right){var p=c.left;c.left=c.right,c.right=p}}}else c.top=Math.min(a.top,l.bottom),c.bottom=Math.max(a.bottom,l.top),c.left=Math.min(a.left,l.right),c.right=Math.max(a.right,l.left);for(var f in c.width=c.right-c.left,c.height=c.bottom-c.top,c)u[f]=c[f]-d[f];i.edges=n.prepared.edges,i.rect=c,i.deltaRect=u}}(e),Oe(e)},"interactions:action-end":function(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.prepared.edges){var i=t;i.edges=n.prepared.edges,i.rect=n._rects.corrected,i.deltaRect=n._rects.delta}},"auto-start:check":function(e){var t=e.interaction,n=e.interactable,i=e.element,r=e.rect,s=e.buttons;if(r){var a=H({},t.coords.cur.page),o=n.options.resize;if(o&&o.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||0!=(s&o.mouseButtons))){if(_.object(o.edges)){var l={left:!1,right:!1,top:!1,bottom:!1};for(var c in l)l[c]=De(c,o.edges[c],a,t._latestPointer.eventTarget,i,r,o.margin||Fe.defaultMargin);l.left=l.left&&!l.right,l.top=l.top&&!l.bottom,(l.left||l.right||l.top||l.bottom)&&(e.action={name:"resize",edges:l})}else{var u="y"!==o.axis&&a.x>r.right-Fe.defaultMargin,d="x"!==o.axis&&a.y>r.bottom-Fe.defaultMargin;(u||d)&&(e.action={name:"resize",axes:(u?"x":"")+(d?"y":"")})}return!e.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(e){var t=e.edges,n=e.axis,i=e.name,r=Fe.cursors,s=null;if(n)s=r[i+n];else if(t){for(var a="",o=0,l=["top","bottom","left","right"];o<l.length;o++){var c=l[o];t[c]&&(a+=c)}s=r[a]}return s},filterEventType:function(e){return 0===e.search("resize")},defaultMargin:null},$e=Fe,Be={id:"actions",install:function(e){e.usePlugin(Pe),e.usePlugin($e),e.usePlugin(k),e.usePlugin(Ae)}},ze=0,Ue={request:function(e){return Le(e)},cancel:function(e){return Me(e)},init:function(e){if(Le=e.requestAnimationFrame,Me=e.cancelAnimationFrame,!Le)for(var t=["ms","moz","webkit","o"],n=0;n<t.length;n++){var i=t[n];Le=e["".concat(i,"RequestAnimationFrame")],Me=e["".concat(i,"CancelAnimationFrame")]||e["".concat(i,"CancelRequestAnimationFrame")]}Le=Le&&Le.bind(e),Me=Me&&Me.bind(e),Le||(Le=function(t){var n=Date.now(),i=Math.max(0,16-(n-ze)),r=e.setTimeout(function(){t(n+i)},i);return ze=n+i,r},Me=function(e){return clearTimeout(e)})}},Ge={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(e){Ge.isScrolling=!0,Ue.cancel(Ge.i),e.autoScroll=Ge,Ge.interaction=e,Ge.prevTime=Ge.now(),Ge.i=Ue.request(Ge.scroll)},stop:function(){Ge.isScrolling=!1,Ge.interaction&&(Ge.interaction.autoScroll=null),Ue.cancel(Ge.i)},scroll:function(){var e=Ge.interaction,t=e.interactable,n=e.element,i=e.prepared.name,r=t.options[i].autoScroll,s=Ve(r.container,t,n),a=Ge.now(),o=(a-Ge.prevTime)/1e3,l=r.speed*o;if(l>=1){var c={x:Ge.x*l,y:Ge.y*l};if(c.x||c.y){var u=He(s);_.window(s)?s.scrollBy(c.x,c.y):s&&(s.scrollLeft+=c.x,s.scrollTop+=c.y);var d=He(s),h={x:d.x-u.x,y:d.y-u.y};(h.x||h.y)&&t.fire({type:"autoscroll",target:n,interactable:t,delta:h,interaction:e,container:s})}Ge.prevTime=a}Ge.isScrolling&&(Ue.cancel(Ge.i),Ge.i=Ue.request(Ge.scroll))},check:function(e,t){var n;return null==(n=e.options[t].autoScroll)?void 0:n.enabled},onInteractionMove:function(e){var t=e.interaction,n=e.pointer;if(t.interacting()&&Ge.check(t.interactable,t.prepared.name))if(t.simulation)Ge.x=Ge.y=0;else{var i,r,s,a,o=t.interactable,l=t.element,c=t.prepared.name,u=o.options[c].autoScroll,d=Ve(u.container,o,l);if(_.window(d))a=n.clientX<Ge.margin,i=n.clientY<Ge.margin,r=n.clientX>d.innerWidth-Ge.margin,s=n.clientY>d.innerHeight-Ge.margin;else{var h=z(d);a=n.clientX<h.left+Ge.margin,i=n.clientY<h.top+Ge.margin,r=n.clientX>h.right-Ge.margin,s=n.clientY>h.bottom-Ge.margin}Ge.x=r?1:a?-1:0,Ge.y=s?1:i?-1:0,Ge.isScrolling||(Ge.margin=u.margin,Ge.speed=u.speed,Ge.start(t))}}};function Ve(e,t,n){return(_.string(e)?W(e,t,n):e)||v(n)}function He(e){return _.window(e)&&(e=window.document.body),{x:e.scrollLeft,y:e.scrollTop}}var We={id:"auto-scroll",install:function(e){var t=e.defaults,n=e.actions;e.autoScroll=Ge,Ge.now=function(){return e.now()},n.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=Ge.defaults},listeners:{"interactions:new":function(e){e.interaction.autoScroll=null},"interactions:destroy":function(e){e.interaction.autoScroll=null,Ge.stop(),Ge.interaction&&(Ge.interaction=null)},"interactions:stop":Ge.stop,"interactions:action-move":function(e){return Ge.onInteractionMove(e)}}};function je(e,t){var n=!1;return function(){return n||(b.console.warn(t),n=!0),e.apply(this,arguments)}}function qe(e,t){return e.name=t.name,e.axis=t.axis,e.edges=t.edges,e}function Xe(e){return _.bool(e)?(this.options.styleCursor=e,this):null===e?(delete this.options.styleCursor,this):this.options.styleCursor}function Ke(e){return _.func(e)?(this.options.actionChecker=e,this):null===e?(delete this.options.actionChecker,this):this.options.actionChecker}var Ye={id:"auto-start/interactableMethods",install:function(e){var t=e.Interactable;t.prototype.getAction=function(t,n,i,r){var s,a,o,l,c,u,d,h=(a=n,o=i,l=r,c=e,u=(s=this).getRect(l),d={action:null,interactable:s,interaction:o,element:l,rect:u,buttons:a.buttons||{0:1,1:4,3:8,4:16}[a.button]},c.fire("auto-start:check",d),d.action);return this.options.actionChecker?this.options.actionChecker(t,n,h,this,r,i):h},t.prototype.ignoreFrom=je(function(e){return this._backCompatOption("ignoreFrom",e)},"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=je(function(e){return this._backCompatOption("allowFrom",e)},"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Ke,t.prototype.styleCursor=Xe}};function Ze(e,t,n,i,r){return t.testIgnoreAllow(t.options[e.name],n,i)&&t.options[e.name].enabled&&tt(t,n,e,r)?e:null}function Qe(e,t,n,i,r,s,a){for(var o=0,l=i.length;o<l;o++){var c=i[o],u=r[o],d=c.getAction(t,n,e,u);if(d){var h=Ze(d,c,u,s,a);if(h)return{action:h,interactable:c,element:u}}}return{action:null,interactable:null,element:null}}function Je(e,t,n,i,r){var s=[],a=[],o=i;function l(e){s.push(e),a.push(o)}for(;_.element(o);){s=[],a=[],r.interactables.forEachMatch(o,l);var c=Qe(e,t,n,s,a,i,r);if(c.action&&!c.interactable.options[c.action.name].manualStart)return c;o=O(o)}return{action:null,interactable:null,element:null}}function et(e,t,n){var i=t.action,r=t.interactable,s=t.element;i=i||{name:null},e.interactable=r,e.element=s,qe(e.prepared,i),e.rect=r&&i.name?r.getRect(s):null,rt(e,n),n.fire("autoStart:prepared",{interaction:e})}function tt(e,t,n,i){var r=e.options,s=r[n.name].max,a=r[n.name].maxPerElement,o=i.autoStart.maxInteractions,l=0,c=0,u=0;if(!(s&&a&&o))return!1;for(var d=0,h=i.interactions.list;d<h.length;d++){var p=h[d],f=p.prepared.name;if(p.interacting()){if(++l>=o)return!1;if(p.interactable===e){if((c+=f===n.name?1:0)>=s)return!1;if(p.element===t&&(u++,f===n.name&&u>=a))return!1}}}return o>0}function nt(e,t){return _.number(e)?(t.autoStart.maxInteractions=e,this):t.autoStart.maxInteractions}function it(e,t,n){var i=n.autoStart.cursorElement;i&&i!==e&&(i.style.cursor=""),e.ownerDocument.documentElement.style.cursor=t,e.style.cursor=t,n.autoStart.cursorElement=t?e:null}function rt(e,t){var n=e.interactable,i=e.element,r=e.prepared;if("mouse"===e.pointerType&&n&&n.options.styleCursor){var s="";if(r.name){var a=n.options[r.name].cursorChecker;s=_.func(a)?a(r,n,i,e._interacting):t.actions.map[r.name].getCursor(r)}it(e.element,s||"",t)}else t.autoStart.cursorElement&&it(t.autoStart.cursorElement,"",t)}var st={id:"auto-start/base",before:["actions"],install:function(e){var t=e.interactStatic,n=e.defaults;e.usePlugin(Ye),n.base.actionChecker=null,n.base.styleCursor=!0,H(n.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(t){return nt(t,e)},e.autoStart={maxInteractions:1/0,withinInteractionLimit:tt,cursorElement:null}},listeners:{"interactions:down":function(e,t){var n=e.interaction,i=e.pointer,r=e.event,s=e.eventTarget;n.interacting()||et(n,Je(n,i,r,s,t),t)},"interactions:move":function(e,t){var n,i,r,s,a,o;i=t,r=(n=e).interaction,s=n.pointer,a=n.event,o=n.eventTarget,"mouse"!==r.pointerType||r.pointerIsDown||r.interacting()||et(r,Je(r,s,a,o,i),i),function(e,t){var n=e.interaction;if(n.pointerIsDown&&!n.interacting()&&n.pointerWasMoved&&n.prepared.name){t.fire("autoStart:before-start",e);var i=n.interactable,r=n.prepared.name;r&&i&&(i.options[r].manualStart||!tt(i,n.element,n.prepared,t)?n.stop():(n.start(n.prepared,i,n.element),rt(n,t)))}}(e,t)},"interactions:stop":function(e,t){var n=e.interaction,i=n.interactable;i&&i.options.styleCursor&&it(n.element,"",t)}},maxInteractions:nt,withinInteractionLimit:tt,validateAction:Ze},at={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(e,t){var n=e.interaction,i=e.eventTarget,r=e.dx,s=e.dy;if("drag"===n.prepared.name){var a=Math.abs(r),o=Math.abs(s),l=n.interactable.options.drag,c=l.startAxis,u=a>o?"x":a<o?"y":"xy";if(n.prepared.axis="start"===l.lockAxis?u[0]:l.lockAxis,"xy"!==u&&"xy"!==c&&c!==u){n.prepared.name=null;for(var d=i,h=function(e){if(e!==n.interactable){var r=n.interactable.options.drag;if(!r.manualStart&&e.testIgnoreAllow(r,d,i)){var s=e.getAction(n.downPointer,n.downEvent,n,d);if(s&&"drag"===s.name&&function(e,t){if(!t)return!1;var n=t.options.drag.startAxis;return"xy"===e||"xy"===n||n===e}(u,e)&&st.validateAction(s,e,d,i,t))return e}}};_.element(d);){var p=t.interactables.forEachMatch(d,h);if(p){n.prepared.name="drag",n.interactable=p,n.element=d;break}d=O(d)}}}}}};function ot(e){var t=e.prepared&&e.prepared.name;if(!t)return null;var n=e.interactable.options;return n[t].hold||n[t].delay}var lt={id:"auto-start/hold",install:function(e){var t=e.defaults;e.usePlugin(st),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(e){e.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(e){var t=e.interaction,n=ot(t);n>0&&(t.autoStartHoldTimer=setTimeout(function(){t.start(t.prepared,t.interactable,t.element)},n))},"interactions:move":function(e){var t=e.interaction,n=e.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!n&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(e){var t=e.interaction;ot(t)>0&&(t.prepared.name=null)}},getHoldDuration:ot},ct={id:"auto-start",install:function(e){e.usePlugin(st),e.usePlugin(lt),e.usePlugin(at)}},ut=function(e){return/^(always|never|auto)$/.test(e)?(this.options.preventDefault=e,this):_.bool(e)?(this.options.preventDefault=e?"always":"never",this):this.options.preventDefault};function dt(e){var t=e.interaction,n=e.event;t.interactable&&t.interactable.checkAndPreventDefault(n)}var ht={id:"core/interactablePreventDefault",install:function(e){var t=e.Interactable;t.prototype.preventDefault=ut,t.prototype.checkAndPreventDefault=function(t){return function(e,t,n){var i=e.options.preventDefault;if("never"!==i)if("always"!==i){if(t.events.supportsPassive&&/^touch(start|move)$/.test(n.type)){var r=v(n.target).document,s=t.getDocOptions(r);if(!s||!s.events||!1!==s.events.passive)return}/^(mouse|pointer|touch)*(down|start)/i.test(n.type)||_.element(n.target)&&L(n.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||n.preventDefault()}else n.preventDefault()}(this,e,t)},e.interactions.docEvents.push({type:"dragstart",listener:function(t){for(var n=0,i=e.interactions.list;n<i.length;n++){var r=i[n];if(r.element&&(r.element===t.target||P(r.element,t.target)))return void r.interactable.checkAndPreventDefault(t)}}})},listeners:["down","move","up","cancel"].reduce(function(e,t){return e["interactions:".concat(t)]=dt,e},{})};function pt(e,t){if(t.phaselessTypes[e])return!0;for(var n in t.map)if(0===e.indexOf(n)&&e.substr(n.length)in t.phases)return!0;return!1}function ft(e){var t={};for(var n in e){var i=e[n];_.plainObject(i)?t[n]=ft(i):_.array(i)?t[n]=ye(i):t[n]=i}return t}var mt=function(){function e(t){r(this,e),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=gt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return a(e,[{key:"start",value:function(e,t){var n,i,r,s,a,o=e.phase,l=this.interaction,c=(s=(r=l).interactable.options[r.prepared.name],(a=s.modifiers)&&a.length?a:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map(function(e){var t=s[e];return t&&t.enabled&&{options:t,methods:t._methods}}).filter(function(e){return!!e}));this.prepareStates(c),this.startEdges=H({},l.edges),this.edges=H({},this.startEdges),this.startOffset=(i=t,(n=l.rect)?{left:i.x-n.left,top:i.y-n.top,right:n.right-i.x,bottom:n.bottom-i.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var u=this.fillArg({phase:o,pageCoords:t,preEnd:!1});return this.result=gt(),this.startAll(u),this.result=this.setAll(u)}},{key:"fillArg",value:function(e){var t=this.interaction;return e.interaction=t,e.interactable=t.interactable,e.element=t.element,e.rect||(e.rect=t.rect),e.edges||(e.edges=this.startEdges),e.startOffset=this.startOffset,e}},{key:"startAll",value:function(e){for(var t=0,n=this.states;t<n.length;t++){var i=n[t];i.methods.start&&(e.state=i,i.methods.start(e))}}},{key:"setAll",value:function(e){var t=e.phase,n=e.preEnd,i=e.skipModifiers,r=e.rect,s=e.edges;e.coords=H({},e.pageCoords),e.rect=H({},r),e.edges=H({},s);for(var a=i?this.states.slice(i):this.states,o=gt(e.coords,e.rect),l=0;l<a.length;l++){var c,u=a[l],d=u.options,h=H({},e.coords),p=null;null!=(c=u.methods)&&c.set&&this.shouldDo(d,n,t)&&(e.state=u,p=u.methods.set(e),K(e.edges,e.rect,{x:e.coords.x-h.x,y:e.coords.y-h.y})),o.eventProps.push(p)}H(this.edges,e.edges),o.delta.x=e.coords.x-e.pageCoords.x,o.delta.y=e.coords.y-e.pageCoords.y,o.rectDelta.left=e.rect.left-r.left,o.rectDelta.right=e.rect.right-r.right,o.rectDelta.top=e.rect.top-r.top,o.rectDelta.bottom=e.rect.bottom-r.bottom;var f=this.result.coords,m=this.result.rect;if(f&&m){var g=o.rect.left!==m.left||o.rect.right!==m.right||o.rect.top!==m.top||o.rect.bottom!==m.bottom;o.changed=g||f.x!==o.coords.x||f.y!==o.coords.y}return o}},{key:"applyToInteraction",value:function(e){var t=this.interaction,n=e.phase,i=t.coords.cur,r=t.coords.start,s=this.result,a=this.startDelta,o=s.delta;"start"===n&&H(this.startDelta,s.delta);for(var l=0,c=[[r,a],[i,o]];l<c.length;l++){var u=c[l],d=u[0],h=u[1];d.page.x+=h.x,d.page.y+=h.y,d.client.x+=h.x,d.client.y+=h.y}var p=this.result.rectDelta,f=e.rect||t.rect;f.left+=p.left,f.right+=p.right,f.top+=p.top,f.bottom+=p.bottom,f.width=f.right-f.left,f.height=f.bottom-f.top}},{key:"setAndApply",value:function(e){var t=this.interaction,n=e.phase,i=e.preEnd,r=e.skipModifiers,s=this.setAll(this.fillArg({preEnd:i,phase:n,pageCoords:e.modifiedCoords||t.coords.cur.page}));if(this.result=s,!s.changed&&(!r||r<this.states.length)&&t.interacting())return!1;if(e.modifiedCoords){var a=t.coords.cur.page,o={x:e.modifiedCoords.x-a.x,y:e.modifiedCoords.y-a.y};s.coords.x+=o.x,s.coords.y+=o.y,s.delta.x+=o.x,s.delta.y+=o.y}this.applyToInteraction(e)}},{key:"beforeEnd",value:function(e){var t=e.interaction,n=e.event,i=this.states;if(i&&i.length){for(var r=!1,s=0;s<i.length;s++){var a=i[s];e.state=a;var o=a.options,l=a.methods,c=l.beforeEnd&&l.beforeEnd(e);if(c)return this.endResult=c,!1;r=r||!r&&this.shouldDo(o,!0,e.phase,!0)}r&&t.move({event:n,preEnd:!0})}}},{key:"stop",value:function(e){var t=e.interaction;if(this.states&&this.states.length){var n=H({states:this.states,interactable:t.interactable,element:t.element,rect:null},e);this.fillArg(n);for(var i=0,r=this.states;i<r.length;i++){var s=r[i];n.state=s,s.methods.stop&&s.methods.stop(n)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(e){this.states=[];for(var t=0;t<e.length;t++){var n=e[t],i=n.options,r=n.methods,s=n.name;this.states.push({options:i,methods:r,index:t,name:s})}return this.states}},{key:"restoreInteractionCoords",value:function(e){var t=e.interaction,n=t.coords,i=t.rect,r=t.modification;if(r.result){for(var s=r.startDelta,a=r.result,o=a.delta,l=a.rectDelta,c=0,u=[[n.start,s],[n.cur,o]];c<u.length;c++){var d=u[c],h=d[0],p=d[1];h.page.x-=p.x,h.page.y-=p.y,h.client.x-=p.x,h.client.y-=p.y}i.left-=l.left,i.right-=l.right,i.top-=l.top,i.bottom-=l.bottom}}},{key:"shouldDo",value:function(e,t,n,i){return!(!e||!1===e.enabled||i&&!e.endOnly||e.endOnly&&!t||"start"===n&&!e.setStart)}},{key:"copyFrom",value:function(e){this.startOffset=e.startOffset,this.startDelta=e.startDelta,this.startEdges=e.startEdges,this.edges=e.edges,this.states=e.states.map(function(e){return ft(e)}),this.result=gt(H({},e.result.coords),H({},e.result.rect))}},{key:"destroy",value:function(){for(var e in this)this[e]=null}}]),e}();function gt(e,t){return{rect:t,coords:e,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function bt(e,t){var n=e.defaults,i={start:e.start,set:e.set,beforeEnd:e.beforeEnd,stop:e.stop},r=function(e){var r=e||{};for(var s in r.enabled=!1!==r.enabled,n)s in r||(r[s]=n[s]);var a={options:r,methods:i,name:t,enable:function(){return r.enabled=!0,a},disable:function(){return r.enabled=!1,a}};return a};return t&&"string"==typeof t&&(r._defaults=n,r._methods=i),r}function yt(e){var t=e.iEvent,n=e.interaction.modification.result;n&&(t.modifiers=n.eventProps)}var vt={id:"modifiers/base",before:["actions"],install:function(e){e.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(e){var t=e.interaction;t.modification=new mt(t)},"interactions:before-action-start":function(e){var t=e.interaction,n=e.interaction.modification;n.start(e,t.coords.start.page),t.edges=n.edges,n.applyToInteraction(e)},"interactions:before-action-move":function(e){var t=e.interaction,n=t.modification,i=n.setAndApply(e);return t.edges=n.edges,i},"interactions:before-action-end":function(e){var t=e.interaction,n=t.modification,i=n.beforeEnd(e);return t.edges=n.startEdges,i},"interactions:action-start":yt,"interactions:action-move":yt,"interactions:action-end":yt,"interactions:after-action-start":function(e){return e.interaction.modification.restoreInteractionCoords(e)},"interactions:after-action-move":function(e){return e.interaction.modification.restoreInteractionCoords(e)},"interactions:stop":function(e){return e.interaction.modification.stop(e)}}},Tt={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},xt=function(e){l(n,e);var t=h(n);function n(e,i,s,a,o,l,c){var u;r(this,n),(u=t.call(this,e)).relatedTarget=null,u.screenX=void 0,u.screenY=void 0,u.button=void 0,u.buttons=void 0,u.ctrlKey=void 0,u.shiftKey=void 0,u.altKey=void 0,u.metaKey=void 0,u.page=void 0,u.client=void 0,u.delta=void 0,u.rect=void 0,u.x0=void 0,u.y0=void 0,u.t0=void 0,u.dt=void 0,u.duration=void 0,u.clientX0=void 0,u.clientY0=void 0,u.velocity=void 0,u.speed=void 0,u.swipe=void 0,u.axes=void 0,u.preEnd=void 0,o=o||e.element;var h=e.interactable,p=(h&&h.options||Tt).deltaSource,f=Y(h,o,s),m="start"===a,g="end"===a,b=m?d(u):e.prevEvent,y=m?e.coords.start:g?{page:b.page,client:b.client,timeStamp:e.coords.cur.timeStamp}:e.coords.cur;return u.page=H({},y.page),u.client=H({},y.client),u.rect=H({},e.rect),u.timeStamp=y.timeStamp,g||(u.page.x-=f.x,u.page.y-=f.y,u.client.x-=f.x,u.client.y-=f.y),u.ctrlKey=i.ctrlKey,u.altKey=i.altKey,u.shiftKey=i.shiftKey,u.metaKey=i.metaKey,u.button=i.button,u.buttons=i.buttons,u.target=o,u.currentTarget=o,u.preEnd=l,u.type=c||s+(a||""),u.interactable=h,u.t0=m?e.pointers[e.pointers.length-1].downTime:b.t0,u.x0=e.coords.start.page.x-f.x,u.y0=e.coords.start.page.y-f.y,u.clientX0=e.coords.start.client.x-f.x,u.clientY0=e.coords.start.client.y-f.y,u.delta=m||g?{x:0,y:0}:{x:u[p].x-b[p].x,y:u[p].y-b[p].y},u.dt=e.coords.delta.timeStamp,u.duration=u.timeStamp-u.t0,u.velocity=H({},e.coords.velocity[p]),u.speed=J(u.velocity.x,u.velocity.y),u.swipe=g||"inertiastart"===a?u.getSwipe():null,u}return a(n,[{key:"getSwipe",value:function(){var e=this._interaction;if(e.prevEvent.speed<600||this.timeStamp-e.prevEvent.timeStamp>150)return null;var t=180*Math.atan2(e.prevEvent.velocityY,e.prevEvent.velocityX)/Math.PI;t<0&&(t+=360);var n=112.5<=t&&t<247.5,i=202.5<=t&&t<337.5;return{up:i,down:!i&&22.5<=t&&t<157.5,left:n,right:!n&&(292.5<=t||t<67.5),angle:t,speed:e.prevEvent.speed,velocity:{x:e.prevEvent.velocityX,y:e.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),n}(ge);Object.defineProperties(xt.prototype,{pageX:{get:function(){return this.page.x},set:function(e){this.page.x=e}},pageY:{get:function(){return this.page.y},set:function(e){this.page.y=e}},clientX:{get:function(){return this.client.x},set:function(e){this.client.x=e}},clientY:{get:function(){return this.client.y},set:function(e){this.client.y=e}},dx:{get:function(){return this.delta.x},set:function(e){this.delta.x=e}},dy:{get:function(){return this.delta.y},set:function(e){this.delta.y=e}},velocityX:{get:function(){return this.velocity.x},set:function(e){this.velocity.x=e}},velocityY:{get:function(){return this.velocity.y},set:function(e){this.velocity.y=e}}});var _t,St=a(function e(t,n,i,s,a){r(this,e),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=n,this.event=i,this.downTime=s,this.downTarget=a}),wt=((_t={}).interactable="",_t.element="",_t.prepared="",_t.pointerIsDown="",_t.pointerWasMoved="",_t._proxy="",_t),It=function(e){return e.start="",e.move="",e.end="",e.stop="",e.interacting="",e}({}),kt=0,Ct=function(){function e(t){var n=this,i=t.pointerType,s=t.scopeFire;r(this,e),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=je(function(e){this.move(e)},"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=kt++,this._scopeFire=s,this.pointerType=i;var a=this;this._proxy={};var o=function(e){Object.defineProperty(n._proxy,e,{get:function(){return a[e]}})};for(var l in wt)o(l);var c=function(e){Object.defineProperty(n._proxy,e,{value:function(){return a[e].apply(a,arguments)}})};for(var u in It)c(u);this._scopeFire("interactions:new",{interaction:this})}return a(e,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(e,t,n){var i=this.updatePointer(e,t,n,!0),r=this.pointers[i];this._scopeFire("interactions:down",{pointer:e,event:t,eventTarget:n,pointerIndex:i,pointerInfo:r,type:"down",interaction:this})}},{key:"start",value:function(e,t,n){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<("gesture"===e.name?2:1)||!t.options[e.name].enabled)&&(qe(this.prepared,e),this.interactable=t,this.element=n,this.rect=t.getRect(n),this.edges=this.prepared.edges?H({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(e,t,n){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(e,t,n,!1);var i,r,s=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(i=this.coords.cur.client.x-this.coords.start.client.x,r=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=J(i,r)>this.pointerMoveTolerance);var a,o,l,c=this.getPointerIndex(e),u={pointer:e,pointerIndex:c,pointerInfo:this.pointers[c],event:t,type:"move",eventTarget:n,dx:i,dy:r,duplicate:s,interaction:this};s||(a=this.coords.velocity,o=this.coords.delta,l=Math.max(o.timeStamp/1e3,.001),a.page.x=o.page.x/l,a.page.y=o.page.y/l,a.client.x=o.client.x/l,a.client.y=o.client.y/l,a.timeStamp=l),this._scopeFire("interactions:move",u),s||this.simulation||(this.interacting()&&(u.type=null,this.move(u)),this.pointerWasMoved&&ne(this.coords.prev,this.coords.cur))}},{key:"move",value:function(e){e&&e.event||ie(this.coords.delta),(e=H({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},e||{})).phase="move",this._doPhase(e)}},{key:"pointerUp",value:function(e,t,n,i){var r=this.getPointerIndex(e);-1===r&&(r=this.updatePointer(e,t,n,!1));var s=/cancel$/i.test(t.type)?"cancel":"up";this._scopeFire("interactions:".concat(s),{pointer:e,pointerIndex:r,pointerInfo:this.pointers[r],event:t,eventTarget:n,type:s,curEventTarget:i,interaction:this}),this.simulation||this.end(t),this.removePointer(e,t)}},{key:"documentBlur",value:function(e){this.end(e),this._scopeFire("interactions:blur",{event:e,type:"blur",interaction:this})}},{key:"end",value:function(e){var t;this._ending=!0,e=e||this._latestPointer.event,this.interacting()&&(t=this._doPhase({event:e,interaction:this,phase:"end"})),this._ending=!1,!0===t&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(e){var t=oe(e);return"mouse"===this.pointerType||"pen"===this.pointerType?this.pointers.length-1:ve(this.pointers,function(e){return e.id===t})}},{key:"getPointerInfo",value:function(e){return this.pointers[this.getPointerIndex(e)]}},{key:"updatePointer",value:function(e,t,n,i){var r,s,a,o=oe(e),l=this.getPointerIndex(e),c=this.pointers[l];return i=!1!==i&&(i||/(down|start)$/i.test(t.type)),c?c.pointer=e:(c=new St(o,e,t,null,null),l=this.pointers.length,this.pointers.push(c)),le(this.coords.cur,this.pointers.map(function(e){return e.pointer}),this._now()),r=this.coords.delta,s=this.coords.prev,a=this.coords.cur,r.page.x=a.page.x-s.page.x,r.page.y=a.page.y-s.page.y,r.client.x=a.client.x-s.client.x,r.client.y=a.client.y-s.client.y,r.timeStamp=a.timeStamp-s.timeStamp,i&&(this.pointerIsDown=!0,c.downTime=this.coords.cur.timeStamp,c.downTarget=n,te(this.downPointer,e),this.interacting()||(ne(this.coords.start,this.coords.cur),ne(this.coords.prev,this.coords.cur),this.downEvent=t,this.pointerWasMoved=!1)),this._updateLatestPointer(e,t,n),this._scopeFire("interactions:update-pointer",{pointer:e,event:t,eventTarget:n,down:i,pointerInfo:c,pointerIndex:l,interaction:this}),l}},{key:"removePointer",value:function(e,t){var n=this.getPointerIndex(e);if(-1!==n){var i=this.pointers[n];this._scopeFire("interactions:remove-pointer",{pointer:e,event:t,eventTarget:null,pointerIndex:n,pointerInfo:i,interaction:this}),this.pointers.splice(n,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(e,t,n){this._latestPointer.pointer=e,this._latestPointer.event=t,this._latestPointer.eventTarget=n}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(e,t,n,i){return new xt(this,e,this.prepared.name,t,this.element,n,i)}},{key:"_fireEvent",value:function(e){var t;null==(t=this.interactable)||t.fire(e),(!this.prevEvent||e.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=e)}},{key:"_doPhase",value:function(e){var t=e.event,n=e.phase,i=e.preEnd,r=e.type,s=this.rect;if(s&&"move"===n&&(K(this.edges,s,this.coords.delta[this.interactable.options.deltaSource]),s.width=s.right-s.left,s.height=s.bottom-s.top),!1===this._scopeFire("interactions:before-action-".concat(n),e))return!1;var a=e.iEvent=this._createPreparedEvent(t,n,i,r);return this._scopeFire("interactions:action-".concat(n),e),"start"===n&&(this.prevEvent=a),this._fireEvent(a),this._scopeFire("interactions:after-action-".concat(n),e),!0}},{key:"_now",value:function(){return Date.now()}}]),e}();function Et(e){At(e.interaction)}function At(e){if(!(t=e).offset.pending.x&&!t.offset.pending.y)return!1;var t,n=e.offset.pending;return Nt(e.coords.cur,n),Nt(e.coords.delta,n),K(e.edges,e.rect,n),n.x=0,n.y=0,!0}function Rt(e){var t=e.x,n=e.y;this.offset.pending.x+=t,this.offset.pending.y+=n,this.offset.total.x+=t,this.offset.total.y+=n}function Nt(e,t){var n=e.page,i=e.client,r=t.x,s=t.y;n.x+=r,n.y+=s,i.x+=r,i.y+=s}It.offsetBy="";var Pt={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(e){e.Interaction.prototype.offsetBy=Rt},listeners:{"interactions:new":function(e){e.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(e){var t;(t=e.interaction).pointerIsDown&&(Nt(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)},"interactions:before-action-start":Et,"interactions:before-action-move":Et,"interactions:before-action-end":function(e){var t=e.interaction;if(At(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(e){var t=e.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},Dt=function(){function e(t){r(this,e),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return a(e,[{key:"start",value:function(e){var t=this.interaction,n=Ot(t);if(!n||!n.enabled)return!1;var i=t.coords.velocity.client,r=J(i.x,i.y),s=this.modification||(this.modification=new mt(t));if(s.copyFrom(t.modification),this.t0=t._now(),this.allowResume=n.allowResume,this.v0=r,this.currentOffset={x:0,y:0},this.startCoords=t.coords.cur.page,this.modifierArg=s.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-t.coords.cur.timeStamp<50&&r>n.minSpeed&&r>n.endSpeed)this.startInertia();else{if(s.result=s.setAll(this.modifierArg),!s.result.changed)return!1;this.startSmoothEnd()}return t.modification.result.rect=null,t.offsetBy(this.targetOffset),t._doPhase({interaction:t,event:e,phase:"inertiastart"}),t.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),t.modification.result.rect=null,this.active=!0,t.simulation=this,!0}},{key:"startInertia",value:function(){var e=this,t=this.interaction.coords.velocity.client,n=Ot(this.interaction),i=n.resistance,r=-Math.log(n.endSpeed/this.v0)/i;this.targetOffset={x:(t.x-r)/i,y:(t.y-r)/i},this.te=r,this.lambda_v0=i/this.v0,this.one_ve_v0=1-n.endSpeed/this.v0;var s=this.modification,a=this.modifierArg;a.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},s.result=s.setAll(a),s.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+s.result.delta.x,y:this.targetOffset.y+s.result.delta.y}),this.onNextFrame(function(){return e.inertiaTick()})}},{key:"startSmoothEnd",value:function(){var e=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame(function(){return e.smoothEndTick()})}},{key:"onNextFrame",value:function(e){var t=this;this.timeout=Ue.request(function(){t.active&&e()})}},{key:"inertiaTick",value:function(){var e,t,n,i,r,s,a,o=this,l=this.interaction,c=Ot(l).resistance,u=(l._now()-this.t0)/1e3;if(u<this.te){var d,h=1-(Math.exp(-c*u)-this.lambda_v0)/this.one_ve_v0;this.isModified?(e=0,t=0,n=this.targetOffset.x,i=this.targetOffset.y,r=this.modifiedOffset.x,s=this.modifiedOffset.y,d={x:Lt(a=h,e,n,r),y:Lt(a,t,i,s)}):d={x:this.targetOffset.x*h,y:this.targetOffset.y*h};var p={x:d.x-this.currentOffset.x,y:d.y-this.currentOffset.y};this.currentOffset.x+=p.x,this.currentOffset.y+=p.y,l.offsetBy(p),l.move(),this.onNextFrame(function(){return o.inertiaTick()})}else l.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var e=this,t=this.interaction,n=t._now()-this.t0,i=Ot(t).smoothEndDuration;if(n<i){var r={x:Mt(n,0,this.targetOffset.x,i),y:Mt(n,0,this.targetOffset.y,i)},s={x:r.x-this.currentOffset.x,y:r.y-this.currentOffset.y};this.currentOffset.x+=s.x,this.currentOffset.y+=s.y,t.offsetBy(s),t.move({skipModifiers:this.modifierCount}),this.onNextFrame(function(){return e.smoothEndTick()})}else t.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(e){var t=e.pointer,n=e.event,i=e.eventTarget,r=this.interaction;r.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),r.updatePointer(t,n,i,!0),r._doPhase({interaction:r,event:n,phase:"resume"}),ne(r.coords.prev,r.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,Ue.cancel(this.timeout)}}]),e}();function Ot(e){var t=e.interactable,n=e.prepared;return t&&t.options&&n.name&&t.options[n.name].inertia}function Lt(e,t,n,i){var r=1-e;return r*r*t+2*r*e*n+e*e*i}function Mt(e,t,n,i){return-n*(e/=i)*(e-2)+t}var Ft={id:"inertia",before:["modifiers","actions"],install:function(e){var t=e.defaults;e.usePlugin(Pt),e.usePlugin(vt),e.actions.phases.inertiastart=!0,e.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(e){var t=e.interaction;t.inertia=new Dt(t)},"interactions:before-action-end":function(e){var t=e.interaction,n=e.event;return(!t._interacting||t.simulation||!t.inertia.start(n))&&null},"interactions:down":function(e){var t=e.interaction,n=e.eventTarget,i=t.inertia;if(i.active)for(var r=n;_.element(r);){if(r===t.element){i.resume(e);break}r=O(r)}},"interactions:stop":function(e){var t=e.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(e){var t=e.interaction.modification;t.stop(e),t.start(e,e.interaction.coords.cur.page),t.applyToInteraction(e)},"interactions:before-action-inertiastart":function(e){return e.interaction.modification.setAndApply(e)},"interactions:action-resume":yt,"interactions:action-inertiastart":yt,"interactions:after-action-inertiastart":function(e){return e.interaction.modification.restoreInteractionCoords(e)},"interactions:after-action-resume":function(e){return e.interaction.modification.restoreInteractionCoords(e)}}};function $t(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(e.immediatePropagationStopped)break;i(e)}}var Bt=function(){function e(t){r(this,e),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=H({},t||{})}return a(e,[{key:"fire",value:function(e){var t,n=this.global;(t=this.types[e.type])&&$t(e,t),!e.propagationStopped&&n&&(t=n[e.type])&&$t(e,t)}},{key:"on",value:function(e,t){var n=Z(e,t);for(e in n)this.types[e]=be(this.types[e]||[],n[e])}},{key:"off",value:function(e,t){var n=Z(e,t);for(e in n){var i=this.types[e];if(i&&i.length)for(var r=0,s=n[e];r<s.length;r++){var a=s[r],o=i.indexOf(a);-1!==o&&i.splice(o,1)}}}},{key:"getRect",value:function(e){return null}}]),e}(),zt=function(){function e(t){r(this,e),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,te(this,t)}return a(e,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),e}();function Ut(e){return _.object(e)?{capture:!!e.capture,passive:!!e.passive}:{capture:!!e,passive:!1}}function Gt(e,t){return e===t||("boolean"==typeof e?!!t.capture===e&&0==!!t.passive:!!e.capture==!!t.capture&&!!e.passive==!!t.passive)}var Vt={id:"events",install:function(e){var t,n=[],i={},r=[],s={add:a,remove:o,addDelegate:function(e,t,n,s,o){var u=Ut(o);if(!i[n]){i[n]=[];for(var d=0;d<r.length;d++){var h=r[d];a(h,n,l),a(h,n,c,!0)}}var p=i[n],f=Te(p,function(n){return n.selector===e&&n.context===t});f||(f={selector:e,context:t,listeners:[]},p.push(f)),f.listeners.push({func:s,options:u})},removeDelegate:function(e,t,n,r,s){var a,u=Ut(s),d=i[n],h=!1;if(d)for(a=d.length-1;a>=0;a--){var p=d[a];if(p.selector===e&&p.context===t){for(var f=p.listeners,m=f.length-1;m>=0;m--){var g=f[m];if(g.func===r&&Gt(g.options,u)){f.splice(m,1),f.length||(d.splice(a,1),o(t,n,l),o(t,n,c,!0)),h=!0;break}}if(h)break}}},delegateListener:l,delegateUseCapture:c,delegatedEvents:i,documents:r,targets:n,supportsOptions:!1,supportsPassive:!1};function a(e,t,i,r){if(e.addEventListener){var a=Ut(r),o=Te(n,function(t){return t.eventTarget===e});o||(o={eventTarget:e,events:{}},n.push(o)),o.events[t]||(o.events[t]=[]),Te(o.events[t],function(e){return e.func===i&&Gt(e.options,a)})||(e.addEventListener(t,i,s.supportsOptions?a:a.capture),o.events[t].push({func:i,options:a}))}}function o(e,t,i,r){if(e.addEventListener&&e.removeEventListener){var a=ve(n,function(t){return t.eventTarget===e}),l=n[a];if(l&&l.events)if("all"!==t){var c=!1,u=l.events[t];if(u){if("all"===i){for(var d=u.length-1;d>=0;d--){var h=u[d];o(e,t,h.func,h.options)}return}for(var p=Ut(r),f=0;f<u.length;f++){var m=u[f];if(m.func===i&&Gt(m.options,p)){e.removeEventListener(t,i,s.supportsOptions?p:p.capture),u.splice(f,1),0===u.length&&(delete l.events[t],c=!0);break}}}c&&!Object.keys(l.events).length&&n.splice(a,1)}else for(t in l.events)l.events.hasOwnProperty(t)&&o(e,t,"all")}}function l(e,t){for(var n=Ut(t),r=new zt(e),s=i[e.type],a=me(e)[0],o=a;_.element(o);){for(var l=0;l<s.length;l++){var c=s[l],u=c.selector,d=c.context;if(L(o,u)&&P(d,a)&&P(d,o)){var h=c.listeners;r.currentTarget=o;for(var p=0;p<h.length;p++){var f=h[p];Gt(f.options,n)&&f.func(r)}}}o=O(o)}}function c(e){return l(e,!0)}return null==(t=e.document)||t.createElement("div").addEventListener("test",null,{get capture(){return s.supportsOptions=!0},get passive(){return s.supportsPassive=!0}}),e.events=s,s}},Ht={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(e){for(var t=0,n=Ht.methodOrder;t<n.length;t++){var i=n[t],r=Ht[i](e);if(r)return r}return null},simulationResume:function(e){var t=e.pointerType,n=e.eventType,i=e.eventTarget,r=e.scope;if(!/down|start/i.test(n))return null;for(var s=0,a=r.interactions.list;s<a.length;s++){var o=a[s],l=i;if(o.simulation&&o.simulation.allowResume&&o.pointerType===t)for(;l;){if(l===o.element)return o;l=O(l)}}return null},mouseOrPen:function(e){var t,n=e.pointerId,i=e.pointerType,r=e.eventType,s=e.scope;if("mouse"!==i&&"pen"!==i)return null;for(var a=0,o=s.interactions.list;a<o.length;a++){var l=o[a];if(l.pointerType===i){if(l.simulation&&!Wt(l,n))continue;if(l.interacting())return l;t||(t=l)}}if(t)return t;for(var c=0,u=s.interactions.list;c<u.length;c++){var d=u[c];if(!(d.pointerType!==i||/down/i.test(r)&&d.simulation))return d}return null},hasPointer:function(e){for(var t=e.pointerId,n=0,i=e.scope.interactions.list;n<i.length;n++){var r=i[n];if(Wt(r,t))return r}return null},idle:function(e){for(var t=e.pointerType,n=0,i=e.scope.interactions.list;n<i.length;n++){var r=i[n];if(1===r.pointers.length){var s=r.interactable;if(s&&(!s.options.gesture||!s.options.gesture.enabled))continue}else if(r.pointers.length>=2)continue;if(!r.interacting()&&t===r.pointerType)return r}return null}};function Wt(e,t){return e.pointers.some(function(e){return e.id===t})}var jt=Ht,qt=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function Xt(e,t){return function(n){var i=t.interactions.list,r=fe(n),s=me(n),a=s[0],o=s[1],l=[];if(/^touch/.test(n.type)){t.prevTouchTime=t.now();for(var c=0,u=n.changedTouches;c<u.length;c++){var d=u[c],h={pointer:d,pointerId:oe(d),pointerType:r,eventType:n.type,eventTarget:a,curEventTarget:o,scope:t},p=Kt(h);l.push([h.pointer,h.eventTarget,h.curEventTarget,p])}}else{var f=!1;if(!N.supportsPointerEvent&&/mouse/.test(n.type)){for(var m=0;m<i.length&&!f;m++)f="mouse"!==i[m].pointerType&&i[m].pointerIsDown;f=f||t.now()-t.prevTouchTime<500||0===n.timeStamp}if(!f){var g={pointer:n,pointerId:oe(n),pointerType:r,eventType:n.type,curEventTarget:o,eventTarget:a,scope:t},b=Kt(g);l.push([g.pointer,g.eventTarget,g.curEventTarget,b])}}for(var y=0;y<l.length;y++){var v=l[y],T=v[0],x=v[1],_=v[2];v[3][e](T,n,x,_)}}}function Kt(e){var t=e.pointerType,n=e.scope,i={interaction:jt.search(e),searchDetails:e};return n.fire("interactions:find",i),i.interaction||n.interactions.new({pointerType:t})}function Yt(e,t){var n=e.doc,i=e.scope,r=e.options,s=i.interactions.docEvents,a=i.events,o=a[t];for(var l in i.browser.isIOS&&!r.events&&(r.events={passive:!1}),a.delegatedEvents)o(n,l,a.delegateListener),o(n,l,a.delegateUseCapture,!0);for(var c=r&&r.events,u=0;u<s.length;u++){var d=s[u];o(n,d.type,d.listener,c)}}var Zt={id:"core/interactions",install:function(e){for(var t={},n=0;n<qt.length;n++){var i=qt[n];t[i]=Xt(i,e)}var s,o=N.pEventTypes;function c(){for(var t=0,n=e.interactions.list;t<n.length;t++){var i=n[t];if(i.pointerIsDown&&"touch"===i.pointerType&&!i._interacting)for(var r=function(){var t=a[s];e.documents.some(function(e){return P(e.doc,t.downTarget)})||i.removePointer(t.pointer,t.event)},s=0,a=i.pointers;s<a.length;s++)r()}}(s=A.PointerEvent?[{type:o.down,listener:c},{type:o.down,listener:t.pointerDown},{type:o.move,listener:t.pointerMove},{type:o.up,listener:t.pointerUp},{type:o.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:c},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(t){for(var n=0,i=e.interactions.list;n<i.length;n++)i[n].documentBlur(t)}}),e.prevTouchTime=0,e.Interaction=function(t){l(i,t);var n=h(i);function i(){return r(this,i),n.apply(this,arguments)}return a(i,[{key:"pointerMoveTolerance",get:function(){return e.interactions.pointerMoveTolerance},set:function(t){e.interactions.pointerMoveTolerance=t}},{key:"_now",value:function(){return e.now()}}]),i}(Ct),e.interactions={list:[],new:function(t){t.scopeFire=function(t,n){return e.fire(t,n)};var n=new e.Interaction(t);return e.interactions.list.push(n),n},listeners:t,docEvents:s,pointerMoveTolerance:1},e.usePlugin(ht)},listeners:{"scope:add-document":function(e){return Yt(e,"add")},"scope:remove-document":function(e){return Yt(e,"remove")},"interactable:unset":function(e,t){for(var n=e.interactable,i=t.interactions.list.length-1;i>=0;i--){var r=t.interactions.list[i];r.interactable===n&&(r.stop(),t.fire("interactions:destroy",{interaction:r}),r.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(i,1))}}},onDocSignal:Yt,doOnInteractions:Xt,methodNames:qt},Qt=Zt,Jt=function(e){return e[e.On=0]="On",e[e.Off=1]="Off",e}(Jt||{}),en=function(){function e(t,n,i,s){r(this,e),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new Bt,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=n.actions,this.target=t,this._context=n.context||i,this._win=v(V(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=s,this.set(n)}return a(e,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(e,t){return _.func(t.onstart)&&this.on("".concat(e,"start"),t.onstart),_.func(t.onmove)&&this.on("".concat(e,"move"),t.onmove),_.func(t.onend)&&this.on("".concat(e,"end"),t.onend),_.func(t.oninertiastart)&&this.on("".concat(e,"inertiastart"),t.oninertiastart),this}},{key:"updatePerActionListeners",value:function(e,t,n){var i,r=this,s=null==(i=this._actions.map[e])?void 0:i.filterEventType,a=function(e){return(null==s||s(e))&&pt(e,r._actions)};(_.array(t)||_.object(t))&&this._onOff(Jt.Off,e,t,void 0,a),(_.array(n)||_.object(n))&&this._onOff(Jt.On,e,n,void 0,a)}},{key:"setPerAction",value:function(e,t){var n=this._defaults;for(var i in t){var r=i,s=this.options[e],a=t[r];"listeners"===r&&this.updatePerActionListeners(e,s.listeners,a),_.array(a)?s[r]=ye(a):_.plainObject(a)?(s[r]=H(s[r]||{},ft(a)),_.object(n.perAction[r])&&"enabled"in n.perAction[r]&&(s[r].enabled=!1!==a.enabled)):_.bool(a)&&_.object(n.perAction[r])?s[r].enabled=a:s[r]=a}}},{key:"getRect",value:function(e){return e=e||(_.element(this.target)?this.target:null),_.string(this.target)&&(e=e||this._context.querySelector(this.target)),U(e)}},{key:"rectChecker",value:function(e){var t=this;return _.func(e)?(this.getRect=function(n){var i=H({},e.apply(t,n));return"width"in i||(i.width=i.right-i.left,i.height=i.bottom-i.top),i},this):null===e?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(e,t){if(V(t)||_.object(t)){for(var n in this.options[e]=t,this._actions.map)this.options[n][e]=t;return this}return this.options[e]}},{key:"origin",value:function(e){return this._backCompatOption("origin",e)}},{key:"deltaSource",value:function(e){return"page"===e||"client"===e?(this.options.deltaSource=e,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var e=this.target;return _.string(e)?Array.from(this._context.querySelectorAll(e)):_.func(e)&&e.getAllElements?e.getAllElements():_.element(e)?[e]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(e){return this._context===e.ownerDocument||P(this._context,e)}},{key:"testIgnoreAllow",value:function(e,t,n){return!this.testIgnore(e.ignoreFrom,t,n)&&this.testAllow(e.allowFrom,t,n)}},{key:"testAllow",value:function(e,t,n){return!e||!!_.element(n)&&(_.string(e)?$(n,e,t):!!_.element(e)&&P(e,n))}},{key:"testIgnore",value:function(e,t,n){return!(!e||!_.element(n))&&(_.string(e)?$(n,e,t):!!_.element(e)&&P(e,n))}},{key:"fire",value:function(e){return this.events.fire(e),this}},{key:"_onOff",value:function(e,t,n,i,r){_.object(t)&&!_.array(t)&&(i=n,n=null);var s=Z(t,n,r);for(var a in s){"wheel"===a&&(a=N.wheelEvent);for(var o=0,l=s[a];o<l.length;o++){var c=l[o];pt(a,this._actions)?this.events[e===Jt.On?"on":"off"](a,c):_.string(this.target)?this._scopeEvents[e===Jt.On?"addDelegate":"removeDelegate"](this.target,this._context,a,c,i):this._scopeEvents[e===Jt.On?"add":"remove"](this.target,a,c,i)}}return this}},{key:"on",value:function(e,t,n){return this._onOff(Jt.On,e,t,n)}},{key:"off",value:function(e,t,n){return this._onOff(Jt.Off,e,t,n)}},{key:"set",value:function(e){var t=this._defaults;for(var n in _.object(e)||(e={}),this.options=ft(t.base),this._actions.methodDict){var i=n,r=this._actions.methodDict[i];this.options[i]={},this.setPerAction(i,H(H({},t.perAction),t.actions[i])),this[r](e[i])}for(var s in e)"getRect"!==s?_.func(this[s])&&this[s](e[s]):this.rectChecker(e.getRect);return this}},{key:"unset",value:function(){if(_.string(this.target))for(var e in this._scopeEvents.delegatedEvents)for(var t=this._scopeEvents.delegatedEvents[e],n=t.length-1;n>=0;n--){var i=t[n],r=i.selector,s=i.context,a=i.listeners;r===this.target&&s===this._context&&t.splice(n,1);for(var o=a.length-1;o>=0;o--)this._scopeEvents.removeDelegate(this.target,this._context,e,a[o][0],a[o][1])}else this._scopeEvents.remove(this.target,"all")}}]),e}(),tn=function(){function e(t){var n=this;r(this,e),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(e){var t=e.interactable,i=t.target,r=_.string(i)?n.selectorMap[i]:i[n.scope.id],s=ve(r,function(e){return e===t});r.splice(s,1)}})}return a(e,[{key:"new",value:function(e,t){t=H(t||{},{actions:this.scope.actions});var n=new this.scope.Interactable(e,t,this.scope.document,this.scope.events);return this.scope.addDocument(n._doc),this.list.push(n),_.string(e)?(this.selectorMap[e]||(this.selectorMap[e]=[]),this.selectorMap[e].push(n)):(n.target[this.scope.id]||Object.defineProperty(e,this.scope.id,{value:[],configurable:!0}),e[this.scope.id].push(n)),this.scope.fire("interactable:new",{target:e,options:t,interactable:n,win:this.scope._win}),n}},{key:"getExisting",value:function(e,t){var n=t&&t.context||this.scope.document,i=_.string(e),r=i?this.selectorMap[e]:e[this.scope.id];if(r)return Te(r,function(t){return t._context===n&&(i||t.inContext(e))})}},{key:"forEachMatch",value:function(e,t){for(var n=0,i=this.list;n<i.length;n++){var r=i[n],s=void 0;if((_.string(r.target)?_.element(e)&&L(e,r.target):e===r.target)&&r.inContext(e)&&(s=t(r)),void 0!==s)return s}}}]),e}(),nn=function(){function e(){var t,n,i=this;r(this,e),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=N,this.defaults=ft(Tt),this.Eventable=Bt,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(t=this,(n=function e(n,i){var r=t.interactables.getExisting(n,i);return r||((r=t.interactables.new(n,i)).events.global=e.globalEvents),r}).getPointerAverage=ue,n.getTouchBBox=de,n.getTouchDistance=he,n.getTouchAngle=pe,n.getElementRect=U,n.getElementClientRect=z,n.matchesSelector=L,n.closest=D,n.globalEvents={},n.version="1.10.27",n.scope=t,n.use=function(e,t){return this.scope.usePlugin(e,t),this},n.isSet=function(e,t){return!!this.scope.interactables.get(e,t&&t.context)},n.on=je(function(e,t,n){if(_.string(e)&&-1!==e.search(" ")&&(e=e.trim().split(/ +/)),_.array(e)){for(var i=0,r=e;i<r.length;i++){var s=r[i];this.on(s,t,n)}return this}if(_.object(e)){for(var a in e)this.on(a,e[a],t);return this}return pt(e,this.scope.actions)?this.globalEvents[e]?this.globalEvents[e].push(t):this.globalEvents[e]=[t]:this.scope.events.add(this.scope.document,e,t,{options:n}),this},"The interact.on() method is being deprecated"),n.off=je(function(e,t,n){if(_.string(e)&&-1!==e.search(" ")&&(e=e.trim().split(/ +/)),_.array(e)){for(var i=0,r=e;i<r.length;i++){var s=r[i];this.off(s,t,n)}return this}if(_.object(e)){for(var a in e)this.off(a,e[a],t);return this}var o;return pt(e,this.scope.actions)?e in this.globalEvents&&-1!==(o=this.globalEvents[e].indexOf(t))&&this.globalEvents[e].splice(o,1):this.scope.events.remove(this.scope.document,e,t,n),this},"The interact.off() method is being deprecated"),n.debug=function(){return this.scope},n.supportsTouch=function(){return N.supportsTouch},n.supportsPointerEvent=function(){return N.supportsPointerEvent},n.stop=function(){for(var e=0,t=this.scope.interactions.list;e<t.length;e++)t[e].stop();return this},n.pointerMoveTolerance=function(e){return _.number(e)?(this.scope.interactions.pointerMoveTolerance=e,this):this.scope.interactions.pointerMoveTolerance},n.addDocument=function(e,t){this.scope.addDocument(e,t)},n.removeDocument=function(e){this.scope.removeDocument(e)},n),this.InteractEvent=xt,this.Interactable=void 0,this.interactables=new tn(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(e){return i.removeDocument(e.target)};var s=this;this.Interactable=function(e){l(n,e);var t=h(n);function n(){return r(this,n),t.apply(this,arguments)}return a(n,[{key:"_defaults",get:function(){return s.defaults}},{key:"set",value:function(e){return p(c(n.prototype),"set",this).call(this,e),s.fire("interactable:set",{options:e,interactable:this}),this}},{key:"unset",value:function(){p(c(n.prototype),"unset",this).call(this);var e=s.interactables.list.indexOf(this);e<0||(s.interactables.list.splice(e,1),s.fire("interactable:unset",{interactable:this}))}}]),n}(en)}return a(e,[{key:"addListeners",value:function(e,t){this.listenerMaps.push({id:t,map:e})}},{key:"fire",value:function(e,t){for(var n=0,i=this.listenerMaps;n<i.length;n++){var r=i[n].map[e];if(r&&!1===r(t,this,e))return!1}}},{key:"init",value:function(e){return this.isInitialized?this:(n=e,(t=this).isInitialized=!0,_.window(n)&&y(n),A.init(n),N.init(n),Ue.init(n),t.window=n,t.document=n.document,t.usePlugin(Qt),t.usePlugin(Vt),t);var t,n}},{key:"pluginIsInstalled",value:function(e){var t=e.id;return t?!!this._plugins.map[t]:-1!==this._plugins.list.indexOf(e)}},{key:"usePlugin",value:function(e,t){if(!this.isInitialized)return this;if(this.pluginIsInstalled(e))return this;if(e.id&&(this._plugins.map[e.id]=e),this._plugins.list.push(e),e.install&&e.install(this,t),e.listeners&&e.before){for(var n=0,i=this.listenerMaps.length,r=e.before.reduce(function(e,t){return e[t]=!0,e[rn(t)]=!0,e},{});n<i;n++){var s=this.listenerMaps[n].id;if(s&&(r[s]||r[rn(s)]))break}this.listenerMaps.splice(n,0,{id:e.id,map:e.listeners})}else e.listeners&&this.listenerMaps.push({id:e.id,map:e.listeners});return this}},{key:"addDocument",value:function(e,t){if(-1!==this.getDocIndex(e))return!1;var n=v(e);t=t?H({},t):{},this.documents.push({doc:e,options:t}),this.events.documents.push(e),e!==this.document&&this.events.add(n,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:e,window:n,scope:this,options:t})}},{key:"removeDocument",value:function(e){var t=this.getDocIndex(e),n=v(e),i=this.documents[t].options;this.events.remove(n,"unload",this.onWindowUnload),this.documents.splice(t,1),this.events.documents.splice(t,1),this.fire("scope:remove-document",{doc:e,window:n,scope:this,options:i})}},{key:"getDocIndex",value:function(e){for(var t=0;t<this.documents.length;t++)if(this.documents[t].doc===e)return t;return-1}},{key:"getDocOptions",value:function(e){var t=this.getDocIndex(e);return-1===t?null:this.documents[t].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),e}();function rn(e){return e&&e.replace(/\/.*$/,"")}var sn=new nn,an=sn.interactStatic,on="undefined"!=typeof globalThis?globalThis:window;sn.init(on);var ln=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(e){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter(function(t){var n=t[0],i=t[1];return n in e||i in e}),n=function(n,i){for(var r=e.range,s=e.limits,a=void 0===s?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:s,o=e.offset,l=void 0===o?{x:0,y:0}:o,c={range:r,grid:e,x:null,y:null},u=0;u<t.length;u++){var d=t[u],h=d[0],p=d[1],f=Math.round((n-l.x)/e[h]),m=Math.round((i-l.y)/e[p]);c[h]=Math.max(a.left,Math.min(a.right,f*e[h]+l.x)),c[p]=Math.max(a.top,Math.min(a.bottom,m*e[p]+l.y))}return c};return n.grid=e,n.coordFields=t,n}}),cn={id:"snappers",install:function(e){var t=e.interactStatic;t.snappers=H(t.snappers||{},ln),t.createSnapGrid=t.snappers.grid}},un=cn,dn={start:function(e){var t=e.state,i=e.rect,r=e.edges,s=e.pageCoords,a=t.options,o=a.ratio,l=a.enabled,c=t.options,u=c.equalDelta,d=c.modifiers;"preserve"===o&&(o=i.width/i.height),t.startCoords=H({},s),t.startRect=H({},i),t.ratio=o,t.equalDelta=u;var h=t.linkedEdges={top:r.top||r.left&&!r.bottom,left:r.left||r.top&&!r.right,bottom:r.bottom||r.right&&!r.top,right:r.right||r.bottom&&!r.left};if(t.xIsPrimaryAxis=!(!r.left&&!r.right),t.equalDelta){var p=(h.left?1:-1)*(h.top?1:-1);t.edgeSign={x:p,y:p}}else t.edgeSign={x:h.left?-1:1,y:h.top?-1:1};if(!1!==l&&H(r,h),null!=d&&d.length){var f=new mt(e.interaction);f.copyFrom(e.interaction.modification),f.prepareStates(d),t.subModification=f,f.startAll(n({},e))}},set:function(e){var t=e.state,i=e.rect,r=e.coords,s=t.linkedEdges,a=H({},r),o=t.equalDelta?hn:pn;if(H(e.edges,s),o(t,t.xIsPrimaryAxis,r,i),!t.subModification)return null;var l=H({},i);K(s,l,{x:r.x-a.x,y:r.y-a.y});var c=t.subModification.setAll(n(n({},e),{},{rect:l,edges:s,pageCoords:r,prevCoords:r,prevRect:l})),u=c.delta;return c.changed&&(o(t,Math.abs(u.x)>Math.abs(u.y),c.coords,c.rect),H(r,c.coords)),c.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function hn(e,t,n){var i=e.startCoords,r=e.edgeSign;t?n.y=i.y+(n.x-i.x)*r.y:n.x=i.x+(n.y-i.y)*r.x}function pn(e,t,n,i){var r=e.startRect,s=e.startCoords,a=e.ratio,o=e.edgeSign;if(t){var l=i.width/a;n.y=s.y+(l-r.height)*o.y}else{var c=i.height*a;n.x=s.x+(c-r.width)*o.x}}var fn=bt(dn,"aspectRatio"),mn=function(){};mn._defaults={};var gn=mn;function bn(e,t,n){return _.func(e)?j(e,t.interactable,t.element,[n.x,n.y,t]):j(e,t.interactable,t.element)}var yn={start:function(e){var t=e.rect,n=e.startOffset,i=e.state,r=e.interaction,s=e.pageCoords,a=i.options,o=a.elementRect,l=H({left:0,top:0,right:0,bottom:0},a.offset||{});if(t&&o){var c=bn(a.restriction,r,s);if(c){var u=c.right-c.left-t.width,d=c.bottom-c.top-t.height;u<0&&(l.left+=u,l.right+=u),d<0&&(l.top+=d,l.bottom+=d)}l.left+=n.left-t.width*o.left,l.top+=n.top-t.height*o.top,l.right+=n.right-t.width*(1-o.right),l.bottom+=n.bottom-t.height*(1-o.bottom)}i.offset=l},set:function(e){var t,n=e.coords,i=e.interaction,r=e.state,s=r.options,a=r.offset,o=bn(s.restriction,i,n);if(o){var l=(!(t=o)||"left"in t&&"top"in t||((t=H({},t)).left=t.x||0,t.top=t.y||0,t.right=t.right||t.left+t.width,t.bottom=t.bottom||t.top+t.height),t);n.x=Math.max(Math.min(l.right-a.right,n.x),l.left+a.left),n.y=Math.max(Math.min(l.bottom-a.bottom,n.y),l.top+a.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},vn=bt(yn,"restrict"),Tn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},xn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function _n(e,t){for(var n=0,i=["top","left","bottom","right"];n<i.length;n++){var r=i[n];r in e||(e[r]=t[r])}return e}var Sn={noInner:Tn,noOuter:xn,start:function(e){var t,n=e.interaction,i=e.startOffset,r=e.state,s=r.options;s&&(t=q(bn(s.offset,n,n.coords.start.page))),t=t||{x:0,y:0},r.offset={top:t.y+i.top,left:t.x+i.left,bottom:t.y-i.bottom,right:t.x-i.right}},set:function(e){var t=e.coords,n=e.edges,i=e.interaction,r=e.state,s=r.offset,a=r.options;if(n){var o=H({},t),l=bn(a.inner,i,o)||{},c=bn(a.outer,i,o)||{};_n(l,Tn),_n(c,xn),n.top?t.y=Math.min(Math.max(c.top+s.top,o.y),l.top+s.top):n.bottom&&(t.y=Math.max(Math.min(c.bottom+s.bottom,o.y),l.bottom+s.bottom)),n.left?t.x=Math.min(Math.max(c.left+s.left,o.x),l.left+s.left):n.right&&(t.x=Math.max(Math.min(c.right+s.right,o.x),l.right+s.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},wn=bt(Sn,"restrictEdges"),In=H({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(e){}},yn.defaults),kn=bt({start:yn.start,set:yn.set,defaults:In},"restrictRect"),Cn={width:-1/0,height:-1/0},En={width:1/0,height:1/0},An=bt({start:function(e){return Sn.start(e)},set:function(e){var t=e.interaction,n=e.state,i=e.rect,r=e.edges,s=n.options;if(r){var a=X(bn(s.min,t,e.coords))||Cn,o=X(bn(s.max,t,e.coords))||En;n.options={endOnly:s.endOnly,inner:H({},Sn.noInner),outer:H({},Sn.noOuter)},r.top?(n.options.inner.top=i.bottom-a.height,n.options.outer.top=i.bottom-o.height):r.bottom&&(n.options.inner.bottom=i.top+a.height,n.options.outer.bottom=i.top+o.height),r.left?(n.options.inner.left=i.right-a.width,n.options.outer.left=i.right-o.width):r.right&&(n.options.inner.right=i.left+a.width,n.options.outer.right=i.left+o.width),Sn.set(e),n.options=s}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),Rn={start:function(e){var t,n,i,r=e.interaction,s=e.interactable,a=e.element,o=e.rect,l=e.state,c=e.startOffset,u=l.options,d=u.offsetWithOrigin?(i=(n=e).interaction.element,q(j(n.state.options.origin,null,null,[i]))||Y(n.interactable,i,n.interaction.prepared.name)):{x:0,y:0};if("startCoords"===u.offset)t={x:r.coords.start.page.x,y:r.coords.start.page.y};else{var h=j(u.offset,s,a,[r]);(t=q(h)||{x:0,y:0}).x+=d.x,t.y+=d.y}var p=u.relativePoints;l.offsets=o&&p&&p.length?p.map(function(e,n){return{index:n,relativePoint:e,x:c.left-o.width*e.x+t.x,y:c.top-o.height*e.y+t.y}}):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(e){var t=e.interaction,n=e.coords,i=e.state,r=i.options,s=i.offsets,a=Y(t.interactable,t.element,t.prepared.name),o=H({},n),l=[];r.offsetWithOrigin||(o.x-=a.x,o.y-=a.y);for(var c=0,u=s;c<u.length;c++)for(var d=u[c],h=o.x-d.x,p=o.y-d.y,f=0,m=r.targets.length;f<m;f++){var g=r.targets[f],b=void 0;(b=_.func(g)?g(h,p,t._proxy,d,f):g)&&l.push({x:(_.number(b.x)?b.x:h)+d.x,y:(_.number(b.y)?b.y:p)+d.y,range:_.number(b.range)?b.range:r.range,source:g,index:f,offset:d})}for(var y={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},v=0;v<l.length;v++){var T=l[v],x=T.range,S=T.x-o.x,w=T.y-o.y,I=J(S,w),k=I<=x;x===1/0&&y.inRange&&y.range!==1/0&&(k=!1),y.target&&!(k?y.inRange&&x!==1/0?I/x<y.distance/y.range:x===1/0&&y.range!==1/0||I<y.distance:!y.inRange&&I<y.distance)||(y.target=T,y.distance=I,y.range=x,y.inRange=k,y.delta.x=S,y.delta.y=w)}return y.inRange&&(n.x=y.target.x,n.y=y.target.y),i.closest=y,y},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},Nn=bt(Rn,"snap"),Pn={start:function(e){var t=e.state,n=e.edges,i=t.options;if(!n)return null;e.state={options:{targets:null,relativePoints:[{x:n.left?0:1,y:n.top?0:1}],offset:i.offset||"self",origin:{x:0,y:0},range:i.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],Rn.start(e),t.offsets=e.state.offsets,e.state=t},set:function(e){var t=e.interaction,n=e.state,i=e.coords,r=n.options,s=n.offsets,a={x:i.x-s[0].x,y:i.y-s[0].y};n.options=H({},r),n.options.targets=[];for(var o=0,l=r.targets||[];o<l.length;o++){var c=l[o],u=void 0;if(u=_.func(c)?c(a.x,a.y,t):c){for(var d=0,h=n.targetFields;d<h.length;d++){var p=h[d],f=p[0],m=p[1];if(f in u||m in u){u.x=u[f],u.y=u[m];break}}n.options.targets.push(u)}}var g=Rn.set(e);return n.options=r,g},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},Dn=bt(Pn,"snapSize"),On={aspectRatio:fn,restrictEdges:wn,restrict:vn,restrictRect:kn,restrictSize:An,snapEdges:bt({start:function(e){var t=e.edges;return t?(e.state.targetFields=e.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],Pn.start(e)):null},set:Pn.set,defaults:H(ft(Pn.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:Nn,snapSize:Dn,spring:gn,avoid:gn,transform:gn,rubberband:gn},Ln={id:"modifiers",install:function(e){var t=e.interactStatic;for(var n in e.usePlugin(vt),e.usePlugin(un),t.modifiers=On,On){var i=On[n],r=i._defaults,s=i._methods;r._methods=s,e.defaults.perAction[n]=r}}},Mn=function(e){l(n,e);var t=h(n);function n(e,i,s,a,o,l){var c;if(r(this,n),te(d(c=t.call(this,o)),s),s!==i&&te(d(c),i),c.timeStamp=l,c.originalEvent=s,c.type=e,c.pointerId=oe(i),c.pointerType=fe(i),c.target=a,c.currentTarget=null,"tap"===e){var u=o.getPointerIndex(i);c.dt=c.timeStamp-o.pointers[u].downTime;var h=c.timeStamp-o.tapTime;c.double=!!o.prevTap&&"doubletap"!==o.prevTap.type&&o.prevTap.target===c.target&&h<500}else"doubletap"===e&&(c.dt=i.timeStamp-o.tapTime,c.double=!0);return c}return a(n,[{key:"_subtractOrigin",value:function(e){var t=e.x,n=e.y;return this.pageX-=t,this.pageY-=n,this.clientX-=t,this.clientY-=n,this}},{key:"_addOrigin",value:function(e){var t=e.x,n=e.y;return this.pageX+=t,this.pageY+=n,this.clientX+=t,this.clientY+=n,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),n}(ge),Fn={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(e){e.pointerEvents=Fn,e.defaults.actions.pointerEvents=Fn.defaults,H(e.actions.phaselessTypes,Fn.types)},listeners:{"interactions:new":function(e){var t=e.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(e){var t=e.down,n=e.pointerInfo;!t&&n.hold||(n.hold={duration:1/0,timeout:null})},"interactions:move":function(e,t){var n=e.interaction,i=e.pointer,r=e.event,s=e.eventTarget;e.duplicate||n.pointerIsDown&&!n.pointerWasMoved||(n.pointerIsDown&&zn(e),$n({interaction:n,pointer:i,event:r,eventTarget:s,type:"move"},t))},"interactions:down":function(e,t){!function(e,t){for(var n=e.interaction,i=e.pointer,r=e.event,s=e.eventTarget,a=e.pointerIndex,o=n.pointers[a].hold,l=G(s),c={interaction:n,pointer:i,event:r,eventTarget:s,type:"hold",targets:[],path:l,node:null},u=0;u<l.length;u++){var d=l[u];c.node=d,t.fire("pointerEvents:collect-targets",c)}if(c.targets.length){for(var h=1/0,p=0,f=c.targets;p<f.length;p++){var m=f[p].eventable.options.holdDuration;m<h&&(h=m)}o.duration=h,o.timeout=setTimeout(function(){$n({interaction:n,eventTarget:s,pointer:i,event:r,type:"hold"},t)},h)}}(e,t),$n(e,t)},"interactions:up":function(e,t){var n,i,r,s,a,o;zn(e),$n(e,t),i=t,r=(n=e).interaction,s=n.pointer,a=n.event,o=n.eventTarget,r.pointerWasMoved||$n({interaction:r,eventTarget:o,pointer:s,event:a,type:"tap"},i)},"interactions:cancel":function(e,t){zn(e),$n(e,t)}},PointerEvent:Mn,fire:$n,collectEventTargets:Bn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function $n(e,t){var n=e.interaction,i=e.pointer,r=e.event,s=e.eventTarget,a=e.type,o=e.targets,l=void 0===o?Bn(e,t):o,c=new Mn(a,i,r,s,n,t.now());t.fire("pointerEvents:new",{pointerEvent:c});for(var u={interaction:n,pointer:i,event:r,eventTarget:s,targets:l,type:a,pointerEvent:c},d=0;d<l.length;d++){var h=l[d];for(var p in h.props||{})c[p]=h.props[p];var f=Y(h.eventable,h.node);if(c._subtractOrigin(f),c.eventable=h.eventable,c.currentTarget=h.node,h.eventable.fire(c),c._addOrigin(f),c.immediatePropagationStopped||c.propagationStopped&&d+1<l.length&&l[d+1].node!==c.currentTarget)break}if(t.fire("pointerEvents:fired",u),"tap"===a){var m=c.double?$n({interaction:n,pointer:i,event:r,eventTarget:s,type:"doubletap"},t):c;n.prevTap=m,n.tapTime=m.timeStamp}return c}function Bn(e,t){var n=e.interaction,i=e.pointer,r=e.event,s=e.eventTarget,a=e.type,o=n.getPointerIndex(i),l=n.pointers[o];if("tap"===a&&(n.pointerWasMoved||!l||l.downTarget!==s))return[];for(var c=G(s),u={interaction:n,pointer:i,event:r,eventTarget:s,type:a,path:c,targets:[],node:null},d=0;d<c.length;d++){var h=c[d];u.node=h,t.fire("pointerEvents:collect-targets",u)}return"hold"===a&&(u.targets=u.targets.filter(function(e){var t,i;return e.eventable.options.holdDuration===(null==(t=n.pointers[o])||null==(i=t.hold)?void 0:i.duration)})),u.targets}function zn(e){var t=e.interaction,n=e.pointerIndex,i=t.pointers[n].hold;i&&i.timeout&&(clearTimeout(i.timeout),i.timeout=null)}var Un=Object.freeze({__proto__:null,default:Fn});function Gn(e){var t=e.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var Vn={id:"pointer-events/holdRepeat",install:function(e){e.usePlugin(Fn);var t=e.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=e.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce(function(e,t){return e["pointerEvents:".concat(t)]=Gn,e},{"pointerEvents:new":function(e){var t=e.pointerEvent;"hold"===t.type&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(e,t){var n=e.interaction,i=e.pointerEvent,r=e.eventTarget,s=e.targets;if("hold"===i.type&&s.length){var a=s[0].eventable.options.holdRepeatInterval;a<=0||(n.holdIntervalHandle=setTimeout(function(){t.pointerEvents.fire({interaction:n,eventTarget:r,type:"hold",pointer:i,event:i},t)},a))}}})},Hn={id:"pointer-events/interactableTargets",install:function(e){var t=e.Interactable;t.prototype.pointerEvents=function(e){return H(this.events.options,e),this};var n=t.prototype._backCompatOption;t.prototype._backCompatOption=function(e,t){var i=n.call(this,e,t);return i===this&&(this.events.options[e]=t),i}},listeners:{"pointerEvents:collect-targets":function(e,t){var n=e.targets,i=e.node,r=e.type,s=e.eventTarget;t.interactables.forEachMatch(i,function(e){var t=e.events,a=t.options;t.types[r]&&t.types[r].length&&e.testIgnoreAllow(a,i,s)&&n.push({node:i,eventable:t,props:{interactable:e}})})},"interactable:new":function(e){var t=e.interactable;t.events.getRect=function(e){return t.getRect(e)}},"interactable:set":function(e,t){var n=e.interactable,i=e.options;H(n.events.options,t.pointerEvents.defaults),H(n.events.options,i.pointerEvents||{})}}},Wn={id:"pointer-events",install:function(e){e.usePlugin(Un),e.usePlugin(Vn),e.usePlugin(Hn)}},jn={id:"reflow",install:function(e){var t=e.Interactable;e.actions.phases.reflow=!0,t.prototype.reflow=function(t){return function(e,t,n){for(var i=e.getAllElements(),r=n.window.Promise,s=r?[]:null,a=function(){var a=i[o],l=e.getRect(a);if(!l)return 1;var c,u=Te(n.interactions.list,function(n){return n.interacting()&&n.interactable===e&&n.element===a&&n.prepared.name===t.name});if(u)u.move(),s&&(c=u._reflowPromise||new r(function(e){u._reflowResolve=e}));else{var d=X(l),h={coords:{page:{x:d.x,y:d.y},client:{x:d.x,y:d.y},timeStamp:n.now()},get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}};c=function(e,t,n,i,r){var s=e.interactions.new({pointerType:"reflow"}),a={interaction:s,event:r,pointer:r,eventTarget:n,phase:"reflow"};s.interactable=t,s.element=n,s.prevEvent=r,s.updatePointer(r,r,n,!0),ie(s.coords.delta),qe(s.prepared,i),s._doPhase(a);var o=e.window.Promise,l=o?new o(function(e){s._reflowResolve=e}):void 0;return s._reflowPromise=l,s.start(i,t,n),s._interacting?(s.move(a),s.end(r)):(s.stop(),s._reflowResolve()),s.removePointer(r,r),l}(n,e,a,t,h)}s&&s.push(c)},o=0;o<i.length&&!a();o++);return s&&r.all(s).then(function(){return e})}(this,t,e)}},listeners:{"interactions:stop":function(e,t){var n,i,r=e.interaction;"reflow"===r.pointerType&&(r._reflowResolve&&r._reflowResolve(),n=t.interactions.list,i=r,n.splice(n.indexOf(i),1))}}};if(an.use(ht),an.use(Pt),an.use(Wn),an.use(Ft),an.use(Ln),an.use(ct),an.use(Be),an.use(We),an.use(jn),an.default=an,"object"===i(e)&&e)try{e.exports=an}catch(_t){}return an.default=an,an}()}(W5);const j5=W5.exports;function q5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function X5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q5(Object(n),!0).forEach(function(t){Q5(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q5(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function K5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y5(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z5(e,t,n){return t&&Y5(e.prototype,t),n&&Y5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Q5(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J5(e){return(J5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function e8(e,t){return(e8=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function t8(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function n8(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r6){return!1}}();return function(){var n,i=J5(e);if(t){var r=J5(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return t8(this,n)}}function i8(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(s6){o=!0,r=s6}finally{try{a||null==n.return||n.return()}finally{if(o)throw r}}return s}(e,t)||s8(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r8(e){return function(e){if(Array.isArray(e))return a8(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s8(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s8(e,t){if(e){if("string"==typeof e)return a8(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a8(e,t):void 0}}function a8(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var o8,l8,c8=function(){function e(t){K5(this,e),this.events={},this.events=t.handlers}return Z5(e,[{key:"on",value:function(e,t){var n=this;return(e instanceof Array?e:e.split(" ")).forEach(function(e){if(!n.events[e])throw new Error("The event ".concat(e," does not exist"));n.events[e].push(t)}),this}},{key:"trigger",value:function(e,t){if(!(e in this.events))throw new Error("The event ".concat(String(e)," cannot be triggered"));return this.events[e].reduce(function(e,n){return!1!==n(t)&&e},!0)}},{key:"bind",value:function(e){if(this.events[e])throw new Error("The event ".concat(e," is already bound"));this.events[e]=[]}},{key:"exist",value:function(e){return Array.isArray(this.events[e])}},{key:"off",value:function(e,t){if(this.events[e]){var n=this.events[e];if(t){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}else this.events[e]=[]}}},{key:"offAll",value:function(){this.events=Object.fromEntries(Object.keys(this.events).map(function(e){return[e,[]]}))}}]),e}(),u8=Z5(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K5(this,e),this.handlers={},this.handlers=X5({beforeSetTime:[],afterSetTime:[],setTimeByTick:[],beforeSetPlayRate:[],afterSetPlayRate:[],setActiveActionIds:[],play:[],paused:[],ended:[]},t)}),d8=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e8(e,t)}(t,c8);var e=n8(t);function t(){var n;return K5(this,t),(n=e.call(this,new u8))._timerId=void 0,n._playRate=1,n._currentTime=0,n._playState="paused",n._prev=void 0,n._effectMap={},n._actionMap={},n._actionSortIds=[],n._next=0,n._activeActionIds=[],n}return Z5(t,[{key:"isPlaying",get:function(){return"playing"===this._playState}},{key:"isPaused",get:function(){return"paused"===this._playState}},{key:"effects",set:function(e){this._effectMap=e}},{key:"data",set:function(e){this.isPlaying&&this.pause(),this._dealData(e),this._dealClear(),this._dealEnter(this._currentTime)}},{key:"setPlayRate",value:function(e){if(!(e<=0))return!!this.trigger("beforeSetPlayRate",{rate:e,engine:this})&&(this._playRate=e,this.trigger("afterSetPlayRate",{rate:e,engine:this}),!0);console.error("Error: rate cannot be less than 0!")}},{key:"getPlayRate",value:function(){return this._playRate}},{key:"reRender",value:function(){this.isPlaying||this._tickAction(this._currentTime)}},{key:"setTime",value:function(e,t){return!(!t&&!this.trigger("beforeSetTime",{time:e,engine:this}))&&(this._currentTime=e,this._next=0,this._dealLeave(e),this._dealEnter(e),t?this.trigger("setTimeByTick",{time:e,engine:this}):this.trigger("afterSetTime",{time:e,engine:this}),!0)}},{key:"getTime",value:function(){return this._currentTime}},{key:"play",value:function(e){var t=this,n=e.toTime,i=e.autoEnd,r=this.getTime();return!(this.isPlaying||n&&n<=r)&&(this._playState="playing",this._startOrStop("start"),this.trigger("play",{engine:this}),this._timerId=requestAnimationFrame(function(e){t._prev=e,t._tick({now:e,autoEnd:i,to:n})}),!0)}},{key:"pause",value:function(){this.isPlaying&&(this._playState="paused",this._startOrStop("stop"),this.trigger("paused",{engine:this})),cancelAnimationFrame(this._timerId)}},{key:"_end",value:function(){this.pause(),this.trigger("ended",{engine:this})}},{key:"_startOrStop",value:function(e){for(var t=0;t<this._activeActionIds.length;t++){var n,i=this._activeActionIds[t],r=this._actionMap[i],s=this._effectMap[null==r?void 0:r.effectId];if("start"===e)(null==s||null===(n=s.source)||void 0===n?void 0:n.start)&&s.source.start({action:r,effect:s,engine:this,isPlaying:this.isPlaying,time:this.getTime()});else if("stop"===e){var a;(null==s||null===(a=s.source)||void 0===a?void 0:a.stop)&&s.source.stop({action:r,effect:s,engine:this,isPlaying:this.isPlaying,time:this.getTime()})}}}},{key:"_tick",value:function(e){var t=this;if(!this.isPaused){var n=e.now,i=e.autoEnd,r=e.to,s=this.getTime()+Math.min(1e3,n-this._prev)/1e3*this._playRate;this._prev=n,r&&r<=s&&(s=r),this.setTime(s,!0),this._tickAction(s),!r&&i&&this._next>=this._actionSortIds.length&&0===this._activeActionIds.length?this._end():(r&&r<=s&&this._end(),this.isPaused||(this._timerId=requestAnimationFrame(function(e){t._tick({now:e,autoEnd:i,to:r})})))}}},{key:"_tickAction",value:function(e){this._dealEnter(e),this._dealLeave(e);for(var t=this._activeActionIds.length,n=0;n<t;n++){var i,r=this._activeActionIds[n],s=this._actionMap[r],a=this._effectMap[s.effectId];a&&(null===(i=a.source)||void 0===i?void 0:i.update)&&a.source.update({time:e,action:s,isPlaying:this.isPlaying,effect:a,engine:this})}}},{key:"_dealClear",value:function(){for(;this._activeActionIds.length;){var e,t=this._activeActionIds.shift(),n=this._actionMap[t],i=this._effectMap[null==n?void 0:n.effectId];(null==i||null===(e=i.source)||void 0===e?void 0:e.leave)&&i.source.leave({action:n,effect:i,engine:this,isPlaying:this.isPlaying,time:this.getTime()})}this._next=0}},{key:"_dealEnter",value:function(e){for(;this._actionSortIds[this._next];){var t=this._actionSortIds[this._next],n=this._actionMap[t];if(!n.disable){if(n.start>e)break;if(n.end>e&&!this._activeActionIds.includes(t)){var i,r=this._effectMap[n.effectId];r&&(null===(i=r.source)||void 0===i?void 0:i.enter)&&r.source.enter({action:n,effect:r,isPlaying:this.isPlaying,time:e,engine:this}),this._activeActionIds.push(t)}}this._next++}}},{key:"_dealLeave",value:function(e){for(var t=0;this._activeActionIds[t];){var n=this._activeActionIds[t],i=this._actionMap[n];if(i.start>e||i.end<e){var r,s=this._effectMap[i.effectId];s&&(null===(r=s.source)||void 0===r?void 0:r.leave)&&s.source.leave({action:i,effect:s,isPlaying:this.isPlaying,time:e,engine:this}),this._activeActionIds.splice(t,1)}else t++}}},{key:"_dealData",value:function(e){var t=[];e.map(function(e){t.push.apply(t,r8(e.actions))});var n=t.sort(function(e,t){return e.start-t.start}),i={},r=[];n.forEach(function(e){r.push(e.id),i[e.id]=X5({},e)}),this._actionMap=i,this._actionSortIds=r}}]),t}(),h8="timeline-editor";(l8=o8||(o8={}))[l8.VERBOSE=0]="VERBOSE",l8[l8.LOG=1]="LOG",l8[l8.INFO=2]="INFO",l8[l8.WARN=3]="WARN",l8[l8.ERROR=4]="ERROR",l8[l8.FATAL=5]="FATAL",l8[l8.SILENT=1/0]="SILENT";var p8={VERBOSE:o8.VERBOSE,LOG:o8.LOG,INFO:o8.INFO,WARN:o8.WARN,ERROR:o8.ERROR,SILENT:o8.SILENT};function f8(e,t){return"color:".concat(e,";font-size:").concat(t,"px;")}var m8=function(){function e(t){K5(this,e),this.Levels=p8,this.level=o8.LOG,this.prefix="",this.enabled=!0,this.debugColor=f8("#cccccc",12),this.logColor=f8("#bbbbbb",12),this.infoColor=f8("#2196f3",12),this.warnColor=f8("#ff00ff",12),this.errorColor=f8("#e91e63",12),this.fatalColor=f8("#9a0101",13),this.setPrefix(t),this.level=e.level,e.instances.push(this)}return Z5(e,[{key:"setPrefix",value:function(e){this.prefix=e}},{key:"enable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.level;this.level=e,this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"setLevel",value:function(e){this.level=e}},{key:"trace",value:function(t){if(this.enabled&&!(this.level>o8.VERBOSE)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).trace.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).trace.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.debugColor].concat(i))}}},{key:"debug",value:function(t){if(this.enabled&&!(this.level>o8.VERBOSE)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).debug.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).debug.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.debugColor].concat(i))}}},{key:"log",value:function(t){if(this.enabled&&!(this.level>o8.LOG)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).log.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).log.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.logColor].concat(i))}}},{key:"info",value:function(t){if(this.enabled&&!(this.level>o8.INFO)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).info.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).info.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.infoColor].concat(i))}}},{key:"warn",value:function(t){if(this.enabled&&!(this.level>o8.WARN)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).warn.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).warn.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.warnColor].concat(i))}}},{key:"error",value:function(t){if(this.enabled&&!(this.level>o8.ERROR)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).error.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).error.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.errorColor].concat(i))}}},{key:"fatal",value:function(t){if(this.enabled&&!(this.level>o8.FATAL)){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s,a;if(e.noColor)(s=console).error.apply(s,["[".concat(this.prefix,"] ").concat(t)].concat(i));else(a=console).error.apply(a,["%c[".concat(this.prefix,"] ").concat(t),this.fatalColor].concat(i))}}},{key:"group",value:function(){var e;console.group&&(e=console).group.apply(e,arguments)}},{key:"groupEnd",value:function(){console.groupEnd&&console.groupEnd()}},{key:"groupCollapsed",value:function(){var e;console.groupCollapsed&&(e=console).groupCollapsed.apply(e,arguments)}}],[{key:"setLevel",value:function(e){this.level=e,this.instances.forEach(function(t){return t.setLevel(e)})}},{key:"enable",value:function(e){e&&(this.level=e),this.instances.forEach(function(e){return e.enable()})}},{key:"disable",value:function(){this.instances.forEach(function(e){return e.disable()})}}]),e}();m8.instances=[],m8.level=o8.LOG,m8.Levels=p8,m8.noColor=!1;var g8=new m8("timeline");function b8(e,t){return t.startLeft+e/t.scale*t.scaleWidth}function y8(e,t){var n=t.startLeft,i=t.scale;return(e-n)/t.scaleWidth*i}function v8(e,t){var n=e.left,i=e.width;return{start:y8(n,t),end:y8(n+i,t)}}function T8(e,t){var n=e.start,i=e.end,r=b8(n,t);return{left:r,width:b8(i,t)-r}}function x8(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return H5.apply(void 0,["".concat(h8,"-")].concat(t))}var _8=function(e){var t=e.children,i=e.interactRef,r=e.draggable,s=e.resizable,a=e.draggableOptions,o=e.resizableOptions,l=n.exports.useRef(),c=n.exports.useRef(),u=n.exports.useRef(),d=n.exports.useRef();n.exports.useEffect(function(){u.current=X5({},a),d.current=X5({},o)},[a,o]),n.exports.useEffect(function(){c.current&&c.current.unset(),c.current=j5(l.current),i.current=c.current,h()},[r,s]);var h=function(){r&&c.current.draggable(X5(X5({},u.current),{},{onstart:function(e){return u.current.onstart&&u.current.onstart(e)},onmove:function(e){return u.current.onmove&&u.current.onmove(e)},onend:function(e){return u.current.onend&&u.current.onend(e)}})),s&&c.current.resizable(X5(X5({},d.current),{},{onstart:function(e){return d.current.onstart&&d.current.onstart(e)},onmove:function(e){return d.current.onmove&&d.current.onmove(e)},onend:function(e){return d.current.onend&&d.current.onend(e)}}))};return n.exports.cloneElement(t,{ref:l,draggable:!1})},S8=i.forwardRef(function(e,t){var r,s,a,l,c,u=e.children,d=e.edges,h=e.left,p=e.width,f=e.start,m=void 0===f?20:f,g=e.grid,b=void 0===g?1:g,y=e.bounds,v=void 0===y?{left:Number.MIN_SAFE_INTEGER,right:Number.MAX_SAFE_INTEGER}:y,T=e.enableResizing,x=void 0===T||T,_=e.enableDragging,S=void 0===_||_,w=e.adsorptionDistance,I=void 0===w?8:w,k=e.adsorptionPositions,C=void 0===k?[]:k,E=e.onResizeStart,A=e.onResize,R=e.onResizeEnd,N=e.onDragStart,P=e.onDragEnd,D=e.onDrag,O=e.parentRef,L=e.deltaScrollLeft,M=n.exports.useRef(),F=n.exports.useRef(0),$=n.exports.useRef(!1),B=(r=O,s=n.exports.useRef(Number.MIN_SAFE_INTEGER),a=n.exports.useRef(Number.MAX_SAFE_INTEGER),l=n.exports.useRef(1),c=n.exports.useRef(),{initAutoScroll:function(){if(null==r?void 0:r.current){var e=r.current.getBoundingClientRect(),t=e.left,n=e.width;s.current=t,a.current=t+n}},dealDragAutoScroll:function(e,t){if(e.clientX>=a.current||e.clientX<=s.current){cancelAnimationFrame(c.current);var n=Math.abs(e.clientX>=a.current?e.clientX-a.current:e.clientX-s.current);l.current=Math.min(1*Number((n/10).toFixed(0)),3);var i=(e.clientX>=a.current?1:-1)*l.current;return c.current=requestAnimationFrame(function e(){t&&t(i),c.current=requestAnimationFrame(e)}),!1}return cancelAnimationFrame(c.current),!0},dealResizeAutoScroll:function(e,t,n){if(e.clientX>=a.current||e.clientX<s.current){cancelAnimationFrame(c.current);var i=Math.abs(e.clientX>=a.current?e.clientX-a.current:e.clientX-s.current);l.current=Math.min(1*Number((i/10).toFixed(0)),3);var r=(e.clientX>=a.current?1:-1)*l.current;return c.current=requestAnimationFrame(function e(){n&&n(r),c.current=requestAnimationFrame(e)}),!1}return cancelAnimationFrame(c.current),!0},stopAutoScroll:function(){s.current=Number.MIN_SAFE_INTEGER,a.current=Number.MAX_SAFE_INTEGER,l.current=1,cancelAnimationFrame(c.current)}}),z=B.initAutoScroll,U=B.dealDragAutoScroll,G=B.dealResizeAutoScroll,V=B.stopAutoScroll;n.exports.useEffect(function(){return function(){M.current&&M.current.unset()}},[]),n.exports.useImperativeHandle(t,function(){return{updateLeft:function(e){return H(e||0,!1)},updateWidth:function(e){return W(e,!1)},getLeft:j,getWidth:q}}),n.exports.useEffect(function(){var e=M.current.target;W(void 0===p?e.offsetWidth:p,!1)},[p]),n.exports.useEffect(function(){H(h||0,!1)},[h]);var H=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(M.current&&M.current.target){t&&(F.current=0);var n=M.current.target;n.style.left="".concat(e,"px"),Object.assign(n.dataset,{left:e})}},W=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(M.current&&M.current.target){t&&(F.current=0);var n=M.current.target;n.style.width="".concat(e,"px"),Object.assign(n.dataset,{width:e})}},j=function(){var e,t=M.current.target;return parseFloat((null==t||null===(e=t.dataset)||void 0===e?void 0:e.left)||"0")},q=function(){var e,t=M.current.target;return parseFloat((null==t||null===(e=t.dataset)||void 0===e?void 0:e.width)||"0")},X=function(e){var t=e.preLeft,n=e.preWidth,i=e.scrollDelta,r=$.current?I:b;if(Math.abs(F.current)>=r){var s=t+parseInt(F.current/r+"")*r,a=s,o=Number.MAX_SAFE_INTEGER;if(C.forEach(function(e){var t=Math.abs(e-s);t<I&&t<o&&(a=e);var i=Math.abs(e-(s+n));i<I&&i<o&&(a=e-n)}),a!==s?($.current=!0,s=a):((s-m)%b!==0&&(s=m+b*Math.round((s-m)/b)),$.current=!1),F.current=F.current%r,s<v.left?s=v.left:s+n>v.right&&(s=v.right-n),D)if(!1===D({lastLeft:t,left:s,lastWidth:n,width:n},i))return;H(s,!1)}},K=function(e){var t=e.dir,n=e.preWidth,i=e.preLeft,r=$.current?I:b;if("left"===t){if(Math.abs(F.current)>=r){var s=parseInt(F.current/r+""),a=i+s*r,o=a,l=Number.MAX_SAFE_INTEGER;C.forEach(function(e){var t=Math.abs(e-a);t<I&&t<l&&(o=e)}),o!==a?($.current=!0,a=o):((a-m)%b!==0&&(a=m+b*Math.round((a-m)/b)),$.current=!1),F.current=F.current%r;var c=i+n;a<v.left&&(a=v.left);var u=c-a;if(A)if(!1===A("left",{lastLeft:i,lastWidth:n,left:a,width:u}))return;H(a,!1),W(u,!1)}}else if("right"===t&&Math.abs(F.current)>=r){var d=n+parseInt(F.current/b+"")*b,h=i+d,p=Number.MAX_SAFE_INTEGER;if(C.forEach(function(e){var t=Math.abs(e-(i+d));t<I&&t<p&&(h=e)}),h!==i+d)$.current=!0,d=h-i;else{var f=i+d;(f-m)%b!==0&&(f=m+b*Math.round((f-m)/b),d=f-i),$.current=!1}if(F.current=F.current%r,i+d>v.right&&(d=v.right-i),A)if(!1===A("right",{lastLeft:i,lastWidth:n,left:i,width:d}))return;W(d,!1)}};return o(_8,{interactRef:M,draggable:S,resizable:x,draggableOptions:{lockAxis:"x",onmove:function(e){var t=e.target;if(L&&(null==O?void 0:O.current)&&!U(e,function(e){L(e);var n=t.dataset,i=n.left,r=n.width,s=parseFloat(i),a=parseFloat(r);F.current+=e,X({preLeft:s,preWidth:a,scrollDelta:e})}))return;var n=t.dataset,i=n.left,r=n.width,s=parseFloat(i),a=parseFloat(r);F.current+=e.dx,X({preLeft:s,preWidth:a})},onstart:function(e){F.current=0,$.current=!1,z(),N&&N()},onend:function(e){F.current=0,$.current=!1,V();var t=e.target.dataset,n=t.left,i=t.width;P&&P({left:parseFloat(n),width:parseFloat(i)})},cursorChecker:function(){return null}},resizableOptions:{axis:"x",invert:"none",edges:X5({left:!0,right:!0,top:!1,bottom:!1},d||{}),onmove:function(e){var t,n=e.target,i=(null===(t=e.edges)||void 0===t?void 0:t.left)?"left":"right";if(L&&(null==O?void 0:O.current)&&!G(e,i,function(e){L(e);var t=n.dataset,r=t.left,s=t.width,a=parseFloat(r),o=parseFloat(s);F.current+=e,K({preLeft:a,preWidth:o,dir:i})}))return;var r=n.dataset,s=r.left,a=r.width,o=parseFloat(s),l=parseFloat(a);F.current+="left"===i?e.deltaRect.left:e.deltaRect.right,K({preLeft:o,preWidth:l,dir:i})},onstart:function(e){var t;F.current=0,$.current=!1,z();var n=(null===(t=e.edges)||void 0===t?void 0:t.right)?"right":"left";E&&E(n)},onend:function(e){var t;F.current=0,$.current=!1,V();var n=e.target.dataset,i=n.left,r=n.width,s=(null===(t=e.edges)||void 0===t?void 0:t.right)?"right":"left";R&&R(s,{left:parseFloat(i),width:parseFloat(r)})}},children:i.cloneElement(u,{style:X5(X5({},u.props.style||{}),{},{left:h,width:p})})})});function w8(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}w8(".timeline-editor-cursor {\n  cursor: ew-resize;\n  position: absolute;\n  top: 32px;\n  height: calc(100% - 32px);\n  box-sizing: border-box;\n  border-left: 1px solid #5297FF;\n  border-right: 1px solid #5297FF;\n  transform: translateX(-25%) scaleX(0.5);\n}\n.timeline-editor-cursor-top {\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translate(-50%, 0) scaleX(2);\n  margin: auto;\n}\n.timeline-editor-cursor-area {\n  width: 16px;\n  height: 100%;\n  cursor: ew-resize;\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n}\n");var I8=function(e){var t=e.disableDrag,i=e.cursorTime,r=e.setCursor,s=e.startLeft,a=e.timelineWidth,l=e.scaleWidth,c=e.scale,d=e.scrollLeft,h=e.scrollSync,p=e.areaRef,f=e.maxScaleCount,m=e.deltaScrollLeft,g=e.onCursorDragStart,b=e.onCursorDrag,y=e.onCursorDragEnd,v=n.exports.useRef(),T=n.exports.useRef();return n.exports.useEffect(function(){void 0===T.current&&v.current.updateLeft(b8(i,{startLeft:s,scaleWidth:l,scale:c})-d)},[i,s,l,c,d]),o(S8,{start:s,ref:v,parentRef:p,bounds:{left:0,right:Math.min(a,f*l+s-d)},deltaScrollLeft:m,enableDragging:!t,enableResizing:!1,onDragStart:function(){g&&g(i),T.current=b8(i,{startLeft:s,scaleWidth:l,scale:c})-d,v.current.updateLeft(T.current)},onDragEnd:function(){var e=y8(T.current+d,{startLeft:s,scale:c,scaleWidth:l});r({time:e}),y&&y(e),T.current=void 0},onDrag:function(e){var t=e.left,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=h.current.state.scrollLeft;n&&0!==i?T.current<s-i-n&&(T.current=s-i-n):T.current=t<s-i?s-i:t,v.current.updateLeft(T.current);var a=y8(T.current+i,{startLeft:s,scale:c,scaleWidth:l});return r({time:a}),b&&b(a),!1},children:u("div",{className:x8("cursor"),children:[o("svg",{className:x8("cursor-top"),width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",children:o("path",{d:"M0 1C0 0.447715 0.447715 0 1 0H7C7.55228 0 8 0.447715 8 1V9.38197C8 9.76074 7.786 10.107 7.44721 10.2764L4.44721 11.7764C4.16569 11.9172 3.83431 11.9172 3.55279 11.7764L0.552786 10.2764C0.214002 10.107 0 9.76074 0 9.38197V1Z",fill:"#5297FF"})}),o("div",{className:x8("cursor-area")})]})})};w8(".timeline-editor-drag-line-container {\n  position: absolute;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n.timeline-editor-drag-line {\n  width: 0;\n  position: absolute;\n  top: 0;\n  height: 99%;\n  border-left: 1px dashed rgba(82, 151, 255, 0.6);\n}\n");var k8=function(e){var t=e.isMoving,n=e.movePositions,i=void 0===n?[]:n,r=e.assistPositions,s=void 0===r?[]:r,a=e.scrollLeft;return o("div",{className:x8("drag-line-container"),children:t&&i.filter(function(e){return s.includes(e)}).map(function(e,t){return o("div",{className:x8("drag-line"),style:{left:e-a}},t)})})};w8(".timeline-editor:hover .timeline-editor-edit-area .ReactVirtualized__Grid::-webkit-scrollbar {\n  height: 4px;\n}\n.timeline-editor-edit-area {\n  flex: 1 1 auto;\n  margin-top: 10px;\n  overflow: hidden;\n  position: relative;\n}\n.timeline-editor-edit-area .ReactVirtualized__Grid {\n  outline: none !important;\n  overflow: overlay !important;\n}\n.timeline-editor-edit-area .ReactVirtualized__Grid::-webkit-scrollbar {\n  width: 0;\n  height: 0;\n}\n.timeline-editor-edit-area .ReactVirtualized__Grid::-webkit-scrollbar-track {\n  background-color: transparent !important;\n}\n.timeline-editor-edit-area .ReactVirtualized__Grid::-webkit-scrollbar-thumb {\n  background: #313132;\n  border-radius: 16px;\n}\n");w8('.timeline-editor-action {\n  position: absolute;\n  left: 0;\n  top: 0;\n  background-color: #2f3134;\n}\n.timeline-editor-action .timeline-editor-action-left-stretch,\n.timeline-editor-action .timeline-editor-action-right-stretch {\n  position: absolute;\n  top: 0;\n  width: 10px;\n  border-radius: 4px;\n  height: 100%;\n  overflow: hidden;\n}\n.timeline-editor-action .timeline-editor-action-left-stretch::after,\n.timeline-editor-action .timeline-editor-action-right-stretch::after {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  border-radius: 4px;\n  border-top: 28px solid transparent;\n  border-bottom: 28px solid transparent;\n}\n.timeline-editor-action .timeline-editor-action-left-stretch {\n  left: 0;\n}\n.timeline-editor-action .timeline-editor-action-left-stretch::after {\n  left: 0;\n  content: "";\n  border-left: 7px solid rgba(255, 255, 255, 0.1);\n  border-right: 7px solid transparent;\n}\n.timeline-editor-action .timeline-editor-action-right-stretch {\n  right: 0;\n}\n.timeline-editor-action .timeline-editor-action-right-stretch::after {\n  right: 0;\n  content: "";\n  border-right: 7px solid rgba(255, 255, 255, 0.1);\n  border-left: 7px solid transparent;\n}\n');var C8=function(e){var t=e.editorData,i=e.row,r=e.action,s=e.effects,a=e.rowHeight,l=e.scale,c=e.scaleWidth,d=e.scaleSplitCount,h=e.startLeft,p=e.gridSnap,f=e.disableDrag,m=e.scaleCount,g=e.maxScaleCount,b=e.setScaleCount,y=e.onActionMoveStart,v=e.onActionMoving,T=e.onActionMoveEnd,x=e.onActionResizeStart,_=e.onActionResizeEnd,S=e.onActionResizing,w=e.dragLineData,I=e.setEditorData,k=e.onClickAction,C=e.onClickActionOnly,E=e.onDoubleClickAction,A=e.onContextMenuAction,R=e.getActionRender,N=e.handleTime,P=e.areaRef,D=e.deltaScrollLeft,O=n.exports.useRef(),L=n.exports.useRef(!1),M=r.id,F=r.maxEnd,$=r.minStart,B=r.end,z=r.start,U=r.selected,G=r.flexible,V=void 0===G||G,H=r.movable,W=void 0===H||H,j=r.effectId,q=b8($||0,{startLeft:h,scale:l,scaleWidth:c}),X=Math.min(g*c+h,b8(F||Number.MAX_VALUE,{startLeft:h,scale:l,scaleWidth:c})),K=i8(n.exports.useState(function(){return T8({start:z,end:B},{startLeft:h,scale:l,scaleWidth:c})}),2),Y=K[0],Z=K[1];n.exports.useLayoutEffect(function(){Z(T8({start:z,end:B},{startLeft:h,scale:l,scaleWidth:c}))},[B,z,h,c,l]);var Q=c/d,J=["action"];W&&J.push("action-movable"),U&&J.push("action-selected"),V&&J.push("action-flexible"),s[j]&&J.push("action-effect-".concat(j));var ee=function(e,t){var n=function(e,t){var n=t.startLeft,i=t.scaleWidth,r=Math.ceil((e-n)/i);return Math.max(r+5,t.scaleCount)}(e+t,{startLeft:h,scaleCount:m,scaleWidth:c});n!==m&&b(n)},te=X5(X5({},r),v8({left:Y.left,width:Y.width},{startLeft:h,scaleWidth:c,scale:l})),ne=X5(X5({},i),{},{actions:r8(i.actions)});return i.actions.includes(r)&&(ne.actions[i.actions.indexOf(r)]=te),o(S8,{ref:O,parentRef:P,start:h,left:Y.left,width:Y.width,grid:p&&Q||1,adsorptionDistance:p?Math.max((Q||1)/2,8):8,adsorptionPositions:w.assistPositions,bounds:{left:q,right:X},edges:{left:!f&&V&&".".concat(x8("action-left-stretch")),right:!f&&V&&".".concat(x8("action-right-stretch"))},enableDragging:!f&&W,enableResizing:!f&&V,onDragStart:function(){y&&y({action:r,row:i})},onDrag:function(e){var t=e.left,n=e.width;if(L.current=!0,v){var s=v8({left:t,width:n},{scaleWidth:c,scale:l,startLeft:h}),a=s.start,o=s.end;if(!1===v({action:r,row:i,start:a,end:o}))return!1}Z({left:t,width:n}),ee(t,n)},onDragEnd:function(e){var n=v8({left:e.left,width:e.width},{scaleWidth:c,scale:l,startLeft:h}),r=n.start,s=n.end,a=t.find(function(e){return e.id===i.id}).actions.find(function(e){return e.id===M});a.start=r,a.end=s,I(t),T&&T({action:a,row:i,start:r,end:s})},onResizeStart:function(e){x&&x({action:r,row:i,dir:e})},onResize:function(e,t){var n=t.left,s=t.width;if(L.current=!0,S){var a=v8({left:n,width:s},{scaleWidth:c,scale:l,startLeft:h}),o=a.start,u=a.end;if(!1===S({action:r,row:i,start:o,end:u,dir:e}))return!1}Z({left:n,width:s}),ee(n,s)},onResizeEnd:function(e,n){var r=v8({left:n.left,width:n.width},{scaleWidth:c,scale:l,startLeft:h}),s=r.start,a=r.end,o=t.find(function(e){return e.id===i.id}).actions.find(function(e){return e.id===M});o.start=s,o.end=a,I(t),_&&_({action:o,row:i,start:s,end:a,dir:e})},deltaScrollLeft:D,children:u("div",{onMouseDown:function(){L.current=!1},onClick:function(e){var t;k&&(t=N(e),k(e,{row:i,action:r,time:t})),!L.current&&C&&(t||(t=N(e)),C(e,{row:i,action:r,time:t}))},onDoubleClick:function(e){if(E){var t=N(e);E(e,{row:i,action:r,time:t})}},onContextMenu:function(e){if(A){var t=N(e);A(e,{row:i,action:r,time:t})}},className:x8((J||[]).join(" ")),style:{height:a},children:[R&&R(te,ne),V&&o("div",{className:x8("action-left-stretch")}),V&&o("div",{className:x8("action-right-stretch")})]})})};w8(".timeline-editor-edit-row {\n  background-repeat: no-repeat, repeat;\n  background-image: linear-gradient(#191b1d, #191b1d), linear-gradient(90deg, rgba(255, 255, 255, 0.08) 1px, transparent 0);\n  display: flex;\n  flex-direction: row;\n  box-sizing: border-box;\n}\n");var E8=function(e){var t=e.rowData,n=e.style,i=void 0===n?{}:n,r=e.onClickRow,s=e.onDoubleClickRow,a=e.onContextMenuRow,l=e.areaRef,c=e.scrollLeft,u=e.startLeft,d=e.scale,h=e.scaleWidth,p=["edit-row"];(null==t?void 0:t.selected)&&p.push("edit-row-selected");var f=function(e){if(l.current){var t=l.current.getBoundingClientRect();return y8(e.clientX-t.x+c,{startLeft:u,scale:d,scaleWidth:h})}};return o("div",{className:"".concat(x8.apply(void 0,p)," ").concat(((null==t?void 0:t.classNames)||[]).join(" ")),style:i,onClick:function(e){if(t&&r){var n=f(e);r(e,{row:t,time:n})}},onDoubleClick:function(e){if(t&&s){var n=f(e);s(e,{row:t,time:n})}},onContextMenu:function(e){if(t&&a){var n=f(e);a(e,{row:t,time:n})}},children:((null==t?void 0:t.actions)||[]).map(function(n){return o(C8,{...X5(X5({key:n.id},e),{},{handleTime:f,row:t,action:n})})})})};function A8(){var e=i8(n.exports.useState({isMoving:!1,movePositions:[],assistPositions:[]}),2),t=e[0],i=e[1];return{initDragLine:function(e){var t=e.movePositions,n=e.assistPositions;i({isMoving:!0,movePositions:t||[],assistPositions:n||[]})},updateDragLine:function(e){var t=e.movePositions,n=e.assistPositions;i(function(e){return X5(X5({},e),{},{movePositions:t||e.movePositions,assistPositions:n||e.assistPositions})})},disposeDragLine:function(){i({isMoving:!1,movePositions:[],assistPositions:[]})},dragLineData:t,defaultGetAssistPosition:function(e){var t=e.editorData,n=e.assistActionIds,i=e.action,r=e.row,s=e.scale,a=e.scaleWidth,o=e.startLeft,l=e.cursorLeft,c=e.hideCursor,u=[];n?t.forEach(function(e){e.actions.forEach(function(e){n.includes(e.id)&&u.push(e)})}):t.forEach(function(e){e.id!==r.id?u.push.apply(u,r8(e.actions)):e.actions.forEach(function(e){e.id!==i.id&&u.push(e)})});var d=function(e,t){var n=[];return e.forEach(function(e){n.push(b8(e.start,t)),n.push(b8(e.end,t))}),n}(u,{startLeft:o,scale:s,scaleWidth:a});return c||d.push(l),d},defaultGetMovePosition:function(e){var t=e.start,n=e.end,i=e.dir,r=e.scale,s=e.scaleWidth,a=T8({start:t,end:n},{startLeft:e.startLeft,scaleWidth:s,scale:r}),o=a.left,l=a.width;return i?"right"===i?[o+l]:[o]:[o,o+l]}}}var R8=i.forwardRef(function(e,t){var i=e.editorData,r=e.rowHeight,s=e.scaleWidth,a=e.scaleCount,l=e.startLeft,c=e.scrollLeft,d=e.scrollTop,h=e.scale,p=e.hideCursor,f=e.cursorTime,m=e.onScroll,g=e.dragLine,b=e.getAssistDragLineActionIds,y=e.onActionMoveEnd,v=e.onActionMoveStart,T=e.onActionMoving,x=e.onActionResizeEnd,_=e.onActionResizeStart,S=e.onActionResizing,w=A8(),I=w.dragLineData,k=w.initDragLine,C=w.updateDragLine,E=w.disposeDragLine,A=w.defaultGetAssistPosition,R=w.defaultGetMovePosition,N=n.exports.useRef(),P=n.exports.useRef(),D=n.exports.useRef(-1);n.exports.useImperativeHandle(t,function(){return{get domRef(){return N}}});var O=function(e){if(g){var t=b&&b({action:e.action,row:e.row,editorData:i}),n=b8(f,{scaleWidth:s,scale:h,startLeft:l}),r=A({editorData:i,assistActionIds:t,action:e.action,row:e.row,scale:h,scaleWidth:s,startLeft:l,hideCursor:p,cursorLeft:n});k({assistPositions:r})}},L=function(e){if(g){var t=R(X5(X5({},e),{},{startLeft:l,scaleWidth:s,scale:h}));C({movePositions:t})}},M=function(t){var n=t.rowIndex,a=t.key,c=t.style,u=i[n];return o(E8,{...X5(X5({},e),{},{style:X5(X5({},c),{},{backgroundPositionX:"0, ".concat(l,"px"),backgroundSize:"".concat(l,"px, ").concat(s,"px")}),areaRef:N,key:a,rowHeight:(null==u?void 0:u.rowHeight)||r,rowData:u,dragLineData:I,onActionMoveStart:function(e){return O(e),v&&v(e)},onActionResizeStart:function(e){return O(e),_&&_(e)},onActionMoving:function(e){return L(e),T&&T(e)},onActionResizing:function(e){return L(e),S&&S(e)},onActionResizeEnd:function(e){return E(),x&&x(e)},onActionMoveEnd:function(e){return E(),y&&y(e)}})})};return n.exports.useLayoutEffect(function(){var e;null===(e=P.current)||void 0===e||e.scrollToPosition({scrollTop:d,scrollLeft:c})},[d,c]),n.exports.useEffect(function(){P.current.recomputeGridSize()},[i]),u("div",{ref:N,className:x8("edit-area"),children:[o(V3,{children:function(e){var t=e.width,n=e.height,c=0,u=i.map(function(e){var t=e.rowHeight||r;return c+=t,t});return c<n&&(u.push(n-c),D.current!==n&&D.current>=0&&setTimeout(function(){var e;return null===(e=P.current)||void 0===e?void 0:e.recomputeGridSize({rowIndex:u.length-1})})),D.current=n,o(A4,{columnCount:1,rowCount:u.length,ref:P,cellRenderer:M,columnWidth:Math.max(a*s+l,t),width:t,height:n,rowHeight:function(e){var t=e.index;return u[t]||r},overscanRowCount:10,overscanColumnCount:0,onScroll:function(e){m(e)}})}}),g&&o(k8,{...X5({scrollLeft:c},I)})]})});w8('.timeline-editor {\n  height: 600px;\n  width: 600px;\n  min-height: 32px;\n  position: relative;\n  font-size: 12px;\n  font-family: "PingFang SC";\n  background-color: #191b1d;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n');w8(".timeline-editor-time-area {\n  position: relative;\n  height: 32px;\n  flex: 0 0 auto;\n}\n.timeline-editor-time-area .ReactVirtualized__Grid {\n  outline: none;\n}\n.timeline-editor-time-area .ReactVirtualized__Grid::-webkit-scrollbar {\n  display: none;\n}\n.timeline-editor-time-area-interact {\n  position: absolute;\n  cursor: pointer;\n  left: 0;\n  top: 0;\n}\n.timeline-editor-time-unit {\n  border-right: 1px solid rgba(255, 255, 255, 0.2);\n  position: relative;\n  box-sizing: content-box;\n  height: 4px !important;\n  bottom: 0 !important;\n  top: auto !important;\n}\n.timeline-editor-time-unit-big {\n  height: 8px !important;\n}\n.timeline-editor-time-unit-scale {\n  color: rgba(255, 255, 255, 0.6);\n  position: absolute;\n  right: 0;\n  top: 0;\n  transform: translate(50%, -100%);\n}\n");var N8=function(e){var t=e.setCursor,i=e.maxScaleCount,r=e.hideCursor,s=e.scale,a=e.scaleWidth,l=e.scaleCount,c=e.scaleSplitCount,h=e.startLeft,p=e.scrollLeft,f=e.onClickTimeArea,m=e.getScaleRender,g=n.exports.useRef(),b=c>0,y=function(e){var t=e.columnIndex,n=e.key,i=e.style,r=!b||t%c===0,a=["time-unit"];r&&a.push("time-unit-big");var l=(b?t/c:t)*s;return o("div",{style:i,className:x8.apply(void 0,a),children:r&&o("div",{className:x8("time-unit-scale"),children:m?m(l):l})},n)};n.exports.useEffect(function(){var e;null===(e=g.current)||void 0===e||e.recomputeGridSize()},[a,h]);var v=function(e){return 0===e.index?h:b?a/c:a};return o("div",{className:x8("time-area"),children:o(V3,{children:function(e){var n=e.width,m=e.height;return u(d,{children:[o(A4,{ref:g,columnCount:b?l*c+1:l,columnWidth:v,rowCount:1,rowHeight:m,width:n,height:m,overscanRowCount:0,overscanColumnCount:10,cellRenderer:y,scrollLeft:p}),o("div",{style:{width:n,height:m},onClick:function(e){if(!r){var n=e.currentTarget.getBoundingClientRect(),o=e.clientX-n.x,l=Math.max(o+p,h);if(!(l>i*a+h-p)){var c=y8(l,{startLeft:h,scale:s,scaleWidth:a});!1!==(f&&f(c,e))&&t({time:c})}}},className:x8("time-area-interact")})]})}})})},P8=i.forwardRef(function(e,t){var i=function(e){var t=e.editorData,n=void 0===t?[]:t,i=e.effects,r=void 0===i?{}:i,s=e.scrollTop,a=void 0===s?0:s,o=e.scale,l=void 0===o?1:o,c=e.scaleSplitCount,u=void 0===c?10:c,d=e.scaleWidth,h=void 0===d?160:d,p=e.startLeft,f=void 0===p?20:p,m=e.minScaleCount,g=void 0===m?20:m,b=e.maxScaleCount,y=void 0===b?1/0:b,v=e.rowHeight,T=void 0===v?32:v;l<=0&&(g8.error("Error: scale must be greater than 0!"),l=1),a<0&&(g8.warn("Warning: scrollTop cannot be less than 0!"),a=0),u<=0&&(g8.warn("Warning: scaleSplitCount cannot be less than 1!"),u=1),h<=0&&(g8.warn("Warning: scaleWidth must be greater than 0!"),h=160),f<0&&(g8.warn("Warning: startLeft cannot be less than 0!"),f=0),g<1&&(g8.warn("Warning: minScaleCount must be greater than 1!"),g=20),y<(g=parseInt(g+""))&&(g8.warn("Warning: maxScaleCount cannot be less than minScaleCount!"),y=g),y=y===1/0?1/0:parseInt(y+""),T<=0&&(g8.warn("Warning: rowHeight must be greater than 0!"),T=32);var x=X5({},e);return delete x.style,X5(X5({},x),{},{editorData:n,effects:r,scrollTop:a,scale:l,scaleSplitCount:u,scaleWidth:h,startLeft:f,minScaleCount:g,maxScaleCount:y,rowHeight:T})}(e),r=e.style,s=i.effects,a=i.editorData,l=i.scrollTop,c=i.autoScroll,h=i.hideCursor,p=i.disableDrag,f=i.scale,m=i.scaleWidth,g=i.startLeft,b=i.minScaleCount,y=i.maxScaleCount,v=i.onChange,T=i.engine,x=i.autoReRender,_=void 0===x||x,S=i.onScroll,w=n.exports.useRef(T||new d8),I=n.exports.useRef(),k=n.exports.useRef(),C=n.exports.useRef(),E=i8(n.exports.useState(a),2),A=E[0],R=E[1],N=i8(n.exports.useState(20),2),P=N[0],D=N[1],O=i8(n.exports.useState(0),2),L=O[0],M=O[1],F=i8(n.exports.useState(!1),2),$=F[0],B=F[1],z=i8(n.exports.useState(Number.MAX_SAFE_INTEGER),2),U=z[0],G=z[1];n.exports.useLayoutEffect(function(){V(function(e,t){var n=0;return e.forEach(function(e){e.actions.forEach(function(e){n=Math.max(n,e.end)})}),Math.ceil(n/t.scale)+5}(a,{scale:f})),R(a)},[a,b,y,f]),n.exports.useEffect(function(){w.current.effects=s},[s]),n.exports.useEffect(function(){w.current.data=A},[A]),n.exports.useEffect(function(){_&&w.current.reRender()},[A]),n.exports.useEffect(function(){C.current&&C.current.setState({scrollTop:l})},[l]);var V=function(e){var t=Math.min(y,Math.max(b,e));D(t)},H=function(e){!1!==v(e)&&(w.current.data=e,_&&w.current.reRender())},W=function(e){var t=e.left,n=e.time,i=e.updateTime,r=void 0===i||i;if(void 0!==t||void 0!==n){void 0===n&&(void 0===t&&(t=b8(n,{startLeft:g,scale:f,scaleWidth:m})),n=y8(t,{startLeft:g,scale:f,scaleWidth:m}));var s=!0;return r&&(s=w.current.setTime(n),_&&w.current.reRender()),s&&M(n),s}},j=function(e){C.current.state.scrollLeft+e>P*(m-1)+g-U||C.current&&C.current.setState({scrollLeft:Math.max(C.current.state.scrollLeft+e,0)})};return n.exports.useEffect(function(){w.current.on("setTimeByTick",function(e){var t=e.time;W({time:t,updateTime:!1})}),w.current.on("play",function(){return B(!0)}),w.current.on("paused",function(){return B(!1)})},[]),n.exports.useImperativeHandle(t,function(){return{get target(){return I.current},get listener(){return w.current},get isPlaying(){return w.current.isPlaying},get isPaused(){return w.current.isPaused},setPlayRate:w.current.setPlayRate.bind(w.current),getPlayRate:w.current.getPlayRate.bind(w.current),setTime:function(e){return W({time:e})},getTime:w.current.getTime.bind(w.current),reRender:w.current.reRender.bind(w.current),play:function(e){return w.current.play(X5({},e))},pause:w.current.pause.bind(w.current),setScrollLeft:function(e){C.current&&C.current.setState({scrollLeft:Math.max(e,0)})},setScrollTop:function(e){C.current&&C.current.setState({scrollTop:Math.max(e,0)})}}}),n.exports.useEffect(function(){if(k.current){var e=new ResizeObserver(function(){k.current&&G(k.current.getBoundingClientRect().width)});return e.observe(k.current),function(){e&&e.disconnect()}}},[]),o("div",{ref:I,style:r,className:"".concat(h8," ").concat(p?h8+"-disable":""),children:o(b5,{ref:C,children:function(e){var t=e.scrollLeft,n=e.scrollTop,r=e.onScroll;return u(d,{children:[o(N8,{...X5(X5({},i),{},{timelineWidth:U,disableDrag:p||$,setCursor:W,cursorTime:L,editorData:A,scaleCount:P,setScaleCount:V,onScroll:r,scrollLeft:t})}),o(R8,{...X5(X5({},i),{},{timelineWidth:U,ref:function(e){return k.current=null==e?void 0:e.domRef.current},disableDrag:p||$,editorData:A,cursorTime:L,scaleCount:P,setScaleCount:V,scrollTop:n,scrollLeft:t,setEditorData:H,deltaScrollLeft:c&&j,onScroll:function(e){r(e),S&&S(e)}})}),!h&&o(I8,{...X5(X5({},i),{},{timelineWidth:U,disableDrag:$,scrollLeft:t,scaleCount:P,setScaleCount:V,setCursor:W,cursorTime:L,editorData:A,areaRef:k,scrollSync:C,deltaScrollLeft:c&&j})})]})}})})});const D8=$e(e=>({activeContext:e.general.activeContext,imageData:e.labels.imagesData[e.labels.activeImageIndex],labelNames:e.labels.labels}))(({size:e,activeContext:t,currentTime:i,duration:r,isPlaying:s,frameRate:a,onTogglePlay:l,onStepFrame:c,onStepSeconds:d,onJumpToTime:h,imageData:p,labelNames:f})=>{const m=n.exports.useRef(null),g=n.exports.useRef(null);n.exports.useEffect(()=>{if(m.current){m.current.setTime(i);const e=g.current;if(e){const t=e.clientWidth;let n=0;i>5&&(n=20+i*60-t/2,n=Math.max(0,n)),m.current.setScrollLeft(n)}}},[i]);const b=(p.labelRects||[]).filter(e=>e.timestamp||"number"==typeof e.frame).map(e=>{let t,n;if(e.timestamp)t=MG.parseTimestamp(e.timestamp);else{if("number"!=typeof e.frame)return null;t=e.frame/a}const r=e.endTimestamp||"number"==typeof e.endFrame;return n=e.endTimestamp?MG.parseTimestamp(e.endTimestamp):"number"==typeof e.endFrame?e.endFrame/a:Math.max(i,t+.1),console.log("Timeline action created:",{id:e.id,start:t,end:n,behavior:e.behavior,timestamp:e.timestamp,frame:e.frame,endTimestamp:e.endTimestamp,endFrame:e.endFrame,isOngoing:!r}),{id:e.id,start:t,end:n,effectId:e.id}}).filter(e=>null!==e);console.log("Total timeline actions:",b.length),console.log("Timeline actions data:",b);const y=[{id:"rects",actions:b}],v=b.reduce((e,t)=>{const n=p.labelRects.find(e=>e.id===t.id),i=f.find(e=>e.id===(null==n?void 0:n.labelId));return e[t.effectId]={id:t.effectId,name:i?i.name+((null==n?void 0:n.behavior)?`: ${n.behavior}`:""):"",color:(null==i?void 0:i.color)||"#5297FF"},e},{});return console.log("Timeline data:",y),console.log("Timeline effects:",v),u("div",{className:C("EditorBottomNavigationBar",{"with-context":t===bn.EDITOR}),children:[o("div",{className:"TimelineWrapper",ref:g,style:{pointerEvents:"none"},children:o(P8,{disableDrag:!0,ref:m,rowHeight:20,editorData:y,effects:v,getActionRender:(e,t)=>{const n=p.labelRects.find(t=>t.id===e.id),i=f.find(e=>e.id===(null==n?void 0:n.labelId)),r=(null==i?void 0:i.color)||"#5297FF",s=(null==n?void 0:n.behavior)||(null==i?void 0:i.name)||"Behavior",a=!((null==n?void 0:n.endTimestamp)||"number"==typeof(null==n?void 0:n.endFrame));return u("div",{style:{backgroundColor:r,height:"100%",width:"100%",color:"white",fontSize:"12px",padding:"2px 4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",opacity:a?.8:1,border:a?"2px solid rgba(255,255,255,0.5)":"none",boxSizing:"border-box"},title:`${s} (${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s)${a?" - Ongoing":""}`,children:[s," ",a?"?":""]})},autoScroll:!0,scaleWidth:60,minScaleCount:Math.max(Math.ceil(r),10),maxScaleCount:Math.max(Math.ceil(r),10),getScaleRender:e=>MG.formatTime(e).split(".")[0]})}),u("div",{className:"VideoControls",children:[u("div",{className:"time-display",children:[MG.formatTime(i)," / ",MG.formatTime(r)]}),u("div",{className:"frame-display",children:[MG.calculateFrame(i,a)," / ",MG.calculateFrame(r,a)," frames"]})]})]})}),O8={width:30,height:30},L8=h(({className:e,...t})=>o(p,{...t,classes:{popper:e}}))(({theme:e})=>({[`& .${f.tooltip}`]:{backgroundColor:"#171717",color:"#ffffff",boxShadow:e.shadows[1],fontSize:12,maxWidth:200,textAlign:"center"}})),M8=(e,t,n,i,r,s,a)=>o(L8,{disableFocusListener:!0,title:t,TransitionComponent:m,TransitionProps:{timeout:600},placement:"bottom",children:o("div",{children:o(ki,{buttonSize:O8,padding:10,image:n,imageAlt:i,href:s,onClick:a,isActive:r})})},e),F8=$e(e=>({activeContext:e.general.activeContext,imageDragMode:e.general.imageDragMode,crossHairVisible:e.general.crossHairVisible,activeLabelType:e.labels.activeLabelType}),{updateImageDragModeStatusAction:xn,updateCrossHairVisibleStatusAction:_n})(({activeContext:e,updateImageDragModeStatusAction:t,updateCrossHairVisibleStatusAction:n,imageDragMode:i,crossHairVisible:r,activeLabelType:s})=>{const a=s===je.RECT&&pn.isAISSDObjectDetectorModelLoaded()||s===je.RECT&&pn.isAIYOLOObjectDetectorModelLoaded()||s===je.RECT&&pn.isRoboflowAPIModelLoaded()||s===je.POINT&&pn.isAIPoseDetectorModelLoaded();return u("div",{className:C("EditorTopNavigationBar",{"with-context":e===bn.EDITOR}),children:[u("div",{className:"ButtonWrapper",children:[M8("zoom-in","zoom in","ico/zoom-in.png","zoom-in",!1,void 0,()=>ii.zoomIn()),M8("zoom-out","zoom out","ico/zoom-out.png","zoom-out",!1,void 0,()=>ii.zoomOut()),M8("zoom-fit","fit image to available space","ico/zoom-fit.png","zoom-fit",!1,void 0,()=>ii.setDefaultZoom()),M8("zoom-max","maximum allowed image zoom","ico/zoom-max.png","zoom-max",!1,void 0,()=>ii.setOneForOneZoom())]}),u("div",{className:"ButtonWrapper",children:[M8("image-drag-mode",i?"turn-off image drag mode":"turn-on image drag mode - works only when image is zoomed","ico/hand.png","image-drag-mode",i,void 0,()=>{(i||On.getZoom()!==Jn.MIN_ZOOM)&&t(!i)}),M8("cursor-cross-hair",r?"turn-off cursor cross-hair":"turn-on cursor cross-hair","ico/cross-hair.png","cross-hair",r,void 0,()=>{n(!r)})]}),a&&u("div",{className:"ButtonWrapper",children:[M8("accept-all","accept all proposed detections","ico/accept-all.png","accept-all",!1,void 0,()=>ji.acceptAllSuggestedLabels(Nn.getActiveImageData())),M8("reject-all","reject all proposed detections","ico/reject-all.png","reject-all",!1,void 0,()=>ji.rejectAllSuggestedLabels(Nn.getActiveImageData()))]})]})}),$8=$e(e=>({windowSize:e.general.windowSize,activeImageIndex:e.labels.activeImageIndex,imagesData:e.labels.imagesData,activeContext:e.general.activeContext,projectType:e.general.projectData.type}))(({windowSize:e,activeImageIndex:t,imagesData:i,activeContext:r,projectType:s})=>{const[a,l]=n.exports.useState(!0),[c,h]=n.exports.useState({currentTime:0,duration:0,isPlaying:!1,frameRate:30}),p=n.exports.useRef(null),f=()=>{if(e){const t=a?We.SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX:We.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX;return{width:e.width-t,height:e.height-We.TOP_NAVIGATION_BAR_HEIGHT_PX-We.EDITOR_BOTTOM_NAVIGATION_BAR_HEIGHT_PX-We.EDITOR_TOP_NAVIGATION_BAR_HEIGHT_PX}}return null},m=()=>{a?a&&r===bn.RIGHT_NAVBAR&&_i.restoreCtx():_i.switchCtx(bn.RIGHT_NAVBAR),l(!a)},g=()=>{p.current&&p.current.togglePlay&&p.current.togglePlay()},b=e=>{p.current&&p.current.stepFrame&&p.current.stepFrame(e)},y=e=>{p.current&&p.current.stepSeconds&&p.current.stepSeconds(e)},v=e=>{p.current&&p.current.jumpToTime&&p.current.jumpToTime(e)};return u("div",{className:"EditorContainer",children:[u("div",{className:"EditorWrapper",onMouseDown:()=>_i.switchCtx(bn.EDITOR),children:[s===ri.OBJECT_DETECTION&&o(F8,{},"editor-top-navigation-bar"),o(S3,{ref:p,size:f(),imageData:i[t],onVideoStateChange:e=>{h(e)},onTogglePlay:g,onStepFrame:b,onStepSeconds:y,onJumpToTime:v},"editor"),o(D8,{size:f(),currentTime:c.currentTime,duration:c.duration,isPlaying:c.isPlaying,frameRate:c.frameRate,onTogglePlay:g,onStepFrame:b,onStepSeconds:y,onJumpToTime:e=>v(e.toString())},"editor-bottom-navigation-bar")]},"editor-wrapper"),o(XG,{direction:Ge.RIGHT,isOpen:a,isWithContext:r===bn.RIGHT_NAVBAR,renderCompanion:()=>o(d,{children:o(KG,{label:"Labels",image:"/ico/tags.png",imageAlt:"labels",onClick:m,isActive:a})}),renderContent:()=>o(qG,{})},"right-side-navigation-bar")]})}),B8=$e(e=>({imagesData:e.labels.imagesData,activeLabelType:e.labels.activeLabelType}),{})(({imagesData:e,activeLabelType:t})=>{const n=e.reduce((e,t)=>e+(t.labelPoints.length>0?1:0),0),i=e.reduce((e,t)=>e+(t.labelRects.length>0?1:0),0),r=e.reduce((e,t)=>e+(t.labelPolygons.length>0?1:0),0),s=e.reduce((e,t)=>e+(t.labelLines.length>0?1:0),0),a=e.reduce((e,t)=>e+(0!==t.labelNameIds.length?1:0),0);return o("div",{className:"StateBar",children:o("div",{style:{width:(()=>{switch(t){case je.POINT:return 100*n/e.length;case je.RECT:return 100*i/e.length;case je.POLYGON:return 100*r/e.length;case je.LINE:return 100*s/e.length;case je.VIDEO_RECOGNITION:return 100*a/e.length;default:return 0}})()+"%"},className:"done"})})}),z8=$e(e=>({}),{updatePreventCustomCursorStatusAction:Tn})(({updatePreventCustomCursorStatusAction:e})=>{const[t,i]=n.exports.useState(null),[r,s]=n.exports.useState(null),a=t=>{e(!0)},l=t=>{e(!1)},c=e=>{e.target.classList.contains("DropDownMenuTab")||e.target.classList.contains("DropDownMenuContentOption")||(i(null),document.removeEventListener(Pn.MOUSE_DOWN,c))},h=(t,n)=>()=>{n||(t&&t(),i(null),e(!1),document.removeEventListener(Pn.MOUSE_DOWN,c))},p=(e,n)=>{return u("div",{className:(r=n,C("DropDownMenuTab",{active:r===t})),onClick:e=>((e,n)=>{null===t&&document.addEventListener(Pn.MOUSE_DOWN,c),t===e?(i(null),s(null)):(i(e),s({x:n.target.offsetLeft,y:35}))})(n,e),onMouseEnter:e=>((e,n)=>{null!==t&&t!==e&&(i(e),s({x:n.target.offsetLeft,y:35}))})(n,e),children:[o("img",{draggable:!1,src:e.imageSrc,alt:e.imageAlt}),e.name]},n);var r};return o("div",{className:"DropDownMenuWrapper",children:u(d,{children:[ir.map((e,t)=>p(e,t)),(e=>{if(null!==t){const t={top:35,left:r.x,height:40*e.children.length+10};return o("div",{className:"DropDownMenuContent",style:t,onMouseEnter:a,onMouseLeave:l,children:e.children.map((e,t)=>{return u("div",{className:(n=e.disabled,C("DropDownMenuContentOption",{active:!n})),onClick:h(e.onClick,e.disabled),children:[o("div",{className:"Marker"}),o("img",{src:e.imageSrc,alt:e.imageAlt}),e.name]},t);var n})})}return null})(ir[t])]})})}),U8=$e(e=>({projectData:e.general.projectData}),{updateActivePopupTypeAction:yn,updateProjectDataAction:Sn})(e=>u("div",{className:"TopNavigationBar",children:[o(B8,{}),u("div",{className:"TopNavigationBarWrapper",children:[o("div",{className:"NavigationBarGroupWrapper",children:u("div",{className:"Header",onClick:()=>e.updateActivePopupTypeAction(Ve.EXIT_PROJECT),children:[o("img",{draggable:!1,alt:"make-sense",src:"/make-sense-ico-transparent.png"}),"Make Sense"]})}),o("div",{className:"NavigationBarGroupWrapper",children:o(z8,{})}),u("div",{className:"NavigationBarGroupWrapper middle",children:[o("div",{className:"ProjectName",children:"Project Name:"}),o(nr,{isPassword:!1,value:e.projectData.name,onChange:t=>{const n=t.target.value.toLowerCase().replace(" ","-");e.updateProjectDataAction({...e.projectData,name:n})},onFocus:e=>{e.target.setSelectionRange(0,e.target.value.length)}})]}),o("div",{className:"NavigationBarGroupWrapper",children:o(ki,{image:"ico/github-logo.png",imageAlt:"github-logo.png",buttonSize:{width:30,height:30},href:We.GITHUB_URL})})]})]})),G8=$e(e=>({activePopupType:e.general.activePopupType}))(({activePopupType:e})=>u("div",{className:C("EditorView",{withPopup:!!e}),draggable:!1,children:[o(U8,{}),o($8,{})]})),V8=$e(e=>({projectType:On.getProjectType(),windowSize:On.getWindowSize(),isObjectDetectorLoaded:On.isObjectDetectorLoaded(),isPoseDetectionLoaded:On.isPoseDetectionLoaded(),isYOLOV5ObjectDetectorLoaded:On.isYOLOV5ObjectDetectorLoaded(),roboflowAPIDetails:On.getRoboflowAPIDetails()}))(({projectType:e,windowSize:t,isObjectDetectorLoaded:n,isPoseDetectionLoaded:i,isYOLOV5ObjectDetectorLoaded:r,roboflowAPIDetails:s})=>{const a=n||i||r||""!==s.model&&""!==s.key&&s.status;return u("div",{className:C("App",{AI:a}),draggable:!1,children:[zi.mobileDeviceData.manufacturer&&zi.mobileDeviceData.os?o(PG,{}):e?t.height<We.EDITOR_MIN_HEIGHT||t.width<We.EDITOR_MIN_WIDTH?o(DG,{}):e===ri.VIDEO||e===ri.VIDEO_RECOGNITION?o(G8,{}):o(ar,{}):o(ds,{}),o(NG,{}),o(LG,{})]})});function H8(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var W8="function"==typeof Symbol&&Symbol.observable||"@@observable",j8=function(){return Math.random().toString(36).substring(7).split("").join(".")},q8={INIT:"@@redux/INIT"+j8(),REPLACE:"@@redux/REPLACE"+j8(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+j8()}};function X8(e,t,n){var i;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(H8(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(H8(1));return n(X8)(e,t)}if("function"!=typeof e)throw new Error(H8(2));var r=e,s=t,a=[],o=a,l=!1;function c(){o===a&&(o=a.slice())}function u(){if(l)throw new Error(H8(3));return s}function d(e){if("function"!=typeof e)throw new Error(H8(4));if(l)throw new Error(H8(5));var t=!0;return c(),o.push(e),function(){if(t){if(l)throw new Error(H8(6));t=!1,c();var n=o.indexOf(e);o.splice(n,1),a=null}}}function h(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error(H8(7));if(void 0===e.type)throw new Error(H8(8));if(l)throw new Error(H8(9));try{l=!0,s=r(s,e)}finally{l=!1}for(var t=a=o,n=0;n<t.length;n++){(0,t[n])()}return e}return h({type:q8.INIT}),(i={dispatch:h,subscribe:d,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(H8(10));r=e,h({type:q8.REPLACE})}})[W8]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(H8(11));function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[W8]=function(){return this},e},i}const K8={activeImageIndex:null,activeLabelNameId:null,activeLabelType:null,activeLabelId:null,highlightedLabelId:null,imagesData:[],firstLabelCreatedFlag:!1,labels:[]};const Y8={windowSize:null,activePopupType:null,customCursorStyle:Rn.DEFAULT,activeContext:null,preventCustomCursor:!1,imageDragMode:!1,crossHairVisible:!0,enablePerClassColoration:!0,projectData:{type:null,name:"my-project-name"},zoom:Jn.MIN_ZOOM,jumpToFrameIndex:null};const Z8={suggestedLabelList:[],rejectedSuggestedLabelList:[],isSSDObjectDetectorLoaded:!1,isYOLOV5ObjectDetectorLoaded:!1,isPoseDetectorLoaded:!1,roboflowAPIDetails:{status:!1,model:"",key:""},isAIDisabled:!1};const Q8={queue:[]};const J8=function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++){var r=t[i];"function"==typeof e[r]&&(n[r]=e[r])}var s,a=Object.keys(n);try{!function(e){Object.keys(e).forEach(function(t){var n=e[t];if(void 0===n(void 0,{type:q8.INIT}))throw new Error(H8(12));if(void 0===n(void 0,{type:q8.PROBE_UNKNOWN_ACTION()}))throw new Error(H8(13))})}(n)}catch(r6){s=r6}return function(e,t){if(void 0===e&&(e={}),s)throw s;for(var i=!1,r={},o=0;o<a.length;o++){var l=a[o],c=n[l],u=e[l],d=c(u,t);if(void 0===d)throw t&&t.type,new Error(H8(14));r[l]=d,i=i||d!==u}return(i=i||a.length!==Object.keys(e).length)?r:e}}({general:function(e=Y8,t){switch(t.type){case en.UPDATE_WINDOW_SIZE:return{...e,windowSize:t.payload.windowSize};case en.UPDATE_ACTIVE_POPUP_TYPE:return{...e,activePopupType:t.payload.activePopupType};case en.UPDATE_CUSTOM_CURSOR_STYLE:return{...e,customCursorStyle:t.payload.customCursorStyle};case en.UPDATE_CONTEXT:return{...e,activeContext:t.payload.activeContext};case en.UPDATE_PREVENT_CUSTOM_CURSOR_STATUS:return{...e,preventCustomCursor:t.payload.preventCustomCursor};case en.UPDATE_IMAGE_DRAG_MODE_STATUS:return{...e,imageDragMode:t.payload.imageDragMode};case en.UPDATE_CROSS_HAIR_VISIBLE_STATUS:return{...e,crossHairVisible:t.payload.crossHairVisible};case en.UPDATE_PROJECT_DATA:return{...e,projectData:t.payload.projectData};case en.UPDATE_ZOOM:return{...e,zoom:t.payload.zoom};case en.UPDATE_ENABLE_PER_CLASS_COLORATION_STATUS:return{...e,enablePerClassColoration:t.payload.enablePerClassColoration};case en.JUMP_TO_FRAME:return{...e,jumpToFrameIndex:t.payload.frameIndex};default:return e}},labels:function(e=K8,t){switch(t.type){case en.UPDATE_ACTIVE_IMAGE_INDEX:return{...e,activeImageIndex:t.payload.activeImageIndex};case en.UPDATE_ACTIVE_LABEL_NAME_ID:return{...e,activeLabelNameId:t.payload.activeLabelNameId};case en.UPDATE_ACTIVE_LABEL_ID:return{...e,activeLabelId:t.payload.activeLabelId};case en.UPDATE_HIGHLIGHTED_LABEL_ID:return{...e,highlightedLabelId:t.payload.highlightedLabelId};case en.UPDATE_ACTIVE_LABEL_TYPE:return{...e,activeLabelType:t.payload.activeLabelType};case en.UPDATE_IMAGE_DATA_BY_ID:return{...e,imagesData:e.imagesData.map(e=>e.id===t.payload.id?t.payload.newImageData:e)};case en.ADD_IMAGES_DATA:return{...e,imagesData:e.imagesData.concat(t.payload.imageData)};case en.UPDATE_IMAGES_DATA:return{...e,imagesData:t.payload.imageData};case en.UPDATE_LABEL_NAMES:return{...e,labels:t.payload.labels};case en.UPDATE_FIRST_LABEL_CREATED_FLAG:return{...e,firstLabelCreatedFlag:t.payload.firstLabelCreatedFlag};default:return e}},ai:function(e=Z8,t){switch(t.type){case en.UPDATE_SUGGESTED_LABEL_LIST:return{...e,suggestedLabelList:t.payload.labelList};case en.UPDATE_REJECTED_SUGGESTED_LABEL_LIST:return{...e,rejectedSuggestedLabelList:t.payload.labelList};case en.UPDATE_SSD_OBJECT_DETECTOR_STATUS:return{...e,isSSDObjectDetectorLoaded:t.payload.isSSDObjectDetectorLoaded};case en.UPDATE_YOLO_V5_OBJECT_DETECTOR_STATUS:return{...e,isYOLOV5ObjectDetectorLoaded:t.payload.isYOLOV5ObjectDetectorLoaded};case en.UPDATE_POSE_DETECTOR_STATUS:return{...e,isPoseDetectorLoaded:t.payload.isPoseDetectorLoaded};case en.UPDATE_DISABLED_AI_FLAG:return{...e,isAIDisabled:t.payload.isAIDisabled};case en.UPDATE_ROBOFLOW_API_DETAILS:return{...e,roboflowAPIDetails:t.payload.roboflowAPIDetails};default:return e}},notifications:function(e=Q8,t){switch(t.type){case en.SUBMIT_NEW_NOTIFICATION:return e.queue.length>0&&e.queue.at(-1).type===t.payload.notification.type?e:{...e,queue:[...e.queue,t.payload.notification]};case en.DELETE_NOTIFICATION_BY_ID:return{...e,queue:e.queue.filter(e=>e.id!==t.payload.id)};default:return e}}});class e6{static isDev(){return!1}static isProd(){return!0}}const t6=class{static inti(){t6.handleResize(),t6.detectDeviceParams(),t6.handleAccidentalPageExit(),window.addEventListener(Pn.RESIZE,t6.handleResize),window.addEventListener(Pn.MOUSE_WHEEL,t6.disableGenericScrollZoom,{passive:!1}),window.addEventListener(Pn.KEY_DOWN,t6.disableUnwantedKeyBoardBehaviour),window.addEventListener(Pn.KEY_PRESS,t6.disableUnwantedKeyBoardBehaviour),_i.init()}};let n6=t6;t(n6,"handleAccidentalPageExit",()=>{window.onbeforeunload=e=>{null!=On.getProjectType()&&e6.isProd()&&(e.preventDefault(),e.returnValue="")}}),t(n6,"handleResize",()=>{var e;i6.dispatch((e={width:window.innerWidth,height:window.innerHeight},{type:en.UPDATE_WINDOW_SIZE,payload:{windowSize:e}}))}),t(n6,"disableUnwantedKeyBoardBehaviour",e=>{["=","+","-"].includes(e.key)&&(e.ctrlKey||zi.isMac&&e.metaKey)&&e.preventDefault()}),t(n6,"disableGenericScrollZoom",e=>{(e.ctrlKey||zi.isMac&&e.metaKey)&&e.preventDefault()}),t(n6,"detectDeviceParams",()=>{const e=window.navigator.userAgent;zi.mobileDeviceData=gi.getMobileDeviceData(e),zi.isMac=gi.isMac(e),zi.isSafari=gi.isSafari(e),zi.isFirefox=gi.isFirefox(e)});const i6=X8(J8,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());n6.inti();R.createRoot(document.getElementById("root")||document.createElement("div")).render(o(i.StrictMode,{children:o(Be,{store:i6,children:o(V8,{})})}));
